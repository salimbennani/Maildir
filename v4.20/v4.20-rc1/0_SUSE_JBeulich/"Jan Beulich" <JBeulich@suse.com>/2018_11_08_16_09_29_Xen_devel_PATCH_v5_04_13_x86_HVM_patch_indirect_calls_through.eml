Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 09 Nov 2018 00:35:57 -0000
Received: from icoremail.net (unknown [209.85.214.171])
	by mail-app2 (Coremail) with SMTP id by_KCgD3_ws8YORbNixhAQ--.29354S3;
	Fri, 09 Nov 2018 00:11:41 +0800 (CST)
Received: from mail-pl1-f171.google.com (unknown [209.85.214.171])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwAnAT04YORb0oodAA--.10133S3;
	Fri, 09 Nov 2018 00:11:36 +0800 (CST)
Received: by mail-pl1-f171.google.com with SMTP id n4-v6so9753096plp.2
        for <xuliker@zju.edu.cn>; Thu, 08 Nov 2018 08:11:36 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :message-id:date:from:to:references:in-reply-to:mime-version
         :content-disposition:subject:precedence:list-id:list-unsubscribe
         :list-post:list-help:list-subscribe:cc:content-transfer-encoding
         :errors-to:sender;
        bh=1lJ0vVB/ICyWEXhkigFnIeKha48MOXKRU78tR9j3y4A=;
        b=tD6flleshDrrK34UhcdbW2rFPIrlKoNoFs7bCrPrp3BfdlSymHJGm3CI4cns1C/mpZ
         Qnh467Zjgd6oZVpyuabqap2ZSZODYiggF41pl1lLR7yXfhoFZW8gD8S9f9kINS6KcPgU
         re166OQvZoL1ZuQC3vv9MR62lfmqk3uEoQv5QyzZf0dTkXzkVF8BHVGcyYR8nYVvQnWf
         rnmmwgIuJkX8cNiKOoZxVDxkbbS10npuvohTLLe6n5B+pXFvchdZgNa79tuwyv6aLgbB
         UwRw3Lsg6lk64nsVjH6Y18mz8Q66Edkp6yebys2fTpdHAhynmS3ACUYCht7bfWxHDmVp
         Se2Q==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gLXQyvKEVeJObl/YnbEPStiR9tcLtBUmzD/jtBF9HtKx4c03XzQ
	jj3H2zJyt+nEWdhUmkg7mlkThHqDS+vuYIoGkHSRSQMtyj5gR5Y3Ig==
X-Received: by 2002:a17:902:7082:: with SMTP id z2-v6mr5160687plk.78.1541693496155;
        Thu, 08 Nov 2018 08:11:36 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:c304:0:0:0:0 with SMTP id g4-v6csp382166pjt;
        Thu, 8 Nov 2018 08:11:34 -0800 (PST)
X-Google-Smtp-Source: AJdET5cxqJyoNNVRKj/E87yoiCpB0DvDbzHPl6nvNbraTNr8RgyWhWs3k8BpSrxFe+zQxrKrI4Jh
X-Received: by 2002:a25:3d06:: with SMTP id k6-v6mr4847331yba.162.1541693494879;
        Thu, 08 Nov 2018 08:11:34 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1541693494; cv=none;
        d=google.com; s=arc-20160816;
        b=moYvwNFwHmQgVz4n74hS/zaPYRb7wuKMKixcZxSTT9UFjPS/DillGOCuirTHQ9341m
         vrIRwOlkzXV5j9Jrh724Epl4LEjUWX0IA3umP6jPTN2R9qPU18AGY1szwmEBzeoJhb2D
         PA7MkEOoP/G2ovBkECx4uac54qDYsT733CnjkfZ3ltEvXP337EVCIYAYVIlfbV2D++Lr
         /cCMbbvGJm7BtV+SH7XJDb9vTo2ABWjIpf/3CBU3MP4h/AI/2+Eobs0PfifUqA550IjA
         Dyi9TfrDFSSh8HkZsp49Nl3ODZM7B/MHwqPseWdfK0r0woDtzSE37fj15dyu+PcuKz9i
         35Gw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :content-disposition:mime-version:in-reply-to:references:to:from
         :date:message-id;
        bh=1lJ0vVB/ICyWEXhkigFnIeKha48MOXKRU78tR9j3y4A=;
        b=KF+SULaG22NaUofncF2G+0bzKQaEZzy2WuBp2k6XQiy05FhNxELrlOll0Ff2gRJ/BJ
         QqUSa6+HSg6zCXQCxSfR+YxdD7lb0Pps0oPQVMQI/FXkiqNOlrpRMeLMqmEKgxtIinHp
         Pqa+m6aZExy40ZiE+3ruV1ZgOOW/+QOZZnc6bStcDwASHFXOqR5F71bOSEnLJLrshh+q
         0uCpnRW93Y5c+SRPgp8WOKqKJ9MLwxk0Pbf/H0tOz8GmnyMEvZxA4EC4uP0QG8OD+bpE
         5CKK610ll6LhNb4Blk4epS4SiCOj1SgqUc5X3pENsY7Jfhr+HDe224VB3CPC9WnOnLCI
         ZqAA==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id g10-v6si1750610ybc.373.2018.11.08.08.11.27
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Thu, 08 Nov 2018 08:11:34 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gKmsA-0002lH-KG; Thu, 08 Nov 2018 16:09:34 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89)
 (envelope-from <srs0=e9yk=nt=suse.com=jbeulich@srs-us1.protection.inumbo.net>)
 id 1gKms9-0002lB-Af
 for xen-devel@lists.xenproject.org; Thu, 08 Nov 2018 16:09:33 +0000
X-Inumbo-ID: acdc9bce-e370-11e8-8943-12d6303a7972
Received: from prv1-mh.provo.novell.com (unknown [137.65.248.33])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id acdc9bce-e370-11e8-8943-12d6303a7972;
 Thu, 08 Nov 2018 16:09:31 +0000 (UTC)
Received: from INET-PRV1-MTA by prv1-mh.provo.novell.com
 with Novell_GroupWise; Thu, 08 Nov 2018 09:09:30 -0700
Message-Id: <5BE45FB902000078001F9CAC@prv1-mh.provo.novell.com>
X-Mailer: Novell GroupWise Internet Agent 18.0.2 
Date: Thu, 08 Nov 2018 09:09:29 -0700
From: "Jan Beulich" <JBeulich@suse.com>
To: "xen-devel" <xen-devel@lists.xenproject.org>
References: <5B97C28802000078001E7456@prv1-mh.provo.novell.com>
 <5BE45CB602000078001F9C6A@prv1-mh.provo.novell.com>
In-Reply-To: <5BE45CB602000078001F9C6A@prv1-mh.provo.novell.com>
Mime-Version: 1.0
Content-Disposition: inline
Subject: [Xen-devel] [PATCH v5 04/13] x86/HVM: patch indirect calls through
 hvm_funcs to direct ones
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>, Wei Liu <wei.liu2@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwAnAT04YORb0oodAA--.10133S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3Wr18CFWDCw13Gr4rtryxXwb_yoWfWF4Dpa
	1UGF98ua17JF1UXay3ta1UKw1Y9rZrKrykJFZ3Gan0kFW3tFyrtF1kKryav3WSkrs7Z3Wr
	Xw4q9w17u3W7GFJanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlFb7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Ar0_tr1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Cr0_Gr1UM28EF7xvwVC2
	z280aVAFwI0_Gr0_Cr1l84ACjcxK6I8E87Iv6xkF7I0E14v26r4j6r4UJwAa7VCE64xvF2
	IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x082IY
	62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUJVWUGwAv7V
	C2z280aVAFwI0_Jr0_Gr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VWUMxkI7II2jI8vz4vEwIxGrwCYIxAIcVC0I7IYx2IY
	67AKxVW5JVW7JwCYIxAIcVC0I7IYx2IY6xkF7I0E14v26r4j6F4UMxvI42IY6I8E87Iv67
	AKxVW8JVWxJwCYIxAIcVC2z280aVCY1x0267AKxVW8JVW8Jr1l42xK82IYc2Ij64vIr41l
	42xK82IY64kExVAvwVAq07x20xyl4x8a6x804xWl4I8I3I0E4IkC6x0Yz7v_Jr0_Gr1lx2
	IqxVAqx4xG67AKxVWUJVWUGwC20s026x8GjcxK67AKxVWUGVWUWwC2zVAF1VAY17CE14v2
	6r126r1DMIIYrxkI7VAKI48JMIIF0xvE42xK8VAvwI8IcIk0rVW8JVW3JwCE64xvF2IEb7
	IF0Fy7YxBIdaVFxhVjvjDU0xZFpf9x07bDPfLUUUUU=

VGhpcyBpcyBpbnRlbnRpb25hbGx5IG5vdCB0b3VjaGluZyBob29rcyB1c2VkIHJhcmVseSAob3Ig
bm90IGF0IGFsbCkKZHVyaW5nIHRoZSBsaWZldGltZSBvZiBhIFZNLCBsaWtlIHtkb21haW4sdmNw
dX1faW5pdGlhbGlzZSBvciBjcHVfdXAsCmFzIHdlbGwgYXMgbmVzdGVkLCBWTSBldmVudCwgYW5k
IGFsdHAybSBvbmVzICh0aGV5IGNhbiBhbGwgYmUgZG9uZQpsYXRlciwgaWYgc28gZGVzaXJlZCku
IFZpcnR1YWwgSW50ZXJydXB0IGRlbGl2ZXJ5IG9uZXMgd2lsbCBiZSBkZWFsdAp3aXRoIGluIGEg
c3Vic2VxdWVudCBwYXRjaC4KClNpZ25lZC1vZmYtYnk6IEphbiBCZXVsaWNoIDxqYmV1bGljaEBz
dXNlLmNvbT4KUmV2aWV3ZWQtYnk6IFdlaSBMaXUgPHdlaS5saXUyQGNpdHJpeC5jb20+ClJldmll
d2VkLWJ5OiBQYXVsIER1cnJhbnQgPHBhdWwuZHVycmFudEBjaXRyaXguY29tPgpBY2tlZC1ieTog
QW5kcmV3IENvb3BlciA8YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KLS0tCnYzOiBSZS1iYXNl
Lgp2MjogRHJvcCBvcGVuLWNvZGVkIG51bWJlcnMgZnJvbSBtYWNybyBpbnZvY2F0aW9ucy4gUmUt
YmFzZS4KCi0tLSBhL3hlbi9hcmNoL3g4Ni9odm0vZW11bGF0ZS5jCisrKyBiL3hlbi9hcmNoL3g4
Ni9odm0vZW11bGF0ZS5jCkBAIC0yMTAzLDcgKzIxMDMsNyBAQCBzdGF0aWMgaW50IGh2bWVtdWxf
d3JpdGVfbXNyKAogc3RhdGljIGludCBodm1lbXVsX3diaW52ZCgKICAgICBzdHJ1Y3QgeDg2X2Vt
dWxhdGVfY3R4dCAqY3R4dCkKIHsKLSAgICBodm1fZnVuY3Mud2JpbnZkX2ludGVyY2VwdCgpOwor
ICAgIGFsdGVybmF0aXZlX3ZjYWxsKGh2bV9mdW5jcy53YmludmRfaW50ZXJjZXB0KTsKICAgICBy
ZXR1cm4gWDg2RU1VTF9PS0FZOwogfQogCkBAIC0yMTIxLDcgKzIxMjEsNyBAQCBzdGF0aWMgaW50
IGh2bWVtdWxfZ2V0X2ZwdSgKICAgICBzdHJ1Y3QgdmNwdSAqY3VyciA9IGN1cnJlbnQ7CiAKICAg
ICBpZiAoICFjdXJyLT5mcHVfZGlydGllZCApCi0gICAgICAgIGh2bV9mdW5jcy5mcHVfZGlydHlf
aW50ZXJjZXB0KCk7CisgICAgICAgIGFsdGVybmF0aXZlX3ZjYWxsKGh2bV9mdW5jcy5mcHVfZGly
dHlfaW50ZXJjZXB0KTsKICAgICBlbHNlIGlmICggdHlwZSA9PSBYODZFTVVMX0ZQVV9mcHUgKQog
ICAgIHsKICAgICAgICAgY29uc3QgdHlwZW9mKGN1cnItPmFyY2gueHNhdmVfYXJlYS0+ZnB1X3Nz
ZSkgKmZwdV9jdHh0ID0KQEAgLTIyMzgsNyArMjIzOCw3IEBAIHN0YXRpYyB2b2lkIGh2bWVtdWxf
cHV0X2ZwdSgKICAgICAgICAgewogICAgICAgICAgICAgY3Vyci0+ZnB1X2RpcnRpZWQgPSBmYWxz
ZTsKICAgICAgICAgICAgIHN0dHMoKTsKLSAgICAgICAgICAgIGh2bV9mdW5jcy5mcHVfbGVhdmUo
Y3Vycik7CisgICAgICAgICAgICBhbHRlcm5hdGl2ZV92Y2FsbChodm1fZnVuY3MuZnB1X2xlYXZl
LCBjdXJyKTsKICAgICAgICAgfQogICAgIH0KIH0KQEAgLTI0MDAsNyArMjQwMCw4IEBAIHN0YXRp
YyBpbnQgX2h2bV9lbXVsYXRlX29uZShzdHJ1Y3QgaHZtX2UKICAgICBpZiAoIGh2bWVtdWxfY3R4
dC0+aW50cl9zaGFkb3cgIT0gbmV3X2ludHJfc2hhZG93ICkKICAgICB7CiAgICAgICAgIGh2bWVt
dWxfY3R4dC0+aW50cl9zaGFkb3cgPSBuZXdfaW50cl9zaGFkb3c7Ci0gICAgICAgIGh2bV9mdW5j
cy5zZXRfaW50ZXJydXB0X3NoYWRvdyhjdXJyLCBuZXdfaW50cl9zaGFkb3cpOworICAgICAgICBh
bHRlcm5hdGl2ZV92Y2FsbChodm1fZnVuY3Muc2V0X2ludGVycnVwdF9zaGFkb3csCisgICAgICAg
ICAgICAgICAgICAgICAgICAgIGN1cnIsIG5ld19pbnRyX3NoYWRvdyk7CiAgICAgfQogCiAgICAg
aWYgKCBodm1lbXVsX2N0eHQtPmN0eHQucmV0aXJlLmhsdCAmJgpAQCAtMjUzNyw3ICsyNTM4LDgg
QEAgdm9pZCBodm1fZW11bGF0ZV9pbml0X29uY2UoCiAKICAgICBtZW1zZXQoaHZtZW11bF9jdHh0
LCAwLCBzaXplb2YoKmh2bWVtdWxfY3R4dCkpOwogCi0gICAgaHZtZW11bF9jdHh0LT5pbnRyX3No
YWRvdyA9IGh2bV9mdW5jcy5nZXRfaW50ZXJydXB0X3NoYWRvdyhjdXJyKTsKKyAgICBodm1lbXVs
X2N0eHQtPmludHJfc2hhZG93ID0KKyAgICAgICAgYWx0ZXJuYXRpdmVfY2FsbChodm1fZnVuY3Mu
Z2V0X2ludGVycnVwdF9zaGFkb3csIGN1cnIpOwogICAgIGh2bWVtdWxfZ2V0X3NlZ19yZWcoeDg2
X3NlZ19jcywgaHZtZW11bF9jdHh0KTsKICAgICBodm1lbXVsX2dldF9zZWdfcmVnKHg4Nl9zZWdf
c3MsIGh2bWVtdWxfY3R4dCk7CiAKLS0tIGEveGVuL2FyY2gveDg2L2h2bS9odm0uYworKysgYi94
ZW4vYXJjaC94ODYvaHZtL2h2bS5jCkBAIC0yNzIsMTIgKzI3MiwxMiBAQCB2b2lkIGh2bV9zZXRf
cmR0c2NfZXhpdGluZyhzdHJ1Y3QgZG9tYWluCiAgICAgc3RydWN0IHZjcHUgKnY7CiAKICAgICBm
b3JfZWFjaF92Y3B1ICggZCwgdiApCi0gICAgICAgIGh2bV9mdW5jcy5zZXRfcmR0c2NfZXhpdGlu
Zyh2LCBlbmFibGUpOworICAgICAgICBhbHRlcm5hdGl2ZV92Y2FsbChodm1fZnVuY3Muc2V0X3Jk
dHNjX2V4aXRpbmcsIHYsIGVuYWJsZSk7CiB9CiAKIHZvaWQgaHZtX2dldF9ndWVzdF9wYXQoc3Ry
dWN0IHZjcHUgKnYsIHU2NCAqZ3Vlc3RfcGF0KQogewotICAgIGlmICggIWh2bV9mdW5jcy5nZXRf
Z3Vlc3RfcGF0KHYsIGd1ZXN0X3BhdCkgKQorICAgIGlmICggIWFsdGVybmF0aXZlX2NhbGwoaHZt
X2Z1bmNzLmdldF9ndWVzdF9wYXQsIHYsIGd1ZXN0X3BhdCkgKQogICAgICAgICAqZ3Vlc3RfcGF0
ID0gdi0+YXJjaC5odm0ucGF0X2NyOwogfQogCkBAIC0zMDIsNyArMzAyLDcgQEAgaW50IGh2bV9z
ZXRfZ3Vlc3RfcGF0KHN0cnVjdCB2Y3B1ICp2LCB1NgogICAgICAgICAgICAgcmV0dXJuIDA7CiAg
ICAgICAgIH0KIAotICAgIGlmICggIWh2bV9mdW5jcy5zZXRfZ3Vlc3RfcGF0KHYsIGd1ZXN0X3Bh
dCkgKQorICAgIGlmICggIWFsdGVybmF0aXZlX2NhbGwoaHZtX2Z1bmNzLnNldF9ndWVzdF9wYXQs
IHYsIGd1ZXN0X3BhdCkgKQogICAgICAgICB2LT5hcmNoLmh2bS5wYXRfY3IgPSBndWVzdF9wYXQ7
CiAKICAgICByZXR1cm4gMTsKQEAgLTM0Miw3ICszNDIsNyBAQCBib29sIGh2bV9zZXRfZ3Vlc3Rf
Ym5kY2ZncyhzdHJ1Y3QgdmNwdSAqCiAgICAgICAgICAgICAvKiBub3RoaW5nLCBiZXN0IGVmZm9y
dCBvbmx5ICovOwogICAgIH0KIAotICAgIHJldHVybiBodm1fZnVuY3Muc2V0X2d1ZXN0X2JuZGNm
Z3ModiwgdmFsKTsKKyAgICByZXR1cm4gYWx0ZXJuYXRpdmVfY2FsbChodm1fZnVuY3Muc2V0X2d1
ZXN0X2JuZGNmZ3MsIHYsIHZhbCk7CiB9CiAKIC8qCkBAIC01MDAsNyArNTAwLDggQEAgdm9pZCBo
dm1fbWlncmF0ZV9waXJxcyhzdHJ1Y3QgdmNwdSAqdikKIHN0YXRpYyBib29sIGh2bV9nZXRfcGVu
ZGluZ19ldmVudChzdHJ1Y3QgdmNwdSAqdiwgc3RydWN0IHg4Nl9ldmVudCAqaW5mbykKIHsKICAg
ICBpbmZvLT5jcjIgPSB2LT5hcmNoLmh2bS5ndWVzdF9jclsyXTsKLSAgICByZXR1cm4gaHZtX2Z1
bmNzLmdldF9wZW5kaW5nX2V2ZW50KHYsIGluZm8pOworCisgICAgcmV0dXJuIGFsdGVybmF0aXZl
X2NhbGwoaHZtX2Z1bmNzLmdldF9wZW5kaW5nX2V2ZW50LCB2LCBpbmZvKTsKIH0KIAogdm9pZCBo
dm1fZG9fcmVzdW1lKHN0cnVjdCB2Y3B1ICp2KQpAQCAtMTY1OSw3ICsxNjYwLDcgQEAgdm9pZCBo
dm1faW5qZWN0X2V2ZW50KGNvbnN0IHN0cnVjdCB4ODZfZQogICAgICAgICB9CiAgICAgfQogCi0g
ICAgaHZtX2Z1bmNzLmluamVjdF9ldmVudChldmVudCk7CisgICAgYWx0ZXJuYXRpdmVfdmNhbGwo
aHZtX2Z1bmNzLmluamVjdF9ldmVudCwgZXZlbnQpOwogfQogCiBpbnQgaHZtX2hhcF9uZXN0ZWRf
cGFnZV9mYXVsdChwYWRkcl90IGdwYSwgdW5zaWduZWQgbG9uZyBnbGEsCkBAIC0yMjQ2LDcgKzIy
NDcsNyBAQCBpbnQgaHZtX3NldF9jcjAodW5zaWduZWQgbG9uZyB2YWx1ZSwgYm9vCiAgICAgICAg
ICAoIXJhbmdlc2V0X2lzX2VtcHR5KGQtPmlvbWVtX2NhcHMpIHx8CiAgICAgICAgICAgIXJhbmdl
c2V0X2lzX2VtcHR5KGQtPmFyY2guaW9wb3J0X2NhcHMpIHx8CiAgICAgICAgICAgaGFzX2FyY2hf
cGRldnMoZCkpICkKLSAgICAgICAgaHZtX2Z1bmNzLmhhbmRsZV9jZCh2LCB2YWx1ZSk7CisgICAg
ICAgIGFsdGVybmF0aXZlX3ZjYWxsKGh2bV9mdW5jcy5oYW5kbGVfY2QsIHYsIHZhbHVlKTsKIAog
ICAgIGh2bV91cGRhdGVfY3IodiwgMCwgdmFsdWUpOwogCkBAIC0zNDczLDcgKzM0NzQsOCBAQCBp
bnQgaHZtX21zcl9yZWFkX2ludGVyY2VwdCh1bnNpZ25lZCBpbnQKICAgICAgICAgICAgIGdvdG8g
Z3BfZmF1bHQ7CiAgICAgICAgIC8qIElmIHJldCA9PSAwIHRoZW4gdGhpcyBpcyBub3QgYW4gTUNF
IE1TUiwgc2VlIG90aGVyIE1TUnMuICovCiAgICAgICAgIHJldCA9ICgocmV0ID09IDApCi0gICAg
ICAgICAgICAgICA/IGh2bV9mdW5jcy5tc3JfcmVhZF9pbnRlcmNlcHQobXNyLCBtc3JfY29udGVu
dCkKKyAgICAgICAgICAgICAgID8gYWx0ZXJuYXRpdmVfY2FsbChodm1fZnVuY3MubXNyX3JlYWRf
aW50ZXJjZXB0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zciwgbXNyX2Nv
bnRlbnQpCiAgICAgICAgICAgICAgICA6IFg4NkVNVUxfT0tBWSk7CiAgICAgICAgIGJyZWFrOwog
ICAgIH0KQEAgLTM2MzMsNyArMzYzNSw4IEBAIGludCBodm1fbXNyX3dyaXRlX2ludGVyY2VwdCh1
bnNpZ25lZCBpbnQKICAgICAgICAgICAgIGdvdG8gZ3BfZmF1bHQ7CiAgICAgICAgIC8qIElmIHJl
dCA9PSAwIHRoZW4gdGhpcyBpcyBub3QgYW4gTUNFIE1TUiwgc2VlIG90aGVyIE1TUnMuICovCiAg
ICAgICAgIHJldCA9ICgocmV0ID09IDApCi0gICAgICAgICAgICAgICA/IGh2bV9mdW5jcy5tc3Jf
d3JpdGVfaW50ZXJjZXB0KG1zciwgbXNyX2NvbnRlbnQpCisgICAgICAgICAgICAgICA/IGFsdGVy
bmF0aXZlX2NhbGwoaHZtX2Z1bmNzLm1zcl93cml0ZV9pbnRlcmNlcHQsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgbXNyLCBtc3JfY29udGVudCkKICAgICAgICAgICAgICAgIDog
WDg2RU1VTF9PS0FZKTsKICAgICAgICAgYnJlYWs7CiAgICAgfQpAQCAtMzgyNSw3ICszODI4LDcg
QEAgdm9pZCBodm1faHlwZXJjYWxsX3BhZ2VfaW5pdGlhbGlzZShzdHJ1YwogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpoeXBlcmNhbGxfcGFnZSkKIHsKICAgICBodm1f
bGF0Y2hfc2hpbmZvX3NpemUoZCk7Ci0gICAgaHZtX2Z1bmNzLmluaXRfaHlwZXJjYWxsX3BhZ2Uo
ZCwgaHlwZXJjYWxsX3BhZ2UpOworICAgIGFsdGVybmF0aXZlX3ZjYWxsKGh2bV9mdW5jcy5pbml0
X2h5cGVyY2FsbF9wYWdlLCBkLCBoeXBlcmNhbGxfcGFnZSk7CiB9CiAKIHZvaWQgaHZtX3ZjcHVf
cmVzZXRfc3RhdGUoc3RydWN0IHZjcHUgKnYsIHVpbnQxNl90IGNzLCB1aW50MTZfdCBpcCkKQEAg
LTUwMzEsNyArNTAzNCw3IEBAIHZvaWQgaHZtX2RvbWFpbl9zb2Z0X3Jlc2V0KHN0cnVjdCBkb21h
aW4KIHZvaWQgaHZtX2dldF9zZWdtZW50X3JlZ2lzdGVyKHN0cnVjdCB2Y3B1ICp2LCBlbnVtIHg4
Nl9zZWdtZW50IHNlZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBzZWdt
ZW50X3JlZ2lzdGVyICpyZWcpCiB7Ci0gICAgaHZtX2Z1bmNzLmdldF9zZWdtZW50X3JlZ2lzdGVy
KHYsIHNlZywgcmVnKTsKKyAgICBhbHRlcm5hdGl2ZV92Y2FsbChodm1fZnVuY3MuZ2V0X3NlZ21l
bnRfcmVnaXN0ZXIsIHYsIHNlZywgcmVnKTsKIAogICAgIHN3aXRjaCAoIHNlZyApCiAgICAgewpA
QCAtNTE3Nyw3ICs1MTgwLDcgQEAgdm9pZCBodm1fc2V0X3NlZ21lbnRfcmVnaXN0ZXIoc3RydWN0
IHZjcAogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgaHZtX2Z1bmNzLnNldF9zZWdtZW50
X3JlZ2lzdGVyKHYsIHNlZywgcmVnKTsKKyAgICBhbHRlcm5hdGl2ZV92Y2FsbChodm1fZnVuY3Mu
c2V0X3NlZ21lbnRfcmVnaXN0ZXIsIHYsIHNlZywgcmVnKTsKIH0KIAogLyoKLS0tIGEveGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9odm0vaHZtLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vaHZt
LmgKQEAgLTM4OCw0MiArMzg4LDQyIEBAIHN0YXRpYyBpbmxpbmUgaW50CiBodm1fZ3Vlc3RfeDg2
X21vZGUoc3RydWN0IHZjcHUgKnYpCiB7CiAgICAgQVNTRVJUKHYgPT0gY3VycmVudCk7Ci0gICAg
cmV0dXJuIGh2bV9mdW5jcy5ndWVzdF94ODZfbW9kZSh2KTsKKyAgICByZXR1cm4gYWx0ZXJuYXRp
dmVfY2FsbChodm1fZnVuY3MuZ3Vlc3RfeDg2X21vZGUsIHYpOwogfQogCiBzdGF0aWMgaW5saW5l
IHZvaWQKIGh2bV91cGRhdGVfaG9zdF9jcjMoc3RydWN0IHZjcHUgKnYpCiB7CiAgICAgaWYgKCBo
dm1fZnVuY3MudXBkYXRlX2hvc3RfY3IzICkKLSAgICAgICAgaHZtX2Z1bmNzLnVwZGF0ZV9ob3N0
X2NyMyh2KTsKKyAgICAgICAgYWx0ZXJuYXRpdmVfdmNhbGwoaHZtX2Z1bmNzLnVwZGF0ZV9ob3N0
X2NyMywgdik7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBodm1fdXBkYXRlX2d1ZXN0X2NyKHN0
cnVjdCB2Y3B1ICp2LCB1bnNpZ25lZCBpbnQgY3IpCiB7Ci0gICAgaHZtX2Z1bmNzLnVwZGF0ZV9n
dWVzdF9jcih2LCBjciwgMCk7CisgICAgYWx0ZXJuYXRpdmVfdmNhbGwoaHZtX2Z1bmNzLnVwZGF0
ZV9ndWVzdF9jciwgdiwgY3IsIDApOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgaHZtX3VwZGF0
ZV9ndWVzdF9jcjMoc3RydWN0IHZjcHUgKnYsIGJvb2wgbm9mbHVzaCkKIHsKICAgICB1bnNpZ25l
ZCBpbnQgZmxhZ3MgPSBub2ZsdXNoID8gSFZNX1VQREFURV9HVUVTVF9DUjNfTk9GTFVTSCA6IDA7
CiAKLSAgICBodm1fZnVuY3MudXBkYXRlX2d1ZXN0X2NyKHYsIDMsIGZsYWdzKTsKKyAgICBhbHRl
cm5hdGl2ZV92Y2FsbChodm1fZnVuY3MudXBkYXRlX2d1ZXN0X2NyLCB2LCAzLCBmbGFncyk7CiB9
CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBodm1fdXBkYXRlX2d1ZXN0X2VmZXIoc3RydWN0IHZjcHUg
KnYpCiB7Ci0gICAgaHZtX2Z1bmNzLnVwZGF0ZV9ndWVzdF9lZmVyKHYpOworICAgIGFsdGVybmF0
aXZlX3ZjYWxsKGh2bV9mdW5jcy51cGRhdGVfZ3Vlc3RfZWZlciwgdik7CiB9CiAKIHN0YXRpYyBp
bmxpbmUgdm9pZCBodm1fY3B1aWRfcG9saWN5X2NoYW5nZWQoc3RydWN0IHZjcHUgKnYpCiB7Ci0g
ICAgaHZtX2Z1bmNzLmNwdWlkX3BvbGljeV9jaGFuZ2VkKHYpOworICAgIGFsdGVybmF0aXZlX3Zj
YWxsKGh2bV9mdW5jcy5jcHVpZF9wb2xpY3lfY2hhbmdlZCwgdik7CiB9CiAKIHN0YXRpYyBpbmxp
bmUgdm9pZCBodm1fc2V0X3RzY19vZmZzZXQoc3RydWN0IHZjcHUgKnYsIHVpbnQ2NF90IG9mZnNl
dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgYXRfdHNj
KQogewotICAgIGh2bV9mdW5jcy5zZXRfdHNjX29mZnNldCh2LCBvZmZzZXQsIGF0X3RzYyk7Cisg
ICAgYWx0ZXJuYXRpdmVfdmNhbGwoaHZtX2Z1bmNzLnNldF90c2Nfb2Zmc2V0LCB2LCBvZmZzZXQs
IGF0X3RzYyk7CiB9CiAKIC8qCkBAIC00NDAsMTggKzQ0MCwxOCBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgaHZtX2ZsdXNoX2d1ZXN0X3RsYnMoCiBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludAogaHZt
X2dldF9jcGwoc3RydWN0IHZjcHUgKnYpCiB7Ci0gICAgcmV0dXJuIGh2bV9mdW5jcy5nZXRfY3Bs
KHYpOworICAgIHJldHVybiBhbHRlcm5hdGl2ZV9jYWxsKGh2bV9mdW5jcy5nZXRfY3BsLCB2KTsK
IH0KIAogc3RhdGljIGlubGluZSB1bnNpZ25lZCBsb25nIGh2bV9nZXRfc2hhZG93X2dzX2Jhc2Uo
c3RydWN0IHZjcHUgKnYpCiB7Ci0gICAgcmV0dXJuIGh2bV9mdW5jcy5nZXRfc2hhZG93X2dzX2Jh
c2Uodik7CisgICAgcmV0dXJuIGFsdGVybmF0aXZlX2NhbGwoaHZtX2Z1bmNzLmdldF9zaGFkb3df
Z3NfYmFzZSwgdik7CiB9CiAKIHN0YXRpYyBpbmxpbmUgYm9vbCBodm1fZ2V0X2d1ZXN0X2JuZGNm
Z3Moc3RydWN0IHZjcHUgKnYsIHU2NCAqdmFsKQogewogICAgIHJldHVybiBodm1fZnVuY3MuZ2V0
X2d1ZXN0X2JuZGNmZ3MgJiYKLSAgICAgICAgICAgaHZtX2Z1bmNzLmdldF9ndWVzdF9ibmRjZmdz
KHYsIHZhbCk7CisgICAgICAgICAgIGFsdGVybmF0aXZlX2NhbGwoaHZtX2Z1bmNzLmdldF9ndWVz
dF9ibmRjZmdzLCB2LCB2YWwpOwogfQogCiAjZGVmaW5lIGhhc19odm1fcGFyYW1zKGQpIFwKQEAg
LTUwOCwxMiArNTA4LDEyIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBodm1faW5qZWN0X3BhZ2VfZmF1
bHQKIAogc3RhdGljIGlubGluZSBpbnQgaHZtX2V2ZW50X3BlbmRpbmcoc3RydWN0IHZjcHUgKnYp
CiB7Ci0gICAgcmV0dXJuIGh2bV9mdW5jcy5ldmVudF9wZW5kaW5nKHYpOworICAgIHJldHVybiBh
bHRlcm5hdGl2ZV9jYWxsKGh2bV9mdW5jcy5ldmVudF9wZW5kaW5nLCB2KTsKIH0KIAogc3RhdGlj
IGlubGluZSB2b2lkIGh2bV9pbnZscGcoc3RydWN0IHZjcHUgKnYsIHVuc2lnbmVkIGxvbmcgbGlu
ZWFyKQogewotICAgIGh2bV9mdW5jcy5pbnZscGcodiwgbGluZWFyKTsKKyAgICBhbHRlcm5hdGl2
ZV92Y2FsbChodm1fZnVuY3MuaW52bHBnLCB2LCBsaW5lYXIpOwogfQogCiAvKiBUaGVzZSBiaXRz
IGluIENSNCBhcmUgb3duZWQgYnkgdGhlIGhvc3QuICovCkBAIC01MzgsMTMgKzUzOCwxNCBAQCBz
dGF0aWMgaW5saW5lIHZvaWQgaHZtX2NwdV9kb3duKHZvaWQpCiAKIHN0YXRpYyBpbmxpbmUgdW5z
aWduZWQgaW50IGh2bV9nZXRfaW5zbl9ieXRlcyhzdHJ1Y3QgdmNwdSAqdiwgdWludDhfdCAqYnVm
KQogewotICAgIHJldHVybiAoaHZtX2Z1bmNzLmdldF9pbnNuX2J5dGVzID8gaHZtX2Z1bmNzLmdl
dF9pbnNuX2J5dGVzKHYsIGJ1ZikgOiAwKTsKKyAgICByZXR1cm4gKGh2bV9mdW5jcy5nZXRfaW5z
bl9ieXRlcworICAgICAgICAgICAgPyBhbHRlcm5hdGl2ZV9jYWxsKGh2bV9mdW5jcy5nZXRfaW5z
bl9ieXRlcywgdiwgYnVmKSA6IDApOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgaHZtX3NldF9p
bmZvX2d1ZXN0KHN0cnVjdCB2Y3B1ICp2KQogewogICAgIGlmICggaHZtX2Z1bmNzLnNldF9pbmZv
X2d1ZXN0ICkKLSAgICAgICAgcmV0dXJuIGh2bV9mdW5jcy5zZXRfaW5mb19ndWVzdCh2KTsKKyAg
ICAgICAgYWx0ZXJuYXRpdmVfdmNhbGwoaHZtX2Z1bmNzLnNldF9pbmZvX2d1ZXN0LCB2KTsKIH0K
IAogc3RhdGljIGlubGluZSB2b2lkIGh2bV9pbnZhbGlkYXRlX3JlZ3NfZmllbGRzKHN0cnVjdCBj
cHVfdXNlcl9yZWdzICpyZWdzKQoKCgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVu
cHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZv
L3hlbi1kZXZlbA==
