Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by i7-8700 with POP3-SSL;
  24 Dec 2018 15:39:39 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga002.fm.intel.com (fmsmga002.fm.intel.com [10.253.24.26])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 5521358050C;
	Thu, 20 Dec 2018 09:42:57 -0800 (PST)
Received: from fmsmga102.fm.intel.com ([10.1.193.69])
  by fmsmga002-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 20 Dec 2018 09:42:57 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AfxBbNhIkiAZzhTdMTtmcpTZWNBhigK39O0sv0rFi?=
 =?us-ascii?q?tYgULv36rarrMEGX3/hxlliBBdydt6oUzbKO+4nbGkU4qa6bt34DdJEeHzQksu?=
 =?us-ascii?q?4x2zIaPcieFEfgJ+TrZSFpVO5LVVti4m3peRMNQJW2aFLduGC94iAPERvjKwV1?=
 =?us-ascii?q?Ov71GonPhMiryuy+4ZLebxlLiTanfb9+MAi9oBnMuMURnYZsMLs6xAHTontPde?=
 =?us-ascii?q?RWxGdoKkyWkh3h+Mq+/4Nt/jpJtf45+MFOTav1f6IjTbxFFzsmKHw65NfqtRbY?=
 =?us-ascii?q?UwSC4GYXX3gMnRpJBwjF6wz6Xov0vyDnuOdxxDWWMMvrRr0vRz+s87lkRwPpiC?=
 =?us-ascii?q?cfNj427mfXitBrjKlGpB6tvgFzz5LIbI2QMvd1Y6HTcs4ARWdZUMhfVzJPDJ6/?=
 =?us-ascii?q?YYsBAOUOIftXoIvzqFsVtRuzBxKhBP/zxjJSmnP6wbc33/onHArb3AIgBdUOsH?=
 =?us-ascii?q?HModjrNKcSS+G1zLLUzTXEd/NW2Sr25orWfRAlpfGNU7NwccXMwkQoFwPKklWQ?=
 =?us-ascii?q?pJfkPzOT2OQNqXKU4Pd+Wu21lmErsQZxoiKgxso1jITCm4Ebykjc+Cln3Io4Ic?=
 =?us-ascii?q?e0RFN1bNK6CpdcqiKXO5dsTs4jQWxkoDs2x7kFtJKhYSQHxpYqywTBZ/CbbYSE?=
 =?us-ascii?q?+A/vWeifLDp+mXlrYqiwhwyo/kil0uD8Vte70FJNriddjNnMuW4C1wbJ5siEVP?=
 =?us-ascii?q?R95EGh1iiL1wzJ7eFEO080mbLaK54n3LEwioIevVrfEiLygkn6kaGbels+9uS1?=
 =?us-ascii?q?6Onrfq/qq56eOoNsjwHxKKUumsixAeQiNQgOWnCW+eC91L3l4E34T6xGjv4ona?=
 =?us-ascii?q?nDtpDVO8Abqre+Aw5b1IYs9Qy/Aiy40NQXg3YHNkhJeBGZgIjzPVHBPvT4Ae24?=
 =?us-ascii?q?g1S2nzdn3+rGMaH5ApXRMnjDl6/sfbJ8605f1gU/199e549PB7EFIfLzXFLxtd?=
 =?us-ascii?q?PCAh84NQy03/joCNFn2owCXmKPB7eTMLnOvl+Q+uIvP+6MaZcVuDnnKvgl++Th?=
 =?us-ascii?q?jXgjlV8dYKmmx50XaH+jE/RiIkWZZ2fsg9gbHWcLuAo+UPLliFmYXTFPYHayWr?=
 =?us-ascii?q?o25isnB4K+EYfDWoetjaSb0yegHp1WYWNGBkqWEXjydYWJQPMMaCOUIs98nT0I?=
 =?us-ascii?q?T7mhS4k91R6wsA/20aZoLu3R+icAr5LsyMB15/HPlRE17TF0DN6S02eXQ2Fwn2?=
 =?us-ascii?q?MHXTk23K9krEx5y1eD17V4gvNCGdxS4fNJThk1NZrGw+NmDNDyXxrLfs2VR1a+?=
 =?us-ascii?q?XtWmHTYxQ8oszNAUfUZyBc+ujhDZ0CqsGL8aibqLCJsw8qLf2njxI91wy3LH1K?=
 =?us-ascii?q?knklknTdFDNWyghq5j6QfTA5TFnFmel6avba4cxjLC9H+fzWqSu0FVSBN/Xr/b?=
 =?us-ascii?q?XX8BfEfWrc725kXZT7CwD7QqKQ9Byc+EKqtXZdzll1RGRPH/ONvAZ2K9gXu/BR?=
 =?us-ascii?q?GNxrmUdorlZ30d3DnBCEgDiw0T4XeGNQ05Bie9o2LfDCZiFU71b0Pr6+l+rHK7?=
 =?us-ascii?q?Tkk7zwyRa01h1ry1+gMahPCGSvMT2K4EtzklqzluAFm92NfWAcKapwV9ZKVcfc?=
 =?us-ascii?q?894FBf2G3DswxyIJOhIL5ih1IEaAt3ol7h2A9xCoVDlsgqsmgnzA5zKaKezVNA?=
 =?us-ascii?q?eCmU3ZH2Or3LNGby+AqjZLLR2lHbyNyW4LsA6Owkq1X/uwGkDkoj82h939ZJyX?=
 =?us-ascii?q?ed55XKAxAUUZL+SUs38xl6p7fHYigy/Y/U1HtsMbWqvT/Gwd4mGOwlyhO4dddF?=
 =?us-ascii?q?LKyEDBPyE9EdB8W2MuwqmkSmYQgePO9P8644JcWmeOWc2K6qJepvgCipjWBa74?=
 =?us-ascii?q?9jyEKM8Cx8R/XM35YExfGYwwSGWy39jFenrsD4h4REaSsOEWq4zCjuHJRRabFq?=
 =?us-ascii?q?fYYXFWeuJNW6x9V/h5L3W39U7kWjB04A2MKyfRqSblr93RBf1EgNoHynnze4wC?=
 =?us-ascii?q?Jwkz0zsqWf2ynOyfz4dBUbIm5LWHVijVD0LIi2ld8aRkuobwsulBe//kb13atb?=
 =?us-ascii?q?pKd+L2nVX0hIeTP7L2VjUqu2q7qDbNRD6JIusSVLTuu8ZUqWRaL6oxsfyynjBX?=
 =?us-ascii?q?dRxCgndzG2vZX0hxx7h3iaLHpprnrZeMdwyAzb5NzdQ/5RwzUHSDN5iTnRGliz?=
 =?us-ascii?q?Id2p8c+ImJfEt+C0T3ihWYFLcSn30YOAszO25W5wDh2+hfyzmsDnHhI80S/0zN?=
 =?us-ascii?q?RqUSTIrBDhYojkzai6MORnflV2C1/48cZ1BoZ+ko4ojpEKxXcanomV/WYAkWrr?=
 =?us-ascii?q?NNVb2KH+Y2AXST8F3dHV+xTl11N5Ln2S2Y35THqdz9BlZ9m7ZGMWxy0849pLCK?=
 =?us-ascii?q?eS8LxLgy91rkCkogLWZPh3hi0dxuc26H4Gn+EJvxIgzjmaArAXB0VZPDbjlxKV?=
 =?us-ascii?q?79Clt6VXZX2icbyx1Ep4gNCgA6uOogBaWHblZJgiGTV84dl4MFLJyHfz8J3reM?=
 =?us-ascii?q?HMbdIPsR2ZiwzPgPJSKJI1i/oGny5nOX/msH0hyu47iwFu3J6gsIiGLWVt4Ly2?=
 =?us-ascii?q?AhpCOjLpYMMT/ynnjbxCkcaOw4CvApJhFy0JXJTySPKnDikSue77NwqUEz08t3?=
 =?us-ascii?q?SbGafZHQCF80drtHbPE5GtN3GKK3gV19RiRB+BJENBhAAYRik1npk8Fgqy3szu?=
 =?us-ascii?q?bF955iwN5l7/shZNyuVoNwTmUmfCvgiobC04SIOYLBpQ4QFP/EPVMc2Y7uJuEC?=
 =?us-ascii?q?BU5JyhrAqRKmOFYwREF30GWkuBB1r7JLmh+cHA8/SEBuq5N/bOYauBqe1dV/eL?=
 =?us-ascii?q?xJKjyIhm/yyLNsWAIHZiFeA72lFYUHB9GsTZnSgPSiMNmyLMac6buAmz+iltos?=
 =?us-ascii?q?+j9/TrXRrl5ZGTBLtKLdVv5xe2jL+ZOO6Nnyl5MyhX15MWyX/MybgSx1oSiyBo?=
 =?us-ascii?q?dzmwHrUMry/NTKTMmqBJCx4XcT98NMxN76gkxAlCJdbbis/p1r5/lvM1F1ZFVV?=
 =?us-ascii?q?n7ls61f8AFP2G9O03BBEuQMLSGJDvLw9z4YK+mSL1QivlUuAO0uTqBD0DjOTGD?=
 =?us-ascii?q?nSHzVx+zKeFMkD2bPBtGtYC9aBltD23jTNPgahKjMd53jSc5wbs7hn7RMW4cMD?=
 =?us-ascii?q?58c15Cr7GK7CNYhOl/FHJF7nZ/MeaEnCOZvKHkLcMxtfZoGS1ym/gSyXI20aZO?=
 =?us-ascii?q?7CpESfp2n2OGp9hiuQv+yrGnxT9uUR4IoTFO0tGlp0JnbI7Z7JhbRXHc/Fot4G?=
 =?us-ascii?q?GUFBUF749lAd3HuqZe0NHDmav/bjBY/ISHroMnG8HIJZffYzIaOh3zFWuRVVNd?=
 =?us-ascii?q?QA=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ABAAA21Btch0O0hNFdCBoBAQEBAQIBA?=
 =?us-ascii?q?QEBBwIBAQEBgVEFAQEBAQsBg2snhF+HN4t7UgaBNRSJD446gjMBhy4iNAkNAQM?=
 =?us-ascii?q?BAQEBAQECARMBAQEIDQkIKSMMgjYkAYJiAQIDAQI3BgEBNwEFCQEBCg4KCRMSA?=
 =?us-ascii?q?wwFKCEYgx2BdQ0FpmaCH4J2AQEFhyEIjD8XeIEHg3UuhFyDXoImkF2QYgmRWSS?=
 =?us-ascii?q?RXZtTgg4zGggoCIMnghuJAYVgHjOBBQEBjWABAQ?=
X-IPAS-Result: =?us-ascii?q?A0ABAAA21Btch0O0hNFdCBoBAQEBAQIBAQEBBwIBAQEBgVE?=
 =?us-ascii?q?FAQEBAQsBg2snhF+HN4t7UgaBNRSJD446gjMBhy4iNAkNAQMBAQEBAQECARMBA?=
 =?us-ascii?q?QEIDQkIKSMMgjYkAYJiAQIDAQI3BgEBNwEFCQEBCg4KCRMSAwwFKCEYgx2BdQ0?=
 =?us-ascii?q?FpmaCH4J2AQEFhyEIjD8XeIEHg3UuhFyDXoImkF2QYgmRWSSRXZtTgg4zGggoC?=
 =?us-ascii?q?IMnghuJAYVgHjOBBQEBjWABAQ?=
X-IronPort-AV: E=Sophos;i="5.56,378,1539673200"; 
   d="scan'208";a="57731158"
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 20 Dec 2018 09:42:56 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2388046AbeLTRjx (ORCPT <rfc822;like.xu@linux.intel.com>
        + 22 others); Thu, 20 Dec 2018 12:39:53 -0500
Received: from bombadil.infradead.org ([198.137.202.133]:59490 "EHLO
        bombadil.infradead.org" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1730526AbeLTRjw (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 20 Dec 2018 12:39:52 -0500
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
        d=infradead.org; s=bombadil.20170209; h=In-Reply-To:Content-Type:MIME-Version
        :References:Message-ID:Subject:Cc:To:From:Date:Sender:Reply-To:
        Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:
        Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:
        List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
         bh=xlP1es0E/CTI638jb51O8he5KmaEfgJt9PkANcyjU3g=; b=oRDDkOJWpzAPLKWeA77FYj0CS
        HUNI2eP+1uUZC6AtOi5Hl7CdVhAkX+YfnSJxefY1LC6uMOSSkRttKoD/1x+o4RnXc0niNS0n86zoi
        6WR4BZSgjflcoS9oDio47eqOsdY2As1ieaIl9fneGaSuIDoIee8E+I/u+02VUQ7vkGG931kkNqtvi
        WZGbZg+g7u1xS6Gd6kJajjJ90y5nel9tz/ironWn8I270eimHowAkRAUsfGAMEBRo+OfY1pw0kUAc
        iI5r8nKlk/e5SfV6tRyudC5V7qNR+X+F/DusFVXfs75NI1Qy3LSDFgwaeJ4jQaqqLnW9gnDF/feOh
        ZzxovbF7A==;
Received: from hch by bombadil.infradead.org with local (Exim 4.90_1 #2 (Red Hat Linux))
        id 1ga2IY-00075g-9x; Thu, 20 Dec 2018 17:39:50 +0000
Date: Thu, 20 Dec 2018 09:39:50 -0800
From: Christoph Hellwig <hch@infradead.org>
To: Oleksandr Andrushchenko <andr2000@gmail.com>
Cc: Christoph Hellwig <hch@infradead.org>,
        Noralf =?iso-8859-1?Q?Tr=F8nnes?= <noralf@tronnes.org>,
        xen-devel@lists.xenproject.org, linux-kernel@vger.kernel.org,
        dri-devel@lists.freedesktop.org, daniel.vetter@intel.com,
        jgross@suse.com, boris.ostrovsky@oracle.com,
        Oleksandr Andrushchenko <oleksandr_andrushchenko@epam.com>
Subject: Re: [PATCH] drm/xen-front: Make shmem backed display buffer coherent
Message-ID: <20181220173950.GA19641@infradead.org>
References: <20181127103252.20994-1-andr2000@gmail.com>
 <17640791-5306-f7e4-8588-dd39c14e975b@tronnes.org>
 <20181220153646.GA22997@infradead.org>
 <f2cfadc7-2e0b-b63d-d094-d5339b0c85fe@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <f2cfadc7-2e0b-b63d-d094-d5339b0c85fe@gmail.com>
User-Agent: Mutt/1.9.2 (2017-12-15)
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by bombadil.infradead.org. See http://www.infradead.org/rpr.html
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, Dec 20, 2018 at 05:49:39PM +0200, Oleksandr Andrushchenko wrote:
> This is the only patch [1], no series. And at the moment I think
> there is nothing to review as I am not sure how to deal with those
> shmem pages: this patch is rather to start a discussion on how shmem
> pages can be flushed on ARM (the only workaround I have so far is
> in this patch which uses DMA API). This is where I am looking for
> some advice, so I can implement the patch the right way.

shmem is basically page cache.  So you need to use the DMA streaming
API (dma_map_*) to map it for DMA.  You need to make sure no one
access the kernel mapping at the same time as you do DMA to it,
so the pages should be locked.  This is how the normal file system
I/O path works.
