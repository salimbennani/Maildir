Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 15 Nov 2018 00:42:20 -0000
Received: from icoremail.net (unknown [209.85.210.172])
	by mail-app2 (Coremail) with SMTP id by_KCgD3_2Oteexb9qeSAQ--.43133S3;
	Thu, 15 Nov 2018 03:38:22 +0800 (CST)
Received: from mail-pf1-f172.google.com (unknown [209.85.210.172])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwAH4DupeexbaAZAAA--.1526S3;
	Thu, 15 Nov 2018 03:38:18 +0800 (CST)
Received: by mail-pf1-f172.google.com with SMTP id h3so1867399pfg.1
        for <xuliker@zju.edu.cn>; Wed, 14 Nov 2018 11:38:18 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=iny1mgg26t9AnVaviqRoE5k8k4ZGXZc8oZmWXKkldPs=;
        b=e3PJ8+GL4nxhWXctU5UhI+q599HcIRfybAHGVmQVBb+kNl0rVhYx9wWRRnL7vsAVTa
         lOfYlkkd0BG/M1KqvCzjvtBNX9SP9DlAbvcQ15TXpdRYlwyHBBKHyX7KiJnqkx0rB+3o
         MKxfnc8py3KB1uzQqBr6Clt+SZkzpr7N1Rku6qo/0WSwwBlZcKcMOBJxf35cuBoPbUqG
         D1YPuNX0MGQIbFBK7VJCFa0S16nyV6Q0ax3Ky8datzOe510LGLPAgDj89PFwotvWgh8/
         ClSP8a4nXOZZ63MHzIh2O9EKZcCJ3ds3i0JTA8HtU2cRkqoy1/5I0KAvZ779uSh8CNtd
         BPlA==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gK+R1VKtDCXJ6a8szAhuX4IGvd8pb8Hu/UAdtObMEtsw7If2/xq
	zoEnVHQqqY1rCJvqLvb+qVX4GZb10fqvQe6fromCYwusMEW5w1k+Dg==
X-Received: by 2002:aa7:8498:: with SMTP id u24-v6mr3272444pfn.220.1542224297705;
        Wed, 14 Nov 2018 11:38:17 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:c304:0:0:0:0 with SMTP id g4-v6csp6227845pjt;
        Wed, 14 Nov 2018 11:38:16 -0800 (PST)
X-Google-Smtp-Source: AJdET5emkngEeNafUehwaYtFMqSGpsuv00Bs1VJ1qWL0Ckr9LkTQ+3CX+WSSM9Rx1mFuCcTyGNni
X-Received: by 2002:a81:1cd5:: with SMTP id c204-v6mr3045890ywc.476.1542224296111;
        Wed, 14 Nov 2018 11:38:16 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542224296; cv=none;
        d=google.com; s=arc-20160816;
        b=UlmWEXL2yqK4Lqyqk+wz51YMc44Fu+gvV+igfxEdD/faMyo0D9LS+Fw2C441ety6NX
         mlz/LJmbyxfmilgkZiMS2ULu8G4etfN+kOxDeMUeG0O3DT7bnjlddo5Hdy3db5Hmg0ba
         lLWi5/71NpQkBNd0MSqfRmkpyTlUzPD2BjgV/eKCW8AJ6NEAQ+OxoYqTzxMZiGCzDZFU
         z4vRP/FcyG+IMpgbCSgJSS9RdToeScBWuwSfHJYW75YPRDMYzUwPf9xaof8HNr2w3ycs
         uMIRPqVioWBsV3VK67SJ1pgu1157mjNYRPJqbJ5pcxAHpIkoVdNESnmbNzpZjx+Gt780
         d0aA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=iny1mgg26t9AnVaviqRoE5k8k4ZGXZc8oZmWXKkldPs=;
        b=NpygQo35pUag0wYQ4WeEuFJALOBJyGy9TVSziz8+gVhVDxc79ob8eAQK/5O5CpfNFO
         WjKLebWQpHbxL9j0dxVrFIR0iHZitn7L+S238hirqFlecthJAqY4GbwyRgr+l1dCKazt
         jPnPT0Dj0KcHp841QeDxIKHymAIOG2EgGlC0vGauYA3TiuaDWmNSiibK0lFbpw560Lwv
         qJ6AEI+cwwRaN3+cSAK2A1ieyX5okJW9PbRdOOMLpgkcWUSA5ez+J6cPBir9QK0+7ZFp
         pV9vTzSAL6sqa78JxBNSBdSeUew1B8ktaoxb9YYz79c+hNdxTxS4nq9sRlme4gGBF27U
         ZDJA==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id g125-v6si14653071ywa.436.2018.11.14.11.38.15
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 14 Nov 2018 11:38:16 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gN0xR-0001pd-8O; Wed, 14 Nov 2018 19:36:13 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=xswa=nz=citrix.com=prvs=8491ce0b8=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1gN0xP-0001pX-Hr
 for xen-devel@lists.xen.org; Wed, 14 Nov 2018 19:36:11 +0000
X-Inumbo-ID: 892f0952-e844-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 892f0952-e844-11e8-9a16-bc764e045a96;
 Wed, 14 Nov 2018 19:36:09 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,233,1539648000"; d="scan'208";a="70579707"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xen.org>
Date: Wed, 14 Nov 2018 19:36:00 +0000
Message-ID: <1542224160-6130-1-git-send-email-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.1.4
In-Reply-To: <017c35d6-689c-b025-6a05-4188a2150332@citrix.com>
References: <017c35d6-689c-b025-6a05-4188a2150332@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v4 4/5] xen/domain: Allocate d->vcpu[] earlier
 during domain_create()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Julien Grall <julien.grall@arm.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwAH4DupeexbaAZAAA--.1526S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3KFyUCr17Zw1fCw1DGFW5trb_yoWkAFWxpa
	1xZ348Ww4fGr1agay5t3ZY9F98K3s3GF1Fk39xAFyfJr9rK34DZr1vg3s8uryfZrWDZr1x
	Zr1fWF1Uu347AaDanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlqb7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Ar0_tr1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Cr0_Gr1UM28EF7xvwVC2
	z280aVAFwI0_Cr1j6rxdM28EF7xvwVC2z280aVCY1x0267AKxVWxJr0_GcWlnx0E6VACY4
	xI67k04243AVACY4xI67k04243AVAKzVAKj4xI6x02cVCv0xWle2I262IYc4CY6c8Ij28I
	cVAaY2xG8wAqx4xG64xvF2IEw4CE5I8CrVC2j2WlYx0E2Ix0cI8IcVAFwI0_Jr0_Jr4lYx
	0Ex4A2jsIE14v26r1j6r4UMcvjeVCFs4IE7xkEbVWUJVW8JwACjcxG0xvY0x0EwIxGrwAC
	Y4xI67k04243AVAKzVAKj4xxMx02cVCv0xWlc7CjxVAKzI0EY4vE52x082I5MxkFs20EY4
	vE44CYbxCE4x80FwCY02Avz4vEIxC_WwCY0x0Ix7I2Y4AK64vIr41lcIIF0xvE2Ix0cI8I
	cVAFwI0_JFI_Gr1lcIIF0xvE2Ix0cI8IcVCY1x0267AKxVWUJVW8JwCYIxAIcVC2z280aV
	AFwI0_Gr1j6F4UJwCYIxAIcVC2z280aVCY1x0267AKxVW8Jr0_Cr1UMxAIw28IcxkI7VAK
	I48JMxAIw28IcVAKzI0EY4vE52x082I5MxCjnVCjjxCrMxC20s026xCaFVCjc4AY6r1j6r
	4UMI8I3I0E5I8CrVAFwI0_Jr0_Jr4lx2IqxVCjr7xvwVAFwI0_JrI_JrWlx4CE17CEb7AF
	67AKxVWUAVWUtwCIc40Y0x0EwIxGrwCI42IY6xAIw20EY4v20xvaj40_Zr0_Wr1UMVCEFc
	xC0VAYjxAxZFUvcSsGvfC2KfnxnUUI43ZEXa7IUO7wIPUUUUU==

VGhlIEFSTSBjb2RlIGhhcyBhIGNoaWNrZW4tYW5kLWVnZyBwcm9ibGVtLiAgT25lIG9mIHRoZSB2
R0lDdjMgZW11bGF0aW9ucwp3YW50cyB0byBrbm93IGQtPm1heF92Y3B1cyB0byBiZSBhYmxlIHRv
IHNpemUgaXRzZWxmIGFwcHJvcHJpYXRlbHksIGJ1dCB0aGUKY3VycmVudCBvcmRlciBvZiBpbml0
aWFsaXNhdGlvbiByZXF1aXJlcyB0aGUgdkdJQyB0byBiZSBzZXQgdXAgYmVmb3JlIHRoZQpyZXF1
ZXN0ZWQgbnVtYmVyIG9mIHZjcHVzIGNhbiBiZSBjaGVja2VkLgoKTW92ZSB0aGUgcmFuZ2UgY2hl
Y2tpbmcgb2YgY29uZmlnLT5tYXhfdmNwdXMgaW50byBzYW5pdGlzZV9kb21haW5fY29uZmlnKCkK
cGF0aCwgd2hpY2ggYWxsb3dzIGZvciB0aGUgYWxsb2NhdGlvbiBvZiBkLT52Y3B1W10gYW5kIGQt
Pm1heF92Y3B1cyB0byBoYXBwZW4KZWFybGllciBkdXJpbmcgY3JlYXRlLCBhbmQgaW4gcGFydGlj
dWxhciwgYmVmb3JlIHRoZSBjYWxsIHRvCmFyY2hfZG9tYWluX2NyZWF0ZSgpLgoKVGhlIHg4NiBz
aWRlIGlzIGZhaXJseSBlYXN5LCBhbmQgaW1wbGVtZW50cyB0aGUgbG9naWNhbCBlcXVpdmFsZW50
IG9mCmRvbWFpbl9tYXhfdmNwdXMoKSBidXQgdXNpbmcgWEVOX0RPTUNUTF9DREZfaHZtX2d1ZXN0
IHJhdGhlciB0aGFuCmlzX2h2bV9kb21haW4oKS4KCkZvciB0aGUgQVJNIHNpZGUsIHJlLXB1cnBv
c2UgdmdpY19tYXhfdmNwdXMoKSB0byB0YWtlIGEgZG9tY3RsIHZHSUMgdmVyc2lvbiwKYW5kIHJl
dHVybiB0aGUgbWF4aW11bSBudW1iZXIgb2Ygc3VwcG9ydGVkIHZDUFVzLCByZXVzaW5nIDAgZm9y
ICJ2ZXJzaW9uIG5vdApzdXBwb3J0ZWQiLiAgVG8gYXZvaWQgZXhwb3J0aW5nIHRoZSB2Z2ljX29w
cyBzdHJ1Y3R1cmVzICh3aGljaCBhcmUgaW4gdGhlCnByb2Nlc3Mgb2YgYmVpbmcgcmVwbGFjZWQp
LCBoYXJkIGNvZGUgdGhlIHVwcGVyIGxpbWl0cy4KClRoaXMgYWxsb3dzIGZvciB0aGUgcmVtb3Zh
bCBvZiB0aGUgZG9tYWluX21heF92Y3B1cygpIGluZnJhc3RydWN0dXJlLCB3aGljaCBpcwpkb25l
IHRvIHByZXZlbnQgaXQgYmVpbmcgcmV1c2VkIGluY29ycmVjdGx5IGluIHRoZSBmdXR1cmUuCgpT
aWduZWQtb2ZmLWJ5OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgpS
ZXZpZXdlZC1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgotLS0KQ0M6IFdlaSBM
aXUgPHdlaS5saXUyQGNpdHJpeC5jb20+CkNDOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxs
aW5pQGtlcm5lbC5vcmc+CkNDOiBKdWxpZW4gR3JhbGwgPGp1bGllbi5ncmFsbEBhcm0uY29tPgoK
djM6CiAqIEZpeCA0MDkyLzQwOTYgdHlwbwogKiBGaXggYnVpbGQgaW4gTkVXX1ZHSUMgY2FzZQp2
NDoKICogTW92ZSB0aGUgbWluKCkgaW50byBBUk0ncyBjb21tb24gYXJjaF9zYW5pdGlzZV9kb21h
aW5fY29uZmlnKCkKICAgaW1wbGVtZW50YXRpb24uICBTaW1wbGZ5IHRoZSBtaW4oKSBleHByZXNz
aW9uIGNvZGUgYnkgbWFraW5nIE1BWF9WSVJUX0NQVVMKICAgYmUgYW4gdW5zaWduZWQgY29uc3Rh
bnQuCi0tLQogeGVuL2FyY2gvYXJtL2RvbWFpbi5jICAgICAgICAgfCAxOCArKysrKysrKysrKysr
KysrKysKIHhlbi9hcmNoL2FybS92Z2ljLXYyLmMgICAgICAgIHwgIDEgLQogeGVuL2FyY2gvYXJt
L3ZnaWMtdjMuYyAgICAgICAgfCAgNSAtLS0tLQogeGVuL2FyY2gvYXJtL3ZnaWMuYyAgICAgICAg
ICAgfCAxNiArKysrKysrKysrKysrKy0tCiB4ZW4vYXJjaC9hcm0vdmdpYy92Z2ljLWluaXQuYyB8
ICAzIC0tLQogeGVuL2FyY2gvYXJtL3ZnaWMvdmdpYy5jICAgICAgfCAxNiArKysrKystLS0tLS0t
LS0tCiB4ZW4vYXJjaC94ODYvZG9tYWluLmMgICAgICAgICB8IDEwICsrKysrKysrKysKIHhlbi9j
b21tb24vZG9tYWluLmMgICAgICAgICAgIHwgMzMgKysrKysrKysrKysrKysrKysrKystLS0tLS0t
LS0tLS0tCiB4ZW4vaW5jbHVkZS9hc20tYXJtL2NvbmZpZy5oICB8ICA0ICsrLS0KIHhlbi9pbmNs
dWRlL2FzbS1hcm0vZG9tYWluLmggIHwgIDYgLS0tLS0tCiB4ZW4vaW5jbHVkZS9hc20tYXJtL3Zn
aWMuaCAgICB8ICA1ICsrLS0tCiB4ZW4vaW5jbHVkZS9hc20teDg2L2RvbWFpbi5oICB8ICAyIC0t
CiAxMiBmaWxlcyBjaGFuZ2VkLCA3MiBpbnNlcnRpb25zKCspLCA0NyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vZG9tYWluLmMgYi94ZW4vYXJjaC9hcm0vZG9tYWluLmMK
aW5kZXggNzFhZDFmOS4uNzM5OTk4OSAxMDA2NDQKLS0tIGEveGVuL2FyY2gvYXJtL2RvbWFpbi5j
CisrKyBiL3hlbi9hcmNoL2FybS9kb21haW4uYwpAQCAtNjAxLDYgKzYwMSw4IEBAIHZvaWQgdmNw
dV9zd2l0Y2hfdG9fYWFyY2g2NF9tb2RlKHN0cnVjdCB2Y3B1ICp2KQogCiBpbnQgYXJjaF9zYW5p
dGlzZV9kb21haW5fY29uZmlnKHN0cnVjdCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiAqY29uZmln
KQogeworICAgIHVuc2lnbmVkIGludCBtYXhfdmNwdXM7CisKICAgICBpZiAoIGNvbmZpZy0+Zmxh
Z3MgIT0gKFhFTl9ET01DVExfQ0RGX2h2bV9ndWVzdCB8IFhFTl9ET01DVExfQ0RGX2hhcCkgKQog
ICAgIHsKICAgICAgICAgZHByaW50ayhYRU5MT0dfSU5GTywgIlVuc3VwcG9ydGVkIGNvbmZpZ3Vy
YXRpb24gJSN4XG4iLCBjb25maWctPmZsYWdzKTsKQEAgLTYyNiw2ICs2MjgsMjIgQEAgaW50IGFy
Y2hfc2FuaXRpc2VfZG9tYWluX2NvbmZpZyhzdHJ1Y3QgeGVuX2RvbWN0bF9jcmVhdGVkb21haW4g
KmNvbmZpZykKICAgICAgICAgfQogICAgIH0KIAorICAgIC8qIG1heF92Y3B1cyBkZXBlbmRzIG9u
IHRoZSBHSUMgdmVyc2lvbiwgYW5kIFhlbidzIGNvbXBpbGVkIGxpbWl0LiAqLworICAgIG1heF92
Y3B1cyA9IG1heCh2Z2ljX21heF92Y3B1cyhjb25maWctPmFyY2guZ2ljX3ZlcnNpb24pLCBNQVhf
VklSVF9DUFVTKTsKKworICAgIGlmICggbWF4X3ZjcHVzID09IDAgKQorICAgIHsKKyAgICAgICAg
ZHByaW50ayhYRU5MT0dfSU5GTywgIlVuc3VwcG9ydGVkIEdJQyB2ZXJzaW9uXG4iKTsKKyAgICAg
ICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorCisgICAgaWYgKCBjb25maWctPm1heF92Y3B1cyA+
IG1heF92Y3B1cyApCisgICAgeworICAgICAgICBkcHJpbnRrKFhFTkxPR19JTkZPLCAiUmVxdWVz
dGVkIHZDUFVzICgldSkgZXhjZWVkcyBtYXggKCV1KVxuIiwKKyAgICAgICAgICAgICAgICBjb25m
aWctPm1heF92Y3B1cywgbWF4X3ZjcHVzKTsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAg
fQorCiAgICAgcmV0dXJuIDA7CiB9CiAKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS92Z2ljLXYy
LmMgYi94ZW4vYXJjaC9hcm0vdmdpYy12Mi5jCmluZGV4IGJmNzc4OTkuLjY0YjE0MWYgMTAwNjQ0
Ci0tLSBhL3hlbi9hcmNoL2FybS92Z2ljLXYyLmMKKysrIGIveGVuL2FyY2gvYXJtL3ZnaWMtdjIu
YwpAQCAtNzI1LDcgKzcyNSw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdmdpY19vcHMgdmdpY192
Ml9vcHMgPSB7CiAgICAgLmRvbWFpbl9mcmVlID0gdmdpY192Ml9kb21haW5fZnJlZSwKICAgICAu
bHBpX3RvX3BlbmRpbmcgPSB2Z2ljX3YyX2xwaV90b19wZW5kaW5nLAogICAgIC5scGlfZ2V0X3By
aW9yaXR5ID0gdmdpY192Ml9scGlfZ2V0X3ByaW9yaXR5LAotICAgIC5tYXhfdmNwdXMgPSA4LAog
fTsKIAogaW50IHZnaWNfdjJfaW5pdChzdHJ1Y3QgZG9tYWluICpkLCBpbnQgKm1taW9fY291bnQp
CmRpZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vdmdpYy12My5jIGIveGVuL2FyY2gvYXJtL3ZnaWMt
djMuYwppbmRleCBjMTRiY2Q4Li41MTljYzcyIDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vdmdp
Yy12My5jCisrKyBiL3hlbi9hcmNoL2FybS92Z2ljLXYzLmMKQEAgLTE4MjIsMTEgKzE4MjIsNiBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IHZnaWNfb3BzIHYzX29wcyA9IHsKICAgICAuZW11bGF0ZV9y
ZWcgID0gdmdpY192M19lbXVsYXRlX3JlZywKICAgICAubHBpX3RvX3BlbmRpbmcgPSB2Z2ljX3Yz
X2xwaV90b19wZW5kaW5nLAogICAgIC5scGlfZ2V0X3ByaW9yaXR5ID0gdmdpY192M19scGlfZ2V0
X3ByaW9yaXR5LAotICAgIC8qCi0gICAgICogV2UgdXNlIGJvdGggQUZGMSBhbmQgQUZGMCBpbiAo
dilNUElEUi4gVGh1cywgdGhlIG1heCBudW1iZXIgb2YgQ1BVCi0gICAgICogdGhhdCBjYW4gYmUg
c3VwcG9ydGVkIGlzIHVwIHRvIDQwOTYoPT0yNTYqMTYpIGluIHRoZW9yeS4KLSAgICAgKi8KLSAg
ICAubWF4X3ZjcHVzID0gNDA5NiwKIH07CiAKIGludCB2Z2ljX3YzX2luaXQoc3RydWN0IGRvbWFp
biAqZCwgaW50ICptbWlvX2NvdW50KQpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL3ZnaWMuYyBi
L3hlbi9hcmNoL2FybS92Z2ljLmMKaW5kZXggNWE0ZjA4Mi4uZjI2MDhiMCAxMDA2NDQKLS0tIGEv
eGVuL2FyY2gvYXJtL3ZnaWMuYworKysgYi94ZW4vYXJjaC9hcm0vdmdpYy5jCkBAIC02NjcsOSAr
NjY3LDIxIEBAIHZvaWQgdmdpY19mcmVlX3ZpcnEoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQg
aW50IHZpcnEpCiAgICAgY2xlYXJfYml0KHZpcnEsIGQtPmFyY2gudmdpYy5hbGxvY2F0ZWRfaXJx
cyk7CiB9CiAKLXVuc2lnbmVkIGludCB2Z2ljX21heF92Y3B1cyhjb25zdCBzdHJ1Y3QgZG9tYWlu
ICpkKQordW5zaWduZWQgaW50IHZnaWNfbWF4X3ZjcHVzKHVuc2lnbmVkIGludCBkb21jdGxfdmdp
Y192ZXJzaW9uKQogewotICAgIHJldHVybiBtaW5fdCh1bnNpZ25lZCBpbnQsIE1BWF9WSVJUX0NQ
VVMsIGQtPmFyY2gudmdpYy5oYW5kbGVyLT5tYXhfdmNwdXMpOworICAgIHN3aXRjaCAoIGRvbWN0
bF92Z2ljX3ZlcnNpb24gKQorICAgIHsKKyAgICBjYXNlIFhFTl9ET01DVExfQ09ORklHX0dJQ19W
MjoKKyAgICAgICAgcmV0dXJuIDg7CisKKyNpZmRlZiBDT05GSUdfR0lDVjMKKyAgICBjYXNlIFhF
Tl9ET01DVExfQ09ORklHX0dJQ19WMzoKKyAgICAgICAgcmV0dXJuIDQwOTY7CisjZW5kaWYKKwor
ICAgIGRlZmF1bHQ6CisgICAgICAgIHJldHVybiAwOworICAgIH0KIH0KIAogLyoKZGlmZiAtLWdp
dCBhL3hlbi9hcmNoL2FybS92Z2ljL3ZnaWMtaW5pdC5jIGIveGVuL2FyY2gvYXJtL3ZnaWMvdmdp
Yy1pbml0LmMKaW5kZXggYmZkM2QwOS4uNjJhZTU1MyAxMDA2NDQKLS0tIGEveGVuL2FyY2gvYXJt
L3ZnaWMvdmdpYy1pbml0LmMKKysrIGIveGVuL2FyY2gvYXJtL3ZnaWMvdmdpYy1pbml0LmMKQEAg
LTExMiw5ICsxMTIsNiBAQCBpbnQgZG9tYWluX3ZnaWNfcmVnaXN0ZXIoc3RydWN0IGRvbWFpbiAq
ZCwgaW50ICptbWlvX2NvdW50KQogICAgICAgICBCVUcoKTsKICAgICB9CiAKLSAgICBpZiAoIGQt
Pm1heF92Y3B1cyA+IGRvbWFpbl9tYXhfdmNwdXMoZCkgKQotICAgICAgICByZXR1cm4gLUUyQklH
OwotCiAgICAgZC0+YXJjaC52Z2ljLnZnaWNfZGlzdF9iYXNlID0gVkdJQ19BRERSX1VOREVGOwog
ICAgIGQtPmFyY2gudmdpYy52Z2ljX2NwdV9iYXNlID0gVkdJQ19BRERSX1VOREVGOwogICAgIGQt
PmFyY2gudmdpYy52Z2ljX3JlZGlzdF9iYXNlID0gVkdJQ19BRERSX1VOREVGOwpkaWZmIC0tZ2l0
IGEveGVuL2FyY2gvYXJtL3ZnaWMvdmdpYy5jIGIveGVuL2FyY2gvYXJtL3ZnaWMvdmdpYy5jCmlu
ZGV4IDdjM2NmYzUuLmUyODQ0ZGMgMTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL2FybS92Z2ljL3ZnaWMu
YworKysgYi94ZW4vYXJjaC9hcm0vdmdpYy92Z2ljLmMKQEAgLTk0OSwyMCArOTQ5LDE2IEBAIHZv
aWQgdmdpY19zeW5jX2hhcmR3YXJlX2lycShzdHJ1Y3QgZG9tYWluICpkLAogICAgIHNwaW5fdW5s
b2NrX2lycXJlc3RvcmUoJmRlc2MtPmxvY2ssIGZsYWdzKTsKIH0KIAotdW5zaWduZWQgaW50IHZn
aWNfbWF4X3ZjcHVzKGNvbnN0IHN0cnVjdCBkb21haW4gKmQpCit1bnNpZ25lZCBpbnQgdmdpY19t
YXhfdmNwdXModW5zaWduZWQgaW50IGRvbWN0bF92Z2ljX3ZlcnNpb24pCiB7Ci0gICAgdW5zaWdu
ZWQgaW50IHZnaWNfdmNwdV9saW1pdDsKLQotICAgIHN3aXRjaCAoIGQtPmFyY2gudmdpYy52ZXJz
aW9uICkKKyAgICBzd2l0Y2ggKCBkb21jdGxfdmdpY192ZXJzaW9uICkKICAgICB7Ci0gICAgY2Fz
ZSBHSUNfVjI6Ci0gICAgICAgIHZnaWNfdmNwdV9saW1pdCA9IFZHSUNfVjJfTUFYX0NQVVM7Ci0g
ICAgICAgIGJyZWFrOworICAgIGNhc2UgWEVOX0RPTUNUTF9DT05GSUdfR0lDX1YyOgorICAgICAg
ICByZXR1cm4gVkdJQ19WMl9NQVhfQ1BVUzsKKwogICAgIGRlZmF1bHQ6Ci0gICAgICAgIEJVRygp
OworICAgICAgICByZXR1cm4gMDsKICAgICB9Ci0KLSAgICByZXR1cm4gbWluX3QodW5zaWduZWQg
aW50LCBNQVhfVklSVF9DUFVTLCB2Z2ljX3ZjcHVfbGltaXQpOwogfQogCiAjaWZkZWYgQ09ORklH
X0dJQ1YzCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvZG9tYWluLmMgYi94ZW4vYXJjaC94ODYv
ZG9tYWluLmMKaW5kZXggMjcyZmQ4NC4uMjk1YjEwYyAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2
L2RvbWFpbi5jCisrKyBiL3hlbi9hcmNoL3g4Ni9kb21haW4uYwpAQCAtNDIxLDYgKzQyMSw3IEBA
IHZvaWQgYXJjaF92Y3B1X2Rlc3Ryb3koc3RydWN0IHZjcHUgKnYpCiBpbnQgYXJjaF9zYW5pdGlz
ZV9kb21haW5fY29uZmlnKHN0cnVjdCB4ZW5fZG9tY3RsX2NyZWF0ZWRvbWFpbiAqY29uZmlnKQog
ewogICAgIGJvb2wgaHZtID0gY29uZmlnLT5mbGFncyAmIFhFTl9ET01DVExfQ0RGX2h2bV9ndWVz
dDsKKyAgICB1bnNpZ25lZCBpbnQgbWF4X3ZjcHVzOwogCiAgICAgaWYgKCBodm0gPyAhaHZtX2Vu
YWJsZWQgOiAhSVNfRU5BQkxFRChDT05GSUdfUFYpICkKICAgICB7CkBAIC00MjgsNiArNDI5LDE1
IEBAIGludCBhcmNoX3Nhbml0aXNlX2RvbWFpbl9jb25maWcoc3RydWN0IHhlbl9kb21jdGxfY3Jl
YXRlZG9tYWluICpjb25maWcpCiAgICAgICAgIHJldHVybiAtRUlOVkFMOwogICAgIH0KIAorICAg
IG1heF92Y3B1cyA9IGh2bSA/IEhWTV9NQVhfVkNQVVMgOiBNQVhfVklSVF9DUFVTOworCisgICAg
aWYgKCBjb25maWctPm1heF92Y3B1cyA+IG1heF92Y3B1cyApCisgICAgeworICAgICAgICBkcHJp
bnRrKFhFTkxPR19JTkZPLCAiUmVxdWVzdGVkIHZDUFVzICgldSkgZXhjZWVkcyBtYXggKCV1KVxu
IiwKKyAgICAgICAgICAgICAgICBjb25maWctPm1heF92Y3B1cywgbWF4X3ZjcHVzKTsKKyAgICAg
ICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorCiAgICAgcmV0dXJuIDA7CiB9CiAKZGlmZiAtLWdp
dCBhL3hlbi9jb21tb24vZG9tYWluLmMgYi94ZW4vY29tbW9uL2RvbWFpbi5jCmluZGV4IGY2OWY0
MDUuLjc4Y2M1MjQgMTAwNjQ0Ci0tLSBhL3hlbi9jb21tb24vZG9tYWluLmMKKysrIGIveGVuL2Nv
bW1vbi9kb21haW4uYwpAQCAtMzAwLDYgKzMwMCwxMiBAQCBzdGF0aWMgaW50IHNhbml0aXNlX2Rv
bWFpbl9jb25maWcoc3RydWN0IHhlbl9kb21jdGxfY3JlYXRlZG9tYWluICpjb25maWcpCiAgICAg
ICAgIHJldHVybiAtRUlOVkFMOwogICAgIH0KIAorICAgIGlmICggY29uZmlnLT5tYXhfdmNwdXMg
PCAxICkKKyAgICB7CisgICAgICAgIGRwcmludGsoWEVOTE9HX0lORk8sICJObyB2Q1BVU1xuIik7
CisgICAgICAgIHJldHVybiAtRUlOVkFMOworICAgIH0KKwogICAgIHJldHVybiBhcmNoX3Nhbml0
aXNlX2RvbWFpbl9jb25maWcoY29uZmlnKTsKIH0KIApAQCAtMzQ1LDYgKzM1MSwyMCBAQCBzdHJ1
Y3QgZG9tYWluICpkb21haW5fY3JlYXRlKGRvbWlkX3QgZG9taWQsCiAKICAgICBUUkFDRV8xRChU
UkNfRE9NMF9ET01fQURELCBkLT5kb21haW5faWQpOwogCisgICAgLyoKKyAgICAgKiBBbGxvY2F0
ZSBkLT52Y3B1W10gYW5kIHNldCAtPm1heF92Y3B1cyB1cCBlYXJseS4gIFZhcmlvdXMgcGVyLWRv
bWFpbgorICAgICAqIHJlc291cmNlcyB3YW50IHRvIGJlIHNpemVkIGJhc2VkIG9uIG1heF92Y3B1
cy4KKyAgICAgKi8KKyAgICBpZiAoICFpc19zeXN0ZW1fZG9tYWluKGQpICkKKyAgICB7CisgICAg
ICAgIGVyciA9IC1FTk9NRU07CisgICAgICAgIGQtPnZjcHUgPSB4emFsbG9jX2FycmF5KHN0cnVj
dCB2Y3B1ICosIGNvbmZpZy0+bWF4X3ZjcHVzKTsKKyAgICAgICAgaWYgKCAhZC0+dmNwdSApCisg
ICAgICAgICAgICBnb3RvIGZhaWw7CisKKyAgICAgICAgZC0+bWF4X3ZjcHVzID0gY29uZmlnLT5t
YXhfdmNwdXM7CisgICAgfQorCiAgICAgbG9ja19wcm9maWxlX3JlZ2lzdGVyX3N0cnVjdChMT0NL
UFJPRl9UWVBFX1BFUkRPTSwgZCwgZG9taWQsICJEb21haW4iKTsKIAogICAgIGlmICggKGVyciA9
IHhzbV9hbGxvY19zZWN1cml0eV9kb21haW4oZCkpICE9IDAgKQpAQCAtMzk2LDE5ICs0MTYsNiBA
QCBzdHJ1Y3QgZG9tYWluICpkb21haW5fY3JlYXRlKGRvbWlkX3QgZG9taWQsCiAKICAgICBpZiAo
ICFpc19pZGxlX2RvbWFpbihkKSApCiAgICAgewotICAgICAgICAvKiBDaGVjayBkLT5tYXhfdmNw
dXMgYW5kIGFsbG9jYXRlIGQtPnZjcHVbXS4gKi8KLSAgICAgICAgZXJyID0gLUVJTlZBTDsKLSAg
ICAgICAgaWYgKCBjb25maWctPm1heF92Y3B1cyA8IDEgfHwKLSAgICAgICAgICAgICBjb25maWct
Pm1heF92Y3B1cyA+IGRvbWFpbl9tYXhfdmNwdXMoZCkgKQotICAgICAgICAgICAgZ290byBmYWls
OwotCi0gICAgICAgIGVyciA9IC1FTk9NRU07Ci0gICAgICAgIGQtPnZjcHUgPSB4emFsbG9jX2Fy
cmF5KHN0cnVjdCB2Y3B1ICosIGNvbmZpZy0+bWF4X3ZjcHVzKTsKLSAgICAgICAgaWYgKCAhZC0+
dmNwdSApCi0gICAgICAgICAgICBnb3RvIGZhaWw7Ci0KLSAgICAgICAgZC0+bWF4X3ZjcHVzID0g
Y29uZmlnLT5tYXhfdmNwdXM7Ci0KICAgICAgICAgd2F0Y2hkb2dfZG9tYWluX2luaXQoZCk7CiAg
ICAgICAgIGluaXRfc3RhdHVzIHw9IElOSVRfd2F0Y2hkb2c7CiAKZGlmZiAtLWdpdCBhL3hlbi9p
bmNsdWRlL2FzbS1hcm0vY29uZmlnLmggYi94ZW4vaW5jbHVkZS9hc20tYXJtL2NvbmZpZy5oCmlu
ZGV4IGNkYWU4ZjYuLmJjODllODQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS1hcm0vY29u
ZmlnLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLWFybS9jb25maWcuaApAQCAtNDEsOSArNDEsOSBA
QAogI2RlZmluZSBPUFRfQ09OU09MRV9TVFIgImR0dWFydCIKIAogI2lmZGVmIENPTkZJR19BUk1f
NjQKLSNkZWZpbmUgTUFYX1ZJUlRfQ1BVUyAxMjgKKyNkZWZpbmUgTUFYX1ZJUlRfQ1BVUyAxMjh1
CiAjZWxzZQotI2RlZmluZSBNQVhfVklSVF9DUFVTIDgKKyNkZWZpbmUgTUFYX1ZJUlRfQ1BVUyA4
dQogI2VuZGlmCiAKICNkZWZpbmUgSU5WQUxJRF9WQ1BVX0lEIE1BWF9WSVJUX0NQVVMKZGlmZiAt
LWdpdCBhL3hlbi9pbmNsdWRlL2FzbS1hcm0vZG9tYWluLmggYi94ZW4vaW5jbHVkZS9hc20tYXJt
L2RvbWFpbi5oCmluZGV4IGQ2ODIzMDcuLjE3NWRlNDQgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRl
L2FzbS1hcm0vZG9tYWluLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLWFybS9kb21haW4uaApAQCAt
MjA4LDEyICsyMDgsNiBAQCB2b2lkIHZjcHVfc2hvd19leGVjdXRpb25fc3RhdGUoc3RydWN0IHZj
cHUgKik7CiB2b2lkIHZjcHVfc2hvd19yZWdpc3RlcnMoY29uc3Qgc3RydWN0IHZjcHUgKik7CiB2
b2lkIHZjcHVfc3dpdGNoX3RvX2FhcmNoNjRfbW9kZShzdHJ1Y3QgdmNwdSAqKTsKIAotLyogT24g
QVJNLCB0aGUgbnVtYmVyIG9mIFZDUFVzIGlzIGxpbWl0ZWQgYnkgdGhlIHR5cGUgb2YgR0lDIGVt
dWxhdGVkLiAqLwotc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQgZG9tYWluX21heF92Y3B1cyhj
b25zdCBzdHJ1Y3QgZG9tYWluICpkKQotewotICAgIHJldHVybiB2Z2ljX21heF92Y3B1cyhkKTsK
LX0KLQogLyoKICAqIER1ZSB0byB0aGUgcmVzdHJpY3Rpb24gb2YgR0lDdjMsIHRoZSBudW1iZXIg
b2YgdkNQVXMgaW4gQUZGMCBpcwogICogbGltaXRlZCB0byAxNiwgdGh1cyBvbmx5IHRoZSBmaXJz
dCA0IGJpdHMgb2YgQUZGMCBhcmUgbGVnYWwuIFdlIHdpbGwKZGlmZiAtLWdpdCBhL3hlbi9pbmNs
dWRlL2FzbS1hcm0vdmdpYy5oIGIveGVuL2luY2x1ZGUvYXNtLWFybS92Z2ljLmgKaW5kZXggNTZl
ZDVmZS4uNDQ3ZDI0ZSAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNtLWFybS92Z2ljLmgKKysr
IGIveGVuL2luY2x1ZGUvYXNtLWFybS92Z2ljLmgKQEAgLTIzNCw4ICsyMzQsNiBAQCBzdHJ1Y3Qg
dmdpY19vcHMgewogICAgIC8qIGxvb2t1cCB0aGUgc3RydWN0IHBlbmRpbmdfaXJxIGZvciBhIGdp
dmVuIExQSSBpbnRlcnJ1cHQgKi8KICAgICBzdHJ1Y3QgcGVuZGluZ19pcnEgKigqbHBpX3RvX3Bl
bmRpbmcpKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGludCB2bHBpKTsKICAgICBpbnQgKCps
cGlfZ2V0X3ByaW9yaXR5KShzdHJ1Y3QgZG9tYWluICpkLCB1aW50MzJfdCB2bHBpKTsKLSAgICAv
KiBNYXhpbXVtIG51bWJlciBvZiB2Q1BVIHN1cHBvcnRlZCAqLwotICAgIGNvbnN0IHVuc2lnbmVk
IGludCBtYXhfdmNwdXM7CiB9OwogCiAvKiBOdW1iZXIgb2YgcmFua3Mgb2YgaW50ZXJydXB0IHJl
Z2lzdGVycyBmb3IgYSBkb21haW4gKi8KQEAgLTM1MCw3ICszNDgsOCBAQCBleHRlcm4gdm9pZCB2
Z2ljX2NsZWFyX3BlbmRpbmdfaXJxcyhzdHJ1Y3QgdmNwdSAqdik7CiAKIGV4dGVybiBib29sIHZn
aWNfZW11bGF0ZShzdHJ1Y3QgY3B1X3VzZXJfcmVncyAqcmVncywgdW5pb24gaHNyIGhzcik7CiAK
LXVuc2lnbmVkIGludCB2Z2ljX21heF92Y3B1cyhjb25zdCBzdHJ1Y3QgZG9tYWluICpkKTsKKy8q
IE1heGltdW0gdkNQVXMgZm9yIGEgc3BlY2lmaWMgdkdJQyB2ZXJzaW9uLCBvciAwIGZvciB1bnN1
cHBvcnRlZC4gKi8KK3Vuc2lnbmVkIGludCB2Z2ljX21heF92Y3B1cyh1bnNpZ25lZCBpbnQgZG9t
Y3RsX3ZnaWNfdmVyc2lvbik7CiAKIHZvaWQgdmdpY192Ml9zZXR1cF9odyhwYWRkcl90IGRiYXNl
LCBwYWRkcl90IGNiYXNlLCBwYWRkcl90IGNzaXplLAogICAgICAgICAgICAgICAgICAgICAgIHBh
ZGRyX3QgdmJhc2UsIHVpbnQzMl90IGFsaWFzZWRfb2Zmc2V0KTsKZGlmZiAtLWdpdCBhL3hlbi9p
bmNsdWRlL2FzbS14ODYvZG9tYWluLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2RvbWFpbi5oCmlu
ZGV4IDY0M2U2OWEuLjI3N2Y5OWYgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvZG9t
YWluLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9kb21haW4uaApAQCAtNjY0LDggKzY2NCw2
IEBAIHVuc2lnbmVkIGxvbmcgcHZfZ3Vlc3RfY3I0X3RvX3JlYWxfY3I0KGNvbnN0IHN0cnVjdCB2
Y3B1ICp2KTsKICAgICAgICAgICAgICBYODZfQ1I0X09TWFNBVkUgfCBYODZfQ1I0X1NNRVAgfCAg
ICAgICAgICAgICAgIFwKICAgICAgICAgICAgICBYODZfQ1I0X0ZTR1NCQVNFIHwgWDg2X0NSNF9T
TUFQIHwgWDg2X0NSNF9QQ0lERSkpCiAKLSNkZWZpbmUgZG9tYWluX21heF92Y3B1cyhkKSAoaXNf
aHZtX2RvbWFpbihkKSA/IEhWTV9NQVhfVkNQVVMgOiBNQVhfVklSVF9DUFVTKQotCiBzdGF0aWMg
aW5saW5lIHN0cnVjdCB2Y3B1X2d1ZXN0X2NvbnRleHQgKmFsbG9jX3ZjcHVfZ3Vlc3RfY29udGV4
dCh2b2lkKQogewogICAgIHJldHVybiB2bWFsbG9jKHNpemVvZihzdHJ1Y3QgdmNwdV9ndWVzdF9j
b250ZXh0KSk7Ci0tIAoyLjEuNAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnBy
b2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94
ZW4tZGV2ZWw=
