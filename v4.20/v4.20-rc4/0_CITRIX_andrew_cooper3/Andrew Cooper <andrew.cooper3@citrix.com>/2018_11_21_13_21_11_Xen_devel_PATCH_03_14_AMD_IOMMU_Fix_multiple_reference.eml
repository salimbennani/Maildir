Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 22 Nov 2018 00:33:14 -0000
Received: from icoremail.net (unknown [209.85.214.170])
	by mail-app2 (Coremail) with SMTP id by_KCgDHH+aIXPVbnx3IAQ--.57708S3;
	Wed, 21 Nov 2018 21:24:25 +0800 (CST)
Received: from mail-pl1-f170.google.com (unknown [209.85.214.170])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwAH6USFXPVbmadjAA--.1278S3;
	Wed, 21 Nov 2018 21:24:21 +0800 (CST)
Received: by mail-pl1-f170.google.com with SMTP id y6-v6so5555383plt.3
        for <xuliker@zju.edu.cn>; Wed, 21 Nov 2018 05:24:21 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=DjGZWDFZs/NTbmI3y5CqObuGsIRzZJEYXXyHZ19hy4o=;
        b=U7MiOSVkLCVi0sOU0G+tXaPZ4YHIn4cvM/8HjHO7135h68jFlpoB7oFIykiC3E8vzk
         T/sAuI2pzLNT+2BBMYVjyLHXiZN5JaCdFqpwm+1OD35nZeYrCRbJ1YdTy6UAi8D7LM/S
         l5DMLKR0w2p7u2Ggph4OGmaibOKUAobJLPoa9hZz9WC+nzOGCMhavsK/vC6acoPZOTRy
         S8QJkUeOcAzdtBk5M4alctglDcFL8o277wDZznsPH3uhSQsn1sVNxVAU8SAxcBO0zmi1
         X64bCZV0ovQWgwZA5aubyR+TOqX2ZIfZzoexzpVyyDHbCuOuOkqfzTFBq6IkIdWNdX0m
         vpAA==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AA+aEWZoFqlrpKxQf+U7GdaOgZXhBHq++4RAKCuIQjAQTmNWCCzZ4OHS
	o2RnKXpEP5KYpcd6n9//96qoCxg+5HRWJi5fWaGG1zglURLwoPw=
X-Received: by 2002:a17:902:8f97:: with SMTP id z23mr6882249plo.283.1542806661275;
        Wed, 21 Nov 2018 05:24:21 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp1942021pju;
        Wed, 21 Nov 2018 05:24:20 -0800 (PST)
X-Google-Smtp-Source: AFSGD/UQpo5Wab/o38N2i8aNqX2xmlk/f9/zPh/1JuNonS4dvrnDmToyedUdbW4VnjxSwsc5dK6x
X-Received: by 2002:a81:4308:: with SMTP id q8mr1914552ywa.357.1542806659951;
        Wed, 21 Nov 2018 05:24:19 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542806659; cv=none;
        d=google.com; s=arc-20160816;
        b=oExUkEJqOfZuT0BDwcqCpEmAfSl2+8z5BPFi4mcBw5Zel+PCALuwvCyPfiM3/bB46g
         FoMxkNWTPt1vnpRpf66nU8hPyvbQVOTDqmQracAVI9WiG0KdwR5hcN2OxiQa8Drk3zex
         8UeE9xDDZg7CQntfcblwX9nZOSLYKW0awv+jtPyUt7VkTcrfS5UAGMFCTsH3pthO7Uqr
         g8snoEyA85ZGiBdyjwjuZbe2LsU147g6p8v3abhERrbS1Q+7iD2DOCzgjbCiWjiJGFS7
         1UfaGe6FrheoiYQzL6ZwRKJUN1xjMP9MuprEleH+ASegHx38i5lGygmtXBqfuJ9KZvVb
         rdzQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=DjGZWDFZs/NTbmI3y5CqObuGsIRzZJEYXXyHZ19hy4o=;
        b=0d5O4u2JlKQvqQS+Bw7oiVNin1N3FYdgUR+lit3CAig1GbJrFncCDSNBiyiS5XO7CM
         kzNPJ9mQEv9C9xJPbPxvUB6VsVWFTEGQUJg4oDLl46EEEcqfWegMl5lSKjgLi9ntsCXp
         FeNw1Ie7a46nwQItPKdZD4UKKuTTjsDRDaZIHnBnqc1d6u4iBefpqsm/OUNDxEHYayT4
         eATluxr6rQgb5zJCPd5oEzMr4z/I/4IxK7335j4F0/ywhEjGGjR8IHgkno4mHEr5LjAu
         yta/sPP1k6PSDriJYAfeFMmzpIIC3b7svrQF9EKK5wAdvu0cP0vEhwkDJ/e1pDDx3QMP
         jT5Q==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id y17-v6si417261yby.332.2018.11.21.05.24.19
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 21 Nov 2018 05:24:19 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gPSRu-0001iZ-LQ; Wed, 21 Nov 2018 13:21:46 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=2odm=oa=citrix.com=prvs=856d69d10=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1gPSRt-0001iA-8a
 for xen-devel@lists.xen.org; Wed, 21 Nov 2018 13:21:45 +0000
X-Inumbo-ID: 63734e60-ed90-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 63734e60-ed90-11e8-9a16-bc764e045a96;
 Wed, 21 Nov 2018 13:21:43 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,261,1539648000"; d="scan'208";a="71193316"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xen.org>
Date: Wed, 21 Nov 2018 13:21:11 +0000
Message-ID: <1542806482-24030-4-git-send-email-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.1.4
In-Reply-To: <1542806482-24030-1-git-send-email-andrew.cooper3@citrix.com>
References: <1542806482-24030-1-git-send-email-andrew.cooper3@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 03/14] AMD/IOMMU: Fix multiple reference
 counting errors
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Wei Liu <wei.liu2@citrix.com>, Jan Beulich <JBeulich@suse.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 Brian Woods <brian.woods@amd.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwAH6USFXPVbmadjAA--.1278S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvAXoW3ZFW5XryrWFW5ur48Jw1UKFg_yoW8GF4UGo
	WfGr4fZw48Jr1rCrsakFW8KFWrJay5t3yayrZ8Wws5ta18Awn8J347J3sxXFyruF4rGF17
	uFs7Ww4SyFy5Arn3n29KB7ZKAUJUUUUU529EdanIXcx71UUUUj7v73VFW2AGmfu7jjvjm3
	AaLaJ3UjIYCTnIWjp_UUUox7k0a2IF6w4kM7kC6x804xWl14x267AKxVWUJVW8JwAFIxvE
	14AKwVWUJVWUGwA2ocxC64kIII0Yj41l84x0c7CEw4AK67xGY2AK021l84ACjcxK6xIIjx
	v20xvE14v26ryj6F1UM28EF7xvwVC0I7IYx2IY6xkF7I0E14v26r4j6F4UM28EF7xvwVC2
	z280aVAFwI0_GcCE3s1l84ACjcxK6I8E87Iv6xkF7I0E14v26rxl6s0DM2vj6VCEFcxC0V
	AYjxAxZF0EFcxC0VAYjxAxZF0Ew4CEw7xC0VCjxxvEa2IrM2AIxVAIcxkEcVAq07x20xvE
	ncxIr21l5I8CrVACY4xI64kE6c02F40Ex7xfMcIj6xIIjxv20xvE14v26r1j6r18McIj6I
	8E87Iv67AKxVWxJVW8Jr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VW5GwCY0x0Ix7I2Y4AK64vIr41lcIIF0xvE2Ix0cI8I
	cVAFwI0_Gr0_Xr1lcIIF0xvE2Ix0cI8IcVCY1x0267AKxVW8JVWxJwCYIxAIcVC2z280aV
	AFwI0_Cr1j6rxdMxvI42IY6I8E87Iv6xkF7I0E14v26F4UJVW0owCF04k20xvY0x0EwIxG
	rwCF04k20xvEw4C26cxK6c8Ij28IcwCF72vE77IF4wCFx2IqxVCFs4IE7xkEbVWUJVW8Jw
	C20s026c02F40E14v26r1j6r18MI8I3I0E7480Y4vE14v26r106r1rMI8E67AF67kF1VAF
	wI0_Jw0_GFylIxkGc2Ij64vIr41lIxAIcVCF04k26cxKx2IYs7xG6r1j6r1xMVCEFcxC0V
	AYjxAxZFUvcSsGvfC2KfnxnUUI43ZEXa7IUYd73JUUUUU==

TW9zdCBvZiB0aGVzZSBpc3N1ZXMgd291bGQgYmUgWFNBcyBpZiB0aGVzZSBwYXRocyB3ZXJlIGFj
Y2Vzc2libGUgdG8gZ3Vlc3RzLgoKRmlyc3QsIG92ZXJyaWRlIHRoZSB7Z2V0LHB1dH1fZ2ZuKCkg
aGVscGVycyB0byB1c2UgZ2ZuX3QsIHdoaWNoIHdhcyB0aGUKb3JpZ2luYWwgcHVycG9zZSBvZiB0
aGlzIHBhdGNoLgoKZ3Vlc3RfaW9tbXVfZ2V0X3RhYmxlX21mbigpIGhhcyB0d28gYnVncy4gIEZp
cnN0LCBpdCBnZXRzIGEgcmVmIG9uIG9uZSBnZm4sCmFuZCBwdXRzIGEgcmVmIGZvciBhIGRpZmZl
cmVudCBnZm4uICBUaGlzIGlzIG9ubHkgYSBsYXRlbnQgYnVnIGZvciBub3csIGFzIHdlCmRvbid0
IGRvIHBlci1nZm4gbG9ja2luZyB5ZXQuICBOZXh0LCB0aGUgbWZuIHJldHVybiB2YWx1ZSBpcyB1
bnNhZmUgdG8gdXNlCmFmdGVyIHB1dF9nZm4oKSBpcyBjYWxsZWQsIGFzIHRoZSBndWVzdCBjb3Vs
ZCBoYXZlIGZyZWVkIHRoZSBwYWdlIGluIHRoZQptZWFudGltZS4KCkluIGFkZGl0aW9uLCBnZXRf
Z2ZuX2Zyb21fYmFzZV9yZWcoKSBlcnJvbmVvdXNseSBhc3NlcnRzIHRoYXQgYmFzZV9yYXcgY2Fu
J3QKYmUgMCwgYnV0IGl0IG1heSBsZWdpdGltYXRlbHkgYmUuICBPbiB0b3Agb2YgdGhhdCwgdGhl
IHJldHVybiB2YWx1ZSBmcm9tCmd1ZXN0X2lvbW11X2dldF90YWJsZV9tZm4oKSBpcyBwYXNzZWQg
aW50byBtYXBfZG9tYWluX3BhZ2UoKSBiZWZvcmUgY2hlY2tpbmcKdGhhdCBpdCBpcyBhIHJlYWwg
bWZuLgoKTW9zdCBvZiB0aGUgY29tcGxleGl0eSBoZXJlIGlzIGlubGluaW5nIGd1ZXN0X2lvbW11
X2dldF90YWJsZV9tZm4oKSBhbmQKaG9sZGluZyB0aGUgZ2ZuIHJlZmVyZW5jZSB1bnRpbCB0aGUg
b3BlcmF0aW9uIGlzIGNvbXBsZXRlLgoKRnVydGhlcm1vcmUsIGd1ZXN0X2lvbW11X3Byb2Nlc3Nf
Y29tbWFuZCgpIGlzIGFsdGVyZWQgdG8gdGFrZSBhIGxvY2FsIGNvcHkgb2YKY21kX2VudHJ5X3Qs
IHJhdGhlciB0aGFuIHBhc3NpbmcgYSBwb2ludGVyIHRvIGd1ZXN0IGNvbnRyb2xsZWQgbWVtb3J5
IGludG8KZWFjaCBvZiB0aGUgaGFuZGxpbmcgZnVuY3Rpb25zLiAgSXQgaXMgYWxzbyBtb2RpZmll
ZCB0byBicmVhayBvbiBlcnJvciByYXRoZXIKdGhhbiBjb250aW51ZS4gIFRoZXNlIGNoYW5nZXMg
YXJlIGluIGxpbmUgd2l0aCB0aGUgc3BlYyB3aGljaCBzdGF0ZXMgdGhhdCB0aGUKSU9NTVUgd2ls
bCBzdHJpY3RseSByZWFkIGEgY29tbWFuZCBlbnRyeSBvbmNlLCBhbmQgd2lsbCBjZWFzZSBwcm9j
ZXNzaW5nIGlmIGFuCmVycm9yIGlzIGVuY291bnRlcmVkLgoKU2lnbmVkLW9mZi1ieTogQW5kcmV3
IENvb3BlciA8YW5kcmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KLS0tCkNDOiBKYW4gQmV1bGljaCA8
SkJldWxpY2hAc3VzZS5jb20+CkNDOiBXZWkgTGl1IDx3ZWkubGl1MkBjaXRyaXguY29tPgpDQzog
Um9nZXIgUGF1IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+CkNDOiBTdXJhdmVlIFN1dGhp
a3VscGFuaXQgPHN1cmF2ZWUuc3V0aGlrdWxwYW5pdEBhbWQuY29tPgpDQzogQnJpYW4gV29vZHMg
PGJyaWFuLndvb2RzQGFtZC5jb20+CgpUaGlzIHBhdGNoIG15IG5vIG1lYW5zIGluZGljYXRlcyB0
aGF0IHRoZSBjb2RlIGlzIHJlYWR5IGZvciBwcm9kdWN0aW9uIHVzZS4KLS0tCiB4ZW4vZHJpdmVy
cy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZ3Vlc3QuYyB8IDIyNCArKysrKysrKysrKysrKysrKysr
LS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNDYgaW5zZXJ0aW9ucygrKSwgNzggZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2RyaXZlcnMvcGFzc3Rocm91Z2gvYW1kL2lvbW11X2d1
ZXN0LmMgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZ3Vlc3QuYwppbmRleCA5
NjE3NWJiLi4wM2NhMGNmIDEwMDY0NAotLS0gYS94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQv
aW9tbXVfZ3Vlc3QuYworKysgYi94ZW4vZHJpdmVycy9wYXNzdGhyb3VnaC9hbWQvaW9tbXVfZ3Vl
c3QuYwpAQCAtMjEsNiArMjEsMTMgQEAKICNpbmNsdWRlIDxhc20vYW1kLWlvbW11Lmg+CiAjaW5j
bHVkZSA8YXNtL2h2bS9zdm0vYW1kLWlvbW11LXByb3RvLmg+CiAKKy8qIE92ZXJyaWRlIHtnZXQs
cHV0fV9nZm4gdG8gd29yayB3aXRoIGdmbl90ICovCisjdW5kZWYgZ2V0X2dmbgorI2RlZmluZSBn
ZXRfZ2ZuKGQsIGcsIHQpIGdldF9nZm5fdHlwZShkLCBnZm5feChnKSwgdCwgUDJNX0FMTE9DKQor
I3VuZGVmIGdldF9nZm5fcXVlcnkKKyNkZWZpbmUgZ2V0X2dmbl9xdWVyeShkLCBnLCB0KSBnZXRf
Z2ZuX3R5cGUoZCwgZ2ZuX3goZyksIHQsIDApCisjdW5kZWYgcHV0X2dmbgorI2RlZmluZSBwdXRf
Z2ZuKGQsIGcpIF9fcHV0X2dmbihwMm1fZ2V0X2hvc3RwMm0oZCksIGdmbl94KGcpKQogCiAjZGVm
aW5lIElPTU1VX01NSU9fU0laRSAgICAgICAgICAgICAgICAgICAgICAgICAweDgwMDAKICNkZWZp
bmUgSU9NTVVfTU1JT19QQUdFX05SICAgICAgICAgICAgICAgICAgICAgIDB4OApAQCAtMTE3LDEz
ICsxMjQsNiBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGhvc3RfZG9taWQoc3RydWN0IGRvbWFpbiAq
ZCwgdWludDY0X3QgZ19kb21pZCkKICAgICByZXR1cm4gZC0+ZG9tYWluX2lkOwogfQogCi1zdGF0
aWMgdW5zaWduZWQgbG9uZyBnZXRfZ2ZuX2Zyb21fYmFzZV9yZWcodWludDY0X3QgYmFzZV9yYXcp
Ci17Ci0gICAgYmFzZV9yYXcgJj0gUEFERFJfTUFTSzsKLSAgICBBU1NFUlQgKCBiYXNlX3JhdyAh
PSAwICk7Ci0gICAgcmV0dXJuIGJhc2VfcmF3ID4+IFBBR0VfU0hJRlQ7Ci19Ci0KIHN0YXRpYyB2
b2lkIGd1ZXN0X2lvbW11X2RlbGl2ZXJfbXNpKHN0cnVjdCBkb21haW4gKmQpCiB7CiAgICAgdWlu
dDhfdCB2ZWN0b3IsIGRlc3QsIGRlc3RfbW9kZSwgZGVsaXZlcnlfbW9kZSwgdHJpZ19tb2RlOwpA
QCAtMTM4LDIzICsxMzgsNiBAQCBzdGF0aWMgdm9pZCBndWVzdF9pb21tdV9kZWxpdmVyX21zaShz
dHJ1Y3QgZG9tYWluICpkKQogICAgIHZtc2lfZGVsaXZlcihkLCB2ZWN0b3IsIGRlc3QsIGRlc3Rf
bW9kZSwgZGVsaXZlcnlfbW9kZSwgdHJpZ19tb2RlKTsKIH0KIAotc3RhdGljIHVuc2lnbmVkIGxv
bmcgZ3Vlc3RfaW9tbXVfZ2V0X3RhYmxlX21mbihzdHJ1Y3QgZG9tYWluICpkLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBiYXNlX3JhdywK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQg
aW50IGVudHJ5X3NpemUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVuc2lnbmVkIGludCBwb3MpCi17Ci0gICAgdW5zaWduZWQgbG9uZyBpZHgsIGdmbiwg
bWZuOwotICAgIHAybV90eXBlX3QgcDJtdDsKLQotICAgIGdmbiA9IGdldF9nZm5fZnJvbV9iYXNl
X3JlZyhiYXNlX3Jhdyk7Ci0gICAgaWR4ID0gKHBvcyAqIGVudHJ5X3NpemUpID4+IFBBR0VfU0hJ
RlQ7Ci0KLSAgICBtZm4gPSBtZm5feChnZXRfZ2ZuKGQsIGdmbiArIGlkeCwgJnAybXQpKTsKLSAg
ICBwdXRfZ2ZuKGQsIGdmbik7Ci0KLSAgICByZXR1cm4gbWZuOwotfQotCiBzdGF0aWMgdm9pZCBn
dWVzdF9pb21tdV9lbmFibGVfZGV2X3RhYmxlKHN0cnVjdCBndWVzdF9pb21tdSAqaW9tbXUpCiB7
CiAgICAgdWludDMyX3QgbGVuZ3RoX3JhdyA9IGdldF9maWVsZF9mcm9tX3JlZ191MzIoaW9tbXUt
PmRldl90YWJsZS5yZWdfYmFzZS5sbywKQEAgLTE3Niw3ICsxNTksMTAgQEAgc3RhdGljIHZvaWQg
Z3Vlc3RfaW9tbXVfZW5hYmxlX3JpbmdfYnVmZmVyKHN0cnVjdCBndWVzdF9pb21tdSAqaW9tbXUs
CiB2b2lkIGd1ZXN0X2lvbW11X2FkZF9wcHJfbG9nKHN0cnVjdCBkb21haW4gKmQsIHUzMiBlbnRy
eVtdKQogewogICAgIHVpbnQxNl90IGdkZXZfaWQ7Ci0gICAgdW5zaWduZWQgbG9uZyBtZm4sIHRh
aWwsIGhlYWQ7CisgICAgdW5zaWduZWQgbG9uZyB0YWlsLCBoZWFkOworICAgIG1mbl90IG1mbjsK
KyAgICBnZm5fdCBnZm47CisgICAgcDJtX3R5cGVfdCBwMm10OwogICAgIHBwcl9lbnRyeV90ICps
b2csICpsb2dfYmFzZTsKICAgICBzdHJ1Y3QgZ3Vlc3RfaW9tbXUgKmlvbW11OwogCkBAIC0xOTcs
MTEgKzE4MywyNCBAQCB2b2lkIGd1ZXN0X2lvbW11X2FkZF9wcHJfbG9nKHN0cnVjdCBkb21haW4g
KmQsIHUzMiBlbnRyeVtdKQogICAgICAgICByZXR1cm47CiAgICAgfQogCi0gICAgbWZuID0gZ3Vl
c3RfaW9tbXVfZ2V0X3RhYmxlX21mbihkLCByZWdfdG9fdTY0KGlvbW11LT5wcHJfbG9nLnJlZ19i
YXNlKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihwcHJfZW50
cnlfdCksIHRhaWwpOwotICAgIEFTU0VSVChtZm5fdmFsaWQoX21mbihtZm4pKSk7CisgICAgZ2Zu
ID0gX2dmbihQRk5fRE9XTihyZWdfdG9fdTY0KGlvbW11LT5wcHJfbG9nLnJlZ19iYXNlKSkgKwor
ICAgICAgICAgICAgICAgUEZOX0RPV04odGFpbCAqIHNpemVvZigqbG9nKSkpOwogCi0gICAgbG9n
X2Jhc2UgPSBtYXBfZG9tYWluX3BhZ2UoX21mbihtZm4pKTsKKyAgICBtZm4gPSBnZXRfZ2ZuKGQs
IGdmbiwgJnAybXQpOworICAgIGlmICggbWZuX2VxKG1mbiwgSU5WQUxJRF9NRk4pIHx8ICFwMm1f
aXNfcmFtKHAybXQpICkKKyAgICB7CisgICAgICAgIEFNRF9JT01NVV9ERUJVRygKKyAgICAgICAg
ICAgICJFcnJvcjogZ3Vlc3QgaW9tbXUgcHByIGxvZyBiYWQgZ2ZuICUiUFJJX2dmbiIsIHR5cGUg
JXUsIG1mbiAlIgorICAgICAgICAgICAgUFJJX21mbiIsIHJlZ19iYXNlICUjIlBSSXg2NCIsIHRh
aWwgJSNseFxuIiwKKyAgICAgICAgICAgIGdmbl94KGdmbiksIHAybXQsIG1mbl94KG1mbiksCisg
ICAgICAgICAgICByZWdfdG9fdTY0KGlvbW11LT5wcHJfbG9nLnJlZ19iYXNlKSwgdGFpbCk7Cisg
ICAgICAgIGd1ZXN0X2lvbW11X2Rpc2FibGUoaW9tbXUpOworICAgICAgICBnb3RvIG91dDsKKyAg
ICB9CisKKyAgICBBU1NFUlQobWZuX3ZhbGlkKG1mbikpOworCisgICAgbG9nX2Jhc2UgPSBtYXBf
ZG9tYWluX3BhZ2UobWZuKTsKICAgICBsb2cgPSBsb2dfYmFzZSArIHRhaWwgJSAoUEFHRV9TSVpF
IC8gc2l6ZW9mKHBwcl9lbnRyeV90KSk7CiAKICAgICAvKiBDb252ZXJ0IHBoeXNpY2FsIGRldmlj
ZSBpZCBiYWNrIGludG8gdmlydHVhbCBkZXZpY2UgaWQgKi8KQEAgLTIyMCwxMiArMjE5LDE4IEBA
IHZvaWQgZ3Vlc3RfaW9tbXVfYWRkX3Bwcl9sb2coc3RydWN0IGRvbWFpbiAqZCwgdTMyIGVudHJ5
W10pCiAgICAgdW5tYXBfZG9tYWluX3BhZ2UobG9nX2Jhc2UpOwogCiAgICAgZ3Vlc3RfaW9tbXVf
ZGVsaXZlcl9tc2koZCk7CisKK291dDoKKyAgICBwdXRfZ2ZuKGQsIGdmbik7CiB9CiAKIHZvaWQg
Z3Vlc3RfaW9tbXVfYWRkX2V2ZW50X2xvZyhzdHJ1Y3QgZG9tYWluICpkLCB1MzIgZW50cnlbXSkK
IHsKICAgICB1aW50MTZfdCBkZXZfaWQ7Ci0gICAgdW5zaWduZWQgbG9uZyBtZm4sIHRhaWwsIGhl
YWQ7CisgICAgdW5zaWduZWQgbG9uZyB0YWlsLCBoZWFkOworICAgIG1mbl90IG1mbjsKKyAgICBn
Zm5fdCBnZm47CisgICAgcDJtX3R5cGVfdCBwMm10OwogICAgIGV2ZW50X2VudHJ5X3QgKmxvZywg
KmxvZ19iYXNlOwogICAgIHN0cnVjdCBndWVzdF9pb21tdSAqaW9tbXU7CiAKQEAgLTI0NiwxMSAr
MjUxLDI0IEBAIHZvaWQgZ3Vlc3RfaW9tbXVfYWRkX2V2ZW50X2xvZyhzdHJ1Y3QgZG9tYWluICpk
LCB1MzIgZW50cnlbXSkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAotICAgIG1mbiA9IGd1ZXN0
X2lvbW11X2dldF90YWJsZV9tZm4oZCwgcmVnX3RvX3U2NChpb21tdS0+ZXZlbnRfbG9nLnJlZ19i
YXNlKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihldmVudF9l
bnRyeV90KSwgdGFpbCk7Ci0gICAgQVNTRVJUKG1mbl92YWxpZChfbWZuKG1mbikpKTsKKyAgICBn
Zm4gPSBfZ2ZuKFBGTl9ET1dOKHJlZ190b191NjQoaW9tbXUtPmV2ZW50X2xvZy5yZWdfYmFzZSkp
ICsKKyAgICAgICAgICAgICAgIFBGTl9ET1dOKHRhaWwgKiBzaXplb2YoKmxvZykpKTsKKworICAg
IG1mbiA9IGdldF9nZm4oZCwgZ2ZuLCAmcDJtdCk7CisgICAgaWYgKCBtZm5fZXEobWZuLCBJTlZB
TElEX01GTikgfHwgIXAybV9pc19yYW0ocDJtdCkgKQorICAgIHsKKyAgICAgICAgQU1EX0lPTU1V
X0RFQlVHKAorICAgICAgICAgICAgIkVycm9yOiBndWVzdCBpb21tdSBldmVudCBsb2cgYmFkIGdm
biAlIlBSSV9nZm4iLCB0eXBlICV1LCBtZm4gJSIKKyAgICAgICAgICAgIFBSSV9tZm4iLCByZWdf
YmFzZSAlIyJQUkl4NjQiLCB0YWlsICUjbHhcbiIsCisgICAgICAgICAgICBnZm5feChnZm4pLCBw
Mm10LCBtZm5feChtZm4pLAorICAgICAgICAgICAgcmVnX3RvX3U2NChpb21tdS0+cHByX2xvZy5y
ZWdfYmFzZSksIHRhaWwpOworICAgICAgICBndWVzdF9pb21tdV9kaXNhYmxlKGlvbW11KTsKKyAg
ICAgICAgZ290byBvdXQ7CisgICAgfQorCisgICAgQVNTRVJUKG1mbl92YWxpZChtZm4pKTsKIAot
ICAgIGxvZ19iYXNlID0gbWFwX2RvbWFpbl9wYWdlKF9tZm4obWZuKSk7CisgICAgbG9nX2Jhc2Ug
PSBtYXBfZG9tYWluX3BhZ2UobWZuKTsKICAgICBsb2cgPSBsb2dfYmFzZSArIHRhaWwgJSAoUEFH
RV9TSVpFIC8gc2l6ZW9mKGV2ZW50X2VudHJ5X3QpKTsKIAogICAgIC8qIHJlLXdyaXRlIHBoeXNp
Y2FsIGRldmljZSBpZCBpbnRvIHZpcnR1YWwgZGV2aWNlIGlkICovCkBAIC0yNjksNiArMjg3LDkg
QEAgdm9pZCBndWVzdF9pb21tdV9hZGRfZXZlbnRfbG9nKHN0cnVjdCBkb21haW4gKmQsIHUzMiBl
bnRyeVtdKQogICAgIHVubWFwX2RvbWFpbl9wYWdlKGxvZ19iYXNlKTsKIAogICAgIGd1ZXN0X2lv
bW11X2RlbGl2ZXJfbXNpKGQpOworCitvdXQ6CisgICAgcHV0X2dmbihkLCBnZm4pOwogfQogCiBz
dGF0aWMgaW50IGRvX2NvbXBsZXRlX3Bwcl9yZXF1ZXN0KHN0cnVjdCBkb21haW4gKmQsIGNtZF9l
bnRyeV90ICpjbWQpCkBAIC0zNDYsMTAgKzM2Nyw4IEBAIHN0YXRpYyBpbnQgZG9faW52YWxpZGF0
ZV9pb3RsYl9wYWdlcyhzdHJ1Y3QgZG9tYWluICpkLCBjbWRfZW50cnlfdCAqY21kKQogCiBzdGF0
aWMgaW50IGRvX2NvbXBsZXRpb25fd2FpdChzdHJ1Y3QgZG9tYWluICpkLCBjbWRfZW50cnlfdCAq
Y21kKQogewotICAgIGJvb2xfdCBjb21fd2FpdF9pbnRfZW4sIGNvbV93YWl0X2ludCwgaSwgczsK
KyAgICBib29sIGNvbV93YWl0X2ludF9lbiwgY29tX3dhaXRfaW50LCBpLCBzOwogICAgIHN0cnVj
dCBndWVzdF9pb21tdSAqaW9tbXU7Ci0gICAgdW5zaWduZWQgbG9uZyBnZm47Ci0gICAgcDJtX3R5
cGVfdCBwMm10OwogCiAgICAgaW9tbXUgPSBkb21haW5faW9tbXUoZCk7CiAKQEAgLTM2Miw3ICsz
ODEsMTAgQEAgc3RhdGljIGludCBkb19jb21wbGV0aW9uX3dhaXQoc3RydWN0IGRvbWFpbiAqZCwg
Y21kX2VudHJ5X3QgKmNtZCkKICAgICBpZiAoIHMgKQogICAgIHsKICAgICAgICAgdWludDY0X3Qg
Z2FkZHJfbG8sIGdhZGRyX2hpLCBnYWRkcl82NCwgZGF0YTsKLSAgICAgICAgdm9pZCAqdmFkZHI7
CisgICAgICAgIG1mbl90IG1mbjsKKyAgICAgICAgZ2ZuX3QgZ2ZuOworICAgICAgICBwMm1fdHlw
ZV90IHAybXQ7CisgICAgICAgIHVpbnQ2NF90ICpwdHI7CiAKICAgICAgICAgZGF0YSA9ICh1aW50
NjRfdCljbWQtPmRhdGFbM10gPDwgMzIgfCBjbWQtPmRhdGFbMl07CiAgICAgICAgIGdhZGRyX2xv
ID0gZ2V0X2ZpZWxkX2Zyb21fcmVnX3UzMihjbWQtPmRhdGFbMF0sCkBAIC0zNzQsMTMgKzM5Niwy
NCBAQCBzdGF0aWMgaW50IGRvX2NvbXBsZXRpb25fd2FpdChzdHJ1Y3QgZG9tYWluICpkLCBjbWRf
ZW50cnlfdCAqY21kKQogCiAgICAgICAgIGdhZGRyXzY0ID0gKGdhZGRyX2hpIDw8IDMyKSB8IChn
YWRkcl9sbyA8PCAzKTsKIAotICAgICAgICBnZm4gPSBnYWRkcl82NCA+PiBQQUdFX1NISUZUOwot
ICAgICAgICB2YWRkciA9IG1hcF9kb21haW5fcGFnZShnZXRfZ2ZuKGQsIGdmbiAsJnAybXQpKTsK
LSAgICAgICAgcHV0X2dmbihkLCBnZm4pOworICAgICAgICBnZm4gPSBfZ2ZuKGdhZGRyXzY0ID4+
IFBBR0VfU0hJRlQpOworICAgICAgICBtZm4gPSBnZXRfZ2ZuKGQsIGdmbiwgJnAybXQpOwogCi0g
ICAgICAgIHdyaXRlX3U2NF9hdG9taWMoKHVpbnQ2NF90ICopKHZhZGRyICsgKGdhZGRyXzY0ICYg
KFBBR0VfU0laRS0xKSkpLAotICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEpOwotICAgICAg
ICB1bm1hcF9kb21haW5fcGFnZSh2YWRkcik7CisgICAgICAgIGlmICggbWZuX2VxKG1mbiwgSU5W
QUxJRF9NRk4pIHx8ICFwMm1faXNfcmFtKHAybXQpICkKKyAgICAgICAgeworICAgICAgICAgICAg
LyogWFhYIC0gV2hhdCB0byBkbyBoZXJlLCBlcnJvciB3aXNlPyAqLworICAgICAgICAgICAgZ3Vl
c3RfaW9tbXVfZGlzYWJsZShpb21tdSk7CisgICAgICAgICAgICBwdXRfZ2ZuKGQsIGdmbik7CisK
KyAgICAgICAgICAgIHJldHVybiAwOworICAgICAgICB9CisKKyAgICAgICAgcHRyID0gbWFwX2Rv
bWFpbl9wYWdlKG1mbikgKyAoZ2FkZHJfNjQgJiB+UEFHRV9NQVNLKTsKKworICAgICAgICB3cml0
ZV91NjRfYXRvbWljKHB0ciwgZGF0YSk7CisgICAgICAgIHVubWFwX2RvbWFpbl9wYWdlKHB0cik7
CisKKyAgICAgICAgcHV0X2dmbihkLCBnZm4pOwogICAgIH0KIAogICAgIGNvbV93YWl0X2ludF9l
biA9IGlvbW11X2dldF9iaXQoaW9tbXUtPnJlZ19jdHJsLmxvLApAQCAtNDAwLDkgKzQzMywxMCBA
QCBzdGF0aWMgaW50IGRvX2ludmFsaWRhdGVfZHRlKHN0cnVjdCBkb21haW4gKmQsIGNtZF9lbnRy
eV90ICpjbWQpCiAgICAgZGV2X2VudHJ5X3QgKmdkdGUsICptZHRlLCAqZHRlX2Jhc2U7CiAgICAg
c3RydWN0IGFtZF9pb21tdSAqaW9tbXUgPSBOVUxMOwogICAgIHN0cnVjdCBndWVzdF9pb21tdSAq
Z19pb21tdTsKLSAgICB1aW50NjRfdCBnY3IzX2dmbiwgZ2NyM19tZm47CisgICAgbWZuX3QgZHRl
X21mbiwgZ2NyM19tZm47CisgICAgZ2ZuX3QgZHRlX2dmbiwgZ2NyM19nZm47CiAgICAgdWludDhf
dCBnbHgsIGd2OwotICAgIHVuc2lnbmVkIGxvbmcgZHRlX21mbiwgZmxhZ3M7CisgICAgdW5zaWdu
ZWQgbG9uZyBmbGFnczsKICAgICBwMm1fdHlwZV90IHAybXQ7CiAKICAgICBnX2lvbW11ID0gZG9t
YWluX2lvbW11KGQpOwpAQCAtNDE3LDM1ICs0NTEsNDkgQEAgc3RhdGljIGludCBkb19pbnZhbGlk
YXRlX2R0ZShzdHJ1Y3QgZG9tYWluICpkLCBjbWRfZW50cnlfdCAqY21kKQogICAgIGlmICggKGdi
ZGYgKiBzaXplb2YoZGV2X2VudHJ5X3QpKSA+IGdfaW9tbXUtPmRldl90YWJsZS5zaXplICkKICAg
ICAgICAgcmV0dXJuIDA7CiAKLSAgICBkdGVfbWZuID0gZ3Vlc3RfaW9tbXVfZ2V0X3RhYmxlX21m
bihkLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ190b191NjQo
Z19pb21tdS0+ZGV2X3RhYmxlLnJlZ19iYXNlKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzaXplb2YoZGV2X2VudHJ5X3QpLCBnYmRmKTsKLSAgICBBU1NFUlQobWZu
X3ZhbGlkKF9tZm4oZHRlX21mbikpKTsKKyAgICBkdGVfZ2ZuID0gX2dmbihQRk5fRE9XTihyZWdf
dG9fdTY0KGdfaW9tbXUtPmRldl90YWJsZS5yZWdfYmFzZSkpICsKKyAgICAgICAgICAgICAgICAg
ICBQRk5fRE9XTihnYmRmICogc2l6ZW9mKCpnZHRlKSkpOworICAgIGR0ZV9tZm4gPSBnZXRfZ2Zu
KGQsIGR0ZV9nZm4sICZwMm10KTsKKworICAgIGlmICggbWZuX2VxKGR0ZV9tZm4sIElOVkFMSURf
TUZOKSB8fCAhcDJtX2lzX3JhbShwMm10KSApCisgICAgeworICAgICAgICBwdXRfZ2ZuKGQsIGR0
ZV9nZm4pOworICAgICAgICByZXR1cm4gMDsKKyAgICB9CisKKyAgICBBU1NFUlQobWZuX3ZhbGlk
KGR0ZV9tZm4pKTsKIAogICAgIC8qIFJlYWQgZ3Vlc3QgZHRlIGluZm9ybWF0aW9uICovCi0gICAg
ZHRlX2Jhc2UgPSBtYXBfZG9tYWluX3BhZ2UoX21mbihkdGVfbWZuKSk7CisgICAgZHRlX2Jhc2Ug
PSBtYXBfZG9tYWluX3BhZ2UoZHRlX21mbik7CiAKICAgICBnZHRlID0gZHRlX2Jhc2UgKyBnYmRm
ICUgKFBBR0VfU0laRSAvIHNpemVvZihkZXZfZW50cnlfdCkpOwogCiAgICAgZ2RvbV9pZCAgPSBn
ZXRfZG9taWRfZnJvbV9kdGUoZ2R0ZSk7Ci0gICAgZ2NyM19nZm4gPSBnZXRfZ3Vlc3RfY3IzX2Zy
b21fZHRlKGdkdGUpOworICAgIGdjcjNfZ2ZuID0gX2dmbihnZXRfZ3Vlc3RfY3IzX2Zyb21fZHRl
KGdkdGUpKTsKICAgICBnbHggICAgICA9IGdldF9nbHhfZnJvbV9kdGUoZ2R0ZSk7CiAgICAgZ3Yg
ICAgICAgPSBnZXRfZ3ZfZnJvbV9kdGUoZ2R0ZSk7CiAKICAgICB1bm1hcF9kb21haW5fcGFnZShk
dGVfYmFzZSk7CisgICAgcHV0X2dmbihkLCBkdGVfZ2ZuKTsKIAogICAgIC8qIERvIG5vdCB1cGRh
dGUgaG9zdCBkdGUgYmVmb3JlIGdjcjMgaGFzIGJlZW4gc2V0ICovCi0gICAgaWYgKCBnY3IzX2dm
biA9PSAwICkKKyAgICBpZiAoIGdmbl94KGdjcjNfZ2ZuKSA9PSAwICkKICAgICAgICAgcmV0dXJu
IDA7CiAKLSAgICBnY3IzX21mbiA9IG1mbl94KGdldF9nZm4oZCwgZ2NyM19nZm4sICZwMm10KSk7
Ci0gICAgcHV0X2dmbihkLCBnY3IzX2dmbik7CisgICAgZ2NyM19tZm4gPSBnZXRfZ2ZuKGQsIGdj
cjNfZ2ZuLCAmcDJtdCk7CiAKLSAgICBBU1NFUlQobWZuX3ZhbGlkKF9tZm4oZ2NyM19tZm4pKSk7
CisgICAgaWYgKCBtZm5fZXEoZ2NyM19tZm4sIElOVkFMSURfTUZOKSB8fCAhcDJtX2lzX3JhbShw
Mm10KSApCisgICAgeworICAgICAgICBwdXRfZ2ZuKGQsIGdjcjNfZ2ZuKTsKKyAgICAgICAgcmV0
dXJuIDA7CisgICAgfQorCisgICAgQVNTRVJUKG1mbl92YWxpZChnY3IzX21mbikpOwogCiAgICAg
aW9tbXUgPSBmaW5kX2lvbW11X2Zvcl9kZXZpY2UoMCwgbWJkZik7CiAgICAgaWYgKCAhaW9tbXUg
KQogICAgIHsKKyAgICAgICAgcHV0X2dmbihkLCBnY3IzX2dmbik7CiAgICAgICAgIEFNRF9JT01N
VV9ERUJVRygiJXM6IEZhaWwgdG8gZmluZCBpb21tdSBmb3IgYmRmICV4IVxuIiwKICAgICAgICAg
ICAgICAgICAgICAgICAgIF9fZnVuY19fLCBtYmRmKTsKICAgICAgICAgcmV0dXJuIC1FTk9ERVY7
CkBAIC00NTgsMTggKzUwNiwxOSBAQCBzdGF0aWMgaW50IGRvX2ludmFsaWRhdGVfZHRlKHN0cnVj
dCBkb21haW4gKmQsIGNtZF9lbnRyeV90ICpjbWQpCiAKICAgICBzcGluX2xvY2tfaXJxc2F2ZSgm
aW9tbXUtPmxvY2ssIGZsYWdzKTsKICAgICBpb21tdV9kdGVfc2V0X2d1ZXN0X2NyMygodTMyICop
bWR0ZSwgaGRvbV9pZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBnY3IzX21mbiA8PCBQ
QUdFX1NISUZULCBndiwgZ2x4KTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZm5fdG9f
bWFkZHIoZ2NyM19tZm4pLCBndiwgZ2x4KTsKIAogICAgIGFtZF9pb21tdV9mbHVzaF9kZXZpY2Uo
aW9tbXUsIHJlcV9pZCk7CiAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaW9tbXUtPmxvY2ss
IGZsYWdzKTsKIAorICAgIHB1dF9nZm4oZCwgZ2NyM19nZm4pOworCiAgICAgcmV0dXJuIDA7CiB9
CiAKIHN0YXRpYyB2b2lkIGd1ZXN0X2lvbW11X3Byb2Nlc3NfY29tbWFuZCh1bnNpZ25lZCBsb25n
IF9kKQogewotICAgIHVuc2lnbmVkIGxvbmcgb3Bjb2RlLCB0YWlsLCBoZWFkLCBlbnRyaWVzX3Bl
cl9wYWdlLCBjbWRfbWZuOwotICAgIGNtZF9lbnRyeV90ICpjbWQsICpjbWRfYmFzZTsKKyAgICB1
bnNpZ25lZCBsb25nIHRhaWwsIGhlYWQ7CiAgICAgc3RydWN0IGRvbWFpbiAqZCA9IChzdHJ1Y3Qg
ZG9tYWluICopX2Q7CiAgICAgc3RydWN0IGd1ZXN0X2lvbW11ICppb21tdTsKIApAQCAtNDkzLDU2
ICs1NDIsNzUgQEAgc3RhdGljIHZvaWQgZ3Vlc3RfaW9tbXVfcHJvY2Vzc19jb21tYW5kKHVuc2ln
bmVkIGxvbmcgX2QpCiAgICAgICAgIHJldHVybjsKICAgICB9CiAKLSAgICBlbnRyaWVzX3Blcl9w
YWdlID0gUEFHRV9TSVpFIC8gc2l6ZW9mKGNtZF9lbnRyeV90KTsKLQogICAgIHdoaWxlICggaGVh
ZCAhPSB0YWlsICkKICAgICB7CisgICAgICAgIG1mbl90IG1mbjsKKyAgICAgICAgZ2ZuX3QgZ2Zu
OworICAgICAgICBwMm1fdHlwZV90IHAybXQ7CisgICAgICAgIGNtZF9lbnRyeV90IGNtZCwgKnB0
cjsKICAgICAgICAgaW50IHJldCA9IDA7CisgICAgICAgIHVuc2lnbmVkIGludCBvcGNvZGU7CisK
KyAgICAgICAgZ2ZuID0gX2dmbihQRk5fRE9XTihyZWdfdG9fdTY0KGlvbW11LT5jbWRfYnVmZmVy
LnJlZ19iYXNlKSkgKworICAgICAgICAgICAgICAgICAgIFBGTl9ET1dOKGhlYWQgKiBzaXplb2Yo
Y21kKSkpOwogCi0gICAgICAgIGNtZF9tZm4gPSBndWVzdF9pb21tdV9nZXRfdGFibGVfbWZuKGQs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ190b191NjQo
aW9tbXUtPmNtZF9idWZmZXIucmVnX2Jhc2UpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBzaXplb2YoY21kX2VudHJ5X3QpLCBoZWFkKTsKLSAgICAgICAgQVNT
RVJUKG1mbl92YWxpZChfbWZuKGNtZF9tZm4pKSk7CisgICAgICAgIG1mbiA9IGdldF9nZm4oZCwg
Z2ZuLCAmcDJtdCk7CisgICAgICAgIGlmICggbWZuX2VxKG1mbiwgSU5WQUxJRF9NRk4pIHx8ICFw
Mm1faXNfcmFtKHAybXQpICkKKyAgICAgICAgeworICAgICAgICAgICAgQU1EX0lPTU1VX0RFQlVH
KAorICAgICAgICAgICAgICAgICJFcnJvcjogZ3Vlc3QgaW9tbXUgY21kIGJ1ZmZlciBiYWQgZ2Zu
ICUiUFJJX2dmbiIsIHR5cGUgJXUsIG1mbiAlIgorICAgICAgICAgICAgICAgIFBSSV9tZm4iLCBy
ZWdfYmFzZSAlIyJQUkl4NjQiLCBoZWFkICUjbHhcbiIsCisgICAgICAgICAgICAgICAgZ2ZuX3go
Z2ZuKSwgcDJtdCwgbWZuX3gobWZuKSwKKyAgICAgICAgICAgICAgICByZWdfdG9fdTY0KGlvbW11
LT5jbWRfYnVmZmVyLnJlZ19iYXNlKSwgaGVhZCk7CisgICAgICAgICAgICBwdXRfZ2ZuKGQsIGdm
bik7CisgICAgICAgICAgICBndWVzdF9pb21tdV9kaXNhYmxlKGlvbW11KTsKKyAgICAgICAgICAg
IHJldHVybjsKKyAgICAgICAgfQogCi0gICAgICAgIGNtZF9iYXNlID0gbWFwX2RvbWFpbl9wYWdl
KF9tZm4oY21kX21mbikpOwotICAgICAgICBjbWQgPSBjbWRfYmFzZSArIGhlYWQgJSBlbnRyaWVz
X3Blcl9wYWdlOworICAgICAgICBwdHIgPSBtYXBfZG9tYWluX3BhZ2UobWZuKSArIGhlYWQgJSAo
UEFHRV9TSVpFIC8gc2l6ZW9mKGNtZF9lbnRyeV90KSk7CisgICAgICAgIG1lbWNweSgmY21kLCBw
dHIsIHNpemVvZihjbWQpKTsKKyAgICAgICAgdW5tYXBfZG9tYWluX3BhZ2UocHRyKTsKKyAgICAg
ICAgcHV0X2dmbihkLCBnZm4pOwogCi0gICAgICAgIG9wY29kZSA9IGdldF9maWVsZF9mcm9tX3Jl
Z191MzIoY21kLT5kYXRhWzFdLAorICAgICAgICBvcGNvZGUgPSBnZXRfZmllbGRfZnJvbV9yZWdf
dTMyKGNtZC5kYXRhWzFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IElPTU1VX0NNRF9PUENPREVfTUFTSywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBJT01NVV9DTURfT1BDT0RFX1NISUZUKTsKICAgICAgICAgc3dpdGNoICggb3Bjb2Rl
ICkKICAgICAgICAgewogICAgICAgICBjYXNlIElPTU1VX0NNRF9DT01QTEVUSU9OX1dBSVQ6Ci0g
ICAgICAgICAgICByZXQgPSBkb19jb21wbGV0aW9uX3dhaXQoZCwgY21kKTsKKyAgICAgICAgICAg
IHJldCA9IGRvX2NvbXBsZXRpb25fd2FpdChkLCAmY21kKTsKICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICBjYXNlIElPTU1VX0NNRF9JTlZBTElEQVRFX0RFVlRBQl9FTlRSWToKLSAgICAgICAg
ICAgIHJldCA9IGRvX2ludmFsaWRhdGVfZHRlKGQsIGNtZCk7CisgICAgICAgICAgICByZXQgPSBk
b19pbnZhbGlkYXRlX2R0ZShkLCAmY21kKTsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBj
YXNlIElPTU1VX0NNRF9JTlZBTElEQVRFX0lPTU1VX1BBR0VTOgotICAgICAgICAgICAgcmV0ID0g
ZG9faW52YWxpZGF0ZV9wYWdlcyhkLCBjbWQpOworICAgICAgICAgICAgcmV0ID0gZG9faW52YWxp
ZGF0ZV9wYWdlcyhkLCAmY21kKTsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBjYXNlIElP
TU1VX0NNRF9JTlZBTElEQVRFX0lPVExCX1BBR0VTOgotICAgICAgICAgICAgcmV0ID0gZG9faW52
YWxpZGF0ZV9pb3RsYl9wYWdlcyhkLCBjbWQpOworICAgICAgICAgICAgcmV0ID0gZG9faW52YWxp
ZGF0ZV9pb3RsYl9wYWdlcyhkLCAmY21kKTsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBj
YXNlIElPTU1VX0NNRF9JTlZBTElEQVRFX0lOVF9UQUJMRToKICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICBjYXNlIElPTU1VX0NNRF9DT01QTEVURV9QUFJfUkVRVUVTVDoKLSAgICAgICAgICAg
IHJldCA9IGRvX2NvbXBsZXRlX3Bwcl9yZXF1ZXN0KGQsIGNtZCk7CisgICAgICAgICAgICByZXQg
PSBkb19jb21wbGV0ZV9wcHJfcmVxdWVzdChkLCAmY21kKTsKICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICBjYXNlIElPTU1VX0NNRF9JTlZBTElEQVRFX0lPTU1VX0FMTDoKLSAgICAgICAgICAg
IHJldCA9IGRvX2ludmFsaWRhdGVfYWxsKGQsIGNtZCk7CisgICAgICAgICAgICByZXQgPSBkb19p
bnZhbGlkYXRlX2FsbChkLCAmY21kKTsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICBkZWZh
dWx0OgotICAgICAgICAgICAgQU1EX0lPTU1VX0RFQlVHKCJDTUQ6IFVua25vd24gY29tbWFuZCBj
bWRfdHlwZSA9ICVseCAiCisgICAgICAgICAgICBBTURfSU9NTVVfREVCVUcoIkNNRDogVW5rbm93
biBjb21tYW5kIGNtZF90eXBlID0gJSN4ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi
aGVhZCA9ICVsZFxuIiwgb3Bjb2RlLCBoZWFkKTsKKyAgICAgICAgICAgIHJldCA9IC1FSU5WQUw7
CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogCi0gICAgICAgIHVubWFwX2RvbWFpbl9w
YWdlKGNtZF9iYXNlKTsKICAgICAgICAgaWYgKCArK2hlYWQgPj0gaW9tbXUtPmNtZF9idWZmZXIu
ZW50cmllcyApCiAgICAgICAgICAgICBoZWFkID0gMDsKICAgICAgICAgaWYgKCByZXQgKQorICAg
ICAgICB7CiAgICAgICAgICAgICBndWVzdF9pb21tdV9kaXNhYmxlKGlvbW11KTsKKyAgICAgICAg
ICAgIGJyZWFrOworICAgICAgICB9CiAgICAgfQogCiAgICAgLyogTm93IHNoaWZ0IGNtZCBidWZm
ZXIgaGVhZCBwb2ludGVyICovCkBAIC04MTgsMTAgKzg4NiwxMCBAQCBpbnQgZ3Vlc3RfaW9tbXVf
c2V0X2Jhc2Uoc3RydWN0IGRvbWFpbiAqZCwgdWludDY0X3QgYmFzZSkKIAogICAgIGZvciAoIGlu
dCBpID0gMDsgaSA8IElPTU1VX01NSU9fUEFHRV9OUjsgaSsrICkKICAgICB7Ci0gICAgICAgIHVu
c2lnbmVkIGxvbmcgZ2ZuID0gYmFzZSArIGk7CisgICAgICAgIGdmbl90IGdmbiA9IF9nZm4oYmFz
ZSArIGkpOwogCiAgICAgICAgIGdldF9nZm5fcXVlcnkoZCwgZ2ZuLCAmdCk7Ci0gICAgICAgIHAy
bV9jaGFuZ2VfdHlwZV9vbmUoZCwgZ2ZuLCB0LCBwMm1fbW1pb19kbSk7CisgICAgICAgIHAybV9j
aGFuZ2VfdHlwZV9vbmUoZCwgZ2ZuX3goZ2ZuKSwgdCwgcDJtX21taW9fZG0pOwogICAgICAgICBw
dXRfZ2ZuKGQsIGdmbik7CiAgICAgfQogCi0tIAoyLjEuNAoKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRl
dmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFp
bG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=
