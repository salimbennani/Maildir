Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 21 Nov 2018 00:40:31 -0000
Received: from icoremail.net (unknown [209.85.210.175])
	by mail-app4 (Coremail) with SMTP id cS_KCgDnXzOuMPRbxrjgAQ--.34238S3;
	Wed, 21 Nov 2018 00:05:03 +0800 (CST)
Received: from mail-pf1-f175.google.com (unknown [209.85.210.175])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwCnj0uoMPRbV_NeAA--.2251S3;
	Wed, 21 Nov 2018 00:04:57 +0800 (CST)
Received: by mail-pf1-f175.google.com with SMTP id c123so509054pfb.0
        for <xuliker@zju.edu.cn>; Tue, 20 Nov 2018 08:04:57 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=KgUA4qk4R2QsAYMp702YwlWXNifLfKJY/OYf3hZ/MQQ=;
        b=gafLtqDza0GvUGi5xXZtnVW0YGuPBizts782GOyAjPwNMIHzj5LrLIs8bsjJ2IyYUV
         b6IuscTrskI1t4D7yBPgcTh6p0GzIuRj6yIn6cbIfXe/0Y27q947IihVa7iGNs/X574V
         tDt3zyYsR4SU2Lw4z7iR1SPWaCpAs2Ip6JjmJNFRj67qiRoqCej5dkRR2f8pJ+N6KFJ3
         028AKKimkSoYSYKZGpxsXLqsn9keb0lPSugCk319AW9BubMW8PKV1KjUK0CRGBa4jMPQ
         heCojrJNlvXJ4SI2Zv7OxLvgq4eDFEnvtH4qa4T4ozp1zjJgM696mWpNF+ajvz6ROMe5
         mcag==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gKXXzmCb7BTBqteYD+Gn8iZHqjOvDKgYwReDT67VCVaWXSUjR+O
	ZeCgUqY6YsPJ5m5s0CL9Ba25oeaZn2uyl9/qjH9YH1eZWZNZKMQ=
X-Received: by 2002:a63:fd53:: with SMTP id m19mr2456894pgj.340.1542729896705;
        Tue, 20 Nov 2018 08:04:56 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp787805pju;
        Tue, 20 Nov 2018 08:04:55 -0800 (PST)
X-Google-Smtp-Source: AJdET5dCprqbO4qdulXsrKSKYeovUfLXBVjqOHfXcODyz0HO0Qe3wZg0rGI9qRWzTvLNZ8ARCnaT
X-Received: by 2002:a25:f80e:: with SMTP id u14-v6mr2323325ybd.161.1542729895235;
        Tue, 20 Nov 2018 08:04:55 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542729895; cv=none;
        d=google.com; s=arc-20160816;
        b=fPTCxjF9WY4ODIFdFQXMssupHb/ewDmHCMMBWCUFkK8c36iPr7wU120S9/WT948Bpm
         jFz9ewf4EpN+EtrRRFPdE8tA92jMdyVbvHq/9YcNOiWZecmc23meEpxlk2cSi9VkfopI
         Gpx8IEM2QH6NNYeAMduudQPHJGGOp9TrQlkqsrOSWMCcEKfsvT4SJfbrOih7utkcDzoI
         /D1OQgtTk0sB9+23B331h1fWDsXQnkgmAxtzPSsuZHBcaifolBV+8bxhMZaKxnLQ5wqP
         LBo7OqqG1x2hdkalniFElIkWDAZOnS93eA2LFIVBKyfoiAu+OFKSZSBblRFXCpXyBPC5
         7mlA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=KgUA4qk4R2QsAYMp702YwlWXNifLfKJY/OYf3hZ/MQQ=;
        b=dlwIJ+WfqLkXppS6DCEwZF7LQwi3rA/8BAF1TjaFJo8cH2VwV9g7Z6MFXkFF6A+fS1
         QBrLaKHcvmAsuEn0/ABPDyQw/ECz8VInnq60FA95GLd1apoPWakhULQSm7+EjsUCXpD2
         SBb5Z/Nud71bMdXW6NKz4cxdasVa8WPXKfpeUp3VgImnsFbPiNIv7nIgU71TPNkADSHf
         g/JLFlqpMBYOJEK0r8vWrNscHN7pV3x+1hYJGZsife64JZGXzfEYL0BKlojNuiS71ShM
         XvJ6powuWR57e22cCCizHRr84bvEDZZywCw3HhCtVaIsTTma+jNT26qTSPl/JYvlHr7u
         s0KQ==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id o5-v6si18187342ywf.182.2018.11.20.08.04.50
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Tue, 20 Nov 2018 08:04:55 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gP8Tn-0006DV-Nh; Tue, 20 Nov 2018 16:02:23 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=rzwt=n7=citrix.com=prvs=855b39dea=roger.pau@srs-us1.protection.inumbo.net>)
 id 1gP8Tm-0006DL-A0
 for xen-devel@lists.xenproject.org; Tue, 20 Nov 2018 16:02:22 +0000
X-Inumbo-ID: a8fde889-ecdd-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id a8fde889-ecdd-11e8-9a16-bc764e045a96;
 Tue, 20 Nov 2018 16:02:20 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,257,1539648000"; d="scan'208";a="71101701"
From: Roger Pau Monne <roger.pau@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Tue, 20 Nov 2018 17:01:48 +0100
Message-ID: <20181120160153.45259-2-roger.pau@citrix.com>
X-Mailer: git-send-email 2.19.1
In-Reply-To: <20181120160153.45259-1-roger.pau@citrix.com>
References: <20181120160153.45259-1-roger.pau@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v5 1/6] vpci: fix updating the command register
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 George Dunlap <George.Dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Tim Deegan <tim@xen.org>,
 Julien Grall <julien.grall@arm.com>, Jan Beulich <jbeulich@suse.com>,
 Roger Pau Monne <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwCnj0uoMPRbV_NeAA--.2251S3
Authentication-Results: mail-app4; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3Ww4fAFyxWF18ZF47KrWxJFb_yoW3GrWfpa
	98Cas8Cw4Yqryag3W0yF4DZryaka97Ja4rGry3u3sYvryYkrn7tF10yFyYvF1xZFZ8uFnF
	vF4agw4Du3WUAFUanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUl0b7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Xr0_Ar1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Gr0_Cr1l84ACjcxK6I8E
	87Iv67AKxVW8JVWxJwA2z4x0Y4vEx4A2jsIEc7CjxVAFwI0_Gr0_Gr1UM2vj6VCEFcxC0V
	AYjxAxZF0EFcxC0VAYjxAxZF0Ew4CEw7xC0VCjxxvEa2IrM2AIxVAIcxkEcVAq07x20xvE
	ncxIr21l5I8CrVACY4xI64kE6c02F40Ex7xfMcIj6xIIjxv20xvE14v26r1j6r18McIj6I
	8E87Iv67AKxVWUJVW8JwAm72CE4IkC6x0Yz7v_Jr0_Gr1lF7xvr2IYc2Ij64vIr41lFcxC
	0VAYjxAxZF0Ew4CEw7xC0wCjxxvEa2IrMxkF7I0Ew4C26cxK6c8Ij28IcwCY1Ik26cxK6x
	AEc7vF6xCjj44lc2xSY4AK6IIF6r1lc2IjII80xcxEwVAKI48JMxvI42IY6xIIjxv20xvE
	14v26r1j6r1xMxvI42IY6xIIjxv20xvEc7CjxVAFwI0_Jr0_Gr1lcIIF0xvEx4A2jsIE14
	v26r1j6r4UMxvI42IY6I8E87Iv6xkF7I0E14v26r1j6r4UMxAIw28IcxkI7VAKI48JMxAI
	w28IcVAKzI0EY4vE52x082I5MxCjnVCjjxCrMxC20s026xCaFVCjc4AY6r1j6r4UMI8I3I
	0E5I8CrVAFwI0_Jr0_Jr4lx2IqxVCjr7xvwVAFwI0_JrI_JrWlx4CE17CEb7AF67AKxVWU
	tVW8ZwCIc40Y0x0EwIxGrwCI42IY6xAIw20EY4v20xvaj40_Gr0_Zr1l6VACY4xI67k042
	43AbIYCTnIWIevJa73UjIFyTuYvjxUPOeoDUUUU

V2hlbiBzd2l0Y2hpbmcgdGhlIG1lbW9yeSBkZWNvZGluZyBiaXQgaW4gdGhlIGNvbW1hbmQgcmVn
aXN0ZXIgdGhlCnJlc3Qgb2YgdGhlIGNoYW5nZXMgd2hlcmUgZHJvcHBlZCwgbGVhZGluZyB0byBv
bmx5IHRoZSBtZW1vcnkgZGVjb2RpbmcKYml0IGJlaW5nIHVwZGF0ZWQuCgpGaXggdGhpcyBieSB3
cml0aW5nIHRoZSBjb21tYW5kIHJlZ2lzdGVyIG9uY2UgdGhlIGd1ZXN0IHBoeXNtYXAKbWFuaXB1
bGF0aW9ucyBhcmUgZG9uZSBpZiB0aGVyZSBhcmUgY2hhbmdlcyB0byB0aGUgbWVtb3J5IGRlY29k
aW5nCmJpdC4KCk5vdGUgdGhhdCB3aGVuIG9ubHkgbWFwcGluZy91bm1hcHBpbmcgdGhlIFJPTSBC
QVIgYSBmYWJyaWNhdGVkIGNvbW1hbmQKcmVnaXN0ZXIgdmFsdWUgaXMgcGFzc2VkIHRvIG1vZGlm
eV9iYXJzIHdoaWNoIGlzIG9ubHkgdXNlZCB0byBzaWduYWwKd2hldGhlciB0aGUgYWN0aW9uIGlz
IGEgbWFwcGluZyBvciB1bm1hcHBpbmcsIGJ1dCB0aGUgdmFsdWUgaXMgbmV2ZXIKd3JpdHRlbiB0
byB0aGUgZGV2aWNlIGNvbW1hbmQgcmVnaXN0ZXIuIFR1cm4gdGhlIG1hb2RpZnlfZGVjb2RpbmcK
QVNTRVJUIGludG8gYW4gQVNTRVJUX1VOUkVBQ0hBQkxFIGFuZCBtYWtlIHN1cmUgdGhhdCBub24t
ZGVidWcgYnVpbGRzCndvbid0IGVuZCB1cCB3cml0aW5nIHRvIHRoZSBjb21tYW5kIHJlZ2lzdGVy
IGlmIG9ubHkgbW9kaWZ5aW5nIHRoZSBST00KQkFSLgoKU2lnbmVkLW9mZi1ieTogUm9nZXIgUGF1
IE1vbm7DqSA8cm9nZXIucGF1QGNpdHJpeC5jb20+Ci0tLQpDYzogQW5kcmV3IENvb3BlciA8YW5k
cmV3LmNvb3BlcjNAY2l0cml4LmNvbT4KQ2M6IEdlb3JnZSBEdW5sYXAgPEdlb3JnZS5EdW5sYXBA
ZXUuY2l0cml4LmNvbT4KQ2M6IElhbiBKYWNrc29uIDxpYW4uamFja3NvbkBldS5jaXRyaXguY29t
PgpDYzogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgpDYzogSnVsaWVuIEdyYWxsIDxq
dWxpZW4uZ3JhbGxAYXJtLmNvbT4KQ2M6IEtvbnJhZCBSemVzenV0ZWsgV2lsayA8a29ucmFkLndp
bGtAb3JhY2xlLmNvbT4KQ2M6IFN0ZWZhbm8gU3RhYmVsbGluaSA8c3N0YWJlbGxpbmlAa2VybmVs
Lm9yZz4KQ2M6IFRpbSBEZWVnYW4gPHRpbUB4ZW4ub3JnPgpDYzogV2VpIExpdSA8d2VpLmxpdTJA
Y2l0cml4LmNvbT4KLS0tCkNoYW5nZXMgc2luY2UgdjQ6CiAtIFR1cm4gdGhlIEFTU0VSVCBpbiBt
b2RpZnlfZGVjb2RpbmcgdG8gYW4gQVNTRVJUX1VOUkVBQ0hBQkxFIHRvIGJlCiAgIHN1cmUgdGhl
IGNtZCB2YWx1ZSBpcyBuZXZlciB3cml0dGVuIHdoZW4gb25seSB7dW59bWFwcGluZyB0aGUgUk9N
CiAgIEJBUi4KIC0gQWRkIGEgY29tbWVudCBpbiByb21fd3JpdGUgYWJvdXQgdGhlIGZhYnJpY2F0
ZWQgY29tbWFuZCByZWdpc3RlcgogICBwYXNzZWQgdG8gbW9kaWZ5X2JhcnMuCgpDaGFuZ2VzIHNp
bmNlIHYzOgogLSBPbmx5IHVwZGF0ZSB0aGUgY29tbWFuZCByZWdpc3RlciBvbmNlIGFmdGVyIHRo
ZSBwaHlzbWFwIGNoYW5nZXMgYXJlCiAgIGRvbmUuCi0tLQogeGVuL2RyaXZlcnMvdnBjaS9oZWFk
ZXIuYyB8IDQ3ICsrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogeGVuL2lu
Y2x1ZGUveGVuL3ZwY2kuaCAgICB8ICAyICstCiAyIGZpbGVzIGNoYW5nZWQsIDI3IGluc2VydGlv
bnMoKyksIDIyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9kcml2ZXJzL3ZwY2kvaGVh
ZGVyLmMgYi94ZW4vZHJpdmVycy92cGNpL2hlYWRlci5jCmluZGV4IDQ1NzNjY2FkZjAuLjM5ZGZm
YjIxZmIgMTAwNjQ0Ci0tLSBhL3hlbi9kcml2ZXJzL3ZwY2kvaGVhZGVyLmMKKysrIGIveGVuL2Ry
aXZlcnMvdnBjaS9oZWFkZXIuYwpAQCAtODEsMTEgKzgxLDEyIEBAIHN0YXRpYyBpbnQgbWFwX3Jh
bmdlKHVuc2lnbmVkIGxvbmcgcywgdW5zaWduZWQgbG9uZyBlLCB2b2lkICpkYXRhLAogICogQkFS
J3MgZW5hYmxlIGJpdCBoYXMgY2hhbmdlZCB3aXRoIHRoZSBtZW1vcnkgZGVjb2RpbmcgYml0IGFs
cmVhZHkgZW5hYmxlZC4KICAqIElmIHJvbV9vbmx5IGlzIG5vdCBzZXQgdGhlbiBpdCdzIHRoZSBt
ZW1vcnkgZGVjb2RpbmcgYml0IHRoYXQgY2hhbmdlZC4KICAqLwotc3RhdGljIHZvaWQgbW9kaWZ5
X2RlY29kaW5nKGNvbnN0IHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBib29sIG1hcCwgYm9vbCByb21f
b25seSkKK3N0YXRpYyB2b2lkIG1vZGlmeV9kZWNvZGluZyhjb25zdCBzdHJ1Y3QgcGNpX2RldiAq
cGRldiwgdWludDE2X3QgY21kLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgcm9t
X29ubHkpCiB7CiAgICAgc3RydWN0IHZwY2lfaGVhZGVyICpoZWFkZXIgPSAmcGRldi0+dnBjaS0+
aGVhZGVyOwogICAgIHVpbnQ4X3Qgc2xvdCA9IFBDSV9TTE9UKHBkZXYtPmRldmZuKSwgZnVuYyA9
IFBDSV9GVU5DKHBkZXYtPmRldmZuKTsKLSAgICB1aW50MTZfdCBjbWQ7CisgICAgYm9vbCBtYXAg
PSBjbWQgJiBQQ0lfQ09NTUFORF9NRU1PUlk7CiAgICAgdW5zaWduZWQgaW50IGk7CiAKICAgICBm
b3IgKCBpID0gMDsgaSA8IEFSUkFZX1NJWkUoaGVhZGVyLT5iYXJzKTsgaSsrICkKQEAgLTExMCwx
MiArMTExLDExIEBAIHN0YXRpYyB2b2lkIG1vZGlmeV9kZWNvZGluZyhjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgYm9vbCBtYXAsIGJvb2wgcm9tX29ubHkpCiAgICAgICAgICAgICBoZWFkZXIt
PmJhcnNbaV0uZW5hYmxlZCA9IG1hcDsKICAgICB9CiAKLSAgICBBU1NFUlQoIXJvbV9vbmx5KTsK
LSAgICBjbWQgPSBwY2lfY29uZl9yZWFkMTYocGRldi0+c2VnLCBwZGV2LT5idXMsIHNsb3QsIGZ1
bmMsIFBDSV9DT01NQU5EKTsKLSAgICBjbWQgJj0gflBDSV9DT01NQU5EX01FTU9SWTsKLSAgICBj
bWQgfD0gbWFwID8gUENJX0NPTU1BTkRfTUVNT1JZIDogMDsKLSAgICBwY2lfY29uZl93cml0ZTE2
KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCBQQ0lfQ09NTUFORCwKLSAgICAgICAg
ICAgICAgICAgICAgIGNtZCk7CisgICAgaWYgKCAhcm9tX29ubHkgKQorICAgICAgICBwY2lfY29u
Zl93cml0ZTE2KHBkZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCBQQ0lfQ09NTUFORCwK
KyAgICAgICAgICAgICAgICAgICAgICAgICBjbWQpOworICAgIGVsc2UKKyAgICAgICAgQVNTRVJU
X1VOUkVBQ0hBQkxFKCk7CiB9CiAKIGJvb2wgdnBjaV9wcm9jZXNzX3BlbmRpbmcoc3RydWN0IHZj
cHUgKnYpCkBAIC0xMjQsNyArMTI0LDcgQEAgYm9vbCB2cGNpX3Byb2Nlc3NfcGVuZGluZyhzdHJ1
Y3QgdmNwdSAqdikKICAgICB7CiAgICAgICAgIHN0cnVjdCBtYXBfZGF0YSBkYXRhID0gewogICAg
ICAgICAgICAgLmQgPSB2LT5kb21haW4sCi0gICAgICAgICAgICAubWFwID0gdi0+dnBjaS5tYXAs
CisgICAgICAgICAgICAubWFwID0gdi0+dnBjaS5jbWQgJiBQQ0lfQ09NTUFORF9NRU1PUlksCiAg
ICAgICAgIH07CiAgICAgICAgIGludCByYyA9IHJhbmdlc2V0X2NvbnN1bWVfcmFuZ2VzKHYtPnZw
Y2kubWVtLCBtYXBfcmFuZ2UsICZkYXRhKTsKIApAQCAtMTMzLDcgKzEzMyw4IEBAIGJvb2wgdnBj
aV9wcm9jZXNzX3BlbmRpbmcoc3RydWN0IHZjcHUgKnYpCiAKICAgICAgICAgc3Bpbl9sb2NrKCZ2
LT52cGNpLnBkZXYtPnZwY2ktPmxvY2spOwogICAgICAgICAvKiBEaXNhYmxlIG1lbW9yeSBkZWNv
ZGluZyB1bmNvbmRpdGlvbmFsbHkgb24gZmFpbHVyZS4gKi8KLSAgICAgICAgbW9kaWZ5X2RlY29k
aW5nKHYtPnZwY2kucGRldiwgIXJjICYmIHYtPnZwY2kubWFwLAorICAgICAgICBtb2RpZnlfZGVj
b2Rpbmcodi0+dnBjaS5wZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgcmMgPyB2LT52cGNp
LmNtZCAmIH5QQ0lfQ09NTUFORF9NRU1PUlkgOiB2LT52cGNpLmNtZCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICFyYyAmJiB2LT52cGNpLnJvbV9vbmx5KTsKICAgICAgICAgc3Bpbl91bmxvY2so
JnYtPnZwY2kucGRldi0+dnBjaS0+bG9jayk7CiAKQEAgLTE1NCw3ICsxNTUsNyBAQCBib29sIHZw
Y2lfcHJvY2Vzc19wZW5kaW5nKHN0cnVjdCB2Y3B1ICp2KQogfQogCiBzdGF0aWMgaW50IF9faW5p
dCBhcHBseV9tYXAoc3RydWN0IGRvbWFpbiAqZCwgY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHJhbmdlc2V0ICptZW0pCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHJhbmdlc2V0ICptZW0sIHVpbnQxNl90IGNt
ZCkKIHsKICAgICBzdHJ1Y3QgbWFwX2RhdGEgZGF0YSA9IHsgLmQgPSBkLCAubWFwID0gdHJ1ZSB9
OwogICAgIGludCByYzsKQEAgLTE2MywxMyArMTY0LDEzIEBAIHN0YXRpYyBpbnQgX19pbml0IGFw
cGx5X21hcChzdHJ1Y3QgZG9tYWluICpkLCBjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRldiwKICAg
ICAgICAgcHJvY2Vzc19wZW5kaW5nX3NvZnRpcnFzKCk7CiAgICAgcmFuZ2VzZXRfZGVzdHJveSht
ZW0pOwogICAgIGlmICggIXJjICkKLSAgICAgICAgbW9kaWZ5X2RlY29kaW5nKHBkZXYsIHRydWUs
IGZhbHNlKTsKKyAgICAgICAgbW9kaWZ5X2RlY29kaW5nKHBkZXYsIGNtZCwgZmFsc2UpOwogCiAg
ICAgcmV0dXJuIHJjOwogfQogCiBzdGF0aWMgdm9pZCBkZWZlcl9tYXAoc3RydWN0IGRvbWFpbiAq
ZCwgc3RydWN0IHBjaV9kZXYgKnBkZXYsCi0gICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHJh
bmdlc2V0ICptZW0sIGJvb2wgbWFwLCBib29sIHJvbV9vbmx5KQorICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCByYW5nZXNldCAqbWVtLCB1aW50MTZfdCBjbWQsIGJvb2wgcm9tX29ubHkpCiB7
CiAgICAgc3RydWN0IHZjcHUgKmN1cnIgPSBjdXJyZW50OwogCkBAIC0xODEsMTEgKzE4MiwxMSBA
QCBzdGF0aWMgdm9pZCBkZWZlcl9tYXAoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IHBjaV9kZXYg
KnBkZXYsCiAgICAgICovCiAgICAgY3Vyci0+dnBjaS5wZGV2ID0gcGRldjsKICAgICBjdXJyLT52
cGNpLm1lbSA9IG1lbTsKLSAgICBjdXJyLT52cGNpLm1hcCA9IG1hcDsKKyAgICBjdXJyLT52cGNp
LmNtZCA9IGNtZDsKICAgICBjdXJyLT52cGNpLnJvbV9vbmx5ID0gcm9tX29ubHk7CiB9CiAKLXN0
YXRpYyBpbnQgbW9kaWZ5X2JhcnMoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIGJvb2wgbWFw
LCBib29sIHJvbV9vbmx5KQorc3RhdGljIGludCBtb2RpZnlfYmFycyhjb25zdCBzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgdWludDE2X3QgY21kLCBib29sIHJvbV9vbmx5KQogewogICAgIHN0cnVjdCB2
cGNpX2hlYWRlciAqaGVhZGVyID0gJnBkZXYtPnZwY2ktPmhlYWRlcjsKICAgICBzdHJ1Y3QgcmFu
Z2VzZXQgKm1lbSA9IHJhbmdlc2V0X25ldyhOVUxMLCBOVUxMLCAwKTsKQEAgLTMwNSwxMSArMzA2
LDExIEBAIHN0YXRpYyBpbnQgbW9kaWZ5X2JhcnMoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYs
IGJvb2wgbWFwLCBib29sIHJvbV9vbmx5KQogICAgICAgICAgKiBiZSBjYWxsZWQgaWZmIHRoZSBt
ZW1vcnkgZGVjb2RpbmcgYml0IGlzIGVuYWJsZWQsIHRodXMgdGhlIG9wZXJhdGlvbgogICAgICAg
ICAgKiB3aWxsIGFsd2F5cyBiZSB0byBlc3RhYmxpc2ggbWFwcGluZ3MgYW5kIHByb2Nlc3MgYWxs
IHRoZSBCQVJzLgogICAgICAgICAgKi8KLSAgICAgICAgQVNTRVJUKG1hcCAmJiAhcm9tX29ubHkp
OwotICAgICAgICByZXR1cm4gYXBwbHlfbWFwKHBkZXYtPmRvbWFpbiwgcGRldiwgbWVtKTsKKyAg
ICAgICAgQVNTRVJUKChjbWQgJiBQQ0lfQ09NTUFORF9NRU1PUlkpICYmICFyb21fb25seSk7Cisg
ICAgICAgIHJldHVybiBhcHBseV9tYXAocGRldi0+ZG9tYWluLCBwZGV2LCBtZW0sIGNtZCk7CiAg
ICAgfQogCi0gICAgZGVmZXJfbWFwKGRldi0+ZG9tYWluLCBkZXYsIG1lbSwgbWFwLCByb21fb25s
eSk7CisgICAgZGVmZXJfbWFwKGRldi0+ZG9tYWluLCBkZXYsIG1lbSwgY21kLCByb21fb25seSk7
CiAKICAgICByZXR1cm4gMDsKIH0KQEAgLTMzMiw3ICszMzMsNyBAQCBzdGF0aWMgdm9pZCBjbWRf
d3JpdGUoY29uc3Qgc3RydWN0IHBjaV9kZXYgKnBkZXYsIHVuc2lnbmVkIGludCByZWcsCiAgICAg
ICAgICAqIG1lbW9yeSBkZWNvZGluZyBiaXQgaGFzIG5vdCBiZWVuIGNoYW5nZWQsIHNvIGxlYXZl
IGV2ZXJ5dGhpbmcgYXMtaXMsCiAgICAgICAgICAqIGhvcGluZyB0aGUgZ3Vlc3Qgd2lsbCByZWFs
aXplIGFuZCB0cnkgYWdhaW4uCiAgICAgICAgICAqLwotICAgICAgICBtb2RpZnlfYmFycyhwZGV2
LCBjbWQgJiBQQ0lfQ09NTUFORF9NRU1PUlksIGZhbHNlKTsKKyAgICAgICAgbW9kaWZ5X2JhcnMo
cGRldiwgY21kLCBmYWxzZSk7CiAgICAgZWxzZQogICAgICAgICBwY2lfY29uZl93cml0ZTE2KHBk
ZXYtPnNlZywgcGRldi0+YnVzLCBzbG90LCBmdW5jLCByZWcsIGNtZCk7CiB9CkBAIC00MTMsNyAr
NDE0LDExIEBAIHN0YXRpYyB2b2lkIHJvbV93cml0ZShjb25zdCBzdHJ1Y3QgcGNpX2RldiAqcGRl
diwgdW5zaWduZWQgaW50IHJlZywKICAgICAgICAgaGVhZGVyLT5yb21fZW5hYmxlZCA9IG5ld19l
bmFibGVkOwogICAgICAgICBwY2lfY29uZl93cml0ZTMyKHBkZXYtPnNlZywgcGRldi0+YnVzLCBz
bG90LCBmdW5jLCByZWcsIHZhbCk7CiAgICAgfQotICAgIGVsc2UgaWYgKCBtb2RpZnlfYmFycyhw
ZGV2LCBuZXdfZW5hYmxlZCwgdHJ1ZSkgKQorICAgIC8qCisgICAgICogUGFzcyBQQ0lfQ09NTUFO
RF9NRU1PUlkgb3IgMCB0byBzaWduYWwgYSBtYXAvdW5tYXAgcmVxdWVzdCwgbm90ZSB0aGF0Cisg
ICAgICogdGhpcyBmYWJyaWNhdGVkIGNvbW1hbmQgaXMgbmV2ZXIgZ29pbmcgdG8gYmUgd3JpdHRl
biB0byB0aGUgcmVnaXN0ZXIuCisgICAgICovCisgICAgZWxzZSBpZiAoIG1vZGlmeV9iYXJzKHBk
ZXYsIG5ld19lbmFibGVkID8gUENJX0NPTU1BTkRfTUVNT1JZIDogMCwgdHJ1ZSkgKQogICAgICAg
ICAvKgogICAgICAgICAgKiBObyBtZW1vcnkgaGFzIGJlZW4gYWRkZWQgb3IgcmVtb3ZlZCBmcm9t
IHRoZSBwMm0gKGJlY2F1c2UgdGhlIGFjdHVhbAogICAgICAgICAgKiBwMm0gY2hhbmdlcyBhcmUg
ZGVmZXJyZWQgaW4gZGVmZXJfbWFwKSBhbmQgdGhlIFJPTSBlbmFibGUgYml0IGhhcwpAQCAtNTQ5
LDcgKzU1NCw3IEBAIHN0YXRpYyBpbnQgaW5pdF9iYXJzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQog
ICAgICAgICAgICAgcm9tLT50eXBlID0gVlBDSV9CQVJfRU1QVFk7CiAgICAgfQogCi0gICAgcmV0
dXJuIChjbWQgJiBQQ0lfQ09NTUFORF9NRU1PUlkpID8gbW9kaWZ5X2JhcnMocGRldiwgdHJ1ZSwg
ZmFsc2UpIDogMDsKKyAgICByZXR1cm4gKGNtZCAmIFBDSV9DT01NQU5EX01FTU9SWSkgPyBtb2Rp
ZnlfYmFycyhwZGV2LCBjbWQsIGZhbHNlKSA6IDA7CiB9CiBSRUdJU1RFUl9WUENJX0lOSVQoaW5p
dF9iYXJzLCBWUENJX1BSSU9SSVRZX01JRERMRSk7CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRl
L3hlbi92cGNpLmggYi94ZW4vaW5jbHVkZS94ZW4vdnBjaS5oCmluZGV4IGFmMmI4NTgwZWUuLjQ0
MTA0Yjc1YjYgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNsdWRlL3hlbi92cGNpLmgKKysrIGIveGVuL2lu
Y2x1ZGUveGVuL3ZwY2kuaApAQCAtMTQ1LDcgKzE0NSw3IEBAIHN0cnVjdCB2cGNpX3ZjcHUgewog
ICAgIC8qIFBlci12Y3B1IHN0cnVjdHVyZSB0byBzdG9yZSBzdGF0ZSB3aGlsZSB7dW59bWFwcGlu
ZyBvZiBQQ0kgQkFScy4gKi8KICAgICBzdHJ1Y3QgcmFuZ2VzZXQgKm1lbTsKICAgICBzdHJ1Y3Qg
cGNpX2RldiAqcGRldjsKLSAgICBib29sIG1hcCAgICAgIDogMTsKKyAgICB1aW50MTZfdCBjbWQ7
CiAgICAgYm9vbCByb21fb25seSA6IDE7CiB9OwogCi0tIAoyLjE5LjEKCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0
Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qu
b3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs
