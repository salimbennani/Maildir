Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 22 Nov 2018 00:34:19 -0000
Received: from icoremail.net (unknown [209.85.214.170])
	by mail-app2 (Coremail) with SMTP id by_KCgCn36RbevVbRSfJAQ--.58162S3;
	Wed, 21 Nov 2018 23:31:39 +0800 (CST)
Received: from mail-pl1-f170.google.com (unknown [209.85.214.170])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwBHLEhXevVbExtkAA--.2120S3;
	Wed, 21 Nov 2018 23:31:35 +0800 (CST)
Received: by mail-pl1-f170.google.com with SMTP id t13so5998886ply.13
        for <xuliker@zju.edu.cn>; Wed, 21 Nov 2018 07:31:35 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=oonEc80b++dp7TZYOc0pQNQK6FNN+8m7jGACXjJhZF4=;
        b=qVOC5xXA9YgzJSTT8DAm2HYKwRH9Dh4lv9/pV0E/E/n+vFu8roZeUwJZGI/7Rxvy8G
         aSeA5tmpjsliMlL1er6t526UtuWpacejavweuosvdYnkAE1IEs3Kp8HNfMpUFQTe49zM
         MyGXBQuQuq++tOhNNs39P5vPcEOPDdTdYgpk2kCJTM0hwrrlegupAL14FDMAACCgjEIu
         hGz9N0Jisxb2g2yo9NCujgzjORopiKOgNDtgRI3VJ3aMylFsv9Jvr0xWV2ckqZwmc2zZ
         noiA29wDdFvXoj58QfHQr5NCSfPZ5FzB0Wp4/hmrMOCM0+2vGfDv3MuHxl+pNQg569BB
         2Q+Q==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AA+aEWY4f9LYgpxM6KQGsSSZoAbAsnUc4lDdlITyf6vdIv8W4APze9mL
	FZ6mgonfGjXY/LiRHkOJM+yA8ZiWtO2Rmv4Ori63fiHA3/e6DZU=
X-Received: by 2002:a63:a91a:: with SMTP id u26mr6333784pge.349.1542814295329;
        Wed, 21 Nov 2018 07:31:35 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp2101077pju;
        Wed, 21 Nov 2018 07:31:34 -0800 (PST)
X-Google-Smtp-Source: AFSGD/URQES462D5w6lEQ5/kSnESaZrYmGO7WN6rurEJxNlMVozDgpPXI0JzcMZwN5aC+ZOTqFNJ
X-Received: by 2002:a5b:ecb:: with SMTP id a11-v6mr5655862ybs.77.1542814294043;
        Wed, 21 Nov 2018 07:31:34 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542814294; cv=none;
        d=google.com; s=arc-20160816;
        b=HuqcTgO/q+ECC8DtEIIuPQKrx+N0rcDGBZsNN9GAck3K1A5q/llvSplruqRPF5cZcA
         KKxM5jRjfbF/wRDuduTj77nP9HScmZjBVqJ7IHpHRl9WmKNtZw9epsiooSdKXjzXXdA8
         Hg56ZM1cja1q266VDN93RT3kzX4LmcevMP8jk3laUbrsmwk9215Njcab/8Io5bYveZ2q
         jG5/CtRuERTIkIMgJmbSo5dAJ4Pr7zvtvkp26zRQeU27GRySBOBSgZQs+DzatwmowBw4
         TWlcrcsgBzYNPM8szBWnH66publZOltHX5ln669L7hHw/KiX8WYna4JphJgXmXkek34+
         PFBA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=oonEc80b++dp7TZYOc0pQNQK6FNN+8m7jGACXjJhZF4=;
        b=0Sg7KR/4GCsNFxd1eoc0RZTWWQ/5S5yJ+fJqEZdpBk1jJxaRb9kxEMmhoOlb7HBUpE
         +TU0OU5x4wPJrwtiYVyI57mTrv8bkgA7JZHPde40/C7MYjB8dwfH+7gH6UWkYVYakqbY
         TYjTu3s7NkBeIXehOJlHyisN6+8kenLoJzIzIaaklmqeJ4xfAeGsbtsAPkdldvwQ4zn/
         cUh/6axZzCbyBon1eDNjHCQEZnU84XnK3OXCZlFIEMa+fG8Z6h5r0D/J1pGQBiAFkrSt
         ykLP5K2vOiVXAtwpIawNHAwBMKKNbNy4mFeRiEIiqjGz8E7fzadbk3ptMx3gwLC8jw/l
         cDtg==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id p7-v6si29933312ywh.247.2018.11.21.07.31.30
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 21 Nov 2018 07:31:34 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gPUR4-0000qW-2O; Wed, 21 Nov 2018 15:29:02 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=wvse=oa=citrix.com=prvs=856356900=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1gPUR2-0000qJ-V8
 for xen-devel@lists.xenproject.org; Wed, 21 Nov 2018 15:29:00 +0000
X-Inumbo-ID: 2afccb8e-eda2-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 2afccb8e-eda2-11e8-9a16-bc764e045a96;
 Wed, 21 Nov 2018 15:28:59 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,261,1539648000"; d="scan'208";a="71207534"
From: Paul Durrant <paul.durrant@citrix.com>
To: <qemu-block@nongnu.org>, <qemu-devel@nongnu.org>,
 <xen-devel@lists.xenproject.org>
Date: Wed, 21 Nov 2018 15:12:07 +0000
Message-ID: <20181121151211.15997-15-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20181121151211.15997-1-paul.durrant@citrix.com>
References: <20181121151211.15997-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 14/18] xen: add implementations of xen-qdisk
 connect and disconnect functions...
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony Perard <anthony.perard@citrix.com>, Kevin Wolf <kwolf@redhat.com>,
 Paul Durrant <paul.durrant@citrix.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Max Reitz <mreitz@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwBHLEhXevVbExtkAA--.2120S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3tF17Cw1xGFWxJF1xJFyDtrb_yoWDXFyUpF
	1vgF43KrWUGr15Aw4fWrn3GF13GFW7G3WSk3sxJw1I9r9xJas3ZrWvkryYgw18GrZ3JF45
	ZrW3Xry8Z3WxWaUanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUUjbIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlFb7Iv0xC_KF4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Ar0_tr1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Cr0_Gr1UM28EF7xvwVC2
	z280aVAFwI0_GcCE3s1l84ACjcxK6I8E87Iv6xkF7I0E14v26rxl6s0DM2vj6VCEFcxC0V
	AYjxAxZF0EFcxC0VAYjxAxZF0Ew4CEw7xC0VCjxxvEa2IrM2AIxVAIcxkEcVAq07x20xvE
	ncxIr21l5I8CrVACY4xI64kE6c02F40Ex7xfMcIj6xIIjxv20xvE14v26r1Y6r17McIj6I
	8E87Iv67AKxVWxJVW8Jr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VW5WwCY0x0Ix7I2Y4AK64vIr41lcIIF0xvE2Ix0cI8I
	cVAFwI0_Xr0_Ar1lcIIF0xvE2Ix0cI8IcVCY1x0267AKxVW8JVWxJwCYIxAIcVC2z280aV
	AFwI0_GcCE3s1lcIIF0xvEx4A2jsIEc7CjxVAFwI0_GcCE3s1l42xK82IYc2Ij64vIr41l
	42xK82IY64kExVAvwVAq07x20xyl4x8a6x804xWl4I8I3I0E4IkC6x0Yz7v_Jr0_Gr1lx2
	IqxVAqx4xG67AKxVWUJVWUGwC20s026x8GjcxK67AKxVWUGVWUWwC2zVAF1VAY17CE14v2
	6r1q6r43MIIYrxkI7VAKI48JMIIF0xvE42xK8VAvwI8IcIk0rVWUJVWUCwCE64xvF2IEb7
	IF0Fy7YxBIdaVFxhVjvjDU0xZFpf9x07jL_-QUUUUU=

Li4uYW5kIHdpcmUgaW4gdGhlIGRhdGFwbGFuZS4KClRoaXMgcGF0Y2ggYWRkcyB0aGUgcmVtYWlu
aW5nIGNvZGUgdG8gbWFrZSB0aGUgeGVuLXFkaXNrIFhlbkRldmljZQpmdW5jdGlvbmFsLiBUaGUg
cGFyYW1ldGVycyB0aGF0IGEgYmxvY2sgZnJvbnRlbmQgZXhwZWN0cyB0byBmaW5kIGFyZQpwb3B1
bGF0ZWQgaW4gdGhlIGJhY2tlbmQgeGVuc3RvcmUgYXJlYSwgYW5kIHRoZSAncmluZy1yZWYnIGFu
ZAonZXZlbnQtY2hhbm5lbCcgdmFsdWVzIHNwZWNpZmllZCBpbiB0aGUgZnJvbnRlbmQgeGVuc3Rv
cmUgYXJlYSBhcmUKbWFwcGVkL2JvdW5kIGFuZCB1c2VkIHRvIHNldCB1cCB0aGUgZGF0YXBsYW5l
LgoKU2lnbmVkLW9mZi1ieTogUGF1bCBEdXJyYW50IDxwYXVsLmR1cnJhbnRAY2l0cml4LmNvbT4K
LS0tCkNjOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNjOiBB
bnRob255IFBlcmFyZCA8YW50aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4KQ2M6IEtldmluIFdvbGYg
PGt3b2xmQHJlZGhhdC5jb20+CkNjOiBNYXggUmVpdHogPG1yZWl0ekByZWRoYXQuY29tPgotLS0K
IGh3L2Jsb2NrL3hlbi1xZGlzay5jICAgICAgIHwgMTQwICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKwogaHcveGVuL3hlbi1idXMuYyAgICAgICAgICAgfCAgMTIg
KystLQogaW5jbHVkZS9ody94ZW4veGVuLWJ1cy5oICAgfCAgIDggKysrCiBpbmNsdWRlL2h3L3hl
bi94ZW4tcWRpc2suaCB8ICAxMiArKysrCiA0IGZpbGVzIGNoYW5nZWQsIDE2NiBpbnNlcnRpb25z
KCspLCA2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2h3L2Jsb2NrL3hlbi1xZGlzay5jIGIv
aHcvYmxvY2sveGVuLXFkaXNrLmMKaW5kZXggMzVmN2I3MDQ4MC4uOGM4ODM5MzgzMiAxMDA2NDQK
LS0tIGEvaHcvYmxvY2sveGVuLXFkaXNrLmMKKysrIGIvaHcvYmxvY2sveGVuLXFkaXNrLmMKQEAg
LTksNiArOSwxMCBAQAogI2luY2x1ZGUgInFhcGkvdmlzaXRvci5oIgogI2luY2x1ZGUgImh3L2h3
LmgiCiAjaW5jbHVkZSAiaHcveGVuL3hlbi1xZGlzay5oIgorI2luY2x1ZGUgInN5c2VtdS9ibG9j
a2Rldi5oIgorI2luY2x1ZGUgInN5c2VtdS9ibG9jay1iYWNrZW5kLmgiCisjaW5jbHVkZSAic3lz
ZW11L2lvdGhyZWFkLmgiCisjaW5jbHVkZSAiZGF0YXBsYW5lL3hlbi1xZGlzay5oIgogI2luY2x1
ZGUgInRyYWNlLmgiCiAKIHN0YXRpYyBjaGFyICp4ZW5fcWRpc2tfZ2V0X25hbWUoWGVuRGV2aWNl
ICp4ZW5kZXYsIEVycm9yICoqZXJycCkKQEAgLTIzLDYgKzI3LDExIEBAIHN0YXRpYyB2b2lkIHhl
bl9xZGlza19yZWFsaXplKFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAg
WGVuUWRpc2tEZXZpY2UgKnFkaXNrZGV2ID0gWEVOX1FESVNLX0RFVklDRSh4ZW5kZXYpOwogICAg
IFhlblFkaXNrVmRldiAqdmRldiA9ICZxZGlza2Rldi0+dmRldjsKKyAgICBCbG9ja0NvbmYgKmNv
bmYgPSAmcWRpc2tkZXYtPmNvbmY7CisgICAgRHJpdmVJbmZvICpkaW5mbzsKKyAgICBib29sIGlz
X2Nkcm9tOworICAgIHVuc2lnbmVkIGludCBpbmZvOworICAgIGludDY0X3Qgc2l6ZTsKIAogICAg
IGlmICghdmRldi0+dmFsaWQpIHsKICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAidmRldiBwcm9w
ZXJ0eSBub3Qgc2V0Iik7CkBAIC0zMCwxMyArMzksMTM0IEBAIHN0YXRpYyB2b2lkIHhlbl9xZGlz
a19yZWFsaXplKFhlbkRldmljZSAqeGVuZGV2LCBFcnJvciAqKmVycnApCiAgICAgfQogCiAgICAg
dHJhY2VfeGVuX3FkaXNrX3JlYWxpemUodmRldi0+ZGlzaywgdmRldi0+cGFydGl0aW9uKTsKKwor
ICAgIGlmICghY29uZi0+YmxrKSB7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgImRyaXZlIHBy
b3BlcnR5IG5vdCBzZXQiKTsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKworICAgIGlmICghYmxr
X2lzX2luc2VydGVkKGNvbmYtPmJsaykpIHsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiZGV2
aWNlIG5lZWRzIG1lZGlhLCBidXQgZHJpdmUgaXMgZW1wdHkiKTsKKyAgICAgICAgcmV0dXJuOwor
ICAgIH0KKworICAgIGlmICghYmxrY29uZl9hcHBseV9iYWNrZW5kX29wdGlvbnMoY29uZiwgYmxr
X2lzX3JlYWRfb25seShjb25mLT5ibGspLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZmFsc2UsIGVycnApKSB7CisgICAgICAgIHJldHVybjsKKyAgICB9CisKKyAgICBp
ZiAoIWJsa2NvbmZfZ2VvbWV0cnkoY29uZiwgTlVMTCwgNjU1MzUsIDI1NSwgMjU1LCBlcnJwKSkg
eworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgZGluZm8gPSBibGtfbGVnYWN5X2RpbmZv
KGNvbmYtPmJsayk7CisgICAgaXNfY2Ryb20gPSAoZGluZm8gJiYgZGluZm8tPm1lZGlhX2NkKTsK
KworICAgIGJsa2NvbmZfYmxvY2tzaXplcyhjb25mKTsKKworICAgIGlmIChjb25mLT5sb2dpY2Fs
X2Jsb2NrX3NpemUgPiBjb25mLT5waHlzaWNhbF9ibG9ja19zaXplKSB7CisgICAgICAgIGVycm9y
X3NldGcoCisgICAgICAgICAgICBlcnJwLCAibG9naWNhbF9ibG9ja19zaXplID4gcGh5c2ljYWxf
YmxvY2tfc2l6ZSBub3Qgc3VwcG9ydGVkIik7CisgICAgICAgIHJldHVybjsKKyAgICB9CisKKyAg
ICBibGtfc2V0X2d1ZXN0X2Jsb2NrX3NpemUoY29uZi0+YmxrLCBjb25mLT5sb2dpY2FsX2Jsb2Nr
X3NpemUpOworCisgICAgaWYgKGNvbmYtPmRpc2NhcmRfZ3JhbnVsYXJpdHkgPiAwKSB7CisgICAg
ICAgIHhlbl9kZXZpY2VfYmFja2VuZF9wcmludGYoeGVuZGV2LCAiZmVhdHVyZS1kaXNjYXJkIiwg
IiV1IiwgMSk7CisgICAgfQorCisgICAgeGVuX2RldmljZV9iYWNrZW5kX3ByaW50Zih4ZW5kZXYs
ICJmZWF0dXJlLWZsdXNoLWNhY2hlIiwgIiV1IiwgMSk7CisgICAgeGVuX2RldmljZV9iYWNrZW5k
X3ByaW50Zih4ZW5kZXYsICJtYXgtcmluZy1wYWdlLW9yZGVyIiwgIiV1IiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHFkaXNrZGV2LT5tYXhfcmluZ19wYWdlX29yZGVyKTsKKworICAg
IGluZm8gPSBibGtfaXNfcmVhZF9vbmx5KGNvbmYtPmJsaykgPyBWRElTS19SRUFET05MWSA6IDA7
CisgICAgaW5mbyB8PSBpc19jZHJvbSA/IFZESVNLX0NEUk9NIDogMDsKKworICAgIHhlbl9kZXZp
Y2VfYmFja2VuZF9wcmludGYoeGVuZGV2LCAiaW5mbyIsICIldSIsIGluZm8pOworCisgICAgeGVu
X2RldmljZV9mcm9udGVuZF9wcmludGYoeGVuZGV2LCAidmlydHVhbC1kZXZpY2UiLCAiJXUiLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZkZXYtPm51bWJlcik7CisgICAgeGVuX2Rl
dmljZV9mcm9udGVuZF9wcmludGYoeGVuZGV2LCAiZGV2aWNlLXR5cGUiLCAiJXMiLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2Nkcm9tID8gImNkcm9tIiA6ICJkaXNrIik7CisK
KyAgICBzaXplID0gYmxrX2dldGxlbmd0aChjb25mLT5ibGspOworICAgIHhlbl9kZXZpY2VfYmFj
a2VuZF9wcmludGYoeGVuZGV2LCAic2VjdG9yLXNpemUiLCAiJXUiLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY29uZi0+bG9naWNhbF9ibG9ja19zaXplKTsKKyAgICB4ZW5fZGV2aWNl
X2JhY2tlbmRfcHJpbnRmKHhlbmRldiwgInNlY3RvcnMiLCAiJWx1IiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHNpemUgLyBjb25mLT5sb2dpY2FsX2Jsb2NrX3NpemUpOworCisgICAg
cWRpc2tkZXYtPmRhdGFwbGFuZSA9IHhlbl9xZGlza19kYXRhcGxhbmVfY3JlYXRlKHhlbmRldiwg
Y29uZiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgcWRpc2tkZXYtPmlvdGhyZWFkKTsKIH0KIAogc3RhdGljIHZvaWQgeGVuX3FkaXNrX2Nvbm5l
Y3QoWGVuUWRpc2tEZXZpY2UgKnFkaXNrZGV2LCBFcnJvciAqKmVycnApCiB7CiAgICAgWGVuUWRp
c2tWZGV2ICp2ZGV2ID0gJnFkaXNrZGV2LT52ZGV2OworICAgIFhlbkRldmljZSAqeGVuZGV2ID0g
WEVOX0RFVklDRShxZGlza2Rldik7CisgICAgdW5zaWduZWQgaW50IG9yZGVyLCBucl9yaW5nX3Jl
ZiwgKnJpbmdfcmVmLCBldmVudF9jaGFubmVsLCBwcm90b2NvbDsKKyAgICBjaGFyICpzdHI7CiAK
ICAgICB0cmFjZV94ZW5fcWRpc2tfY29ubmVjdCh2ZGV2LT5kaXNrLCB2ZGV2LT5wYXJ0aXRpb24p
OworCisgICAgaWYgKHhlbl9kZXZpY2VfZnJvbnRlbmRfc2NhbmYoeGVuZGV2LCAicmluZy1wYWdl
LW9yZGVyIiwgIiV1IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmb3JkZXIp
ICE9IDEpIHsKKyAgICAgICAgbnJfcmluZ19yZWYgPSAxOworICAgICAgICByaW5nX3JlZiA9IGdf
bmV3KHVuc2lnbmVkIGludCwgbnJfcmluZ19yZWYpOworCisgICAgICAgIGlmICh4ZW5fZGV2aWNl
X2Zyb250ZW5kX3NjYW5mKHhlbmRldiwgInJpbmctcmVmIiwgIiV1IiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJnJpbmdfcmVmWzBdKSAhPSAxKSB7CisgICAgICAgICAg
ICBlcnJvcl9zZXRnKGVycnAsICJmYWlsZWQgdG8gcmVhZCByaW5nLXJlZiIpOworICAgICAgICAg
ICAgcmV0dXJuOworICAgICAgICB9CisgICAgfSBlbHNlIGlmIChvcmRlciA8PSBxZGlza2Rldi0+
bWF4X3JpbmdfcGFnZV9vcmRlcikgeworICAgICAgICB1bnNpZ25lZCBpbnQgaTsKKworICAgICAg
ICBucl9yaW5nX3JlZiA9IDEgPDwgb3JkZXI7CisgICAgICAgIHJpbmdfcmVmID0gZ19uZXcodW5z
aWduZWQgaW50LCBucl9yaW5nX3JlZik7CisKKyAgICAgICAgZm9yIChpID0gMDsgaSA8IG5yX3Jp
bmdfcmVmOyBpKyspIHsKKyAgICAgICAgICAgIGNvbnN0IGNoYXIgKmtleSA9IGdfc3RyZHVwX3By
aW50ZigicmluZy1yZWYldSIsIGkpOworCisgICAgICAgICAgICBpZiAoeGVuX2RldmljZV9mcm9u
dGVuZF9zY2FuZih4ZW5kZXYsIGtleSwgIiV1IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZyaW5nX3JlZltpXSkgIT0gMSkgeworICAgICAgICAgICAgICAgIGVy
cm9yX3NldGcoZXJycCwgImZhaWxlZCB0byByZWFkICVzIiwga2V5KTsKKyAgICAgICAgICAgICAg
ICBnX2ZyZWUoKGdwb2ludGVyKWtleSk7CisgICAgICAgICAgICAgICAgcmV0dXJuOworICAgICAg
ICAgICAgfQorCisgICAgICAgICAgICBnX2ZyZWUoKGdwb2ludGVyKWtleSk7CisgICAgICAgIH0K
KyAgICB9IGVsc2UgeworICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJpbnZhbGlkIHJpbmctcGFn
ZS1vcmRlciAoJWQpIiwgb3JkZXIpOworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgaWYg
KHhlbl9kZXZpY2VfZnJvbnRlbmRfc2NhbmYoeGVuZGV2LCAiZXZlbnQtY2hhbm5lbCIsICIldSIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmV2ZW50X2NoYW5uZWwpICE9IDEp
IHsKKyAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiZmFpbGVkIHRvIHJlYWQgZXZlbnQtY2hhbm5l
bCIpOworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgaWYgKHhlbl9kZXZpY2VfZnJvbnRl
bmRfc2NhbmYoeGVuZGV2LCAicHJvdG9jb2wiLCAiJW1zIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAmc3RyKSAhPSAxKSB7CisgICAgICAgIHByb3RvY29sID0gQkxLSUZfUFJP
VE9DT0xfTkFUSVZFOworICAgIH0gZWxzZSB7CisgICAgICAgIGlmIChzdHJjbXAoc3RyLCBYRU5f
SU9fUFJPVE9fQUJJX1g4Nl8zMikgPT0gMCkgeworICAgICAgICAgICAgcHJvdG9jb2wgPSBCTEtJ
Rl9QUk9UT0NPTF9YODZfMzI7CisgICAgICAgIH0gZWxzZSBpZiAoc3RyY21wKHN0ciwgWEVOX0lP
X1BST1RPX0FCSV9YODZfNjQpID09IDApIHsKKyAgICAgICAgICAgIHByb3RvY29sID0gQkxLSUZf
UFJPVE9DT0xfWDg2XzY0OworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgcHJvdG9jb2wg
PSBCTEtJRl9QUk9UT0NPTF9OQVRJVkU7CisgICAgICAgIH0KKworICAgICAgICBmcmVlKHN0cik7
CisgICAgfQorCisgICAgeGVuX3FkaXNrX2RhdGFwbGFuZV9zdGFydChxZGlza2Rldi0+ZGF0YXBs
YW5lLCByaW5nX3JlZiwgbnJfcmluZ19yZWYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBldmVudF9jaGFubmVsLCBwcm90b2NvbCk7CisKKyAgICBnX2ZyZWUocmluZ19yZWYpOwogfQog
CiBzdGF0aWMgdm9pZCB4ZW5fcWRpc2tfZGlzY29ubmVjdChYZW5RZGlza0RldmljZSAqcWRpc2tk
ZXYsIEVycm9yICoqZXJycCkKQEAgLTQ0LDYgKzE3NCw4IEBAIHN0YXRpYyB2b2lkIHhlbl9xZGlz
a19kaXNjb25uZWN0KFhlblFkaXNrRGV2aWNlICpxZGlza2RldiwgRXJyb3IgKiplcnJwKQogICAg
IFhlblFkaXNrVmRldiAqdmRldiA9ICZxZGlza2Rldi0+dmRldjsKIAogICAgIHRyYWNlX3hlbl9x
ZGlza19kaXNjb25uZWN0KHZkZXYtPmRpc2ssIHZkZXYtPnBhcnRpdGlvbik7CisKKyAgICB4ZW5f
cWRpc2tfZGF0YXBsYW5lX3N0b3AocWRpc2tkZXYtPmRhdGFwbGFuZSk7CiB9CiAKIHN0YXRpYyB2
b2lkIHhlbl9xZGlza19mcm9udGVuZF9jaGFuZ2VkKFhlbkRldmljZSAqeGVuZGV2LApAQCAtOTMs
NiArMjI1LDkgQEAgc3RhdGljIHZvaWQgeGVuX3FkaXNrX3VucmVhbGl6ZShYZW5EZXZpY2UgKnhl
bmRldiwgRXJyb3IgKiplcnJwKQogICAgIHRyYWNlX3hlbl9xZGlza191bnJlYWxpemUodmRldi0+
ZGlzaywgdmRldi0+cGFydGl0aW9uKTsKIAogICAgIHhlbl9xZGlza19kaXNjb25uZWN0KHFkaXNr
ZGV2LCAmZXJyb3JfZmF0YWwpOworCisgICAgeGVuX3FkaXNrX2RhdGFwbGFuZV9kZXN0cm95KHFk
aXNrZGV2LT5kYXRhcGxhbmUpOworICAgIHFkaXNrZGV2LT5kYXRhcGxhbmUgPSBOVUxMOwogfQog
CiBzdGF0aWMgY2hhciAqZGlza190b192YmRfbmFtZSh1bnNpZ25lZCBpbnQgZGlzaykKQEAgLTI4
OSw2ICs0MjQsMTEgQEAgY29uc3QgUHJvcGVydHlJbmZvIHhlbl9xZGlza19wcm9wX3ZkZXYgPSB7
CiBzdGF0aWMgUHJvcGVydHkgeGVuX3FkaXNrX3Byb3BzW10gPSB7CiAgICAgREVGSU5FX1BST1Ao
InZkZXYiLCBYZW5RZGlza0RldmljZSwgdmRldiwKICAgICAgICAgICAgICAgICB4ZW5fcWRpc2tf
cHJvcF92ZGV2LCBYZW5RZGlza1ZkZXYpLAorICAgIERFRklORV9CTE9DS19QUk9QRVJUSUVTKFhl
blFkaXNrRGV2aWNlLCBjb25mKSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoIm1heC1yaW5nLXBh
Z2Utb3JkZXIiLCBYZW5RZGlza0RldmljZSwKKyAgICAgICAgICAgICAgICAgICAgICAgbWF4X3Jp
bmdfcGFnZV9vcmRlciwgNCksCisgICAgREVGSU5FX1BST1BfTElOSygiaW90aHJlYWQiLCBYZW5R
ZGlza0RldmljZSwgaW90aHJlYWQsIFRZUEVfSU9USFJFQUQsCisgICAgICAgICAgICAgICAgICAg
ICBJT1RocmVhZCAqKSwKICAgICBERUZJTkVfUFJPUF9FTkRfT0ZfTElTVCgpCiB9OwogCmRpZmYg
LS1naXQgYS9ody94ZW4veGVuLWJ1cy5jIGIvaHcveGVuL3hlbi1idXMuYwppbmRleCA2NGM4YWY1
NGIwLi5jNGIyNTMxMDNmIDEwMDY0NAotLS0gYS9ody94ZW4veGVuLWJ1cy5jCisrKyBiL2h3L3hl
bi94ZW4tYnVzLmMKQEAgLTIxNyw4ICsyMTcsOCBAQCBzdGF0aWMgY29uc3QgVHlwZUluZm8geGVu
X2J1c190eXBlX2luZm8gPSB7CiAgICAgLmNsYXNzX2luaXQgPSB4ZW5fYnVzX2NsYXNzX2luaXQs
CiB9OwogCi1zdGF0aWMgdm9pZCB4ZW5fZGV2aWNlX2JhY2tlbmRfcHJpbnRmKFhlbkRldmljZSAq
eGVuZGV2LCBjb25zdCBjaGFyICprZXksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGNvbnN0IGNoYXIgKmZtdCwgLi4uKQordm9pZCB4ZW5fZGV2aWNlX2JhY2tlbmRfcHJp
bnRmKFhlbkRldmljZSAqeGVuZGV2LCBjb25zdCBjaGFyICprZXksCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgY29uc3QgY2hhciAqZm10LCAuLi4pCiB7CiAgICAgWGVuQnVzICp4ZW5i
dXMgPSBYRU5fQlVTKHFkZXZfZ2V0X3BhcmVudF9idXMoREVWSUNFKHhlbmRldikpKTsKICAgICB2
YV9saXN0IGFwOwpAQCAtMzA1LDggKzMwNSw4IEBAIHN0YXRpYyB2b2lkIHhlbl9kZXZpY2VfYmFj
a2VuZF9kZXN0cm95KFhlbkRldmljZSAqeGVuZGV2KQogICAgIGdfZnJlZSh4ZW5kZXYtPmJhY2tl
bmRfcGF0aCk7CiB9CiAKLXN0YXRpYyB2b2lkIHhlbl9kZXZpY2VfZnJvbnRlbmRfcHJpbnRmKFhl
bkRldmljZSAqeGVuZGV2LCBjb25zdCBjaGFyICprZXksCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICpmbXQsIC4uLikKK3ZvaWQgeGVuX2RldmljZV9m
cm9udGVuZF9wcmludGYoWGVuRGV2aWNlICp4ZW5kZXYsIGNvbnN0IGNoYXIgKmtleSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAqZm10LCAuLi4pCiB7CiAgICAg
WGVuQnVzICp4ZW5idXMgPSBYRU5fQlVTKHFkZXZfZ2V0X3BhcmVudF9idXMoREVWSUNFKHhlbmRl
dikpKTsKICAgICB2YV9saXN0IGFwOwpAQCAtMzE4LDggKzMxOCw4IEBAIHN0YXRpYyB2b2lkIHhl
bl9kZXZpY2VfZnJvbnRlbmRfcHJpbnRmKFhlbkRldmljZSAqeGVuZGV2LCBjb25zdCBjaGFyICpr
ZXksCiAgICAgdmFfZW5kKGFwKTsKIH0KIAotc3RhdGljIGludCB4ZW5fZGV2aWNlX2Zyb250ZW5k
X3NjYW5mKFhlbkRldmljZSAqeGVuZGV2LCBjb25zdCBjaGFyICprZXksCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKmZtdCwgLi4uKQoraW50IHhlbl9k
ZXZpY2VfZnJvbnRlbmRfc2NhbmYoWGVuRGV2aWNlICp4ZW5kZXYsIGNvbnN0IGNoYXIgKmtleSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKmZtdCwgLi4uKQogewog
ICAgIFhlbkJ1cyAqeGVuYnVzID0gWEVOX0JVUyhxZGV2X2dldF9wYXJlbnRfYnVzKERFVklDRSh4
ZW5kZXYpKSk7CiAgICAgdmFfbGlzdCBhcDsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvaHcveGVuL3hl
bi1idXMuaCBiL2luY2x1ZGUvaHcveGVuL3hlbi1idXMuaAppbmRleCAzODZmNmJmYzkzLi5kOTMx
ZTAxMjY4IDEwMDY0NAotLS0gYS9pbmNsdWRlL2h3L3hlbi94ZW4tYnVzLmgKKysrIGIvaW5jbHVk
ZS9ody94ZW4veGVuLWJ1cy5oCkBAIC04Miw2ICs4MiwxNCBAQCB2b2lkIHhlbl9kZXZpY2VfYmFj
a2VuZF9zZXRfc3RhdGUoWGVuRGV2aWNlICp4ZW5kZXYsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZW51bSB4ZW5idXNfc3RhdGUgc3RhdGUpOwogZW51bSB4ZW5idXNfc3RhdGUg
eGVuX2RldmljZV9iYWNrZW5kX2dldF9zdGF0ZShYZW5EZXZpY2UgKnhlbmRldik7CiAKK3ZvaWQg
eGVuX2RldmljZV9iYWNrZW5kX3ByaW50ZihYZW5EZXZpY2UgKnhlbmRldiwgY29uc3QgY2hhciAq
a2V5LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKmZtdCwgLi4u
KTsKKwordm9pZCB4ZW5fZGV2aWNlX2Zyb250ZW5kX3ByaW50ZihYZW5EZXZpY2UgKnhlbmRldiwg
Y29uc3QgY2hhciAqa2V5LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBj
aGFyICpmbXQsIC4uLik7CitpbnQgeGVuX2RldmljZV9mcm9udGVuZF9zY2FuZihYZW5EZXZpY2Ug
KnhlbmRldiwgY29uc3QgY2hhciAqa2V5LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y29uc3QgY2hhciAqZm10LCAuLi4pOworCiB2b2lkIHhlbl9kZXZpY2Vfc2V0X21heF9ncmFudF9y
ZWZzKFhlbkRldmljZSAqeGVuZGV2LCB1bnNpZ25lZCBpbnQgbnJfcmVmcywKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3IgKiplcnJwKTsKIHZvaWQgKnhlbl9kZXZpY2Vf
bWFwX2dyYW50X3JlZnMoWGVuRGV2aWNlICp4ZW5kZXYsIHVpbnQzMl90ICpyZWZzLApkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9ody94ZW4veGVuLXFkaXNrLmggYi9pbmNsdWRlL2h3L3hlbi94ZW4tcWRp
c2suaAppbmRleCBhZGUwODY2MDM3Li5kN2RkMmJmMGVlIDEwMDY0NAotLS0gYS9pbmNsdWRlL2h3
L3hlbi94ZW4tcWRpc2suaAorKysgYi9pbmNsdWRlL2h3L3hlbi94ZW4tcWRpc2suaApAQCAtNiw3
ICs2LDE1IEBACiAjaWZuZGVmIEhXX1hFTl9RRElTS19ICiAjZGVmaW5lIEhXX1hFTl9RRElTS19I
CiAKKyNpbmNsdWRlICJody94ZW4veGVuLmgiCiAjaW5jbHVkZSAiaHcveGVuL3hlbi1idXMuaCIK
KyNpbmNsdWRlICJody9ibG9jay9ibG9jay5oIgorI2luY2x1ZGUgImh3L2Jsb2NrL3hlbl9ibGtp
Zi5oIgorI2luY2x1ZGUgImh3L2Jsb2NrL2RhdGFwbGFuZS94ZW4tcWRpc2suaCIKKyNpbmNsdWRl
ICJzeXNlbXUvYmxvY2tkZXYuaCIKKyNpbmNsdWRlICJzeXNlbXUvaW90aHJlYWQuaCIKKyNpbmNs
dWRlICJzeXNlbXUvYmxvY2stYmFja2VuZC5oIgorI2luY2x1ZGUgInN5c2VtdS9pb3RocmVhZC5o
IgogCiB0eXBlZGVmIGVudW0gWGVuUWRpc2tWZGV2VHlwZSB7CiAgICAgWEVOX1FESVNLX1ZERVZf
VFlQRV9EUCwKQEAgLTMzLDYgKzQxLDEwIEBAIHR5cGVkZWYgc3RydWN0IFhlblFkaXNrRGV2aWNl
IFhlblFkaXNrRGV2aWNlOwogc3RydWN0IFhlblFkaXNrRGV2aWNlIHsKICAgICBYZW5EZXZpY2Ug
eGVuZGV2OwogICAgIFhlblFkaXNrVmRldiB2ZGV2OworICAgIEJsb2NrQ29uZiBjb25mOworICAg
IHVuc2lnbmVkIGludCBtYXhfcmluZ19wYWdlX29yZGVyOworICAgIElPVGhyZWFkICppb3RocmVh
ZDsKKyAgICBYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lOwogfTsKIAogI2VuZGlmIC8qIEhX
X1hFTl9RRElTS19IICovCi0tIAoyLjExLjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0
cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlz
dGluZm8veGVuLWRldmVs
