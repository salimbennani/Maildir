Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 22 Nov 2018 00:34:19 -0000
Received: from icoremail.net (unknown [209.85.214.179])
	by mail-app2 (Coremail) with SMTP id by_KCgC3fyVsevVbtSfJAQ--.58425S3;
	Wed, 21 Nov 2018 23:31:57 +0800 (CST)
Received: from mail-pl1-f179.google.com (unknown [209.85.214.179])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwC3nEhpevVbVxtkAA--.2220S3;
	Wed, 21 Nov 2018 23:31:53 +0800 (CST)
Received: by mail-pl1-f179.google.com with SMTP id t13so5999952ply.13
        for <xuliker@zju.edu.cn>; Wed, 21 Nov 2018 07:31:53 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=sVIDJmNiDA3SqxzzSzmTGpm46JoUrOvfewCgRSWnZhA=;
        b=aT3cC2+/8fgSH1oEzmLxemcqs/VLx8tJxD7ZBdGIm6zSkpQ4M3jhsR7RAwTdmJtcFw
         UkQ7k0KCiYoEiwHZDWuJmhpFoiLGgMWuPVaNKyCd7r+PMMi1HBnvk0dhHpmAVjJTzpKO
         WEw++LuHWD0FKD/N14Xy+/tA/9Qlm1GE0av3cG+tXGS00RZR7tL7aP1YvU4vvXXpP0Dw
         EEAnXW9sSyV4u/+wlLC8E1c1nsBl2h4TbE3iRtD6JKlPdaVJpfKN+eUvu4hbUoKBZ3+o
         bQPRtQD95kKAVDu8/5FNmYjAZ33o+k+dO6oi1C+hZ3PnuqGdQLgt6rAo3Y/rAgmfNklp
         eG5g==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AA+aEWa+PhSP1KVAneW8NxaSKWkgF53aHPcu2vOT0XHKEZBgG62vn3NR
	O54uuV3y+4BzBss5MehApZmQ8ll2DbuEMG0oxnPRaZlIXH85OZU=
X-Received: by 2002:a63:f615:: with SMTP id m21mr6569299pgh.428.1542814313069;
        Wed, 21 Nov 2018 07:31:53 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp2101464pju;
        Wed, 21 Nov 2018 07:31:51 -0800 (PST)
X-Google-Smtp-Source: AFSGD/XuIP/I3i/K4g5+OrIR0G1bwmFWgA92qA2g5ndoTZ5hQQfCyXAiXu2rjsHeQGFiz2E7QvJQ
X-Received: by 2002:a25:5186:: with SMTP id f128-v6mr6699964ybb.203.1542814311050;
        Wed, 21 Nov 2018 07:31:51 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542814310; cv=none;
        d=google.com; s=arc-20160816;
        b=Cfl3WnzazE/+TQ8f7nxZ3hWcyCHi013gnOA8Lshmf7rh+d/fgIo1UmlEuX8D0cj1o2
         FttItzjcUFUy55/YYD8twbTVNaSj44GZgMsRseqzXWU6cjD0bY13xcsFb+PNEAejY0Cp
         tdoeJOy7bOFzzsSEVEDj+d7mRSC/KnWNTwW4U/Tu4vV3LSuFy8PeaZDMOXxB89LbWvIt
         HDgJNdr6kGOzMNWKCM96viBEA98eK9n9EI0YfucP+Hdv8z2Ygwp0AoRghuc6SDGKY/P2
         9sA+ULF0WUYLgSl1ZvE8kLN8uAvNt99PesMY0V9TOwYGvbTlkUkYaWDv21qKTV5iAREI
         rJnA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=sVIDJmNiDA3SqxzzSzmTGpm46JoUrOvfewCgRSWnZhA=;
        b=M6J9lnNFHz4kTfpZIzcmcWHB+oIrQFQ6/rjNKmDfoGCgiLX4uHqS8EMOYjamNnlMpb
         kwNtrlgQwNNFEJD6FH7zR5RBQl/SrLZnfCPH8hdhKWVn6WzoL+EX3d5CRiYhwHcEcSq0
         fbICclto1BXlJGahxmV9B145DooQD0lG9VQAO5vAfZw8/Il+BzKkzFMS6B3HmPE7hpBB
         ZC9QDQKwHn/jZ1b4sUEhSOIkMcz+9oky6tWVNLZi8gE4r4ENmzHLvEWOJz29gu8P2+cj
         xFm7m+Oad5AHKthy//4d+0W4JoMtDBe3ked1F0hpkplZ7qJl2wCx9dfNyy4zZg9R9hWC
         QIGw==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id x131si11301191ywd.27.2018.11.21.07.31.32
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 21 Nov 2018 07:31:50 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gPURD-0000yu-K6; Wed, 21 Nov 2018 15:29:11 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=wVSe=OA=citrix.com=prvs=856356900=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1gPURB-0000w2-I0
 for xen-devel@lists.xenproject.org; Wed, 21 Nov 2018 15:29:09 +0000
X-Inumbo-ID: 2fd1a534-eda2-11e8-a444-12d6303a7972
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2fd1a534-eda2-11e8-a444-12d6303a7972;
 Wed, 21 Nov 2018 15:29:08 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,261,1539648000"; d="scan'208";a="71207584"
From: Paul Durrant <paul.durrant@citrix.com>
To: <qemu-block@nongnu.org>, <qemu-devel@nongnu.org>,
 <xen-devel@lists.xenproject.org>
Date: Wed, 21 Nov 2018 15:12:11 +0000
Message-ID: <20181121151211.15997-19-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20181121151211.15997-1-paul.durrant@citrix.com>
References: <20181121151211.15997-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 18/18] xen: remove the legacy 'xen_disk' backend
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, Paul Durrant <paul.durrant@citrix.com>,
 Max Reitz <mreitz@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwC3nEhpevVbVxtkAA--.2220S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvAXoWfCry3Zw1xGFyxGry5Kw4xXrb_yoW5WF18Xo
	Z3ursrZ3y8Wry8CrnrXr1UAasrWF95J3WxCF15Jrs0gw1qqF1jgF47Ka15G345Kr4FqFy8
	XFyxX3yfJ3Z8GFZrn29KB7ZKAUJUUUUU529EdanIXcx71UUUUj7v73VFW2AGmfu7jjvjm3
	AaLaJ3UjIYCTnIWjp_UUUo47k0a2IF6w4kM7kC6x804xWl14x267AKxVWUJVW8JwAFIxvE
	14AKwVWUJVWUGwA2ocxC64kIII0Yj41l84x0c7CEw4AK67xGY2AK021l84ACjcxK6xIIjx
	v20xvE14v26F1j6w1UM28EF7xvwVC0I7IYx2IY6xkF7I0E14v26F4j6r4UJwA2z4x0Y4vE
	x4A2jsIE14v26rxl6s0DM28EF7xvwVC2z280aVCY1x0267AKxVW0oVCq3wAa7VCE64xvF2
	IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x082IY
	62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUJVWUGwAv7V
	C2z280aVAFwI0_Cr0_Gr1UMcvjeVCFs4IE7xkEbVWUJVW8JwACjcxG0xvY0x0EwIxGrwAC
	Y4xI67k04243AVAKzVAKj4xxMx02cVCv0xWlc7CjxVAKzI0EY4vE52x082I5MxkFs20EY4
	vE44CYbxCE4x80FwCY02Avz4vEIxC_XrWlc2IjII80xcxEwVAKI48JMxvI42IY6xIIjxv2
	0xvE14v26ryj6F1UMxvI42IY6xIIjxv20xvEc7CjxVAFwI0_Gr0_Cr1lcIIF0xvEx4A2js
	IE14v26rxl6s0DMxvI42IY6I8E87Iv6xkF7I0E14v26rxl6s0DMxAIw28IcxkI7VAKI48J
	MxAIw28IcVAKzI0EY4vE52x082I5MxCjnVCjjxCrMxC20s026xCaFVCjc4AY6r1j6r4UMI
	8I3I0E5I8CrVAFwI0_Jr0_Jr4lx2IqxVCjr7xvwVAFwI0_JrI_JrWlx4CE17CEb7AF67AK
	xVWUAVWUtwCIc40Y0x0EwIxGrwCI42IY6xAIw20EY4v20xvaj40_JFI_Gr1l6VACY4xI67
	k04243AbIYCTnIWIevJa73UjIFyTuYvjxUBID2UUUUU

VGhpcyBiYWNrZW5kIGhhcyBub3cgYmVlbiByZXBsYWNlZCBieSB0aGUgJ3hlbi1xZGlzaycgWGVu
RGV2aWNlLgoKU2lnbmVkLW9mZi1ieTogUGF1bCBEdXJyYW50IDxwYXVsLmR1cnJhbnRAY2l0cml4
LmNvbT4KLS0tCkNjOiBLZXZpbiBXb2xmIDxrd29sZkByZWRoYXQuY29tPgpDYzogTWF4IFJlaXR6
IDxtcmVpdHpAcmVkaGF0LmNvbT4KLS0tCiBody9ibG9jay9NYWtlZmlsZS5vYmpzIHwgICAgMSAt
CiBody9ibG9jay94ZW5fZGlzay5jICAgIHwgMTAxMSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMTAxMiBkZWxldGlvbnMo
LSkKIGRlbGV0ZSBtb2RlIDEwMDY0NCBody9ibG9jay94ZW5fZGlzay5jCgpkaWZmIC0tZ2l0IGEv
aHcvYmxvY2svTWFrZWZpbGUub2JqcyBiL2h3L2Jsb2NrL01ha2VmaWxlLm9ianMKaW5kZXggYmNk
ZDM2ZDMxOC4uZDlkMmYzZmRlNSAxMDA2NDQKLS0tIGEvaHcvYmxvY2svTWFrZWZpbGUub2Jqcwor
KysgYi9ody9ibG9jay9NYWtlZmlsZS5vYmpzCkBAIC00LDcgKzQsNiBAQCBjb21tb24tb2JqLSQo
Q09ORklHX1NTSV9NMjVQODApICs9IG0yNXA4MC5vCiBjb21tb24tb2JqLSQoQ09ORklHX05BTkQp
ICs9IG5hbmQubwogY29tbW9uLW9iai0kKENPTkZJR19QRkxBU0hfQ0ZJMDEpICs9IHBmbGFzaF9j
ZmkwMS5vCiBjb21tb24tb2JqLSQoQ09ORklHX1BGTEFTSF9DRkkwMikgKz0gcGZsYXNoX2NmaTAy
Lm8KLWNvbW1vbi1vYmotJChDT05GSUdfWEVOKSArPSB4ZW5fZGlzay5vCiBjb21tb24tb2JqLSQo
Q09ORklHX1hFTikgKz0geGVuLXFkaXNrLm8KIGNvbW1vbi1vYmotJChDT05GSUdfRUNDKSArPSBl
Y2MubwogY29tbW9uLW9iai0kKENPTkZJR19PTkVOQU5EKSArPSBvbmVuYW5kLm8KZGlmZiAtLWdp
dCBhL2h3L2Jsb2NrL3hlbl9kaXNrLmMgYi9ody9ibG9jay94ZW5fZGlzay5jCmRlbGV0ZWQgZmls
ZSBtb2RlIDEwMDY0NAppbmRleCA3NWZlNTVmMmFlLi4wMDAwMDAwMDAwCi0tLSBhL2h3L2Jsb2Nr
L3hlbl9kaXNrLmMKKysrIC9kZXYvbnVsbApAQCAtMSwxMDExICswLDAgQEAKLS8qCi0gKiAgeGVu
IHBhcmF2aXJ0IGJsb2NrIGRldmljZSBiYWNrZW5kCi0gKgotICogIChjKSBHZXJkIEhvZmZtYW5u
IDxrcmF4ZWxAcmVkaGF0LmNvbT4KLSAqCi0gKiAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdh
cmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKLSAqICBpdCB1bmRlciB0
aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBi
eQotICogIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IHVuZGVyIHZlcnNpb24gMiBvZiB0
aGUgTGljZW5zZS4KLSAqCi0gKiAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBo
b3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCi0gKiAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZ
OyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKLSAqICBNRVJDSEFOVEFCSUxJ
VFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCi0gKiAgR05V
IEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KLSAqCi0gKiAgWW91IHNo
b3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vu
c2UgYWxvbmcKLSAqICB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cu
Z251Lm9yZy9saWNlbnNlcy8+LgotICoKLSAqICBDb250cmlidXRpb25zIGFmdGVyIDIwMTItMDEt
MTMgYXJlIGxpY2Vuc2VkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUKLSAqICBHTlUgR1BMLCB2ZXJz
aW9uIDIgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KLSAqLwotCi0jaW5j
bHVkZSAicWVtdS9vc2RlcC5oIgotI2luY2x1ZGUgInFlbXUvdW5pdHMuaCIKLSNpbmNsdWRlIDxz
eXMvaW9jdGwuaD4KLSNpbmNsdWRlIDxzeXMvdWlvLmg+Ci0KLSNpbmNsdWRlICJody9ody5oIgot
I2luY2x1ZGUgImh3L3hlbi94ZW4tbGVnYWN5LWJhY2tlbmQuaCIKLSNpbmNsdWRlICJ4ZW5fYmxr
aWYuaCIKLSNpbmNsdWRlICJzeXNlbXUvYmxvY2tkZXYuaCIKLSNpbmNsdWRlICJzeXNlbXUvaW90
aHJlYWQuaCIKLSNpbmNsdWRlICJzeXNlbXUvYmxvY2stYmFja2VuZC5oIgotI2luY2x1ZGUgInFh
cGkvZXJyb3IuaCIKLSNpbmNsdWRlICJxYXBpL3FtcC9xZGljdC5oIgotI2luY2x1ZGUgInFhcGkv
cW1wL3FzdHJpbmcuaCIKLSNpbmNsdWRlICJ0cmFjZS5oIgotCi0vKiAtLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCi0KLSNkZWZp
bmUgQkxPQ0tfU0laRSAgNTEyCi0jZGVmaW5lIElPQ0JfQ09VTlQgIChCTEtJRl9NQVhfU0VHTUVO
VFNfUEVSX1JFUVVFU1QgKyAyKQotCi1zdHJ1Y3QgaW9yZXEgewotICAgIGJsa2lmX3JlcXVlc3Rf
dCAgICAgcmVxOwotICAgIGludDE2X3QgICAgICAgICAgICAgc3RhdHVzOwotCi0gICAgLyogcGFy
c2VkIHJlcXVlc3QgKi8KLSAgICBvZmZfdCAgICAgICAgICAgICAgIHN0YXJ0OwotICAgIFFFTVVJ
T1ZlY3RvciAgICAgICAgdjsKLSAgICB2b2lkICAgICAgICAgICAgICAgICpidWY7Ci0gICAgc2l6
ZV90ICAgICAgICAgICAgICBzaXplOwotICAgIGludCAgICAgICAgICAgICAgICAgcHJlc3luYzsK
LQotICAgIC8qIGFpbyBzdGF0dXMgKi8KLSAgICBpbnQgICAgICAgICAgICAgICAgIGFpb19pbmZs
aWdodDsKLSAgICBpbnQgICAgICAgICAgICAgICAgIGFpb19lcnJvcnM7Ci0KLSAgICBzdHJ1Y3Qg
WGVuQmxrRGV2ICAgICpibGtkZXY7Ci0gICAgUUxJU1RfRU5UUlkoaW9yZXEpICAgbGlzdDsKLSAg
ICBCbG9ja0FjY3RDb29raWUgICAgIGFjY3Q7Ci19OwotCi0jZGVmaW5lIE1BWF9SSU5HX1BBR0Vf
T1JERVIgNAotCi1zdHJ1Y3QgWGVuQmxrRGV2IHsKLSAgICBzdHJ1Y3QgWGVuTGVnYWN5RGV2aWNl
ICAgIHhlbmRldjsgIC8qIG11c3QgYmUgZmlyc3QgKi8KLSAgICBjaGFyICAgICAgICAgICAgICAg
ICpwYXJhbXM7Ci0gICAgY2hhciAgICAgICAgICAgICAgICAqbW9kZTsKLSAgICBjaGFyICAgICAg
ICAgICAgICAgICp0eXBlOwotICAgIGNoYXIgICAgICAgICAgICAgICAgKmRldjsKLSAgICBjaGFy
ICAgICAgICAgICAgICAgICpkZXZ0eXBlOwotICAgIGJvb2wgICAgICAgICAgICAgICAgZGlyZWN0
aW9zYWZlOwotICAgIGNvbnN0IGNoYXIgICAgICAgICAgKmZpbGVwcm90bzsKLSAgICBjb25zdCBj
aGFyICAgICAgICAgICpmaWxlbmFtZTsKLSAgICB1bnNpZ25lZCBpbnQgICAgICAgIHJpbmdfcmVm
WzEgPDwgTUFYX1JJTkdfUEFHRV9PUkRFUl07Ci0gICAgdW5zaWduZWQgaW50ICAgICAgICBucl9y
aW5nX3JlZjsKLSAgICB2b2lkICAgICAgICAgICAgICAgICpzcmluZzsKLSAgICBpbnQ2NF90ICAg
ICAgICAgICAgIGZpbGVfYmxrOwotICAgIGludDY0X3QgICAgICAgICAgICAgZmlsZV9zaXplOwot
ICAgIGludCAgICAgICAgICAgICAgICAgcHJvdG9jb2w7Ci0gICAgYmxraWZfYmFja19yaW5nc190
ICByaW5nczsKLSAgICBpbnQgICAgICAgICAgICAgICAgIG1vcmVfd29yazsKLQotICAgIC8qIHJl
cXVlc3QgbGlzdHMgKi8KLSAgICBRTElTVF9IRUFEKGluZmxpZ2h0X2hlYWQsIGlvcmVxKSBpbmZs
aWdodDsKLSAgICBRTElTVF9IRUFEKGZpbmlzaGVkX2hlYWQsIGlvcmVxKSBmaW5pc2hlZDsKLSAg
ICBRTElTVF9IRUFEKGZyZWVsaXN0X2hlYWQsIGlvcmVxKSBmcmVlbGlzdDsKLSAgICBpbnQgICAg
ICAgICAgICAgICAgIHJlcXVlc3RzX3RvdGFsOwotICAgIGludCAgICAgICAgICAgICAgICAgcmVx
dWVzdHNfaW5mbGlnaHQ7Ci0gICAgaW50ICAgICAgICAgICAgICAgICByZXF1ZXN0c19maW5pc2hl
ZDsKLSAgICB1bnNpZ25lZCBpbnQgICAgICAgIG1heF9yZXF1ZXN0czsKLQotICAgIGdib29sZWFu
ICAgICAgICAgICAgZmVhdHVyZV9kaXNjYXJkOwotCi0gICAgLyogcWVtdSBibG9jayBkcml2ZXIg
Ki8KLSAgICBEcml2ZUluZm8gICAgICAgICAgICpkaW5mbzsKLSAgICBCbG9ja0JhY2tlbmQgICAg
ICAgICpibGs7Ci0gICAgUUVNVUJIICAgICAgICAgICAgICAqYmg7Ci0KLSAgICBJT1RocmVhZCAg
ICAgICAgICAgICppb3RocmVhZDsKLSAgICBBaW9Db250ZXh0ICAgICAgICAgICpjdHg7Ci19Owot
Ci0vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tICovCi0KLXN0YXRpYyB2b2lkIGlvcmVxX3Jlc2V0KHN0cnVjdCBpb3JlcSAqaW9y
ZXEpCi17Ci0gICAgbWVtc2V0KCZpb3JlcS0+cmVxLCAwLCBzaXplb2YoaW9yZXEtPnJlcSkpOwot
ICAgIGlvcmVxLT5zdGF0dXMgPSAwOwotICAgIGlvcmVxLT5zdGFydCA9IDA7Ci0gICAgaW9yZXEt
PmJ1ZiA9IE5VTEw7Ci0gICAgaW9yZXEtPnNpemUgPSAwOwotICAgIGlvcmVxLT5wcmVzeW5jID0g
MDsKLQotICAgIGlvcmVxLT5haW9faW5mbGlnaHQgPSAwOwotICAgIGlvcmVxLT5haW9fZXJyb3Jz
ID0gMDsKLQotICAgIGlvcmVxLT5ibGtkZXYgPSBOVUxMOwotICAgIG1lbXNldCgmaW9yZXEtPmxp
c3QsIDAsIHNpemVvZihpb3JlcS0+bGlzdCkpOwotICAgIG1lbXNldCgmaW9yZXEtPmFjY3QsIDAs
IHNpemVvZihpb3JlcS0+YWNjdCkpOwotCi0gICAgcWVtdV9pb3ZlY19yZXNldCgmaW9yZXEtPnYp
OwotfQotCi1zdGF0aWMgc3RydWN0IGlvcmVxICppb3JlcV9zdGFydChzdHJ1Y3QgWGVuQmxrRGV2
ICpibGtkZXYpCi17Ci0gICAgc3RydWN0IGlvcmVxICppb3JlcSA9IE5VTEw7Ci0KLSAgICBpZiAo
UUxJU1RfRU1QVFkoJmJsa2Rldi0+ZnJlZWxpc3QpKSB7Ci0gICAgICAgIGlmIChibGtkZXYtPnJl
cXVlc3RzX3RvdGFsID49IGJsa2Rldi0+bWF4X3JlcXVlc3RzKSB7Ci0gICAgICAgICAgICBnb3Rv
IG91dDsKLSAgICAgICAgfQotICAgICAgICAvKiBhbGxvY2F0ZSBuZXcgc3RydWN0ICovCi0gICAg
ICAgIGlvcmVxID0gZ19tYWxsb2MwKHNpemVvZigqaW9yZXEpKTsKLSAgICAgICAgaW9yZXEtPmJs
a2RldiA9IGJsa2RldjsKLSAgICAgICAgYmxrZGV2LT5yZXF1ZXN0c190b3RhbCsrOwotICAgICAg
ICBxZW11X2lvdmVjX2luaXQoJmlvcmVxLT52LCAxKTsKLSAgICB9IGVsc2UgewotICAgICAgICAv
KiBnZXQgb25lIGZyb20gZnJlZWxpc3QgKi8KLSAgICAgICAgaW9yZXEgPSBRTElTVF9GSVJTVCgm
YmxrZGV2LT5mcmVlbGlzdCk7Ci0gICAgICAgIFFMSVNUX1JFTU9WRShpb3JlcSwgbGlzdCk7Ci0g
ICAgfQotICAgIFFMSVNUX0lOU0VSVF9IRUFEKCZibGtkZXYtPmluZmxpZ2h0LCBpb3JlcSwgbGlz
dCk7Ci0gICAgYmxrZGV2LT5yZXF1ZXN0c19pbmZsaWdodCsrOwotCi1vdXQ6Ci0gICAgcmV0dXJu
IGlvcmVxOwotfQotCi1zdGF0aWMgdm9pZCBpb3JlcV9maW5pc2goc3RydWN0IGlvcmVxICppb3Jl
cSkKLXsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpibGtkZXYgPSBpb3JlcS0+YmxrZGV2OwotCi0g
ICAgUUxJU1RfUkVNT1ZFKGlvcmVxLCBsaXN0KTsKLSAgICBRTElTVF9JTlNFUlRfSEVBRCgmYmxr
ZGV2LT5maW5pc2hlZCwgaW9yZXEsIGxpc3QpOwotICAgIGJsa2Rldi0+cmVxdWVzdHNfaW5mbGln
aHQtLTsKLSAgICBibGtkZXYtPnJlcXVlc3RzX2ZpbmlzaGVkKys7Ci19Ci0KLXN0YXRpYyB2b2lk
IGlvcmVxX3JlbGVhc2Uoc3RydWN0IGlvcmVxICppb3JlcSwgYm9vbCBmaW5pc2gpCi17Ci0gICAg
c3RydWN0IFhlbkJsa0RldiAqYmxrZGV2ID0gaW9yZXEtPmJsa2RldjsKLQotICAgIFFMSVNUX1JF
TU9WRShpb3JlcSwgbGlzdCk7Ci0gICAgaW9yZXFfcmVzZXQoaW9yZXEpOwotICAgIGlvcmVxLT5i
bGtkZXYgPSBibGtkZXY7Ci0gICAgUUxJU1RfSU5TRVJUX0hFQUQoJmJsa2Rldi0+ZnJlZWxpc3Qs
IGlvcmVxLCBsaXN0KTsKLSAgICBpZiAoZmluaXNoKSB7Ci0gICAgICAgIGJsa2Rldi0+cmVxdWVz
dHNfZmluaXNoZWQtLTsKLSAgICB9IGVsc2UgewotICAgICAgICBibGtkZXYtPnJlcXVlc3RzX2lu
ZmxpZ2h0LS07Ci0gICAgfQotfQotCi0vKgotICogdHJhbnNsYXRlIHJlcXVlc3QgaW50byBpb3Zl
YyArIHN0YXJ0IG9mZnNldAotICogZG8gc2FuaXR5IGNoZWNrcyBhbG9uZyB0aGUgd2F5Ci0gKi8K
LXN0YXRpYyBpbnQgaW9yZXFfcGFyc2Uoc3RydWN0IGlvcmVxICppb3JlcSkKLXsKLSAgICBzdHJ1
Y3QgWGVuQmxrRGV2ICpibGtkZXYgPSBpb3JlcS0+YmxrZGV2OwotICAgIHN0cnVjdCBYZW5MZWdh
Y3lEZXZpY2UgKnhlbmRldiA9ICZibGtkZXYtPnhlbmRldjsKLSAgICBzaXplX3QgbGVuOwotICAg
IGludCBpOwotCi0gICAgeGVuX3B2X3ByaW50Zih4ZW5kZXYsIDMsCi0gICAgICAgICAgICAgICAg
ICAib3AgJWQsIG5yICVkLCBoYW5kbGUgJWQsIGlkICUiIFBSSWQ2NCAiLCBzZWN0b3IgJSIgUFJJ
ZDY0ICJcbiIsCi0gICAgICAgICAgICAgICAgICBpb3JlcS0+cmVxLm9wZXJhdGlvbiwgaW9yZXEt
PnJlcS5ucl9zZWdtZW50cywKLSAgICAgICAgICAgICAgICAgIGlvcmVxLT5yZXEuaGFuZGxlLCBp
b3JlcS0+cmVxLmlkLCBpb3JlcS0+cmVxLnNlY3Rvcl9udW1iZXIpOwotICAgIHN3aXRjaCAoaW9y
ZXEtPnJlcS5vcGVyYXRpb24pIHsKLSAgICBjYXNlIEJMS0lGX09QX1JFQUQ6Ci0gICAgICAgIGJy
ZWFrOwotICAgIGNhc2UgQkxLSUZfT1BfRkxVU0hfRElTS0NBQ0hFOgotICAgICAgICBpb3JlcS0+
cHJlc3luYyA9IDE7Ci0gICAgICAgIGlmICghaW9yZXEtPnJlcS5ucl9zZWdtZW50cykgewotICAg
ICAgICAgICAgcmV0dXJuIDA7Ci0gICAgICAgIH0KLSAgICAgICAgLyogZmFsbCB0aHJvdWdoICov
Ci0gICAgY2FzZSBCTEtJRl9PUF9XUklURToKLSAgICAgICAgYnJlYWs7Ci0gICAgY2FzZSBCTEtJ
Rl9PUF9ESVNDQVJEOgotICAgICAgICByZXR1cm4gMDsKLSAgICBkZWZhdWx0OgotICAgICAgICB4
ZW5fcHZfcHJpbnRmKHhlbmRldiwgMCwgImVycm9yOiB1bmtub3duIG9wZXJhdGlvbiAoJWQpXG4i
LAotICAgICAgICAgICAgICAgICAgICAgIGlvcmVxLT5yZXEub3BlcmF0aW9uKTsKLSAgICAgICAg
Z290byBlcnI7Ci0gICAgfTsKLQotICAgIGlmIChpb3JlcS0+cmVxLm9wZXJhdGlvbiAhPSBCTEtJ
Rl9PUF9SRUFEICYmIGJsa2Rldi0+bW9kZVswXSAhPSAndycpIHsKLSAgICAgICAgeGVuX3B2X3By
aW50Zih4ZW5kZXYsIDAsICJlcnJvcjogd3JpdGUgcmVxIGZvciBybyBkZXZpY2VcbiIpOwotICAg
ICAgICBnb3RvIGVycjsKLSAgICB9Ci0KLSAgICBpb3JlcS0+c3RhcnQgPSBpb3JlcS0+cmVxLnNl
Y3Rvcl9udW1iZXIgKiBibGtkZXYtPmZpbGVfYmxrOwotICAgIGZvciAoaSA9IDA7IGkgPCBpb3Jl
cS0+cmVxLm5yX3NlZ21lbnRzOyBpKyspIHsKLSAgICAgICAgaWYgKGkgPT0gQkxLSUZfTUFYX1NF
R01FTlRTX1BFUl9SRVFVRVNUKSB7Ci0gICAgICAgICAgICB4ZW5fcHZfcHJpbnRmKHhlbmRldiwg
MCwgImVycm9yOiBucl9zZWdtZW50cyB0b28gYmlnXG4iKTsKLSAgICAgICAgICAgIGdvdG8gZXJy
OwotICAgICAgICB9Ci0gICAgICAgIGlmIChpb3JlcS0+cmVxLnNlZ1tpXS5maXJzdF9zZWN0ID4g
aW9yZXEtPnJlcS5zZWdbaV0ubGFzdF9zZWN0KSB7Ci0gICAgICAgICAgICB4ZW5fcHZfcHJpbnRm
KHhlbmRldiwgMCwgImVycm9yOiBmaXJzdCA+IGxhc3Qgc2VjdG9yXG4iKTsKLSAgICAgICAgICAg
IGdvdG8gZXJyOwotICAgICAgICB9Ci0gICAgICAgIGlmIChpb3JlcS0+cmVxLnNlZ1tpXS5sYXN0
X3NlY3QgKiBCTE9DS19TSVpFID49IFhDX1BBR0VfU0laRSkgewotICAgICAgICAgICAgeGVuX3B2
X3ByaW50Zih4ZW5kZXYsIDAsICJlcnJvcjogcGFnZSBjcm9zc2luZ1xuIik7Ci0gICAgICAgICAg
ICBnb3RvIGVycjsKLSAgICAgICAgfQotCi0gICAgICAgIGxlbiA9IChpb3JlcS0+cmVxLnNlZ1tp
XS5sYXN0X3NlY3QgLSBpb3JlcS0+cmVxLnNlZ1tpXS5maXJzdF9zZWN0ICsgMSkgKiBibGtkZXYt
PmZpbGVfYmxrOwotICAgICAgICBpb3JlcS0+c2l6ZSArPSBsZW47Ci0gICAgfQotICAgIGlmIChp
b3JlcS0+c3RhcnQgKyBpb3JlcS0+c2l6ZSA+IGJsa2Rldi0+ZmlsZV9zaXplKSB7Ci0gICAgICAg
IHhlbl9wdl9wcmludGYoeGVuZGV2LCAwLCAiZXJyb3I6IGFjY2VzcyBiZXlvbmQgZW5kIG9mIGZp
bGVcbiIpOwotICAgICAgICBnb3RvIGVycjsKLSAgICB9Ci0gICAgcmV0dXJuIDA7Ci0KLWVycjoK
LSAgICBpb3JlcS0+c3RhdHVzID0gQkxLSUZfUlNQX0VSUk9SOwotICAgIHJldHVybiAtMTsKLX0K
LQotc3RhdGljIGludCBpb3JlcV9ncmFudF9jb3B5KHN0cnVjdCBpb3JlcSAqaW9yZXEpCi17Ci0g
ICAgc3RydWN0IFhlbkJsa0RldiAqYmxrZGV2ID0gaW9yZXEtPmJsa2RldjsKLSAgICBzdHJ1Y3Qg
WGVuTGVnYWN5RGV2aWNlICp4ZW5kZXYgPSAmYmxrZGV2LT54ZW5kZXY7Ci0gICAgWGVuR3JhbnRD
b3B5U2VnbWVudCBzZWdzW0JMS0lGX01BWF9TRUdNRU5UU19QRVJfUkVRVUVTVF07Ci0gICAgaW50
IGksIGNvdW50LCByYzsKLSAgICBpbnQ2NF90IGZpbGVfYmxrID0gYmxrZGV2LT5maWxlX2JsazsK
LSAgICBib29sIHRvX2RvbWFpbiA9IChpb3JlcS0+cmVxLm9wZXJhdGlvbiA9PSBCTEtJRl9PUF9S
RUFEKTsKLSAgICB2b2lkICp2aXJ0ID0gaW9yZXEtPmJ1ZjsKLQotICAgIGlmIChpb3JlcS0+cmVx
Lm5yX3NlZ21lbnRzID09IDApIHsKLSAgICAgICAgcmV0dXJuIDA7Ci0gICAgfQotCi0gICAgY291
bnQgPSBpb3JlcS0+cmVxLm5yX3NlZ21lbnRzOwotCi0gICAgZm9yIChpID0gMDsgaSA8IGNvdW50
OyBpKyspIHsKLSAgICAgICAgaWYgKHRvX2RvbWFpbikgewotICAgICAgICAgICAgc2Vnc1tpXS5k
ZXN0LmZvcmVpZ24ucmVmID0gaW9yZXEtPnJlcS5zZWdbaV0uZ3JlZjsKLSAgICAgICAgICAgIHNl
Z3NbaV0uZGVzdC5mb3JlaWduLm9mZnNldCA9IGlvcmVxLT5yZXEuc2VnW2ldLmZpcnN0X3NlY3Qg
KiBmaWxlX2JsazsKLSAgICAgICAgICAgIHNlZ3NbaV0uc291cmNlLnZpcnQgPSB2aXJ0OwotICAg
ICAgICB9IGVsc2UgewotICAgICAgICAgICAgc2Vnc1tpXS5zb3VyY2UuZm9yZWlnbi5yZWYgPSBp
b3JlcS0+cmVxLnNlZ1tpXS5ncmVmOwotICAgICAgICAgICAgc2Vnc1tpXS5zb3VyY2UuZm9yZWln
bi5vZmZzZXQgPSBpb3JlcS0+cmVxLnNlZ1tpXS5maXJzdF9zZWN0ICogZmlsZV9ibGs7Ci0gICAg
ICAgICAgICBzZWdzW2ldLmRlc3QudmlydCA9IHZpcnQ7Ci0gICAgICAgIH0KLSAgICAgICAgc2Vn
c1tpXS5sZW4gPSAoaW9yZXEtPnJlcS5zZWdbaV0ubGFzdF9zZWN0Ci0gICAgICAgICAgICAgICAg
ICAgICAgIC0gaW9yZXEtPnJlcS5zZWdbaV0uZmlyc3Rfc2VjdCArIDEpICogZmlsZV9ibGs7Ci0g
ICAgICAgIHZpcnQgKz0gc2Vnc1tpXS5sZW47Ci0gICAgfQotCi0gICAgcmMgPSB4ZW5fYmVfY29w
eV9ncmFudF9yZWZzKHhlbmRldiwgdG9fZG9tYWluLCBzZWdzLCBjb3VudCk7Ci0KLSAgICBpZiAo
cmMpIHsKLSAgICAgICAgeGVuX3B2X3ByaW50Zih4ZW5kZXYsIDAsCi0gICAgICAgICAgICAgICAg
ICAgICAgImZhaWxlZCB0byBjb3B5IGRhdGEgJWRcbiIsIHJjKTsKLSAgICAgICAgaW9yZXEtPmFp
b19lcnJvcnMrKzsKLSAgICAgICAgcmV0dXJuIC0xOwotICAgIH0KLQotICAgIHJldHVybiByYzsK
LX0KLQotc3RhdGljIGludCBpb3JlcV9ydW5pb19xZW11X2FpbyhzdHJ1Y3QgaW9yZXEgKmlvcmVx
KTsKLQotc3RhdGljIHZvaWQgcWVtdV9haW9fY29tcGxldGUodm9pZCAqb3BhcXVlLCBpbnQgcmV0
KQotewotICAgIHN0cnVjdCBpb3JlcSAqaW9yZXEgPSBvcGFxdWU7Ci0gICAgc3RydWN0IFhlbkJs
a0RldiAqYmxrZGV2ID0gaW9yZXEtPmJsa2RldjsKLSAgICBzdHJ1Y3QgWGVuTGVnYWN5RGV2aWNl
ICp4ZW5kZXYgPSAmYmxrZGV2LT54ZW5kZXY7Ci0KLSAgICBhaW9fY29udGV4dF9hY3F1aXJlKGJs
a2Rldi0+Y3R4KTsKLQotICAgIGlmIChyZXQgIT0gMCkgewotICAgICAgICB4ZW5fcHZfcHJpbnRm
KHhlbmRldiwgMCwgIiVzIEkvTyBlcnJvclxuIiwKLSAgICAgICAgICAgICAgICAgICAgICBpb3Jl
cS0+cmVxLm9wZXJhdGlvbiA9PSBCTEtJRl9PUF9SRUFEID8gInJlYWQiIDogIndyaXRlIik7Ci0g
ICAgICAgIGlvcmVxLT5haW9fZXJyb3JzKys7Ci0gICAgfQotCi0gICAgaW9yZXEtPmFpb19pbmZs
aWdodC0tOwotICAgIGlmIChpb3JlcS0+cHJlc3luYykgewotICAgICAgICBpb3JlcS0+cHJlc3lu
YyA9IDA7Ci0gICAgICAgIGlvcmVxX3J1bmlvX3FlbXVfYWlvKGlvcmVxKTsKLSAgICAgICAgZ290
byBkb25lOwotICAgIH0KLSAgICBpZiAoaW9yZXEtPmFpb19pbmZsaWdodCA+IDApIHsKLSAgICAg
ICAgZ290byBkb25lOwotICAgIH0KLQotICAgIHN3aXRjaCAoaW9yZXEtPnJlcS5vcGVyYXRpb24p
IHsKLSAgICBjYXNlIEJMS0lGX09QX1JFQUQ6Ci0gICAgICAgIC8qIGluIGNhc2Ugb2YgZmFpbHVy
ZSBpb3JlcS0+YWlvX2Vycm9ycyBpcyBpbmNyZWFzZWQgKi8KLSAgICAgICAgaWYgKHJldCA9PSAw
KSB7Ci0gICAgICAgICAgICBpb3JlcV9ncmFudF9jb3B5KGlvcmVxKTsKLSAgICAgICAgfQotICAg
ICAgICBxZW11X3ZmcmVlKGlvcmVxLT5idWYpOwotICAgICAgICBicmVhazsKLSAgICBjYXNlIEJM
S0lGX09QX1dSSVRFOgotICAgIGNhc2UgQkxLSUZfT1BfRkxVU0hfRElTS0NBQ0hFOgotICAgICAg
ICBpZiAoIWlvcmVxLT5yZXEubnJfc2VnbWVudHMpIHsKLSAgICAgICAgICAgIGJyZWFrOwotICAg
ICAgICB9Ci0gICAgICAgIHFlbXVfdmZyZWUoaW9yZXEtPmJ1Zik7Ci0gICAgICAgIGJyZWFrOwot
ICAgIGRlZmF1bHQ6Ci0gICAgICAgIGJyZWFrOwotICAgIH0KLQotICAgIGlvcmVxLT5zdGF0dXMg
PSBpb3JlcS0+YWlvX2Vycm9ycyA/IEJMS0lGX1JTUF9FUlJPUiA6IEJMS0lGX1JTUF9PS0FZOwot
ICAgIGlvcmVxX2ZpbmlzaChpb3JlcSk7Ci0KLSAgICBzd2l0Y2ggKGlvcmVxLT5yZXEub3BlcmF0
aW9uKSB7Ci0gICAgY2FzZSBCTEtJRl9PUF9XUklURToKLSAgICBjYXNlIEJMS0lGX09QX0ZMVVNI
X0RJU0tDQUNIRToKLSAgICAgICAgaWYgKCFpb3JlcS0+cmVxLm5yX3NlZ21lbnRzKSB7Ci0gICAg
ICAgICAgICBicmVhazsKLSAgICAgICAgfQotICAgIGNhc2UgQkxLSUZfT1BfUkVBRDoKLSAgICAg
ICAgaWYgKGlvcmVxLT5zdGF0dXMgPT0gQkxLSUZfUlNQX09LQVkpIHsKLSAgICAgICAgICAgIGJs
b2NrX2FjY3RfZG9uZShibGtfZ2V0X3N0YXRzKGJsa2Rldi0+YmxrKSwgJmlvcmVxLT5hY2N0KTsK
LSAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgIGJsb2NrX2FjY3RfZmFpbGVkKGJsa19nZXRf
c3RhdHMoYmxrZGV2LT5ibGspLCAmaW9yZXEtPmFjY3QpOwotICAgICAgICB9Ci0gICAgICAgIGJy
ZWFrOwotICAgIGNhc2UgQkxLSUZfT1BfRElTQ0FSRDoKLSAgICBkZWZhdWx0OgotICAgICAgICBi
cmVhazsKLSAgICB9Ci0gICAgcWVtdV9iaF9zY2hlZHVsZShibGtkZXYtPmJoKTsKLQotZG9uZToK
LSAgICBhaW9fY29udGV4dF9yZWxlYXNlKGJsa2Rldi0+Y3R4KTsKLX0KLQotc3RhdGljIGJvb2wg
YmxrX3NwbGl0X2Rpc2NhcmQoc3RydWN0IGlvcmVxICppb3JlcSwgYmxraWZfc2VjdG9yX3Qgc2Vj
dG9yX251bWJlciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IG5yX3Nl
Y3RvcnMpCi17Ci0gICAgc3RydWN0IFhlbkJsa0RldiAqYmxrZGV2ID0gaW9yZXEtPmJsa2RldjsK
LSAgICBpbnQ2NF90IGJ5dGVfb2Zmc2V0OwotICAgIGludCBieXRlX2NodW5rOwotICAgIHVpbnQ2
NF90IGJ5dGVfcmVtYWluaW5nLCBsaW1pdDsKLSAgICB1aW50NjRfdCBzZWNfc3RhcnQgPSBzZWN0
b3JfbnVtYmVyOwotICAgIHVpbnQ2NF90IHNlY19jb3VudCA9IG5yX3NlY3RvcnM7Ci0KLSAgICAv
KiBXcmFwIGFyb3VuZCwgb3Igb3ZlcmZsb3dpbmcgYnl0ZSBsaW1pdD8gKi8KLSAgICBpZiAoc2Vj
X3N0YXJ0ICsgc2VjX2NvdW50IDwgc2VjX2NvdW50IHx8Ci0gICAgICAgIHNlY19zdGFydCArIHNl
Y19jb3VudCA+IElOVDY0X01BWCA+PiBCRFJWX1NFQ1RPUl9CSVRTKSB7Ci0gICAgICAgIHJldHVy
biBmYWxzZTsKLSAgICB9Ci0KLSAgICBsaW1pdCA9IEJEUlZfUkVRVUVTVF9NQVhfU0VDVE9SUyA8
PCBCRFJWX1NFQ1RPUl9CSVRTOwotICAgIGJ5dGVfb2Zmc2V0ID0gc2VjX3N0YXJ0IDw8IEJEUlZf
U0VDVE9SX0JJVFM7Ci0gICAgYnl0ZV9yZW1haW5pbmcgPSBzZWNfY291bnQgPDwgQkRSVl9TRUNU
T1JfQklUUzsKLQotICAgIGRvIHsKLSAgICAgICAgYnl0ZV9jaHVuayA9IGJ5dGVfcmVtYWluaW5n
ID4gbGltaXQgPyBsaW1pdCA6IGJ5dGVfcmVtYWluaW5nOwotICAgICAgICBpb3JlcS0+YWlvX2lu
ZmxpZ2h0Kys7Ci0gICAgICAgIGJsa19haW9fcGRpc2NhcmQoYmxrZGV2LT5ibGssIGJ5dGVfb2Zm
c2V0LCBieXRlX2NodW5rLAotICAgICAgICAgICAgICAgICAgICAgICAgIHFlbXVfYWlvX2NvbXBs
ZXRlLCBpb3JlcSk7Ci0gICAgICAgIGJ5dGVfcmVtYWluaW5nIC09IGJ5dGVfY2h1bms7Ci0gICAg
ICAgIGJ5dGVfb2Zmc2V0ICs9IGJ5dGVfY2h1bms7Ci0gICAgfSB3aGlsZSAoYnl0ZV9yZW1haW5p
bmcgPiAwKTsKLQotICAgIHJldHVybiB0cnVlOwotfQotCi1zdGF0aWMgaW50IGlvcmVxX3J1bmlv
X3FlbXVfYWlvKHN0cnVjdCBpb3JlcSAqaW9yZXEpCi17Ci0gICAgc3RydWN0IFhlbkJsa0RldiAq
YmxrZGV2ID0gaW9yZXEtPmJsa2RldjsKLQotICAgIGlvcmVxLT5idWYgPSBxZW11X21lbWFsaWdu
KFhDX1BBR0VfU0laRSwgaW9yZXEtPnNpemUpOwotICAgIGlmIChpb3JlcS0+cmVxLm5yX3NlZ21l
bnRzICYmCi0gICAgICAgIChpb3JlcS0+cmVxLm9wZXJhdGlvbiA9PSBCTEtJRl9PUF9XUklURSB8
fAotICAgICAgICAgaW9yZXEtPnJlcS5vcGVyYXRpb24gPT0gQkxLSUZfT1BfRkxVU0hfRElTS0NB
Q0hFKSAmJgotICAgICAgICBpb3JlcV9ncmFudF9jb3B5KGlvcmVxKSkgewotICAgICAgICBxZW11
X3ZmcmVlKGlvcmVxLT5idWYpOwotICAgICAgICBnb3RvIGVycjsKLSAgICB9Ci0KLSAgICBpb3Jl
cS0+YWlvX2luZmxpZ2h0Kys7Ci0gICAgaWYgKGlvcmVxLT5wcmVzeW5jKSB7Ci0gICAgICAgIGJs
a19haW9fZmx1c2goaW9yZXEtPmJsa2Rldi0+YmxrLCBxZW11X2Fpb19jb21wbGV0ZSwgaW9yZXEp
OwotICAgICAgICByZXR1cm4gMDsKLSAgICB9Ci0KLSAgICBzd2l0Y2ggKGlvcmVxLT5yZXEub3Bl
cmF0aW9uKSB7Ci0gICAgY2FzZSBCTEtJRl9PUF9SRUFEOgotICAgICAgICBxZW11X2lvdmVjX2Fk
ZCgmaW9yZXEtPnYsIGlvcmVxLT5idWYsIGlvcmVxLT5zaXplKTsKLSAgICAgICAgYmxvY2tfYWNj
dF9zdGFydChibGtfZ2V0X3N0YXRzKGJsa2Rldi0+YmxrKSwgJmlvcmVxLT5hY2N0LAotICAgICAg
ICAgICAgICAgICAgICAgICAgIGlvcmVxLT52LnNpemUsIEJMT0NLX0FDQ1RfUkVBRCk7Ci0gICAg
ICAgIGlvcmVxLT5haW9faW5mbGlnaHQrKzsKLSAgICAgICAgYmxrX2Fpb19wcmVhZHYoYmxrZGV2
LT5ibGssIGlvcmVxLT5zdGFydCwgJmlvcmVxLT52LCAwLAotICAgICAgICAgICAgICAgICAgICAg
ICBxZW11X2Fpb19jb21wbGV0ZSwgaW9yZXEpOwotICAgICAgICBicmVhazsKLSAgICBjYXNlIEJM
S0lGX09QX1dSSVRFOgotICAgIGNhc2UgQkxLSUZfT1BfRkxVU0hfRElTS0NBQ0hFOgotICAgICAg
ICBpZiAoIWlvcmVxLT5yZXEubnJfc2VnbWVudHMpIHsKLSAgICAgICAgICAgIGJyZWFrOwotICAg
ICAgICB9Ci0KLSAgICAgICAgcWVtdV9pb3ZlY19hZGQoJmlvcmVxLT52LCBpb3JlcS0+YnVmLCBp
b3JlcS0+c2l6ZSk7Ci0gICAgICAgIGJsb2NrX2FjY3Rfc3RhcnQoYmxrX2dldF9zdGF0cyhibGtk
ZXYtPmJsayksICZpb3JlcS0+YWNjdCwKLSAgICAgICAgICAgICAgICAgICAgICAgICBpb3JlcS0+
di5zaXplLAotICAgICAgICAgICAgICAgICAgICAgICAgIGlvcmVxLT5yZXEub3BlcmF0aW9uID09
IEJMS0lGX09QX1dSSVRFID8KLSAgICAgICAgICAgICAgICAgICAgICAgICBCTE9DS19BQ0NUX1dS
SVRFIDogQkxPQ0tfQUNDVF9GTFVTSCk7Ci0gICAgICAgIGlvcmVxLT5haW9faW5mbGlnaHQrKzsK
LSAgICAgICAgYmxrX2Fpb19wd3JpdGV2KGJsa2Rldi0+YmxrLCBpb3JlcS0+c3RhcnQsICZpb3Jl
cS0+diwgMCwKLSAgICAgICAgICAgICAgICAgICAgICAgIHFlbXVfYWlvX2NvbXBsZXRlLCBpb3Jl
cSk7Ci0gICAgICAgIGJyZWFrOwotICAgIGNhc2UgQkxLSUZfT1BfRElTQ0FSRDoKLSAgICB7Ci0g
ICAgICAgIHN0cnVjdCBibGtpZl9yZXF1ZXN0X2Rpc2NhcmQgKnJlcSA9ICh2b2lkICopJmlvcmVx
LT5yZXE7Ci0gICAgICAgIGlmICghYmxrX3NwbGl0X2Rpc2NhcmQoaW9yZXEsIHJlcS0+c2VjdG9y
X251bWJlciwgcmVxLT5ucl9zZWN0b3JzKSkgewotICAgICAgICAgICAgZ290byBlcnI7Ci0gICAg
ICAgIH0KLSAgICAgICAgYnJlYWs7Ci0gICAgfQotICAgIGRlZmF1bHQ6Ci0gICAgICAgIC8qIHVu
a25vd24gb3BlcmF0aW9uIChzaG91bGRuJ3QgaGFwcGVuIC0tIHBhcnNlIGNhdGNoZXMgdGhpcykg
Ki8KLSAgICAgICAgZ290byBlcnI7Ci0gICAgfQotCi0gICAgcWVtdV9haW9fY29tcGxldGUoaW9y
ZXEsIDApOwotCi0gICAgcmV0dXJuIDA7Ci0KLWVycjoKLSAgICBpb3JlcV9maW5pc2goaW9yZXEp
OwotICAgIGlvcmVxLT5zdGF0dXMgPSBCTEtJRl9SU1BfRVJST1I7Ci0gICAgcmV0dXJuIC0xOwot
fQotCi1zdGF0aWMgaW50IGJsa19zZW5kX3Jlc3BvbnNlX29uZShzdHJ1Y3QgaW9yZXEgKmlvcmVx
KQotewotICAgIHN0cnVjdCBYZW5CbGtEZXYgICpibGtkZXYgPSBpb3JlcS0+YmxrZGV2OwotICAg
IGludCAgICAgICAgICAgICAgIHNlbmRfbm90aWZ5ICAgPSAwOwotICAgIGludCAgICAgICAgICAg
ICAgIGhhdmVfcmVxdWVzdHMgPSAwOwotICAgIGJsa2lmX3Jlc3BvbnNlX3QgICpyZXNwOwotCi0g
ICAgLyogUGxhY2Ugb24gdGhlIHJlc3BvbnNlIHJpbmcgZm9yIHRoZSByZWxldmFudCBkb21haW4u
ICovCi0gICAgc3dpdGNoIChibGtkZXYtPnByb3RvY29sKSB7Ci0gICAgY2FzZSBCTEtJRl9QUk9U
T0NPTF9OQVRJVkU6Ci0gICAgICAgIHJlc3AgPSAoYmxraWZfcmVzcG9uc2VfdCAqKSBSSU5HX0dF
VF9SRVNQT05TRSgmYmxrZGV2LT5yaW5ncy5uYXRpdmUsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBibGtkZXYtPnJpbmdzLm5hdGl2ZS5yc3BfcHJvZF9wdnQpOwotICAgICAgICBi
cmVhazsKLSAgICBjYXNlIEJMS0lGX1BST1RPQ09MX1g4Nl8zMjoKLSAgICAgICAgcmVzcCA9IChi
bGtpZl9yZXNwb25zZV90ICopIFJJTkdfR0VUX1JFU1BPTlNFKCZibGtkZXYtPnJpbmdzLng4Nl8z
Ml9wYXJ0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxrZGV2LT5yaW5ncy54
ODZfMzJfcGFydC5yc3BfcHJvZF9wdnQpOwotICAgICAgICBicmVhazsKLSAgICBjYXNlIEJMS0lG
X1BST1RPQ09MX1g4Nl82NDoKLSAgICAgICAgcmVzcCA9IChibGtpZl9yZXNwb25zZV90ICopIFJJ
TkdfR0VUX1JFU1BPTlNFKCZibGtkZXYtPnJpbmdzLng4Nl82NF9wYXJ0LAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgYmxrZGV2LT5yaW5ncy54ODZfNjRfcGFydC5yc3BfcHJvZF9w
dnQpOwotICAgICAgICBicmVhazsKLSAgICBkZWZhdWx0OgotICAgICAgICByZXR1cm4gMDsKLSAg
ICB9Ci0KLSAgICByZXNwLT5pZCAgICAgICAgPSBpb3JlcS0+cmVxLmlkOwotICAgIHJlc3AtPm9w
ZXJhdGlvbiA9IGlvcmVxLT5yZXEub3BlcmF0aW9uOwotICAgIHJlc3AtPnN0YXR1cyAgICA9IGlv
cmVxLT5zdGF0dXM7Ci0KLSAgICBibGtkZXYtPnJpbmdzLmNvbW1vbi5yc3BfcHJvZF9wdnQrKzsK
LQotICAgIFJJTkdfUFVTSF9SRVNQT05TRVNfQU5EX0NIRUNLX05PVElGWSgmYmxrZGV2LT5yaW5n
cy5jb21tb24sIHNlbmRfbm90aWZ5KTsKLSAgICBpZiAoYmxrZGV2LT5yaW5ncy5jb21tb24ucnNw
X3Byb2RfcHZ0ID09IGJsa2Rldi0+cmluZ3MuY29tbW9uLnJlcV9jb25zKSB7Ci0gICAgICAgIC8q
Ci0gICAgICAgICAqIFRhaWwgY2hlY2sgZm9yIHBlbmRpbmcgcmVxdWVzdHMuIEFsbG93cyBmcm9u
dGVuZCB0byBhdm9pZAotICAgICAgICAgKiBub3RpZmljYXRpb25zIGlmIHJlcXVlc3RzIGFyZSBh
bHJlYWR5IGluIGZsaWdodCAobG93ZXIKLSAgICAgICAgICogb3ZlcmhlYWRzIGFuZCBwcm9tb3Rl
cyBiYXRjaGluZykuCi0gICAgICAgICAqLwotICAgICAgICBSSU5HX0ZJTkFMX0NIRUNLX0ZPUl9S
RVFVRVNUUygmYmxrZGV2LT5yaW5ncy5jb21tb24sIGhhdmVfcmVxdWVzdHMpOwotICAgIH0gZWxz
ZSBpZiAoUklOR19IQVNfVU5DT05TVU1FRF9SRVFVRVNUUygmYmxrZGV2LT5yaW5ncy5jb21tb24p
KSB7Ci0gICAgICAgIGhhdmVfcmVxdWVzdHMgPSAxOwotICAgIH0KLQotICAgIGlmIChoYXZlX3Jl
cXVlc3RzKSB7Ci0gICAgICAgIGJsa2Rldi0+bW9yZV93b3JrKys7Ci0gICAgfQotICAgIHJldHVy
biBzZW5kX25vdGlmeTsKLX0KLQotLyogd2FsayBmaW5pc2hlZCBsaXN0LCBzZW5kIG91dHN0YW5k
aW5nIHJlc3BvbnNlcywgZnJlZSByZXF1ZXN0cyAqLwotc3RhdGljIHZvaWQgYmxrX3NlbmRfcmVz
cG9uc2VfYWxsKHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldikKLXsKLSAgICBzdHJ1Y3QgaW9yZXEg
KmlvcmVxOwotICAgIGludCBzZW5kX25vdGlmeSA9IDA7Ci0KLSAgICB3aGlsZSAoIVFMSVNUX0VN
UFRZKCZibGtkZXYtPmZpbmlzaGVkKSkgewotICAgICAgICBpb3JlcSA9IFFMSVNUX0ZJUlNUKCZi
bGtkZXYtPmZpbmlzaGVkKTsKLSAgICAgICAgc2VuZF9ub3RpZnkgKz0gYmxrX3NlbmRfcmVzcG9u
c2Vfb25lKGlvcmVxKTsKLSAgICAgICAgaW9yZXFfcmVsZWFzZShpb3JlcSwgdHJ1ZSk7Ci0gICAg
fQotICAgIGlmIChzZW5kX25vdGlmeSkgewotICAgICAgICB4ZW5fcHZfc2VuZF9ub3RpZnkoJmJs
a2Rldi0+eGVuZGV2KTsKLSAgICB9Ci19Ci0KLXN0YXRpYyBpbnQgYmxrX2dldF9yZXF1ZXN0KHN0
cnVjdCBYZW5CbGtEZXYgKmJsa2Rldiwgc3RydWN0IGlvcmVxICppb3JlcSwgUklOR19JRFggcmMp
Ci17Ci0gICAgc3dpdGNoIChibGtkZXYtPnByb3RvY29sKSB7Ci0gICAgY2FzZSBCTEtJRl9QUk9U
T0NPTF9OQVRJVkU6Ci0gICAgICAgIG1lbWNweSgmaW9yZXEtPnJlcSwgUklOR19HRVRfUkVRVUVT
VCgmYmxrZGV2LT5yaW5ncy5uYXRpdmUsIHJjKSwKLSAgICAgICAgICAgICAgIHNpemVvZihpb3Jl
cS0+cmVxKSk7Ci0gICAgICAgIGJyZWFrOwotICAgIGNhc2UgQkxLSUZfUFJPVE9DT0xfWDg2XzMy
OgotICAgICAgICBibGtpZl9nZXRfeDg2XzMyX3JlcSgmaW9yZXEtPnJlcSwKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgUklOR19HRVRfUkVRVUVTVCgmYmxrZGV2LT5yaW5ncy54ODZfMzJf
cGFydCwgcmMpKTsKLSAgICAgICAgYnJlYWs7Ci0gICAgY2FzZSBCTEtJRl9QUk9UT0NPTF9YODZf
NjQ6Ci0gICAgICAgIGJsa2lmX2dldF94ODZfNjRfcmVxKCZpb3JlcS0+cmVxLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBSSU5HX0dFVF9SRVFVRVNUKCZibGtkZXYtPnJpbmdzLng4Nl82
NF9wYXJ0LCByYykpOwotICAgICAgICBicmVhazsKLSAgICB9Ci0gICAgLyogUHJldmVudCB0aGUg
Y29tcGlsZXIgZnJvbSBhY2Nlc3NpbmcgdGhlIG9uLXJpbmcgZmllbGRzIGluc3RlYWQuICovCi0g
ICAgYmFycmllcigpOwotICAgIHJldHVybiAwOwotfQotCi1zdGF0aWMgdm9pZCBibGtfaGFuZGxl
X3JlcXVlc3RzKHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldikKLXsKLSAgICBSSU5HX0lEWCByYywg
cnA7Ci0gICAgc3RydWN0IGlvcmVxICppb3JlcTsKLQotICAgIGJsa2Rldi0+bW9yZV93b3JrID0g
MDsKLQotICAgIHJjID0gYmxrZGV2LT5yaW5ncy5jb21tb24ucmVxX2NvbnM7Ci0gICAgcnAgPSBi
bGtkZXYtPnJpbmdzLmNvbW1vbi5zcmluZy0+cmVxX3Byb2Q7Ci0gICAgeGVuX3JtYigpOyAvKiBF
bnN1cmUgd2Ugc2VlIHF1ZXVlZCByZXF1ZXN0cyB1cCB0byAncnAnLiAqLwotCi0gICAgYmxrX3Nl
bmRfcmVzcG9uc2VfYWxsKGJsa2Rldik7Ci0gICAgd2hpbGUgKHJjICE9IHJwKSB7Ci0gICAgICAg
IC8qIHB1bGwgcmVxdWVzdCBmcm9tIHJpbmcgKi8KLSAgICAgICAgaWYgKFJJTkdfUkVRVUVTVF9D
T05TX09WRVJGTE9XKCZibGtkZXYtPnJpbmdzLmNvbW1vbiwgcmMpKSB7Ci0gICAgICAgICAgICBi
cmVhazsKLSAgICAgICAgfQotICAgICAgICBpb3JlcSA9IGlvcmVxX3N0YXJ0KGJsa2Rldik7Ci0g
ICAgICAgIGlmIChpb3JlcSA9PSBOVUxMKSB7Ci0gICAgICAgICAgICBibGtkZXYtPm1vcmVfd29y
aysrOwotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgIH0KLSAgICAgICAgYmxrX2dldF9yZXF1
ZXN0KGJsa2RldiwgaW9yZXEsIHJjKTsKLSAgICAgICAgYmxrZGV2LT5yaW5ncy5jb21tb24ucmVx
X2NvbnMgPSArK3JjOwotCi0gICAgICAgIC8qIHBhcnNlIHRoZW0gKi8KLSAgICAgICAgaWYgKGlv
cmVxX3BhcnNlKGlvcmVxKSAhPSAwKSB7Ci0KLSAgICAgICAgICAgIHN3aXRjaCAoaW9yZXEtPnJl
cS5vcGVyYXRpb24pIHsKLSAgICAgICAgICAgIGNhc2UgQkxLSUZfT1BfUkVBRDoKLSAgICAgICAg
ICAgICAgICBibG9ja19hY2N0X2ludmFsaWQoYmxrX2dldF9zdGF0cyhibGtkZXYtPmJsayksCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJMT0NLX0FDQ1RfUkVBRCk7Ci0gICAg
ICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICBjYXNlIEJMS0lGX09QX1dSSVRFOgotICAg
ICAgICAgICAgICAgIGJsb2NrX2FjY3RfaW52YWxpZChibGtfZ2V0X3N0YXRzKGJsa2Rldi0+Ymxr
KSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQkxPQ0tfQUNDVF9XUklURSk7
Ci0gICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICBjYXNlIEJMS0lGX09QX0ZMVVNI
X0RJU0tDQUNIRToKLSAgICAgICAgICAgICAgICBibG9ja19hY2N0X2ludmFsaWQoYmxrX2dldF9z
dGF0cyhibGtkZXYtPmJsayksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJM
T0NLX0FDQ1RfRkxVU0gpOwotICAgICAgICAgICAgZGVmYXVsdDoKLSAgICAgICAgICAgICAgICBi
cmVhazsKLSAgICAgICAgICAgIH07Ci0KLSAgICAgICAgICAgIGlmIChibGtfc2VuZF9yZXNwb25z
ZV9vbmUoaW9yZXEpKSB7Ci0gICAgICAgICAgICAgICAgeGVuX3B2X3NlbmRfbm90aWZ5KCZibGtk
ZXYtPnhlbmRldik7Ci0gICAgICAgICAgICB9Ci0gICAgICAgICAgICBpb3JlcV9yZWxlYXNlKGlv
cmVxLCBmYWxzZSk7Ci0gICAgICAgICAgICBjb250aW51ZTsKLSAgICAgICAgfQotCi0gICAgICAg
IGlvcmVxX3J1bmlvX3FlbXVfYWlvKGlvcmVxKTsKLSAgICB9Ci0KLSAgICBpZiAoYmxrZGV2LT5t
b3JlX3dvcmsgJiYgYmxrZGV2LT5yZXF1ZXN0c19pbmZsaWdodCA8IGJsa2Rldi0+bWF4X3JlcXVl
c3RzKSB7Ci0gICAgICAgIHFlbXVfYmhfc2NoZWR1bGUoYmxrZGV2LT5iaCk7Ci0gICAgfQotfQot
Ci0vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tICovCi0KLXN0YXRpYyB2b2lkIGJsa19iaCh2b2lkICpvcGFxdWUpCi17Ci0gICAg
c3RydWN0IFhlbkJsa0RldiAqYmxrZGV2ID0gb3BhcXVlOwotCi0gICAgYWlvX2NvbnRleHRfYWNx
dWlyZShibGtkZXYtPmN0eCk7Ci0gICAgYmxrX2hhbmRsZV9yZXF1ZXN0cyhibGtkZXYpOwotICAg
IGFpb19jb250ZXh0X3JlbGVhc2UoYmxrZGV2LT5jdHgpOwotfQotCi1zdGF0aWMgdm9pZCBibGtf
YWxsb2Moc3RydWN0IFhlbkxlZ2FjeURldmljZSAqeGVuZGV2KQotewotICAgIHN0cnVjdCBYZW5C
bGtEZXYgKmJsa2RldiA9IGNvbnRhaW5lcl9vZih4ZW5kZXYsIHN0cnVjdCBYZW5CbGtEZXYsIHhl
bmRldik7Ci0gICAgRXJyb3IgKmVyciA9IE5VTEw7Ci0KLSAgICB0cmFjZV94ZW5fZGlza19hbGxv
Yyh4ZW5kZXYtPm5hbWUpOwotCi0gICAgUUxJU1RfSU5JVCgmYmxrZGV2LT5pbmZsaWdodCk7Ci0g
ICAgUUxJU1RfSU5JVCgmYmxrZGV2LT5maW5pc2hlZCk7Ci0gICAgUUxJU1RfSU5JVCgmYmxrZGV2
LT5mcmVlbGlzdCk7Ci0KLSAgICBibGtkZXYtPmlvdGhyZWFkID0gaW90aHJlYWRfY3JlYXRlKHhl
bmRldi0+bmFtZSwgJmVycik7Ci0gICAgYXNzZXJ0KCFlcnIpOwotCi0gICAgYmxrZGV2LT5jdHgg
PSBpb3RocmVhZF9nZXRfYWlvX2NvbnRleHQoYmxrZGV2LT5pb3RocmVhZCk7Ci0gICAgYmxrZGV2
LT5iaCA9IGFpb19iaF9uZXcoYmxrZGV2LT5jdHgsIGJsa19iaCwgYmxrZGV2KTsKLX0KLQotc3Rh
dGljIHZvaWQgYmxrX3BhcnNlX2Rpc2NhcmQoc3RydWN0IFhlbkJsa0RldiAqYmxrZGV2KQotewot
ICAgIHN0cnVjdCBYZW5MZWdhY3lEZXZpY2UgKnhlbmRldiA9ICZibGtkZXYtPnhlbmRldjsKLSAg
ICBpbnQgZW5hYmxlOwotCi0gICAgYmxrZGV2LT5mZWF0dXJlX2Rpc2NhcmQgPSB0cnVlOwotCi0g
ICAgaWYgKHhlbnN0b3JlX3JlYWRfYmVfaW50KHhlbmRldiwgImRpc2NhcmQtZW5hYmxlIiwgJmVu
YWJsZSkgPT0gMCkgewotICAgICAgICBibGtkZXYtPmZlYXR1cmVfZGlzY2FyZCA9ICEhZW5hYmxl
OwotICAgIH0KLQotICAgIGlmIChibGtkZXYtPmZlYXR1cmVfZGlzY2FyZCkgewotICAgICAgICB4
ZW5zdG9yZV93cml0ZV9iZV9pbnQoeGVuZGV2LCAiZmVhdHVyZS1kaXNjYXJkIiwgMSk7Ci0gICAg
fQotfQotCi1zdGF0aWMgaW50IGJsa19pbml0KHN0cnVjdCBYZW5MZWdhY3lEZXZpY2UgKnhlbmRl
dikKLXsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpibGtkZXYgPSBjb250YWluZXJfb2YoeGVuZGV2
LCBzdHJ1Y3QgWGVuQmxrRGV2LCB4ZW5kZXYpOwotICAgIGludCBpbmZvID0gMDsKLSAgICBjaGFy
ICpkaXJlY3Rpb3NhZmUgPSBOVUxMOwotCi0gICAgdHJhY2VfeGVuX2Rpc2tfaW5pdCh4ZW5kZXYt
Pm5hbWUpOwotCi0gICAgLyogcmVhZCB4ZW5zdG9yZSBlbnRyaWVzICovCi0gICAgaWYgKGJsa2Rl
di0+cGFyYW1zID09IE5VTEwpIHsKLSAgICAgICAgY2hhciAqaCA9IE5VTEw7Ci0gICAgICAgIGJs
a2Rldi0+cGFyYW1zID0geGVuc3RvcmVfcmVhZF9iZV9zdHIoeGVuZGV2LCAicGFyYW1zIik7Ci0g
ICAgICAgIGlmIChibGtkZXYtPnBhcmFtcyAhPSBOVUxMKSB7Ci0gICAgICAgICAgICBoID0gc3Ry
Y2hyKGJsa2Rldi0+cGFyYW1zLCAnOicpOwotICAgICAgICB9Ci0gICAgICAgIGlmIChoICE9IE5V
TEwpIHsKLSAgICAgICAgICAgIGJsa2Rldi0+ZmlsZXByb3RvID0gYmxrZGV2LT5wYXJhbXM7Ci0g
ICAgICAgICAgICBibGtkZXYtPmZpbGVuYW1lICA9IGgrMTsKLSAgICAgICAgICAgICpoID0gMDsK
LSAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgIGJsa2Rldi0+ZmlsZXByb3RvID0gIjx1bnNl
dD4iOwotICAgICAgICAgICAgYmxrZGV2LT5maWxlbmFtZSAgPSBibGtkZXYtPnBhcmFtczsKLSAg
ICAgICAgfQotICAgIH0KLSAgICBpZiAoIXN0cmNtcCgiYWlvIiwgYmxrZGV2LT5maWxlcHJvdG8p
KSB7Ci0gICAgICAgIGJsa2Rldi0+ZmlsZXByb3RvID0gInJhdyI7Ci0gICAgfQotICAgIGlmICgh
c3RyY21wKCJ2aGQiLCBibGtkZXYtPmZpbGVwcm90bykpIHsKLSAgICAgICAgYmxrZGV2LT5maWxl
cHJvdG8gPSAidnBjIjsKLSAgICB9Ci0gICAgaWYgKGJsa2Rldi0+bW9kZSA9PSBOVUxMKSB7Ci0g
ICAgICAgIGJsa2Rldi0+bW9kZSA9IHhlbnN0b3JlX3JlYWRfYmVfc3RyKHhlbmRldiwgIm1vZGUi
KTsKLSAgICB9Ci0gICAgaWYgKGJsa2Rldi0+dHlwZSA9PSBOVUxMKSB7Ci0gICAgICAgIGJsa2Rl
di0+dHlwZSA9IHhlbnN0b3JlX3JlYWRfYmVfc3RyKHhlbmRldiwgInR5cGUiKTsKLSAgICB9Ci0g
ICAgaWYgKGJsa2Rldi0+ZGV2ID09IE5VTEwpIHsKLSAgICAgICAgYmxrZGV2LT5kZXYgPSB4ZW5z
dG9yZV9yZWFkX2JlX3N0cih4ZW5kZXYsICJkZXYiKTsKLSAgICB9Ci0gICAgaWYgKGJsa2Rldi0+
ZGV2dHlwZSA9PSBOVUxMKSB7Ci0gICAgICAgIGJsa2Rldi0+ZGV2dHlwZSA9IHhlbnN0b3JlX3Jl
YWRfYmVfc3RyKHhlbmRldiwgImRldmljZS10eXBlIik7Ci0gICAgfQotICAgIGRpcmVjdGlvc2Fm
ZSA9IHhlbnN0b3JlX3JlYWRfYmVfc3RyKHhlbmRldiwgImRpcmVjdC1pby1zYWZlIik7Ci0gICAg
YmxrZGV2LT5kaXJlY3Rpb3NhZmUgPSAoZGlyZWN0aW9zYWZlICYmIGF0b2koZGlyZWN0aW9zYWZl
KSk7Ci0KLSAgICAvKiBkbyB3ZSBoYXZlIGFsbCB3ZSBuZWVkPyAqLwotICAgIGlmIChibGtkZXYt
PnBhcmFtcyA9PSBOVUxMIHx8Ci0gICAgICAgIGJsa2Rldi0+bW9kZSA9PSBOVUxMICAgfHwKLSAg
ICAgICAgYmxrZGV2LT50eXBlID09IE5VTEwgICB8fAotICAgICAgICBibGtkZXYtPmRldiA9PSBO
VUxMKSB7Ci0gICAgICAgIGdvdG8gb3V0X2Vycm9yOwotICAgIH0KLQotICAgIC8qIHJlYWQtb25s
eSA/ICovCi0gICAgaWYgKHN0cmNtcChibGtkZXYtPm1vZGUsICJ3IikpIHsKLSAgICAgICAgaW5m
byAgfD0gVkRJU0tfUkVBRE9OTFk7Ci0gICAgfQotCi0gICAgLyogY2Ryb20gPyAqLwotICAgIGlm
IChibGtkZXYtPmRldnR5cGUgJiYgIXN0cmNtcChibGtkZXYtPmRldnR5cGUsICJjZHJvbSIpKSB7
Ci0gICAgICAgIGluZm8gIHw9IFZESVNLX0NEUk9NOwotICAgIH0KLQotICAgIGJsa2Rldi0+Zmls
ZV9ibGsgID0gQkxPQ0tfU0laRTsKLQotICAgIC8qIGZpbGwgaW5mbwotICAgICAqIGJsa19jb25u
ZWN0IHN1cHBsaWVzIHNlY3Rvci1zaXplIGFuZCBzZWN0b3JzCi0gICAgICovCi0gICAgeGVuc3Rv
cmVfd3JpdGVfYmVfaW50KHhlbmRldiwgImZlYXR1cmUtZmx1c2gtY2FjaGUiLCAxKTsKLSAgICB4
ZW5zdG9yZV93cml0ZV9iZV9pbnQoeGVuZGV2LCAiaW5mbyIsIGluZm8pOwotCi0gICAgeGVuc3Rv
cmVfd3JpdGVfYmVfaW50KHhlbmRldiwgIm1heC1yaW5nLXBhZ2Utb3JkZXIiLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICBNQVhfUklOR19QQUdFX09SREVSKTsKLQotICAgIGJsa19wYXJzZV9k
aXNjYXJkKGJsa2Rldik7Ci0KLSAgICBnX2ZyZWUoZGlyZWN0aW9zYWZlKTsKLSAgICByZXR1cm4g
MDsKLQotb3V0X2Vycm9yOgotICAgIGdfZnJlZShibGtkZXYtPnBhcmFtcyk7Ci0gICAgYmxrZGV2
LT5wYXJhbXMgPSBOVUxMOwotICAgIGdfZnJlZShibGtkZXYtPm1vZGUpOwotICAgIGJsa2Rldi0+
bW9kZSA9IE5VTEw7Ci0gICAgZ19mcmVlKGJsa2Rldi0+dHlwZSk7Ci0gICAgYmxrZGV2LT50eXBl
ID0gTlVMTDsKLSAgICBnX2ZyZWUoYmxrZGV2LT5kZXYpOwotICAgIGJsa2Rldi0+ZGV2ID0gTlVM
TDsKLSAgICBnX2ZyZWUoYmxrZGV2LT5kZXZ0eXBlKTsKLSAgICBibGtkZXYtPmRldnR5cGUgPSBO
VUxMOwotICAgIGdfZnJlZShkaXJlY3Rpb3NhZmUpOwotICAgIGJsa2Rldi0+ZGlyZWN0aW9zYWZl
ID0gZmFsc2U7Ci0gICAgcmV0dXJuIC0xOwotfQotCi1zdGF0aWMgaW50IGJsa19jb25uZWN0KHN0
cnVjdCBYZW5MZWdhY3lEZXZpY2UgKnhlbmRldikKLXsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpi
bGtkZXYgPSBjb250YWluZXJfb2YoeGVuZGV2LCBzdHJ1Y3QgWGVuQmxrRGV2LCB4ZW5kZXYpOwot
ICAgIGludCBpbmRleCwgcWZsYWdzOwotICAgIGJvb2wgcmVhZG9ubHkgPSB0cnVlOwotICAgIGJv
b2wgd3JpdGV0aHJvdWdoID0gdHJ1ZTsKLSAgICBpbnQgb3JkZXIsIHJpbmdfcmVmOwotICAgIHVu
c2lnbmVkIGludCByaW5nX3NpemUsIG1heF9ncmFudHM7Ci0gICAgdW5zaWduZWQgaW50IGk7Ci0K
LSAgICB0cmFjZV94ZW5fZGlza19jb25uZWN0KHhlbmRldi0+bmFtZSk7Ci0KLSAgICAvKiByZWFk
LW9ubHkgPyAqLwotICAgIGlmIChibGtkZXYtPmRpcmVjdGlvc2FmZSkgewotICAgICAgICBxZmxh
Z3MgPSBCRFJWX09fTk9DQUNIRSB8IEJEUlZfT19OQVRJVkVfQUlPOwotICAgIH0gZWxzZSB7Ci0g
ICAgICAgIHFmbGFncyA9IDA7Ci0gICAgICAgIHdyaXRldGhyb3VnaCA9IGZhbHNlOwotICAgIH0K
LSAgICBpZiAoc3RyY21wKGJsa2Rldi0+bW9kZSwgInciKSA9PSAwKSB7Ci0gICAgICAgIHFmbGFn
cyB8PSBCRFJWX09fUkRXUjsKLSAgICAgICAgcmVhZG9ubHkgPSBmYWxzZTsKLSAgICB9Ci0gICAg
aWYgKGJsa2Rldi0+ZmVhdHVyZV9kaXNjYXJkKSB7Ci0gICAgICAgIHFmbGFncyB8PSBCRFJWX09f
VU5NQVA7Ci0gICAgfQotCi0gICAgLyogaW5pdCBxZW11IGJsb2NrIGRyaXZlciAqLwotICAgIGlu
ZGV4ID0gKHhlbmRldi0+ZGV2IC0gMjAyICogMjU2KSAvIDE2OwotICAgIGJsa2Rldi0+ZGluZm8g
PSBkcml2ZV9nZXQoSUZfWEVOLCAwLCBpbmRleCk7Ci0gICAgaWYgKCFibGtkZXYtPmRpbmZvKSB7
Ci0gICAgICAgIEVycm9yICpsb2NhbF9lcnIgPSBOVUxMOwotICAgICAgICBRRGljdCAqb3B0aW9u
cyA9IE5VTEw7Ci0KLSAgICAgICAgaWYgKHN0cmNtcChibGtkZXYtPmZpbGVwcm90bywgIjx1bnNl
dD4iKSkgewotICAgICAgICAgICAgb3B0aW9ucyA9IHFkaWN0X25ldygpOwotICAgICAgICAgICAg
cWRpY3RfcHV0X3N0cihvcHRpb25zLCAiZHJpdmVyIiwgYmxrZGV2LT5maWxlcHJvdG8pOwotICAg
ICAgICB9Ci0KLSAgICAgICAgLyogc2V0dXAgdmlhIHhlbmJ1cyAtPiBjcmVhdGUgbmV3IGJsb2Nr
IGRyaXZlciBpbnN0YW5jZSAqLwotICAgICAgICB4ZW5fcHZfcHJpbnRmKHhlbmRldiwgMiwgImNy
ZWF0ZSBuZXcgYmRydiAoeGVuYnVzIHNldHVwKVxuIik7Ci0gICAgICAgIGJsa2Rldi0+YmxrID0g
YmxrX25ld19vcGVuKGJsa2Rldi0+ZmlsZW5hbWUsIE5VTEwsIG9wdGlvbnMsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHFmbGFncywgJmxvY2FsX2Vycik7Ci0gICAgICAgIGlm
ICghYmxrZGV2LT5ibGspIHsKLSAgICAgICAgICAgIHhlbl9wdl9wcmludGYoeGVuZGV2LCAwLCAi
ZXJyb3I6ICVzXG4iLAotICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9nZXRfcHJldHR5
KGxvY2FsX2VycikpOwotICAgICAgICAgICAgZXJyb3JfZnJlZShsb2NhbF9lcnIpOwotICAgICAg
ICAgICAgcmV0dXJuIC0xOwotICAgICAgICB9Ci0gICAgICAgIGJsa19zZXRfZW5hYmxlX3dyaXRl
X2NhY2hlKGJsa2Rldi0+YmxrLCAhd3JpdGV0aHJvdWdoKTsKLSAgICB9IGVsc2UgewotICAgICAg
ICAvKiBzZXR1cCB2aWEgcWVtdSBjbWRsaW5lIC0+IGFscmVhZHkgc2V0dXAgZm9yIHVzICovCi0g
ICAgICAgIHhlbl9wdl9wcmludGYoeGVuZGV2LCAyLAotICAgICAgICAgICAgICAgICAgICAgICJn
ZXQgY29uZmlndXJlZCBiZHJ2IChjbWRsaW5lIHNldHVwKVxuIik7Ci0gICAgICAgIGJsa2Rldi0+
YmxrID0gYmxrX2J5X2xlZ2FjeV9kaW5mbyhibGtkZXYtPmRpbmZvKTsKLSAgICAgICAgaWYgKGJs
a19pc19yZWFkX29ubHkoYmxrZGV2LT5ibGspICYmICFyZWFkb25seSkgewotICAgICAgICAgICAg
eGVuX3B2X3ByaW50Zih4ZW5kZXYsIDAsICJVbmV4cGVjdGVkIHJlYWQtb25seSBkcml2ZSIpOwot
ICAgICAgICAgICAgYmxrZGV2LT5ibGsgPSBOVUxMOwotICAgICAgICAgICAgcmV0dXJuIC0xOwot
ICAgICAgICB9Ci0gICAgICAgIC8qIGJsa2Rldi0+YmxrIGlzIG5vdCBjcmVhdGUgYnkgdXMsIHdl
IGdldCBhIHJlZmVyZW5jZQotICAgICAgICAgKiBzbyB3ZSBjYW4gYmxrX3VucmVmKCkgdW5jb25k
aXRpb25hbGx5ICovCi0gICAgICAgIGJsa19yZWYoYmxrZGV2LT5ibGspOwotICAgIH0KLSAgICBi
bGtfYXR0YWNoX2Rldl9sZWdhY3koYmxrZGV2LT5ibGssIGJsa2Rldik7Ci0gICAgYmxrZGV2LT5m
aWxlX3NpemUgPSBibGtfZ2V0bGVuZ3RoKGJsa2Rldi0+YmxrKTsKLSAgICBpZiAoYmxrZGV2LT5m
aWxlX3NpemUgPCAwKSB7Ci0gICAgICAgIEJsb2NrRHJpdmVyU3RhdGUgKmJzID0gYmxrX2JzKGJs
a2Rldi0+YmxrKTsKLSAgICAgICAgY29uc3QgY2hhciAqZHJ2X25hbWUgPSBicyA/IGJkcnZfZ2V0
X2Zvcm1hdF9uYW1lKGJzKSA6IE5VTEw7Ci0gICAgICAgIHhlbl9wdl9wcmludGYoeGVuZGV2LCAx
LCAiYmxrX2dldGxlbmd0aDogJWQgKCVzKSB8IGRydiAlc1xuIiwKLSAgICAgICAgICAgICAgICAg
ICAgICAoaW50KWJsa2Rldi0+ZmlsZV9zaXplLCBzdHJlcnJvcigtYmxrZGV2LT5maWxlX3NpemUp
LAotICAgICAgICAgICAgICAgICAgICAgIGRydl9uYW1lID86ICItIik7Ci0gICAgICAgIGJsa2Rl
di0+ZmlsZV9zaXplID0gMDsKLSAgICB9Ci0KLSAgICB4ZW5fcHZfcHJpbnRmKHhlbmRldiwgMSwg
InR5cGUgXCIlc1wiLCBmaWxlcHJvdG8gXCIlc1wiLCBmaWxlbmFtZSBcIiVzXCIsIgotICAgICAg
ICAgICAgICAgICAgIiBzaXplICUiIFBSSWQ2NCAiICglIiBQUklkNjQgIiBNQilcbiIsCi0gICAg
ICAgICAgICAgICAgICBibGtkZXYtPnR5cGUsIGJsa2Rldi0+ZmlsZXByb3RvLCBibGtkZXYtPmZp
bGVuYW1lLAotICAgICAgICAgICAgICAgICAgYmxrZGV2LT5maWxlX3NpemUsIGJsa2Rldi0+Zmls
ZV9zaXplIC8gTWlCKTsKLQotICAgIC8qIEZpbGwgaW4gbnVtYmVyIG9mIHNlY3RvciBzaXplIGFu
ZCBudW1iZXIgb2Ygc2VjdG9ycyAqLwotICAgIHhlbnN0b3JlX3dyaXRlX2JlX2ludCh4ZW5kZXYs
ICJzZWN0b3Itc2l6ZSIsIGJsa2Rldi0+ZmlsZV9ibGspOwotICAgIHhlbnN0b3JlX3dyaXRlX2Jl
X2ludDY0KHhlbmRldiwgInNlY3RvcnMiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJs
a2Rldi0+ZmlsZV9zaXplIC8gYmxrZGV2LT5maWxlX2Jsayk7Ci0KLSAgICBpZiAoeGVuc3RvcmVf
cmVhZF9mZV9pbnQoeGVuZGV2LCAicmluZy1wYWdlLW9yZGVyIiwKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgJm9yZGVyKSA9PSAtMSkgewotICAgICAgICBibGtkZXYtPm5yX3JpbmdfcmVm
ID0gMTsKLQotICAgICAgICBpZiAoeGVuc3RvcmVfcmVhZF9mZV9pbnQoeGVuZGV2LCAicmluZy1y
ZWYiLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnJpbmdfcmVmKSA9PSAtMSkg
ewotICAgICAgICAgICAgcmV0dXJuIC0xOwotICAgICAgICB9Ci0gICAgICAgIGJsa2Rldi0+cmlu
Z19yZWZbMF0gPSByaW5nX3JlZjsKLQotICAgIH0gZWxzZSBpZiAob3JkZXIgPj0gMCAmJiBvcmRl
ciA8PSBNQVhfUklOR19QQUdFX09SREVSKSB7Ci0gICAgICAgIGJsa2Rldi0+bnJfcmluZ19yZWYg
PSAxIDw8IG9yZGVyOwotCi0gICAgICAgIGZvciAoaSA9IDA7IGkgPCBibGtkZXYtPm5yX3Jpbmdf
cmVmOyBpKyspIHsKLSAgICAgICAgICAgIGNoYXIgKmtleTsKLQotICAgICAgICAgICAga2V5ID0g
Z19zdHJkdXBfcHJpbnRmKCJyaW5nLXJlZiV1IiwgaSk7Ci0gICAgICAgICAgICBpZiAoIWtleSkg
ewotICAgICAgICAgICAgICAgIHJldHVybiAtMTsKLSAgICAgICAgICAgIH0KLQotICAgICAgICAg
ICAgaWYgKHhlbnN0b3JlX3JlYWRfZmVfaW50KHhlbmRldiwga2V5LAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICZyaW5nX3JlZikgPT0gLTEpIHsKLSAgICAgICAgICAgICAg
ICBnX2ZyZWUoa2V5KTsKLSAgICAgICAgICAgICAgICByZXR1cm4gLTE7Ci0gICAgICAgICAgICB9
Ci0gICAgICAgICAgICBibGtkZXYtPnJpbmdfcmVmW2ldID0gcmluZ19yZWY7Ci0KLSAgICAgICAg
ICAgIGdfZnJlZShrZXkpOwotICAgICAgICB9Ci0gICAgfSBlbHNlIHsKLSAgICAgICAgeGVuX3B2
X3ByaW50Zih4ZW5kZXYsIDAsICJpbnZhbGlkIHJpbmctcGFnZS1vcmRlcjogJWRcbiIsCi0gICAg
ICAgICAgICAgICAgICAgICAgb3JkZXIpOwotICAgICAgICByZXR1cm4gLTE7Ci0gICAgfQotCi0g
ICAgaWYgKHhlbnN0b3JlX3JlYWRfZmVfaW50KHhlbmRldiwgImV2ZW50LWNoYW5uZWwiLAotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAmeGVuZGV2LT5yZW1vdGVfcG9ydCkgPT0gLTEpIHsK
LSAgICAgICAgcmV0dXJuIC0xOwotICAgIH0KLQotICAgIGlmICgheGVuZGV2LT5wcm90b2NvbCkg
ewotICAgICAgICBibGtkZXYtPnByb3RvY29sID0gQkxLSUZfUFJPVE9DT0xfTkFUSVZFOwotICAg
IH0gZWxzZSBpZiAoc3RyY21wKHhlbmRldi0+cHJvdG9jb2wsIFhFTl9JT19QUk9UT19BQklfTkFU
SVZFKSA9PSAwKSB7Ci0gICAgICAgIGJsa2Rldi0+cHJvdG9jb2wgPSBCTEtJRl9QUk9UT0NPTF9O
QVRJVkU7Ci0gICAgfSBlbHNlIGlmIChzdHJjbXAoeGVuZGV2LT5wcm90b2NvbCwgWEVOX0lPX1BS
T1RPX0FCSV9YODZfMzIpID09IDApIHsKLSAgICAgICAgYmxrZGV2LT5wcm90b2NvbCA9IEJMS0lG
X1BST1RPQ09MX1g4Nl8zMjsKLSAgICB9IGVsc2UgaWYgKHN0cmNtcCh4ZW5kZXYtPnByb3RvY29s
LCBYRU5fSU9fUFJPVE9fQUJJX1g4Nl82NCkgPT0gMCkgewotICAgICAgICBibGtkZXYtPnByb3Rv
Y29sID0gQkxLSUZfUFJPVE9DT0xfWDg2XzY0OwotICAgIH0gZWxzZSB7Ci0gICAgICAgIGJsa2Rl
di0+cHJvdG9jb2wgPSBCTEtJRl9QUk9UT0NPTF9OQVRJVkU7Ci0gICAgfQotCi0gICAgcmluZ19z
aXplID0gWENfUEFHRV9TSVpFICogYmxrZGV2LT5ucl9yaW5nX3JlZjsKLSAgICBzd2l0Y2ggKGJs
a2Rldi0+cHJvdG9jb2wpIHsKLSAgICBjYXNlIEJMS0lGX1BST1RPQ09MX05BVElWRToKLSAgICB7
Ci0gICAgICAgIGJsa2Rldi0+bWF4X3JlcXVlc3RzID0gX19DT05TVF9SSU5HX1NJWkUoYmxraWYs
IHJpbmdfc2l6ZSk7Ci0gICAgICAgIGJyZWFrOwotICAgIH0KLSAgICBjYXNlIEJMS0lGX1BST1RP
Q09MX1g4Nl8zMjoKLSAgICB7Ci0gICAgICAgIGJsa2Rldi0+bWF4X3JlcXVlc3RzID0gX19DT05T
VF9SSU5HX1NJWkUoYmxraWZfeDg2XzMyLCByaW5nX3NpemUpOwotICAgICAgICBicmVhazsKLSAg
ICB9Ci0gICAgY2FzZSBCTEtJRl9QUk9UT0NPTF9YODZfNjQ6Ci0gICAgewotICAgICAgICBibGtk
ZXYtPm1heF9yZXF1ZXN0cyA9IF9fQ09OU1RfUklOR19TSVpFKGJsa2lmX3g4Nl82NCwgcmluZ19z
aXplKTsKLSAgICAgICAgYnJlYWs7Ci0gICAgfQotICAgIGRlZmF1bHQ6Ci0gICAgICAgIHJldHVy
biAtMTsKLSAgICB9Ci0KLSAgICAvKiBBZGQgb24gdGhlIG51bWJlciBuZWVkZWQgZm9yIHRoZSBy
aW5nIHBhZ2VzICovCi0gICAgbWF4X2dyYW50cyA9IGJsa2Rldi0+bnJfcmluZ19yZWY7Ci0KLSAg
ICB4ZW5fYmVfc2V0X21heF9ncmFudF9yZWZzKHhlbmRldiwgbWF4X2dyYW50cyk7Ci0gICAgYmxr
ZGV2LT5zcmluZyA9IHhlbl9iZV9tYXBfZ3JhbnRfcmVmcyh4ZW5kZXYsIGJsa2Rldi0+cmluZ19y
ZWYsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibGtkZXYtPm5y
X3JpbmdfcmVmLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJP
VF9SRUFEIHwgUFJPVF9XUklURSk7Ci0gICAgaWYgKCFibGtkZXYtPnNyaW5nKSB7Ci0gICAgICAg
IHJldHVybiAtMTsKLSAgICB9Ci0KLSAgICBzd2l0Y2ggKGJsa2Rldi0+cHJvdG9jb2wpIHsKLSAg
ICBjYXNlIEJMS0lGX1BST1RPQ09MX05BVElWRToKLSAgICB7Ci0gICAgICAgIGJsa2lmX3NyaW5n
X3QgKnNyaW5nX25hdGl2ZSA9IGJsa2Rldi0+c3Jpbmc7Ci0gICAgICAgIEJBQ0tfUklOR19JTklU
KCZibGtkZXYtPnJpbmdzLm5hdGl2ZSwgc3JpbmdfbmF0aXZlLCByaW5nX3NpemUpOwotICAgICAg
ICBicmVhazsKLSAgICB9Ci0gICAgY2FzZSBCTEtJRl9QUk9UT0NPTF9YODZfMzI6Ci0gICAgewot
ICAgICAgICBibGtpZl94ODZfMzJfc3JpbmdfdCAqc3JpbmdfeDg2XzMyID0gYmxrZGV2LT5zcmlu
ZzsKLQotICAgICAgICBCQUNLX1JJTkdfSU5JVCgmYmxrZGV2LT5yaW5ncy54ODZfMzJfcGFydCwg
c3JpbmdfeDg2XzMyLCByaW5nX3NpemUpOwotICAgICAgICBicmVhazsKLSAgICB9Ci0gICAgY2Fz
ZSBCTEtJRl9QUk9UT0NPTF9YODZfNjQ6Ci0gICAgewotICAgICAgICBibGtpZl94ODZfNjRfc3Jp
bmdfdCAqc3JpbmdfeDg2XzY0ID0gYmxrZGV2LT5zcmluZzsKLQotICAgICAgICBCQUNLX1JJTkdf
SU5JVCgmYmxrZGV2LT5yaW5ncy54ODZfNjRfcGFydCwgc3JpbmdfeDg2XzY0LCByaW5nX3NpemUp
OwotICAgICAgICBicmVhazsKLSAgICB9Ci0gICAgfQotCi0gICAgYmxrX3NldF9haW9fY29udGV4
dChibGtkZXYtPmJsaywgYmxrZGV2LT5jdHgpOwotCi0gICAgeGVuX2JlX2JpbmRfZXZ0Y2huKHhl
bmRldik7Ci0KLSAgICB4ZW5fcHZfcHJpbnRmKHhlbmRldiwgMSwgIm9rOiBwcm90byAlcywgbnIt
cmluZy1yZWYgJXUsICIKLSAgICAgICAgICAgICAgICAgICJyZW1vdGUgcG9ydCAlZCwgbG9jYWwg
cG9ydCAlZFxuIiwKLSAgICAgICAgICAgICAgICAgIHhlbmRldi0+cHJvdG9jb2wsIGJsa2Rldi0+
bnJfcmluZ19yZWYsCi0gICAgICAgICAgICAgICAgICB4ZW5kZXYtPnJlbW90ZV9wb3J0LCB4ZW5k
ZXYtPmxvY2FsX3BvcnQpOwotICAgIHJldHVybiAwOwotfQotCi1zdGF0aWMgdm9pZCBibGtfZGlz
Y29ubmVjdChzdHJ1Y3QgWGVuTGVnYWN5RGV2aWNlICp4ZW5kZXYpCi17Ci0gICAgc3RydWN0IFhl
bkJsa0RldiAqYmxrZGV2ID0gY29udGFpbmVyX29mKHhlbmRldiwgc3RydWN0IFhlbkJsa0Rldiwg
eGVuZGV2KTsKLQotICAgIHRyYWNlX3hlbl9kaXNrX2Rpc2Nvbm5lY3QoeGVuZGV2LT5uYW1lKTsK
LQotICAgIGFpb19jb250ZXh0X2FjcXVpcmUoYmxrZGV2LT5jdHgpOwotCi0gICAgaWYgKGJsa2Rl
di0+YmxrKSB7Ci0gICAgICAgIGJsa19zZXRfYWlvX2NvbnRleHQoYmxrZGV2LT5ibGssIHFlbXVf
Z2V0X2Fpb19jb250ZXh0KCkpOwotICAgICAgICBibGtfZGV0YWNoX2RldihibGtkZXYtPmJsaywg
YmxrZGV2KTsKLSAgICAgICAgYmxrX3VucmVmKGJsa2Rldi0+YmxrKTsKLSAgICAgICAgYmxrZGV2
LT5ibGsgPSBOVUxMOwotICAgIH0KLSAgICB4ZW5fcHZfdW5iaW5kX2V2dGNobih4ZW5kZXYpOwot
Ci0gICAgYWlvX2NvbnRleHRfcmVsZWFzZShibGtkZXYtPmN0eCk7Ci0KLSAgICBpZiAoYmxrZGV2
LT5zcmluZykgewotICAgICAgICB4ZW5fYmVfdW5tYXBfZ3JhbnRfcmVmcyh4ZW5kZXYsIGJsa2Rl
di0+c3JpbmcsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsa2Rldi0+bnJfcmlu
Z19yZWYpOwotICAgICAgICBibGtkZXYtPnNyaW5nID0gTlVMTDsKLSAgICB9Ci19Ci0KLXN0YXRp
YyBpbnQgYmxrX2ZyZWUoc3RydWN0IFhlbkxlZ2FjeURldmljZSAqeGVuZGV2KQotewotICAgIHN0
cnVjdCBYZW5CbGtEZXYgKmJsa2RldiA9IGNvbnRhaW5lcl9vZih4ZW5kZXYsIHN0cnVjdCBYZW5C
bGtEZXYsIHhlbmRldik7Ci0gICAgc3RydWN0IGlvcmVxICppb3JlcTsKLQotICAgIHRyYWNlX3hl
bl9kaXNrX2ZyZWUoeGVuZGV2LT5uYW1lKTsKLQotICAgIGJsa19kaXNjb25uZWN0KHhlbmRldik7
Ci0KLSAgICB3aGlsZSAoIVFMSVNUX0VNUFRZKCZibGtkZXYtPmZyZWVsaXN0KSkgewotICAgICAg
ICBpb3JlcSA9IFFMSVNUX0ZJUlNUKCZibGtkZXYtPmZyZWVsaXN0KTsKLSAgICAgICAgUUxJU1Rf
UkVNT1ZFKGlvcmVxLCBsaXN0KTsKLSAgICAgICAgcWVtdV9pb3ZlY19kZXN0cm95KCZpb3JlcS0+
dik7Ci0gICAgICAgIGdfZnJlZShpb3JlcSk7Ci0gICAgfQotCi0gICAgZ19mcmVlKGJsa2Rldi0+
cGFyYW1zKTsKLSAgICBnX2ZyZWUoYmxrZGV2LT5tb2RlKTsKLSAgICBnX2ZyZWUoYmxrZGV2LT50
eXBlKTsKLSAgICBnX2ZyZWUoYmxrZGV2LT5kZXYpOwotICAgIGdfZnJlZShibGtkZXYtPmRldnR5
cGUpOwotICAgIHFlbXVfYmhfZGVsZXRlKGJsa2Rldi0+YmgpOwotICAgIGlvdGhyZWFkX2Rlc3Ry
b3koYmxrZGV2LT5pb3RocmVhZCk7Ci0gICAgcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIGJs
a19ldmVudChzdHJ1Y3QgWGVuTGVnYWN5RGV2aWNlICp4ZW5kZXYpCi17Ci0gICAgc3RydWN0IFhl
bkJsa0RldiAqYmxrZGV2ID0gY29udGFpbmVyX29mKHhlbmRldiwgc3RydWN0IFhlbkJsa0Rldiwg
eGVuZGV2KTsKLQotICAgIHFlbXVfYmhfc2NoZWR1bGUoYmxrZGV2LT5iaCk7Ci19Ci0KLXN0cnVj
dCBYZW5EZXZPcHMgeGVuX2Jsa2Rldl9vcHMgPSB7Ci0gICAgLmZsYWdzICAgICAgPSBERVZPUFNf
RkxBR19ORUVEX0dOVERFViwKLSAgICAuc2l6ZSAgICAgICA9IHNpemVvZihzdHJ1Y3QgWGVuQmxr
RGV2KSwKLSAgICAuYWxsb2MgICAgICA9IGJsa19hbGxvYywKLSAgICAuaW5pdCAgICAgICA9IGJs
a19pbml0LAotICAgIC5pbml0aWFsaXNlID0gYmxrX2Nvbm5lY3QsCi0gICAgLmRpc2Nvbm5lY3Qg
PSBibGtfZGlzY29ubmVjdCwKLSAgICAuZXZlbnQgICAgICA9IGJsa19ldmVudCwKLSAgICAuZnJl
ZSAgICAgICA9IGJsa19mcmVlLAotfTsKLS0gCjIuMTEuMAoKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRl
dmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFp
bG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=
