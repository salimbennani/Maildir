Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 22 Nov 2018 00:34:18 -0000
Received: from icoremail.net (unknown [209.85.214.169])
	by mail-app2 (Coremail) with SMTP id by_KCgDXv+5WevVbLCfJAQ--.58841S3;
	Wed, 21 Nov 2018 23:31:35 +0800 (CST)
Received: from mail-pl1-f169.google.com (unknown [209.85.214.169])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwDny0dRevVb8RpkAA--.2236S3;
	Wed, 21 Nov 2018 23:31:29 +0800 (CST)
Received: by mail-pl1-f169.google.com with SMTP id b5-v6so6007255pla.6
        for <xuliker@zju.edu.cn>; Wed, 21 Nov 2018 07:31:29 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=xnLWtm7eqDxoNUtlN1o9ACauFb15gG9CP8BgODFIyLk=;
        b=OqQzddhlcVTDNxyBqT3dWFcXQ+JNJ00jBkUMy8gKlQRn39zoB1WzewOQYPVsMm7veA
         83we9nyWYoIx45n7rPGkDDWXz5dXsTpYwex00No5fySjKQ6bjb/4z0edsfHgBni3hx18
         DxpE16ThsBY/jZH6LVTgvnabbnvzf3i8Inin7lKs5pH1DODMXmvpRuAADAmitdNQn2Ha
         2bI1P4Hyw65lm0k3sVJpePRnPtSBCbAD2WNVGkeeKk0tUHBxalZQs7HMma40Bjbn43vu
         UAik3pCKlVuSn1pvmNO4elXiiyvi3dIGh/pfm6e73MPIcsa+7iAmGElLoKmZWin8ixof
         NEWA==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AA+aEWbjUrv0wN70OIrrQg8Ve3YjIBw9J3DT9a8XC1Q8UHNS7jGOK2lU
	2fWJYCYb3M14qeq1BjpvQ9+55Hm3216EZCulqoL8bKx/rnVUA1I=
X-Received: by 2002:a63:9402:: with SMTP id m2mr6224669pge.93.1542814289264;
        Wed, 21 Nov 2018 07:31:29 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp2100918pju;
        Wed, 21 Nov 2018 07:31:28 -0800 (PST)
X-Google-Smtp-Source: AFSGD/XT8lpzre0lRgPRioy74qRrkODZbGdqyBSMMywAl/lr+GoiUBrpO2rtZkbry/sB5FAplV8c
X-Received: by 2002:a25:9703:: with SMTP id d3-v6mr6582395ybo.306.1542814288041;
        Wed, 21 Nov 2018 07:31:28 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542814287; cv=none;
        d=google.com; s=arc-20160816;
        b=EcYdoD19ORDoq/V8qgAf2danna3CztjQc3G2hwqdKqfuKtwghPyeKGdHZRloZG9+fy
         ITYDSh3tgm0wJgH0pt/p572rxZOUq56lx8qhF/MNvPS00L9qlP/hS0H01slANcphvrSI
         sG+QbIxez+4bTxWshpVVZlY0dgeViFdCG6sH6a3Vzl1SpVe77vjZgC5MEjAQBJw5CocR
         q5ixfqGo/FFOrMHykgmIWMnDmAurxiomelOw/kEAuOMbNEKTH/EWnD0m/7/YIFHkly9K
         zqFglnQ3srwMa3rI2RjPlC4epUKz3IzpwXPkYCbnoJd4EKs8IqGd3ObJc0TDUf4j6lay
         HqXw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=xnLWtm7eqDxoNUtlN1o9ACauFb15gG9CP8BgODFIyLk=;
        b=OIPuRob+ZlYBjhsheFn7boafj0rlA/g5I0sOo0FCKCAN2aoSudAI/DKv81KylG4x37
         KDkkFwLRRRydcdpQAMFM5N9dznVyNL95JGd1pqS27+q1iVSyJdioz9hH1+ldQISe5nIw
         cXYG0GvM99BZVq72tBqu9lCYciBLDF9eiigDXyNnEWqauraO1cFWBfDtB7s24LB1ydqL
         K49t8ejKmo/yh0CTpnzl5rM2MK+/DG0MSMdliHWVHiF/Ornk+JaD0O2abdNpHooJa/4/
         1Lv5fXn8P3nsKrrY4dOzN+1oIIPDIMlYToR/uof/gLeDNhYkINOOYJirk5f3lrJ1xyKD
         YBhg==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id v185-v6si26794290ywf.275.2018.11.21.07.31.24
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 21 Nov 2018 07:31:27 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gPUR7-0000s8-Qm; Wed, 21 Nov 2018 15:29:05 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=wvse=oa=citrix.com=prvs=856356900=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1gPUR6-0000ra-6C
 for xen-devel@lists.xenproject.org; Wed, 21 Nov 2018 15:29:04 +0000
X-Inumbo-ID: 2c67d6a8-eda2-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 2c67d6a8-eda2-11e8-9a16-bc764e045a96;
 Wed, 21 Nov 2018 15:29:02 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,261,1539648000"; d="scan'208";a="71207552"
From: Paul Durrant <paul.durrant@citrix.com>
To: <qemu-block@nongnu.org>, <qemu-devel@nongnu.org>,
 <xen-devel@lists.xenproject.org>
Date: Wed, 21 Nov 2018 15:12:04 +0000
Message-ID: <20181121151211.15997-12-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20181121151211.15997-1-paul.durrant@citrix.com>
References: <20181121151211.15997-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 11/18] xen: remove 'XenBlkDev' and 'blkdev'
 names from dataplane/xen-qdisk
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, Stefano Stabellini <sstabellini@kernel.org>,
 Max Reitz <mreitz@redhat.com>, Paul Durrant <paul.durrant@citrix.com>,
 Stefan Hajnoczi <stefanha@redhat.com>,
 Anthony Perard <anthony.perard@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwDny0dRevVb8RpkAA--.2236S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvAXoWfZF1xtr1UuF4rGryxKF47CFg_yoW5JFy8Zo
	WfWr4fX3yrXry8Wr9agr17AF9rCFZ5Ca1rCa15Zr1DW3WUtw1j9r47Gr45Aay2ya1SqFWk
	Wwn5JrWft39IyFW7n29KB7ZKAUJUUUUU529EdanIXcx71UUUUj7v73VFW2AGmfu7jjvjm3
	AaLaJ3UjIYCTnIWjp_UUUo47k0a2IF6w4kM7kC6x804xWl14x267AKxVWUJVW8JwAFIxvE
	14AKwVWUJVWUGwA2ocxC64kIII0Yj41l84x0c7CEw4AK67xGY2AK021l84ACjcxK6xIIjx
	v20xvE14v26F1j6w1UM28EF7xvwVC0I7IYx2IY6xkF7I0E14v26F4j6r4UJwA2z4x0Y4vE
	x4A2jsIE14v26rxl6s0DM28EF7xvwVC2z280aVCY1x0267AKxVW0oVCq3wAa7VCE64xvF2
	IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x082IY
	62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUXVWUAwAv7V
	C2z280aVAFwI0_Cr0_Gr1UMcvjeVCFs4IE7xkEbVWUJVW8JwACjcxG0xvY0x0EwIxGrwAC
	Y4xI67k04243AVAKzVAKj4xxMx02cVCv0xWlc7CjxVAKzI0EY4vE52x082I5MxkFs20EY4
	vE44CYbxCE4x80FwCY02Avz4vEIxC_XrWlc2IjII80xcxEwVAKI48JMxvI42IY6xIIjxv2
	0xvE14v26r4j6ryUMxvI42IY6xIIjxv20xvEc7CjxVAFwI0_Gr0_Cr1lcIIF0xvEx4A2js
	IE14v26rxl6s0DMxvI42IY6I8E87Iv6xkF7I0E14v26rxl6s0DMxAIw28IcxkI7VAKI48J
	MxAIw28IcVAKzI0EY4vE52x082I5MxCjnVCjjxCrMxC20s026xCaFVCjc4AY6r1j6r4UMI
	8I3I0E5I8CrVAFwI0_Jr0_Jr4lx2IqxVCjr7xvwVAFwI0_JrI_JrWlx4CE17CEb7AF67AK
	xVWUtVW8ZwCIc40Y0x0EwIxGrwCI42IY6xAIw20EY4v20xvaj40_Jr0_JF4l6VACY4xI67
	k04243AbIYCTnIWIevJa73UjIFyTuYvjxUBOzVUUUUU

VGhpcyBpcyBhIHB1cmVseSBjb3NtZXRpYyBwYXRjaCB0aGF0IHN1YnN0aXR1dGVzIHRoZSBvbGQg
J3N0cnVjdCBYZW5CbGtEZXYnCm5hbWUgd2l0aCAnWGVuUWRpc2tEYXRhUGxhbmUnIGFuZCAnYmxr
ZGV2JyBmaWVsZC92YXJpYWJsZSBuYW1lcyB3aXRoCidkYXRhcGxhbmUnLCBhbmQgdGhlbiBkb2Vz
IG5lY2Vzc2FyeSBmaXgtdXAgdG8gYWRoZXJlIHRvIGNvZGluZyBzdHlsZS4KCk5vIGZ1bmN0aW9u
YWwgY2hhbmdlLgoKU2lnbmVkLW9mZi1ieTogUGF1bCBEdXJyYW50IDxwYXVsLmR1cnJhbnRAY2l0
cml4LmNvbT4KLS0tCkNjOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5v
cmc+CkNjOiBBbnRob255IFBlcmFyZCA8YW50aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4KQ2M6IFN0
ZWZhbiBIYWpub2N6aSA8c3RlZmFuaGFAcmVkaGF0LmNvbT4KQ2M6IEtldmluIFdvbGYgPGt3b2xm
QHJlZGhhdC5jb20+CkNjOiBNYXggUmVpdHogPG1yZWl0ekByZWRoYXQuY29tPgotLS0KIGh3L2Js
b2NrL2RhdGFwbGFuZS94ZW4tcWRpc2suYyB8IDM0MiArKysrKysrKysrKysrKysrKysrKystLS0t
LS0tLS0tLS0tLS0tLS0tLQogaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1xZGlzay5oIHwgICAyICst
CiAyIGZpbGVzIGNoYW5nZWQsIDE3OSBpbnNlcnRpb25zKCspLCAxNjUgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1xZGlzay5jIGIvaHcvYmxvY2svZGF0
YXBsYW5lL3hlbi1xZGlzay5jCmluZGV4IGIwNzVhYTk3NWQuLjIyMTQ0NTVmZjkgMTAwNjQ0Ci0t
LSBhL2h3L2Jsb2NrL2RhdGFwbGFuZS94ZW4tcWRpc2suYworKysgYi9ody9ibG9jay9kYXRhcGxh
bmUveGVuLXFkaXNrLmMKQEAgLTI4LDEyICsyOCwxMiBAQCBzdHJ1Y3QgaW9yZXEgewogICAgIGlu
dCBwcmVzeW5jOwogICAgIGludCBhaW9faW5mbGlnaHQ7CiAgICAgaW50IGFpb19lcnJvcnM7Ci0g
ICAgc3RydWN0IFhlbkJsa0RldiAqYmxrZGV2OworICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRh
cGxhbmU7CiAgICAgUUxJU1RfRU5UUlkoaW9yZXEpIGxpc3Q7CiAgICAgQmxvY2tBY2N0Q29va2ll
IGFjY3Q7CiB9OwogCi1zdHJ1Y3QgWGVuQmxrRGV2IHsKK3N0cnVjdCBYZW5RZGlza0RhdGFQbGFu
ZSB7CiAgICAgWGVuRGV2aWNlICp4ZW5kZXY7CiAgICAgWGVuRXZlbnRDaGFubmVsICpldmVudF9j
aGFubmVsOwogICAgIHVuc2lnbmVkIGludCAqcmluZ19yZWY7CkBAIC02OSwzMyArNjksMzMgQEAg
c3RhdGljIHZvaWQgaW9yZXFfcmVzZXQoc3RydWN0IGlvcmVxICppb3JlcSkKICAgICBpb3JlcS0+
YWlvX2luZmxpZ2h0ID0gMDsKICAgICBpb3JlcS0+YWlvX2Vycm9ycyA9IDA7CiAKLSAgICBpb3Jl
cS0+YmxrZGV2ID0gTlVMTDsKKyAgICBpb3JlcS0+ZGF0YXBsYW5lID0gTlVMTDsKICAgICBtZW1z
ZXQoJmlvcmVxLT5saXN0LCAwLCBzaXplb2YoaW9yZXEtPmxpc3QpKTsKICAgICBtZW1zZXQoJmlv
cmVxLT5hY2N0LCAwLCBzaXplb2YoaW9yZXEtPmFjY3QpKTsKIAogICAgIHFlbXVfaW92ZWNfcmVz
ZXQoJmlvcmVxLT52KTsKIH0KIAotc3RhdGljIHN0cnVjdCBpb3JlcSAqaW9yZXFfc3RhcnQoc3Ry
dWN0IFhlbkJsa0RldiAqYmxrZGV2KQorc3RhdGljIHN0cnVjdCBpb3JlcSAqaW9yZXFfc3RhcnQo
WGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSkKIHsKICAgICBzdHJ1Y3QgaW9yZXEgKmlvcmVx
ID0gTlVMTDsKIAotICAgIGlmIChRTElTVF9FTVBUWSgmYmxrZGV2LT5mcmVlbGlzdCkpIHsKLSAg
ICAgICAgaWYgKGJsa2Rldi0+cmVxdWVzdHNfdG90YWwgPj0gYmxrZGV2LT5tYXhfcmVxdWVzdHMp
IHsKKyAgICBpZiAoUUxJU1RfRU1QVFkoJmRhdGFwbGFuZS0+ZnJlZWxpc3QpKSB7CisgICAgICAg
IGlmIChkYXRhcGxhbmUtPnJlcXVlc3RzX3RvdGFsID49IGRhdGFwbGFuZS0+bWF4X3JlcXVlc3Rz
KSB7CiAgICAgICAgICAgICBnb3RvIG91dDsKICAgICAgICAgfQogICAgICAgICAvKiBhbGxvY2F0
ZSBuZXcgc3RydWN0ICovCiAgICAgICAgIGlvcmVxID0gZ19tYWxsb2MwKHNpemVvZigqaW9yZXEp
KTsKLSAgICAgICAgaW9yZXEtPmJsa2RldiA9IGJsa2RldjsKLSAgICAgICAgYmxrZGV2LT5yZXF1
ZXN0c190b3RhbCsrOworICAgICAgICBpb3JlcS0+ZGF0YXBsYW5lID0gZGF0YXBsYW5lOworICAg
ICAgICBkYXRhcGxhbmUtPnJlcXVlc3RzX3RvdGFsKys7CiAgICAgICAgIHFlbXVfaW92ZWNfaW5p
dCgmaW9yZXEtPnYsIDEpOwogICAgIH0gZWxzZSB7CiAgICAgICAgIC8qIGdldCBvbmUgZnJvbSBm
cmVlbGlzdCAqLwotICAgICAgICBpb3JlcSA9IFFMSVNUX0ZJUlNUKCZibGtkZXYtPmZyZWVsaXN0
KTsKKyAgICAgICAgaW9yZXEgPSBRTElTVF9GSVJTVCgmZGF0YXBsYW5lLT5mcmVlbGlzdCk7CiAg
ICAgICAgIFFMSVNUX1JFTU9WRShpb3JlcSwgbGlzdCk7CiAgICAgfQotICAgIFFMSVNUX0lOU0VS
VF9IRUFEKCZibGtkZXYtPmluZmxpZ2h0LCBpb3JlcSwgbGlzdCk7Ci0gICAgYmxrZGV2LT5yZXF1
ZXN0c19pbmZsaWdodCsrOworICAgIFFMSVNUX0lOU0VSVF9IRUFEKCZkYXRhcGxhbmUtPmluZmxp
Z2h0LCBpb3JlcSwgbGlzdCk7CisgICAgZGF0YXBsYW5lLT5yZXF1ZXN0c19pbmZsaWdodCsrOwog
CiBvdXQ6CiAgICAgcmV0dXJuIGlvcmVxOwpAQCAtMTAzLDI2ICsxMDMsMjYgQEAgb3V0OgogCiBz
dGF0aWMgdm9pZCBpb3JlcV9maW5pc2goc3RydWN0IGlvcmVxICppb3JlcSkKIHsKLSAgICBzdHJ1
Y3QgWGVuQmxrRGV2ICpibGtkZXYgPSBpb3JlcS0+YmxrZGV2OworICAgIFhlblFkaXNrRGF0YVBs
YW5lICpkYXRhcGxhbmUgPSBpb3JlcS0+ZGF0YXBsYW5lOwogCiAgICAgUUxJU1RfUkVNT1ZFKGlv
cmVxLCBsaXN0KTsKLSAgICBRTElTVF9JTlNFUlRfSEVBRCgmYmxrZGV2LT5maW5pc2hlZCwgaW9y
ZXEsIGxpc3QpOwotICAgIGJsa2Rldi0+cmVxdWVzdHNfaW5mbGlnaHQtLTsKLSAgICBibGtkZXYt
PnJlcXVlc3RzX2ZpbmlzaGVkKys7CisgICAgUUxJU1RfSU5TRVJUX0hFQUQoJmRhdGFwbGFuZS0+
ZmluaXNoZWQsIGlvcmVxLCBsaXN0KTsKKyAgICBkYXRhcGxhbmUtPnJlcXVlc3RzX2luZmxpZ2h0
LS07CisgICAgZGF0YXBsYW5lLT5yZXF1ZXN0c19maW5pc2hlZCsrOwogfQogCiBzdGF0aWMgdm9p
ZCBpb3JlcV9yZWxlYXNlKHN0cnVjdCBpb3JlcSAqaW9yZXEsIGJvb2wgZmluaXNoKQogewotICAg
IHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldiA9IGlvcmVxLT5ibGtkZXY7CisgICAgWGVuUWRpc2tE
YXRhUGxhbmUgKmRhdGFwbGFuZSA9IGlvcmVxLT5kYXRhcGxhbmU7CiAKICAgICBRTElTVF9SRU1P
VkUoaW9yZXEsIGxpc3QpOwogICAgIGlvcmVxX3Jlc2V0KGlvcmVxKTsKLSAgICBpb3JlcS0+Ymxr
ZGV2ID0gYmxrZGV2OwotICAgIFFMSVNUX0lOU0VSVF9IRUFEKCZibGtkZXYtPmZyZWVsaXN0LCBp
b3JlcSwgbGlzdCk7CisgICAgaW9yZXEtPmRhdGFwbGFuZSA9IGRhdGFwbGFuZTsKKyAgICBRTElT
VF9JTlNFUlRfSEVBRCgmZGF0YXBsYW5lLT5mcmVlbGlzdCwgaW9yZXEsIGxpc3QpOwogICAgIGlm
IChmaW5pc2gpIHsKLSAgICAgICAgYmxrZGV2LT5yZXF1ZXN0c19maW5pc2hlZC0tOworICAgICAg
ICBkYXRhcGxhbmUtPnJlcXVlc3RzX2ZpbmlzaGVkLS07CiAgICAgfSBlbHNlIHsKLSAgICAgICAg
YmxrZGV2LT5yZXF1ZXN0c19pbmZsaWdodC0tOworICAgICAgICBkYXRhcGxhbmUtPnJlcXVlc3Rz
X2luZmxpZ2h0LS07CiAgICAgfQogfQogCkBAIC0xMzIsNyArMTMyLDcgQEAgc3RhdGljIHZvaWQg
aW9yZXFfcmVsZWFzZShzdHJ1Y3QgaW9yZXEgKmlvcmVxLCBib29sIGZpbmlzaCkKICAqLwogc3Rh
dGljIGludCBpb3JlcV9wYXJzZShzdHJ1Y3QgaW9yZXEgKmlvcmVxKQogewotICAgIHN0cnVjdCBY
ZW5CbGtEZXYgKmJsa2RldiA9IGlvcmVxLT5ibGtkZXY7CisgICAgWGVuUWRpc2tEYXRhUGxhbmUg
KmRhdGFwbGFuZSA9IGlvcmVxLT5kYXRhcGxhbmU7CiAgICAgc2l6ZV90IGxlbjsKICAgICBpbnQg
aTsKIApAQCAtMTU1LDEyICsxNTUsMTIgQEAgc3RhdGljIGludCBpb3JlcV9wYXJzZShzdHJ1Y3Qg
aW9yZXEgKmlvcmVxKQogICAgIH07CiAKICAgICBpZiAoaW9yZXEtPnJlcS5vcGVyYXRpb24gIT0g
QkxLSUZfT1BfUkVBRCAmJgotICAgICAgICBibGtfaXNfcmVhZF9vbmx5KGJsa2Rldi0+YmxrKSkg
eworICAgICAgICBibGtfaXNfcmVhZF9vbmx5KGRhdGFwbGFuZS0+YmxrKSkgewogICAgICAgICBl
cnJvcl9yZXBvcnQoImVycm9yOiB3cml0ZSByZXEgZm9yIHJvIGRldmljZSIpOwogICAgICAgICBn
b3RvIGVycjsKICAgICB9CiAKLSAgICBpb3JlcS0+c3RhcnQgPSBpb3JlcS0+cmVxLnNlY3Rvcl9u
dW1iZXIgKiBibGtkZXYtPmZpbGVfYmxrOworICAgIGlvcmVxLT5zdGFydCA9IGlvcmVxLT5yZXEu
c2VjdG9yX251bWJlciAqIGRhdGFwbGFuZS0+ZmlsZV9ibGs7CiAgICAgZm9yIChpID0gMDsgaSA8
IGlvcmVxLT5yZXEubnJfc2VnbWVudHM7IGkrKykgewogICAgICAgICBpZiAoaSA9PSBCTEtJRl9N
QVhfU0VHTUVOVFNfUEVSX1JFUVVFU1QpIHsKICAgICAgICAgICAgIGVycm9yX3JlcG9ydCgiZXJy
b3I6IG5yX3NlZ21lbnRzIHRvbyBiaWciKTsKQEAgLTE3MCwxNiArMTcwLDE2IEBAIHN0YXRpYyBp
bnQgaW9yZXFfcGFyc2Uoc3RydWN0IGlvcmVxICppb3JlcSkKICAgICAgICAgICAgIGVycm9yX3Jl
cG9ydCgiZXJyb3I6IGZpcnN0ID4gbGFzdCBzZWN0b3IiKTsKICAgICAgICAgICAgIGdvdG8gZXJy
OwogICAgICAgICB9Ci0gICAgICAgIGlmIChpb3JlcS0+cmVxLnNlZ1tpXS5sYXN0X3NlY3QgKiBi
bGtkZXYtPmZpbGVfYmxrID49IFhDX1BBR0VfU0laRSkgeworICAgICAgICBpZiAoaW9yZXEtPnJl
cS5zZWdbaV0ubGFzdF9zZWN0ICogZGF0YXBsYW5lLT5maWxlX2JsayA+PSBYQ19QQUdFX1NJWkUp
IHsKICAgICAgICAgICAgIGVycm9yX3JlcG9ydCgiZXJyb3I6IHBhZ2UgY3Jvc3NpbmciKTsKICAg
ICAgICAgICAgIGdvdG8gZXJyOwogICAgICAgICB9CiAKICAgICAgICAgbGVuID0gKGlvcmVxLT5y
ZXEuc2VnW2ldLmxhc3Rfc2VjdCAtCi0gICAgICAgICAgICAgICBpb3JlcS0+cmVxLnNlZ1tpXS5m
aXJzdF9zZWN0ICsgMSkgKiBibGtkZXYtPmZpbGVfYmxrOworICAgICAgICAgICAgICAgaW9yZXEt
PnJlcS5zZWdbaV0uZmlyc3Rfc2VjdCArIDEpICogZGF0YXBsYW5lLT5maWxlX2JsazsKICAgICAg
ICAgaW9yZXEtPnNpemUgKz0gbGVuOwogICAgIH0KLSAgICBpZiAoaW9yZXEtPnN0YXJ0ICsgaW9y
ZXEtPnNpemUgPiBibGtkZXYtPmZpbGVfc2l6ZSkgeworICAgIGlmIChpb3JlcS0+c3RhcnQgKyBp
b3JlcS0+c2l6ZSA+IGRhdGFwbGFuZS0+ZmlsZV9zaXplKSB7CiAgICAgICAgIGVycm9yX3JlcG9y
dCgiZXJyb3I6IGFjY2VzcyBiZXlvbmQgZW5kIG9mIGZpbGUiKTsKICAgICAgICAgZ290byBlcnI7
CiAgICAgfQpAQCAtMTkyLDExICsxOTIsMTEgQEAgZXJyOgogCiBzdGF0aWMgaW50IGlvcmVxX2dy
YW50X2NvcHkoc3RydWN0IGlvcmVxICppb3JlcSkKIHsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpi
bGtkZXYgPSBpb3JlcS0+YmxrZGV2OwotICAgIFhlbkRldmljZSAqeGVuZGV2ID0gYmxrZGV2LT54
ZW5kZXY7CisgICAgWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSA9IGlvcmVxLT5kYXRhcGxh
bmU7CisgICAgWGVuRGV2aWNlICp4ZW5kZXYgPSBkYXRhcGxhbmUtPnhlbmRldjsKICAgICBYZW5E
ZXZpY2VHcmFudENvcHlTZWdtZW50IHNlZ3NbQkxLSUZfTUFYX1NFR01FTlRTX1BFUl9SRVFVRVNU
XTsKICAgICBpbnQgaSwgY291bnQ7Ci0gICAgaW50NjRfdCBmaWxlX2JsayA9IGJsa2Rldi0+Zmls
ZV9ibGs7CisgICAgaW50NjRfdCBmaWxlX2JsayA9IGRhdGFwbGFuZS0+ZmlsZV9ibGs7CiAgICAg
Ym9vbCB0b19kb21haW4gPSAoaW9yZXEtPnJlcS5vcGVyYXRpb24gPT0gQkxLSUZfT1BfUkVBRCk7
CiAgICAgdm9pZCAqdmlydCA9IGlvcmVxLT5idWY7CiAgICAgRXJyb3IgKmxvY2FsX2VyciA9IE5V
TEw7CkBAIC0yNDQsOSArMjQ0LDkgQEAgc3RhdGljIGludCBpb3JlcV9ydW5pb19xZW11X2Fpbyhz
dHJ1Y3QgaW9yZXEgKmlvcmVxKTsKIHN0YXRpYyB2b2lkIHFlbXVfYWlvX2NvbXBsZXRlKHZvaWQg
Km9wYXF1ZSwgaW50IHJldCkKIHsKICAgICBzdHJ1Y3QgaW9yZXEgKmlvcmVxID0gb3BhcXVlOwot
ICAgIHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldiA9IGlvcmVxLT5ibGtkZXY7CisgICAgWGVuUWRp
c2tEYXRhUGxhbmUgKmRhdGFwbGFuZSA9IGlvcmVxLT5kYXRhcGxhbmU7CiAKLSAgICBhaW9fY29u
dGV4dF9hY3F1aXJlKGJsa2Rldi0+Y3R4KTsKKyAgICBhaW9fY29udGV4dF9hY3F1aXJlKGRhdGFw
bGFuZS0+Y3R4KTsKIAogICAgIGlmIChyZXQgIT0gMCkgewogICAgICAgICBlcnJvcl9yZXBvcnQo
IiVzIEkvTyBlcnJvciIsCkBAIC0yOTUsMjUgKzI5NSwyNSBAQCBzdGF0aWMgdm9pZCBxZW11X2Fp
b19jb21wbGV0ZSh2b2lkICpvcGFxdWUsIGludCByZXQpCiAgICAgICAgIH0KICAgICBjYXNlIEJM
S0lGX09QX1JFQUQ6CiAgICAgICAgIGlmIChpb3JlcS0+c3RhdHVzID09IEJMS0lGX1JTUF9PS0FZ
KSB7Ci0gICAgICAgICAgICBibG9ja19hY2N0X2RvbmUoYmxrX2dldF9zdGF0cyhibGtkZXYtPmJs
ayksICZpb3JlcS0+YWNjdCk7CisgICAgICAgICAgICBibG9ja19hY2N0X2RvbmUoYmxrX2dldF9z
dGF0cyhkYXRhcGxhbmUtPmJsayksICZpb3JlcS0+YWNjdCk7CiAgICAgICAgIH0gZWxzZSB7Ci0g
ICAgICAgICAgICBibG9ja19hY2N0X2ZhaWxlZChibGtfZ2V0X3N0YXRzKGJsa2Rldi0+YmxrKSwg
JmlvcmVxLT5hY2N0KTsKKyAgICAgICAgICAgIGJsb2NrX2FjY3RfZmFpbGVkKGJsa19nZXRfc3Rh
dHMoZGF0YXBsYW5lLT5ibGspLCAmaW9yZXEtPmFjY3QpOwogICAgICAgICB9CiAgICAgICAgIGJy
ZWFrOwogICAgIGNhc2UgQkxLSUZfT1BfRElTQ0FSRDoKICAgICBkZWZhdWx0OgogICAgICAgICBi
cmVhazsKICAgICB9Ci0gICAgcWVtdV9iaF9zY2hlZHVsZShibGtkZXYtPmJoKTsKKyAgICBxZW11
X2JoX3NjaGVkdWxlKGRhdGFwbGFuZS0+YmgpOwogCiBkb25lOgotICAgIGFpb19jb250ZXh0X3Jl
bGVhc2UoYmxrZGV2LT5jdHgpOworICAgIGFpb19jb250ZXh0X3JlbGVhc2UoZGF0YXBsYW5lLT5j
dHgpOwogfQogCiBzdGF0aWMgYm9vbCBibGtfc3BsaXRfZGlzY2FyZChzdHJ1Y3QgaW9yZXEgKmlv
cmVxLCBibGtpZl9zZWN0b3JfdCBzZWN0b3JfbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDY0X3QgbnJfc2VjdG9ycykKIHsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpi
bGtkZXYgPSBpb3JlcS0+YmxrZGV2OworICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUg
PSBpb3JlcS0+ZGF0YXBsYW5lOwogICAgIGludDY0X3QgYnl0ZV9vZmZzZXQ7CiAgICAgaW50IGJ5
dGVfY2h1bms7CiAgICAgdWludDY0X3QgYnl0ZV9yZW1haW5pbmcsIGxpbWl0OwpAQCAtMzIyLDE4
ICszMjIsMTggQEAgc3RhdGljIGJvb2wgYmxrX3NwbGl0X2Rpc2NhcmQoc3RydWN0IGlvcmVxICpp
b3JlcSwgYmxraWZfc2VjdG9yX3Qgc2VjdG9yX251bWJlciwKIAogICAgIC8qIFdyYXAgYXJvdW5k
LCBvciBvdmVyZmxvd2luZyBieXRlIGxpbWl0PyAqLwogICAgIGlmIChzZWNfc3RhcnQgKyBzZWNf
Y291bnQgPCBzZWNfY291bnQgfHwKLSAgICAgICAgc2VjX3N0YXJ0ICsgc2VjX2NvdW50ID4gSU5U
NjRfTUFYIC8gYmxrZGV2LT5maWxlX2JsaykgeworICAgICAgICBzZWNfc3RhcnQgKyBzZWNfY291
bnQgPiBJTlQ2NF9NQVggLyBkYXRhcGxhbmUtPmZpbGVfYmxrKSB7CiAgICAgICAgIHJldHVybiBm
YWxzZTsKICAgICB9CiAKLSAgICBsaW1pdCA9IEJEUlZfUkVRVUVTVF9NQVhfU0VDVE9SUyAqIGJs
a2Rldi0+ZmlsZV9ibGs7Ci0gICAgYnl0ZV9vZmZzZXQgPSBzZWNfc3RhcnQgKiBibGtkZXYtPmZp
bGVfYmxrOwotICAgIGJ5dGVfcmVtYWluaW5nID0gc2VjX2NvdW50ICogYmxrZGV2LT5maWxlX2Js
azsKKyAgICBsaW1pdCA9IEJEUlZfUkVRVUVTVF9NQVhfU0VDVE9SUyAqIGRhdGFwbGFuZS0+Zmls
ZV9ibGs7CisgICAgYnl0ZV9vZmZzZXQgPSBzZWNfc3RhcnQgKiBkYXRhcGxhbmUtPmZpbGVfYmxr
OworICAgIGJ5dGVfcmVtYWluaW5nID0gc2VjX2NvdW50ICogZGF0YXBsYW5lLT5maWxlX2JsazsK
IAogICAgIGRvIHsKICAgICAgICAgYnl0ZV9jaHVuayA9IGJ5dGVfcmVtYWluaW5nID4gbGltaXQg
PyBsaW1pdCA6IGJ5dGVfcmVtYWluaW5nOwogICAgICAgICBpb3JlcS0+YWlvX2luZmxpZ2h0Kys7
Ci0gICAgICAgIGJsa19haW9fcGRpc2NhcmQoYmxrZGV2LT5ibGssIGJ5dGVfb2Zmc2V0LCBieXRl
X2NodW5rLAorICAgICAgICBibGtfYWlvX3BkaXNjYXJkKGRhdGFwbGFuZS0+YmxrLCBieXRlX29m
ZnNldCwgYnl0ZV9jaHVuaywKICAgICAgICAgICAgICAgICAgICAgICAgICBxZW11X2Fpb19jb21w
bGV0ZSwgaW9yZXEpOwogICAgICAgICBieXRlX3JlbWFpbmluZyAtPSBieXRlX2NodW5rOwogICAg
ICAgICBieXRlX29mZnNldCArPSBieXRlX2NodW5rOwpAQCAtMzQ0LDcgKzM0NCw3IEBAIHN0YXRp
YyBib29sIGJsa19zcGxpdF9kaXNjYXJkKHN0cnVjdCBpb3JlcSAqaW9yZXEsIGJsa2lmX3NlY3Rv
cl90IHNlY3Rvcl9udW1iZXIsCiAKIHN0YXRpYyBpbnQgaW9yZXFfcnVuaW9fcWVtdV9haW8oc3Ry
dWN0IGlvcmVxICppb3JlcSkKIHsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpibGtkZXYgPSBpb3Jl
cS0+YmxrZGV2OworICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUgPSBpb3JlcS0+ZGF0
YXBsYW5lOwogCiAgICAgaW9yZXEtPmJ1ZiA9IHFlbXVfbWVtYWxpZ24oWENfUEFHRV9TSVpFLCBp
b3JlcS0+c2l6ZSk7CiAgICAgaWYgKGlvcmVxLT5yZXEubnJfc2VnbWVudHMgJiYKQEAgLTM1Nywx
NyArMzU3LDE3IEBAIHN0YXRpYyBpbnQgaW9yZXFfcnVuaW9fcWVtdV9haW8oc3RydWN0IGlvcmVx
ICppb3JlcSkKIAogICAgIGlvcmVxLT5haW9faW5mbGlnaHQrKzsKICAgICBpZiAoaW9yZXEtPnBy
ZXN5bmMpIHsKLSAgICAgICAgYmxrX2Fpb19mbHVzaChpb3JlcS0+YmxrZGV2LT5ibGssIHFlbXVf
YWlvX2NvbXBsZXRlLCBpb3JlcSk7CisgICAgICAgIGJsa19haW9fZmx1c2goaW9yZXEtPmRhdGFw
bGFuZS0+YmxrLCBxZW11X2Fpb19jb21wbGV0ZSwgaW9yZXEpOwogICAgICAgICByZXR1cm4gMDsK
ICAgICB9CiAKICAgICBzd2l0Y2ggKGlvcmVxLT5yZXEub3BlcmF0aW9uKSB7CiAgICAgY2FzZSBC
TEtJRl9PUF9SRUFEOgogICAgICAgICBxZW11X2lvdmVjX2FkZCgmaW9yZXEtPnYsIGlvcmVxLT5i
dWYsIGlvcmVxLT5zaXplKTsKLSAgICAgICAgYmxvY2tfYWNjdF9zdGFydChibGtfZ2V0X3N0YXRz
KGJsa2Rldi0+YmxrKSwgJmlvcmVxLT5hY2N0LAorICAgICAgICBibG9ja19hY2N0X3N0YXJ0KGJs
a19nZXRfc3RhdHMoZGF0YXBsYW5lLT5ibGspLCAmaW9yZXEtPmFjY3QsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgaW9yZXEtPnYuc2l6ZSwgQkxPQ0tfQUNDVF9SRUFEKTsKICAgICAgICAgaW9y
ZXEtPmFpb19pbmZsaWdodCsrOwotICAgICAgICBibGtfYWlvX3ByZWFkdihibGtkZXYtPmJsaywg
aW9yZXEtPnN0YXJ0LCAmaW9yZXEtPnYsIDAsCisgICAgICAgIGJsa19haW9fcHJlYWR2KGRhdGFw
bGFuZS0+YmxrLCBpb3JlcS0+c3RhcnQsICZpb3JlcS0+diwgMCwKICAgICAgICAgICAgICAgICAg
ICAgICAgcWVtdV9haW9fY29tcGxldGUsIGlvcmVxKTsKICAgICAgICAgYnJlYWs7CiAgICAgY2Fz
ZSBCTEtJRl9PUF9XUklURToKQEAgLTM3NywxMiArMzc3LDEyIEBAIHN0YXRpYyBpbnQgaW9yZXFf
cnVuaW9fcWVtdV9haW8oc3RydWN0IGlvcmVxICppb3JlcSkKICAgICAgICAgfQogCiAgICAgICAg
IHFlbXVfaW92ZWNfYWRkKCZpb3JlcS0+diwgaW9yZXEtPmJ1ZiwgaW9yZXEtPnNpemUpOwotICAg
ICAgICBibG9ja19hY2N0X3N0YXJ0KGJsa19nZXRfc3RhdHMoYmxrZGV2LT5ibGspLCAmaW9yZXEt
PmFjY3QsCisgICAgICAgIGJsb2NrX2FjY3Rfc3RhcnQoYmxrX2dldF9zdGF0cyhkYXRhcGxhbmUt
PmJsayksICZpb3JlcS0+YWNjdCwKICAgICAgICAgICAgICAgICAgICAgICAgICBpb3JlcS0+di5z
aXplLAogICAgICAgICAgICAgICAgICAgICAgICAgIGlvcmVxLT5yZXEub3BlcmF0aW9uID09IEJM
S0lGX09QX1dSSVRFID8KICAgICAgICAgICAgICAgICAgICAgICAgICBCTE9DS19BQ0NUX1dSSVRF
IDogQkxPQ0tfQUNDVF9GTFVTSCk7CiAgICAgICAgIGlvcmVxLT5haW9faW5mbGlnaHQrKzsKLSAg
ICAgICAgYmxrX2Fpb19wd3JpdGV2KGJsa2Rldi0+YmxrLCBpb3JlcS0+c3RhcnQsICZpb3JlcS0+
diwgMCwKKyAgICAgICAgYmxrX2Fpb19wd3JpdGV2KGRhdGFwbGFuZS0+YmxrLCBpb3JlcS0+c3Rh
cnQsICZpb3JlcS0+diwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgIHFlbXVfYWlvX2NvbXBs
ZXRlLCBpb3JlcSk7CiAgICAgICAgIGJyZWFrOwogICAgIGNhc2UgQkxLSUZfT1BfRElTQ0FSRDoK
QEAgLTQxMCwyNyArNDEwLDI3IEBAIGVycjoKIAogc3RhdGljIGludCBibGtfc2VuZF9yZXNwb25z
ZV9vbmUoc3RydWN0IGlvcmVxICppb3JlcSkKIHsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpibGtk
ZXYgPSBpb3JlcS0+YmxrZGV2OworICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUgPSBp
b3JlcS0+ZGF0YXBsYW5lOwogICAgIGludCBzZW5kX25vdGlmeSA9IDA7CiAgICAgaW50IGhhdmVf
cmVxdWVzdHMgPSAwOwogICAgIGJsa2lmX3Jlc3BvbnNlX3QgKnJlc3A7CiAKICAgICAvKiBQbGFj
ZSBvbiB0aGUgcmVzcG9uc2UgcmluZyBmb3IgdGhlIHJlbGV2YW50IGRvbWFpbi4gKi8KLSAgICBz
d2l0Y2ggKGJsa2Rldi0+cHJvdG9jb2wpIHsKKyAgICBzd2l0Y2ggKGRhdGFwbGFuZS0+cHJvdG9j
b2wpIHsKICAgICBjYXNlIEJMS0lGX1BST1RPQ09MX05BVElWRToKICAgICAgICAgcmVzcCA9IChi
bGtpZl9yZXNwb25zZV90ICopUklOR19HRVRfUkVTUE9OU0UoCi0gICAgICAgICAgICAmYmxrZGV2
LT5yaW5ncy5uYXRpdmUsCi0gICAgICAgICAgICBibGtkZXYtPnJpbmdzLm5hdGl2ZS5yc3BfcHJv
ZF9wdnQpOworICAgICAgICAgICAgJmRhdGFwbGFuZS0+cmluZ3MubmF0aXZlLAorICAgICAgICAg
ICAgZGF0YXBsYW5lLT5yaW5ncy5uYXRpdmUucnNwX3Byb2RfcHZ0KTsKICAgICAgICAgYnJlYWs7
CiAgICAgY2FzZSBCTEtJRl9QUk9UT0NPTF9YODZfMzI6CiAgICAgICAgIHJlc3AgPSAoYmxraWZf
cmVzcG9uc2VfdCAqKVJJTkdfR0VUX1JFU1BPTlNFKAotICAgICAgICAgICAgJmJsa2Rldi0+cmlu
Z3MueDg2XzMyX3BhcnQsCi0gICAgICAgICAgICBibGtkZXYtPnJpbmdzLng4Nl8zMl9wYXJ0LnJz
cF9wcm9kX3B2dCk7CisgICAgICAgICAgICAmZGF0YXBsYW5lLT5yaW5ncy54ODZfMzJfcGFydCwK
KyAgICAgICAgICAgIGRhdGFwbGFuZS0+cmluZ3MueDg2XzMyX3BhcnQucnNwX3Byb2RfcHZ0KTsK
ICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBCTEtJRl9QUk9UT0NPTF9YODZfNjQ6CiAgICAgICAg
IHJlc3AgPSAoYmxraWZfcmVzcG9uc2VfdCAqKVJJTkdfR0VUX1JFU1BPTlNFKAotICAgICAgICAg
ICAgJmJsa2Rldi0+cmluZ3MueDg2XzY0X3BhcnQsCi0gICAgICAgICAgICBibGtkZXYtPnJpbmdz
Lng4Nl82NF9wYXJ0LnJzcF9wcm9kX3B2dCk7CisgICAgICAgICAgICAmZGF0YXBsYW5lLT5yaW5n
cy54ODZfNjRfcGFydCwKKyAgICAgICAgICAgIGRhdGFwbGFuZS0+cmluZ3MueDg2XzY0X3BhcnQu
cnNwX3Byb2RfcHZ0KTsKICAgICAgICAgYnJlYWs7CiAgICAgZGVmYXVsdDoKICAgICAgICAgcmV0
dXJuIDA7CkBAIC00NDAsMTExICs0NDAsMTI0IEBAIHN0YXRpYyBpbnQgYmxrX3NlbmRfcmVzcG9u
c2Vfb25lKHN0cnVjdCBpb3JlcSAqaW9yZXEpCiAgICAgcmVzcC0+b3BlcmF0aW9uID0gaW9yZXEt
PnJlcS5vcGVyYXRpb247CiAgICAgcmVzcC0+c3RhdHVzID0gaW9yZXEtPnN0YXR1czsKIAotICAg
IGJsa2Rldi0+cmluZ3MuY29tbW9uLnJzcF9wcm9kX3B2dCsrOworICAgIGRhdGFwbGFuZS0+cmlu
Z3MuY29tbW9uLnJzcF9wcm9kX3B2dCsrOwogCi0gICAgUklOR19QVVNIX1JFU1BPTlNFU19BTkRf
Q0hFQ0tfTk9USUZZKCZibGtkZXYtPnJpbmdzLmNvbW1vbiwgc2VuZF9ub3RpZnkpOwotICAgIGlm
IChibGtkZXYtPnJpbmdzLmNvbW1vbi5yc3BfcHJvZF9wdnQgPT0gYmxrZGV2LT5yaW5ncy5jb21t
b24ucmVxX2NvbnMpIHsKKyAgICBSSU5HX1BVU0hfUkVTUE9OU0VTX0FORF9DSEVDS19OT1RJRlko
JmRhdGFwbGFuZS0+cmluZ3MuY29tbW9uLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzZW5kX25vdGlmeSk7CisgICAgaWYgKGRhdGFwbGFuZS0+cmluZ3MuY29tbW9u
LnJzcF9wcm9kX3B2dCA9PQorICAgICAgICBkYXRhcGxhbmUtPnJpbmdzLmNvbW1vbi5yZXFfY29u
cykgewogICAgICAgICAvKgogICAgICAgICAgKiBUYWlsIGNoZWNrIGZvciBwZW5kaW5nIHJlcXVl
c3RzLiBBbGxvd3MgZnJvbnRlbmQgdG8gYXZvaWQKICAgICAgICAgICogbm90aWZpY2F0aW9ucyBp
ZiByZXF1ZXN0cyBhcmUgYWxyZWFkeSBpbiBmbGlnaHQgKGxvd2VyCiAgICAgICAgICAqIG92ZXJo
ZWFkcyBhbmQgcHJvbW90ZXMgYmF0Y2hpbmcpLgogICAgICAgICAgKi8KLSAgICAgICAgUklOR19G
SU5BTF9DSEVDS19GT1JfUkVRVUVTVFMoJmJsa2Rldi0+cmluZ3MuY29tbW9uLCBoYXZlX3JlcXVl
c3RzKTsKLSAgICB9IGVsc2UgaWYgKFJJTkdfSEFTX1VOQ09OU1VNRURfUkVRVUVTVFMoJmJsa2Rl
di0+cmluZ3MuY29tbW9uKSkgeworICAgICAgICBSSU5HX0ZJTkFMX0NIRUNLX0ZPUl9SRVFVRVNU
UygmZGF0YXBsYW5lLT5yaW5ncy5jb21tb24sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGhhdmVfcmVxdWVzdHMpOworICAgIH0gZWxzZSBpZiAoUklOR19IQVNfVU5DT05T
VU1FRF9SRVFVRVNUUygmZGF0YXBsYW5lLT5yaW5ncy5jb21tb24pKSB7CiAgICAgICAgIGhhdmVf
cmVxdWVzdHMgPSAxOwogICAgIH0KIAogICAgIGlmIChoYXZlX3JlcXVlc3RzKSB7Ci0gICAgICAg
IGJsa2Rldi0+bW9yZV93b3JrKys7CisgICAgICAgIGRhdGFwbGFuZS0+bW9yZV93b3JrKys7CiAg
ICAgfQogICAgIHJldHVybiBzZW5kX25vdGlmeTsKIH0KIAogLyogd2FsayBmaW5pc2hlZCBsaXN0
LCBzZW5kIG91dHN0YW5kaW5nIHJlc3BvbnNlcywgZnJlZSByZXF1ZXN0cyAqLwotc3RhdGljIHZv
aWQgYmxrX3NlbmRfcmVzcG9uc2VfYWxsKHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldikKK3N0YXRp
YyB2b2lkIGJsa19zZW5kX3Jlc3BvbnNlX2FsbChYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5l
KQogewogICAgIHN0cnVjdCBpb3JlcSAqaW9yZXE7CiAgICAgaW50IHNlbmRfbm90aWZ5ID0gMDsK
IAotICAgIHdoaWxlICghUUxJU1RfRU1QVFkoJmJsa2Rldi0+ZmluaXNoZWQpKSB7Ci0gICAgICAg
IGlvcmVxID0gUUxJU1RfRklSU1QoJmJsa2Rldi0+ZmluaXNoZWQpOworICAgIHdoaWxlICghUUxJ
U1RfRU1QVFkoJmRhdGFwbGFuZS0+ZmluaXNoZWQpKSB7CisgICAgICAgIGlvcmVxID0gUUxJU1Rf
RklSU1QoJmRhdGFwbGFuZS0+ZmluaXNoZWQpOwogICAgICAgICBzZW5kX25vdGlmeSArPSBibGtf
c2VuZF9yZXNwb25zZV9vbmUoaW9yZXEpOwogICAgICAgICBpb3JlcV9yZWxlYXNlKGlvcmVxLCB0
cnVlKTsKICAgICB9CiAgICAgaWYgKHNlbmRfbm90aWZ5KSB7Ci0gICAgICAgIHhlbl9kZXZpY2Vf
bm90aWZ5X2V2ZW50X2NoYW5uZWwoYmxrZGV2LT54ZW5kZXYsIGJsa2Rldi0+ZXZlbnRfY2hhbm5l
bCk7CisgICAgICAgIHhlbl9kZXZpY2Vfbm90aWZ5X2V2ZW50X2NoYW5uZWwoZGF0YXBsYW5lLT54
ZW5kZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXBsYW5l
LT5ldmVudF9jaGFubmVsKTsKICAgICB9CiB9CiAKLXN0YXRpYyBpbnQgYmxrX2dldF9yZXF1ZXN0
KHN0cnVjdCBYZW5CbGtEZXYgKmJsa2Rldiwgc3RydWN0IGlvcmVxICppb3JlcSwKK3N0YXRpYyBp
bnQgYmxrX2dldF9yZXF1ZXN0KFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUsIHN0cnVjdCBp
b3JlcSAqaW9yZXEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSSU5HX0lEWCByYykKIHsK
LSAgICBzd2l0Y2ggKGJsa2Rldi0+cHJvdG9jb2wpIHsKLSAgICBjYXNlIEJMS0lGX1BST1RPQ09M
X05BVElWRToKLSAgICAgICAgbWVtY3B5KCZpb3JlcS0+cmVxLCBSSU5HX0dFVF9SRVFVRVNUKCZi
bGtkZXYtPnJpbmdzLm5hdGl2ZSwgcmMpLAotICAgICAgICAgICAgICAgc2l6ZW9mKGlvcmVxLT5y
ZXEpKTsKKyAgICBzd2l0Y2ggKGRhdGFwbGFuZS0+cHJvdG9jb2wpIHsKKyAgICBjYXNlIEJMS0lG
X1BST1RPQ09MX05BVElWRTogeworICAgICAgICBibGtpZl9yZXF1ZXN0X3QgKnJlcSA9CisgICAg
ICAgICAgICBSSU5HX0dFVF9SRVFVRVNUKCZkYXRhcGxhbmUtPnJpbmdzLm5hdGl2ZSwgcmMpOwor
CisgICAgICAgIG1lbWNweSgmaW9yZXEtPnJlcSwgcmVxLCBzaXplb2YoaW9yZXEtPnJlcSkpOwog
ICAgICAgICBicmVhazsKLSAgICBjYXNlIEJMS0lGX1BST1RPQ09MX1g4Nl8zMjoKLSAgICAgICAg
YmxraWZfZ2V0X3g4Nl8zMl9yZXEoJmlvcmVxLT5yZXEsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFJJTkdfR0VUX1JFUVVFU1QoJmJsa2Rldi0+cmluZ3MueDg2XzMyX3BhcnQsIHJjKSk7
CisgICAgfQorICAgIGNhc2UgQkxLSUZfUFJPVE9DT0xfWDg2XzMyOiB7CisgICAgICAgIGJsa2lm
X3g4Nl8zMl9yZXF1ZXN0X3QgKnJlcSA9CisgICAgICAgICAgICBSSU5HX0dFVF9SRVFVRVNUKCZk
YXRhcGxhbmUtPnJpbmdzLng4Nl8zMl9wYXJ0LCByYyk7CisKKyAgICAgICAgYmxraWZfZ2V0X3g4
Nl8zMl9yZXEoJmlvcmVxLT5yZXEsIHJlcSk7CiAgICAgICAgIGJyZWFrOwotICAgIGNhc2UgQkxL
SUZfUFJPVE9DT0xfWDg2XzY0OgotICAgICAgICBibGtpZl9nZXRfeDg2XzY0X3JlcSgmaW9yZXEt
PnJlcSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUklOR19HRVRfUkVRVUVTVCgmYmxr
ZGV2LT5yaW5ncy54ODZfNjRfcGFydCwgcmMpKTsKKyAgICB9CisgICAgY2FzZSBCTEtJRl9QUk9U
T0NPTF9YODZfNjQ6IHsKKyAgICAgICAgYmxraWZfeDg2XzY0X3JlcXVlc3RfdCAqcmVxID0KKyAg
ICAgICAgICAgIFJJTkdfR0VUX1JFUVVFU1QoJmRhdGFwbGFuZS0+cmluZ3MueDg2XzY0X3BhcnQs
IHJjKTsKKworICAgICAgICBibGtpZl9nZXRfeDg2XzY0X3JlcSgmaW9yZXEtPnJlcSwgcmVxKTsK
ICAgICAgICAgYnJlYWs7CiAgICAgfQorICAgIH0KICAgICAvKiBQcmV2ZW50IHRoZSBjb21waWxl
ciBmcm9tIGFjY2Vzc2luZyB0aGUgb24tcmluZyBmaWVsZHMgaW5zdGVhZC4gKi8KICAgICBiYXJy
aWVyKCk7CiAgICAgcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIGJsa19oYW5kbGVfcmVxdWVz
dHMoc3RydWN0IFhlbkJsa0RldiAqYmxrZGV2KQorc3RhdGljIHZvaWQgYmxrX2hhbmRsZV9yZXF1
ZXN0cyhYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lKQogewogICAgIFJJTkdfSURYIHJjLCBy
cDsKICAgICBzdHJ1Y3QgaW9yZXEgKmlvcmVxOwogCi0gICAgYmxrZGV2LT5tb3JlX3dvcmsgPSAw
OworICAgIGRhdGFwbGFuZS0+bW9yZV93b3JrID0gMDsKIAotICAgIHJjID0gYmxrZGV2LT5yaW5n
cy5jb21tb24ucmVxX2NvbnM7Ci0gICAgcnAgPSBibGtkZXYtPnJpbmdzLmNvbW1vbi5zcmluZy0+
cmVxX3Byb2Q7CisgICAgcmMgPSBkYXRhcGxhbmUtPnJpbmdzLmNvbW1vbi5yZXFfY29uczsKKyAg
ICBycCA9IGRhdGFwbGFuZS0+cmluZ3MuY29tbW9uLnNyaW5nLT5yZXFfcHJvZDsKICAgICB4ZW5f
cm1iKCk7IC8qIEVuc3VyZSB3ZSBzZWUgcXVldWVkIHJlcXVlc3RzIHVwIHRvICdycCcuICovCiAK
LSAgICBibGtfc2VuZF9yZXNwb25zZV9hbGwoYmxrZGV2KTsKKyAgICBibGtfc2VuZF9yZXNwb25z
ZV9hbGwoZGF0YXBsYW5lKTsKICAgICB3aGlsZSAocmMgIT0gcnApIHsKICAgICAgICAgLyogcHVs
bCByZXF1ZXN0IGZyb20gcmluZyAqLwotICAgICAgICBpZiAoUklOR19SRVFVRVNUX0NPTlNfT1ZF
UkZMT1coJmJsa2Rldi0+cmluZ3MuY29tbW9uLCByYykpIHsKKyAgICAgICAgaWYgKFJJTkdfUkVR
VUVTVF9DT05TX09WRVJGTE9XKCZkYXRhcGxhbmUtPnJpbmdzLmNvbW1vbiwgcmMpKSB7CiAgICAg
ICAgICAgICBicmVhazsKICAgICAgICAgfQotICAgICAgICBpb3JlcSA9IGlvcmVxX3N0YXJ0KGJs
a2Rldik7CisgICAgICAgIGlvcmVxID0gaW9yZXFfc3RhcnQoZGF0YXBsYW5lKTsKICAgICAgICAg
aWYgKGlvcmVxID09IE5VTEwpIHsKLSAgICAgICAgICAgIGJsa2Rldi0+bW9yZV93b3JrKys7Cisg
ICAgICAgICAgICBkYXRhcGxhbmUtPm1vcmVfd29yaysrOwogICAgICAgICAgICAgYnJlYWs7CiAg
ICAgICAgIH0KLSAgICAgICAgYmxrX2dldF9yZXF1ZXN0KGJsa2RldiwgaW9yZXEsIHJjKTsKLSAg
ICAgICAgYmxrZGV2LT5yaW5ncy5jb21tb24ucmVxX2NvbnMgPSArK3JjOworICAgICAgICBibGtf
Z2V0X3JlcXVlc3QoZGF0YXBsYW5lLCBpb3JlcSwgcmMpOworICAgICAgICBkYXRhcGxhbmUtPnJp
bmdzLmNvbW1vbi5yZXFfY29ucyA9ICsrcmM7CiAKICAgICAgICAgLyogcGFyc2UgdGhlbSAqLwog
ICAgICAgICBpZiAoaW9yZXFfcGFyc2UoaW9yZXEpICE9IDApIHsKIAogICAgICAgICAgICAgc3dp
dGNoIChpb3JlcS0+cmVxLm9wZXJhdGlvbikgewogICAgICAgICAgICAgY2FzZSBCTEtJRl9PUF9S
RUFEOgotICAgICAgICAgICAgICAgIGJsb2NrX2FjY3RfaW52YWxpZChibGtfZ2V0X3N0YXRzKGJs
a2Rldi0+YmxrKSwKKyAgICAgICAgICAgICAgICBibG9ja19hY2N0X2ludmFsaWQoYmxrX2dldF9z
dGF0cyhkYXRhcGxhbmUtPmJsayksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEJMT0NLX0FDQ1RfUkVBRCk7CiAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICBj
YXNlIEJMS0lGX09QX1dSSVRFOgotICAgICAgICAgICAgICAgIGJsb2NrX2FjY3RfaW52YWxpZChi
bGtfZ2V0X3N0YXRzKGJsa2Rldi0+YmxrKSwKKyAgICAgICAgICAgICAgICBibG9ja19hY2N0X2lu
dmFsaWQoYmxrX2dldF9zdGF0cyhkYXRhcGxhbmUtPmJsayksCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEJMT0NLX0FDQ1RfV1JJVEUpOwogICAgICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICAgY2FzZSBCTEtJRl9PUF9GTFVTSF9ESVNLQ0FDSEU6Ci0gICAgICAgICAg
ICAgICAgYmxvY2tfYWNjdF9pbnZhbGlkKGJsa19nZXRfc3RhdHMoYmxrZGV2LT5ibGspLAorICAg
ICAgICAgICAgICAgIGJsb2NrX2FjY3RfaW52YWxpZChibGtfZ2V0X3N0YXRzKGRhdGFwbGFuZS0+
YmxrKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQkxPQ0tfQUNDVF9GTFVT
SCk7CiAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg
ICAgICAgfTsKIAogICAgICAgICAgICAgaWYgKGJsa19zZW5kX3Jlc3BvbnNlX29uZShpb3JlcSkp
IHsKLSAgICAgICAgICAgICAgICB4ZW5fZGV2aWNlX25vdGlmeV9ldmVudF9jaGFubmVsKGJsa2Rl
di0+eGVuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYmxrZGV2LT5ldmVudF9jaGFubmVsKTsKKyAgICAgICAgICAgICAgICB4ZW5fZGV2aWNlX25v
dGlmeV9ldmVudF9jaGFubmVsKGRhdGFwbGFuZS0+eGVuZGV2LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXBsYW5lLT5ldmVudF9jaGFubmVsKTsK
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgIGlvcmVxX3JlbGVhc2UoaW9yZXEsIGZhbHNlKTsK
ICAgICAgICAgICAgIGNvbnRpbnVlOwpAQCAtNTUzLDExMSArNTY2LDExMiBAQCBzdGF0aWMgdm9p
ZCBibGtfaGFuZGxlX3JlcXVlc3RzKHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldikKICAgICAgICAg
aW9yZXFfcnVuaW9fcWVtdV9haW8oaW9yZXEpOwogICAgIH0KIAotICAgIGlmIChibGtkZXYtPm1v
cmVfd29yayAmJiBibGtkZXYtPnJlcXVlc3RzX2luZmxpZ2h0IDwgYmxrZGV2LT5tYXhfcmVxdWVz
dHMpIHsKLSAgICAgICAgcWVtdV9iaF9zY2hlZHVsZShibGtkZXYtPmJoKTsKKyAgICBpZiAoZGF0
YXBsYW5lLT5tb3JlX3dvcmsgJiYKKyAgICAgICAgZGF0YXBsYW5lLT5yZXF1ZXN0c19pbmZsaWdo
dCA8IGRhdGFwbGFuZS0+bWF4X3JlcXVlc3RzKSB7CisgICAgICAgIHFlbXVfYmhfc2NoZWR1bGUo
ZGF0YXBsYW5lLT5iaCk7CiAgICAgfQogfQogCiBzdGF0aWMgdm9pZCBibGtfYmgodm9pZCAqb3Bh
cXVlKQogewotICAgIHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldiA9IG9wYXF1ZTsKKyAgICBYZW5R
ZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lID0gb3BhcXVlOwogCi0gICAgYWlvX2NvbnRleHRfYWNx
dWlyZShibGtkZXYtPmN0eCk7Ci0gICAgYmxrX2hhbmRsZV9yZXF1ZXN0cyhibGtkZXYpOwotICAg
IGFpb19jb250ZXh0X3JlbGVhc2UoYmxrZGV2LT5jdHgpOworICAgIGFpb19jb250ZXh0X2FjcXVp
cmUoZGF0YXBsYW5lLT5jdHgpOworICAgIGJsa19oYW5kbGVfcmVxdWVzdHMoZGF0YXBsYW5lKTsK
KyAgICBhaW9fY29udGV4dF9yZWxlYXNlKGRhdGFwbGFuZS0+Y3R4KTsKIH0KIAogc3RhdGljIHZv
aWQgYmxrX2V2ZW50KHZvaWQgKm9wYXF1ZSkKIHsKLSAgICBzdHJ1Y3QgWGVuQmxrRGV2ICpibGtk
ZXYgPSBvcGFxdWU7CisgICAgWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSA9IG9wYXF1ZTsK
IAotICAgIHFlbXVfYmhfc2NoZWR1bGUoYmxrZGV2LT5iaCk7CisgICAgcWVtdV9iaF9zY2hlZHVs
ZShkYXRhcGxhbmUtPmJoKTsKIH0KIAotc3RydWN0IFhlbkJsa0RldiAqeGVuX3FkaXNrX2RhdGFw
bGFuZV9jcmVhdGUoWGVuRGV2aWNlICp4ZW5kZXYsCitYZW5RZGlza0RhdGFQbGFuZSAqeGVuX3Fk
aXNrX2RhdGFwbGFuZV9jcmVhdGUoWGVuRGV2aWNlICp4ZW5kZXYsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCbG9ja0NvbmYgKmNvbmYsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJT1RocmVhZCAqaW90aHJlYWQpCiB7
Ci0gICAgc3RydWN0IFhlbkJsa0RldiAqYmxrZGV2ID0gZ19uZXcwKHN0cnVjdCBYZW5CbGtEZXYs
IDEpOworICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUgPSBnX25ldzAoWGVuUWRpc2tE
YXRhUGxhbmUsIDEpOwogCi0gICAgYmxrZGV2LT54ZW5kZXYgPSB4ZW5kZXY7Ci0gICAgYmxrZGV2
LT5maWxlX2JsayA9IGNvbmYtPmxvZ2ljYWxfYmxvY2tfc2l6ZTsKLSAgICBibGtkZXYtPmJsayA9
IGNvbmYtPmJsazsKLSAgICBibGtkZXYtPmZpbGVfc2l6ZSA9IGJsa19nZXRsZW5ndGgoYmxrZGV2
LT5ibGspOworICAgIGRhdGFwbGFuZS0+eGVuZGV2ID0geGVuZGV2OworICAgIGRhdGFwbGFuZS0+
ZmlsZV9ibGsgPSBjb25mLT5sb2dpY2FsX2Jsb2NrX3NpemU7CisgICAgZGF0YXBsYW5lLT5ibGsg
PSBjb25mLT5ibGs7CisgICAgZGF0YXBsYW5lLT5maWxlX3NpemUgPSBibGtfZ2V0bGVuZ3RoKGRh
dGFwbGFuZS0+YmxrKTsKIAotICAgIFFMSVNUX0lOSVQoJmJsa2Rldi0+aW5mbGlnaHQpOwotICAg
IFFMSVNUX0lOSVQoJmJsa2Rldi0+ZmluaXNoZWQpOwotICAgIFFMSVNUX0lOSVQoJmJsa2Rldi0+
ZnJlZWxpc3QpOworICAgIFFMSVNUX0lOSVQoJmRhdGFwbGFuZS0+aW5mbGlnaHQpOworICAgIFFM
SVNUX0lOSVQoJmRhdGFwbGFuZS0+ZmluaXNoZWQpOworICAgIFFMSVNUX0lOSVQoJmRhdGFwbGFu
ZS0+ZnJlZWxpc3QpOwogCiAgICAgaWYgKGlvdGhyZWFkKSB7Ci0gICAgICAgIGJsa2Rldi0+aW90
aHJlYWQgPSBpb3RocmVhZDsKLSAgICAgICAgb2JqZWN0X3JlZihPQkpFQ1QoYmxrZGV2LT5pb3Ro
cmVhZCkpOwotICAgICAgICBibGtkZXYtPmN0eCA9IGlvdGhyZWFkX2dldF9haW9fY29udGV4dChi
bGtkZXYtPmlvdGhyZWFkKTsKKyAgICAgICAgZGF0YXBsYW5lLT5pb3RocmVhZCA9IGlvdGhyZWFk
OworICAgICAgICBvYmplY3RfcmVmKE9CSkVDVChkYXRhcGxhbmUtPmlvdGhyZWFkKSk7CisgICAg
ICAgIGRhdGFwbGFuZS0+Y3R4ID0gaW90aHJlYWRfZ2V0X2Fpb19jb250ZXh0KGRhdGFwbGFuZS0+
aW90aHJlYWQpOwogICAgIH0gZWxzZSB7Ci0gICAgICAgIGJsa2Rldi0+Y3R4ID0gcWVtdV9nZXRf
YWlvX2NvbnRleHQoKTsKKyAgICAgICAgZGF0YXBsYW5lLT5jdHggPSBxZW11X2dldF9haW9fY29u
dGV4dCgpOwogICAgIH0KLSAgICBibGtkZXYtPmJoID0gYWlvX2JoX25ldyhibGtkZXYtPmN0eCwg
YmxrX2JoLCBibGtkZXYpOworICAgIGRhdGFwbGFuZS0+YmggPSBhaW9fYmhfbmV3KGRhdGFwbGFu
ZS0+Y3R4LCBibGtfYmgsIGRhdGFwbGFuZSk7CiAKLSAgICByZXR1cm4gYmxrZGV2OworICAgIHJl
dHVybiBkYXRhcGxhbmU7CiB9CiAKLXZvaWQgeGVuX3FkaXNrX2RhdGFwbGFuZV9kZXN0cm95KHN0
cnVjdCBYZW5CbGtEZXYgKmJsa2RldikKK3ZvaWQgeGVuX3FkaXNrX2RhdGFwbGFuZV9kZXN0cm95
KFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUpCiB7CiAgICAgc3RydWN0IGlvcmVxICppb3Jl
cTsKIAotICAgIGlmICghYmxrZGV2KSB7CisgICAgaWYgKCFkYXRhcGxhbmUpIHsKICAgICAgICAg
cmV0dXJuOwogICAgIH0KIAotICAgIHdoaWxlICghUUxJU1RfRU1QVFkoJmJsa2Rldi0+ZnJlZWxp
c3QpKSB7Ci0gICAgICAgIGlvcmVxID0gUUxJU1RfRklSU1QoJmJsa2Rldi0+ZnJlZWxpc3QpOwor
ICAgIHdoaWxlICghUUxJU1RfRU1QVFkoJmRhdGFwbGFuZS0+ZnJlZWxpc3QpKSB7CisgICAgICAg
IGlvcmVxID0gUUxJU1RfRklSU1QoJmRhdGFwbGFuZS0+ZnJlZWxpc3QpOwogICAgICAgICBRTElT
VF9SRU1PVkUoaW9yZXEsIGxpc3QpOwogICAgICAgICBxZW11X2lvdmVjX2Rlc3Ryb3koJmlvcmVx
LT52KTsKICAgICAgICAgZ19mcmVlKGlvcmVxKTsKICAgICB9CiAKLSAgICBxZW11X2JoX2RlbGV0
ZShibGtkZXYtPmJoKTsKLSAgICBpZiAoYmxrZGV2LT5pb3RocmVhZCkgewotICAgICAgICBvYmpl
Y3RfdW5yZWYoT0JKRUNUKGJsa2Rldi0+aW90aHJlYWQpKTsKKyAgICBxZW11X2JoX2RlbGV0ZShk
YXRhcGxhbmUtPmJoKTsKKyAgICBpZiAoZGF0YXBsYW5lLT5pb3RocmVhZCkgeworICAgICAgICBv
YmplY3RfdW5yZWYoT0JKRUNUKGRhdGFwbGFuZS0+aW90aHJlYWQpKTsKICAgICB9CiAKLSAgICBn
X2ZyZWUoYmxrZGV2KTsKKyAgICBnX2ZyZWUoZGF0YXBsYW5lKTsKIH0KIAotdm9pZCB4ZW5fcWRp
c2tfZGF0YXBsYW5lX3N0YXJ0KHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldiwKK3ZvaWQgeGVuX3Fk
aXNrX2RhdGFwbGFuZV9zdGFydChYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVuc2lnbmVkIGludCByaW5nX3JlZltdLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBucl9yaW5nX3JlZiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgZXZlbnRfY2hhbm5l
bCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgcHJvdG9jb2wp
CiB7Ci0gICAgWGVuRGV2aWNlICp4ZW5kZXYgPSBibGtkZXYtPnhlbmRldjsKKyAgICBYZW5EZXZp
Y2UgKnhlbmRldiA9IGRhdGFwbGFuZS0+eGVuZGV2OwogICAgIHVuc2lnbmVkIGludCByaW5nX3Np
emU7CiAgICAgdW5zaWduZWQgaW50IGk7CiAKLSAgICBibGtkZXYtPm5yX3JpbmdfcmVmID0gbnJf
cmluZ19yZWY7Ci0gICAgYmxrZGV2LT5yaW5nX3JlZiA9IGdfbmV3KHVuc2lnbmVkIGludCwgbnJf
cmluZ19yZWYpOworICAgIGRhdGFwbGFuZS0+bnJfcmluZ19yZWYgPSBucl9yaW5nX3JlZjsKKyAg
ICBkYXRhcGxhbmUtPnJpbmdfcmVmID0gZ19uZXcodW5zaWduZWQgaW50LCBucl9yaW5nX3JlZik7
CiAKICAgICBmb3IgKGkgPSAwOyBpIDwgbnJfcmluZ19yZWY7IGkrKykgewotICAgICAgICBibGtk
ZXYtPnJpbmdfcmVmW2ldID0gcmluZ19yZWZbaV07CisgICAgICAgIGRhdGFwbGFuZS0+cmluZ19y
ZWZbaV0gPSByaW5nX3JlZltpXTsKICAgICB9CiAKLSAgICBibGtkZXYtPnByb3RvY29sID0gcHJv
dG9jb2w7CisgICAgZGF0YXBsYW5lLT5wcm90b2NvbCA9IHByb3RvY29sOwogCi0gICAgcmluZ19z
aXplID0gWENfUEFHRV9TSVpFICogYmxrZGV2LT5ucl9yaW5nX3JlZjsKLSAgICBzd2l0Y2ggKGJs
a2Rldi0+cHJvdG9jb2wpIHsKKyAgICByaW5nX3NpemUgPSBYQ19QQUdFX1NJWkUgKiBkYXRhcGxh
bmUtPm5yX3JpbmdfcmVmOworICAgIHN3aXRjaCAoZGF0YXBsYW5lLT5wcm90b2NvbCkgewogICAg
IGNhc2UgQkxLSUZfUFJPVE9DT0xfTkFUSVZFOgogICAgIHsKLSAgICAgICAgYmxrZGV2LT5tYXhf
cmVxdWVzdHMgPSBfX0NPTlNUX1JJTkdfU0laRShibGtpZiwgcmluZ19zaXplKTsKKyAgICAgICAg
ZGF0YXBsYW5lLT5tYXhfcmVxdWVzdHMgPSBfX0NPTlNUX1JJTkdfU0laRShibGtpZiwgcmluZ19z
aXplKTsKICAgICAgICAgYnJlYWs7CiAgICAgfQogICAgIGNhc2UgQkxLSUZfUFJPVE9DT0xfWDg2
XzMyOgogICAgIHsKLSAgICAgICAgYmxrZGV2LT5tYXhfcmVxdWVzdHMgPSBfX0NPTlNUX1JJTkdf
U0laRShibGtpZl94ODZfMzIsIHJpbmdfc2l6ZSk7CisgICAgICAgIGRhdGFwbGFuZS0+bWF4X3Jl
cXVlc3RzID0gX19DT05TVF9SSU5HX1NJWkUoYmxraWZfeDg2XzMyLCByaW5nX3NpemUpOwogICAg
ICAgICBicmVhazsKICAgICB9CiAgICAgY2FzZSBCTEtJRl9QUk9UT0NPTF9YODZfNjQ6CiAgICAg
ewotICAgICAgICBibGtkZXYtPm1heF9yZXF1ZXN0cyA9IF9fQ09OU1RfUklOR19TSVpFKGJsa2lm
X3g4Nl82NCwgcmluZ19zaXplKTsKKyAgICAgICAgZGF0YXBsYW5lLT5tYXhfcmVxdWVzdHMgPSBf
X0NPTlNUX1JJTkdfU0laRShibGtpZl94ODZfNjQsIHJpbmdfc2l6ZSk7CiAgICAgICAgIGJyZWFr
OwogICAgIH0KICAgICBkZWZhdWx0OgpAQCAtNjY1LDc2ICs2NzksNzYgQEAgdm9pZCB4ZW5fcWRp
c2tfZGF0YXBsYW5lX3N0YXJ0KHN0cnVjdCBYZW5CbGtEZXYgKmJsa2RldiwKICAgICAgICAgYnJl
YWs7CiAgICAgfQogCi0gICAgeGVuX2RldmljZV9zZXRfbWF4X2dyYW50X3JlZnMoeGVuZGV2LCBi
bGtkZXYtPm5yX3JpbmdfcmVmLAorICAgIHhlbl9kZXZpY2Vfc2V0X21heF9ncmFudF9yZWZzKHhl
bmRldiwgZGF0YXBsYW5lLT5ucl9yaW5nX3JlZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAmZXJyb3JfZmF0YWwpOwogCi0gICAgYmxrZGV2LT5zcmluZyA9IHhlbl9kZXZpY2Vf
bWFwX2dyYW50X3JlZnMoeGVuZGV2LAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGJsa2Rldi0+cmluZ19yZWYsCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgYmxrZGV2LT5ucl9yaW5nX3JlZiwKKyAgICBkYXRhcGxhbmUt
PnNyaW5nID0geGVuX2RldmljZV9tYXBfZ3JhbnRfcmVmcyh4ZW5kZXYsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXBsYW5lLT5yaW5nX3JlZiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhcGxhbmUtPm5y
X3JpbmdfcmVmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFBST1RfUkVBRCB8IFBST1RfV1JJVEUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgJmVycm9yX2ZhdGFsKTsKIAotICAgIHN3aXRjaCAoYmxrZGV2LT5wcm90
b2NvbCkgeworICAgIHN3aXRjaCAoZGF0YXBsYW5lLT5wcm90b2NvbCkgewogICAgIGNhc2UgQkxL
SUZfUFJPVE9DT0xfTkFUSVZFOgogICAgIHsKLSAgICAgICAgYmxraWZfc3JpbmdfdCAqc3Jpbmdf
bmF0aXZlID0gYmxrZGV2LT5zcmluZzsKKyAgICAgICAgYmxraWZfc3JpbmdfdCAqc3JpbmdfbmF0
aXZlID0gZGF0YXBsYW5lLT5zcmluZzsKIAotICAgICAgICBCQUNLX1JJTkdfSU5JVCgmYmxrZGV2
LT5yaW5ncy5uYXRpdmUsIHNyaW5nX25hdGl2ZSwgcmluZ19zaXplKTsKKyAgICAgICAgQkFDS19S
SU5HX0lOSVQoJmRhdGFwbGFuZS0+cmluZ3MubmF0aXZlLCBzcmluZ19uYXRpdmUsIHJpbmdfc2l6
ZSk7CiAgICAgICAgIGJyZWFrOwogICAgIH0KICAgICBjYXNlIEJMS0lGX1BST1RPQ09MX1g4Nl8z
MjoKICAgICB7Ci0gICAgICAgIGJsa2lmX3g4Nl8zMl9zcmluZ190ICpzcmluZ194ODZfMzIgPSBi
bGtkZXYtPnNyaW5nOworICAgICAgICBibGtpZl94ODZfMzJfc3JpbmdfdCAqc3JpbmdfeDg2XzMy
ID0gZGF0YXBsYW5lLT5zcmluZzsKIAotICAgICAgICBCQUNLX1JJTkdfSU5JVCgmYmxrZGV2LT5y
aW5ncy54ODZfMzJfcGFydCwgc3JpbmdfeDg2XzMyLAorICAgICAgICBCQUNLX1JJTkdfSU5JVCgm
ZGF0YXBsYW5lLT5yaW5ncy54ODZfMzJfcGFydCwgc3JpbmdfeDg2XzMyLAogICAgICAgICAgICAg
ICAgICAgICAgICByaW5nX3NpemUpOwogICAgICAgICBicmVhazsKICAgICB9CiAgICAgY2FzZSBC
TEtJRl9QUk9UT0NPTF9YODZfNjQ6CiAgICAgewotICAgICAgICBibGtpZl94ODZfNjRfc3Jpbmdf
dCAqc3JpbmdfeDg2XzY0ID0gYmxrZGV2LT5zcmluZzsKKyAgICAgICAgYmxraWZfeDg2XzY0X3Ny
aW5nX3QgKnNyaW5nX3g4Nl82NCA9IGRhdGFwbGFuZS0+c3Jpbmc7CiAKLSAgICAgICAgQkFDS19S
SU5HX0lOSVQoJmJsa2Rldi0+cmluZ3MueDg2XzY0X3BhcnQsIHNyaW5nX3g4Nl82NCwKKyAgICAg
ICAgQkFDS19SSU5HX0lOSVQoJmRhdGFwbGFuZS0+cmluZ3MueDg2XzY0X3BhcnQsIHNyaW5nX3g4
Nl82NCwKICAgICAgICAgICAgICAgICAgICAgICAgcmluZ19zaXplKTsKICAgICAgICAgYnJlYWs7
CiAgICAgfQogICAgIH0KIAotICAgIGJsa2Rldi0+ZXZlbnRfY2hhbm5lbCA9CisgICAgZGF0YXBs
YW5lLT5ldmVudF9jaGFubmVsID0KICAgICAgICAgeGVuX2RldmljZV9iaW5kX2V2ZW50X2NoYW5u
ZWwoeGVuZGV2LCBldmVudF9jaGFubmVsLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBibGtfZXZlbnQsIGJsa2RldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYmxrX2V2ZW50LCBkYXRhcGxhbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZlcnJvcl9mYXRhbCk7CiAKLSAgICBhaW9fY29udGV4dF9hY3F1aXJlKGJs
a2Rldi0+Y3R4KTsKLSAgICBibGtfc2V0X2Fpb19jb250ZXh0KGJsa2Rldi0+YmxrLCBibGtkZXYt
PmN0eCk7Ci0gICAgYWlvX2NvbnRleHRfcmVsZWFzZShibGtkZXYtPmN0eCk7CisgICAgYWlvX2Nv
bnRleHRfYWNxdWlyZShkYXRhcGxhbmUtPmN0eCk7CisgICAgYmxrX3NldF9haW9fY29udGV4dChk
YXRhcGxhbmUtPmJsaywgZGF0YXBsYW5lLT5jdHgpOworICAgIGFpb19jb250ZXh0X3JlbGVhc2Uo
ZGF0YXBsYW5lLT5jdHgpOwogfQogCi12b2lkIHhlbl9xZGlza19kYXRhcGxhbmVfc3RvcChzdHJ1
Y3QgWGVuQmxrRGV2ICpibGtkZXYpCit2b2lkIHhlbl9xZGlza19kYXRhcGxhbmVfc3RvcChYZW5R
ZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lKQogewogICAgIFhlbkRldmljZSAqeGVuZGV2OwogCi0g
ICAgaWYgKCFibGtkZXYpIHsKKyAgICBpZiAoIWRhdGFwbGFuZSkgewogICAgICAgICByZXR1cm47
CiAgICAgfQogCi0gICAgYWlvX2NvbnRleHRfYWNxdWlyZShibGtkZXYtPmN0eCk7Ci0gICAgYmxr
X3NldF9haW9fY29udGV4dChibGtkZXYtPmJsaywgcWVtdV9nZXRfYWlvX2NvbnRleHQoKSk7Ci0g
ICAgYWlvX2NvbnRleHRfcmVsZWFzZShibGtkZXYtPmN0eCk7CisgICAgYWlvX2NvbnRleHRfYWNx
dWlyZShkYXRhcGxhbmUtPmN0eCk7CisgICAgYmxrX3NldF9haW9fY29udGV4dChkYXRhcGxhbmUt
PmJsaywgcWVtdV9nZXRfYWlvX2NvbnRleHQoKSk7CisgICAgYWlvX2NvbnRleHRfcmVsZWFzZShk
YXRhcGxhbmUtPmN0eCk7CiAKLSAgICB4ZW5kZXYgPSBibGtkZXYtPnhlbmRldjsKKyAgICB4ZW5k
ZXYgPSBkYXRhcGxhbmUtPnhlbmRldjsKIAotICAgIGlmIChibGtkZXYtPmV2ZW50X2NoYW5uZWwp
IHsKLSAgICAgICAgeGVuX2RldmljZV91bmJpbmRfZXZlbnRfY2hhbm5lbCh4ZW5kZXYsIGJsa2Rl
di0+ZXZlbnRfY2hhbm5lbCk7Ci0gICAgICAgIGJsa2Rldi0+ZXZlbnRfY2hhbm5lbCA9IE5VTEw7
CisgICAgaWYgKGRhdGFwbGFuZS0+ZXZlbnRfY2hhbm5lbCkgeworICAgICAgICB4ZW5fZGV2aWNl
X3VuYmluZF9ldmVudF9jaGFubmVsKHhlbmRldiwgZGF0YXBsYW5lLT5ldmVudF9jaGFubmVsKTsK
KyAgICAgICAgZGF0YXBsYW5lLT5ldmVudF9jaGFubmVsID0gTlVMTDsKICAgICB9CiAKLSAgICBp
ZiAoYmxrZGV2LT5zcmluZykgewotICAgICAgICB4ZW5fZGV2aWNlX3VubWFwX2dyYW50X3JlZnMo
eGVuZGV2LCBibGtkZXYtPnNyaW5nLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgYmxrZGV2LT5ucl9yaW5nX3JlZiwgJmVycm9yX2ZhdGFsKTsKLSAgICAgICAgYmxrZGV2LT5z
cmluZyA9IE5VTEw7CisgICAgaWYgKGRhdGFwbGFuZS0+c3JpbmcpIHsKKyAgICAgICAgeGVuX2Rl
dmljZV91bm1hcF9ncmFudF9yZWZzKHhlbmRldiwgZGF0YXBsYW5lLT5zcmluZywKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFwbGFuZS0+bnJfcmluZ19yZWYsICZlcnJv
cl9mYXRhbCk7CisgICAgICAgIGRhdGFwbGFuZS0+c3JpbmcgPSBOVUxMOwogICAgIH0KIAotICAg
IGdfZnJlZShibGtkZXYtPnJpbmdfcmVmKTsKLSAgICBibGtkZXYtPnJpbmdfcmVmID0gTlVMTDsK
KyAgICBnX2ZyZWUoZGF0YXBsYW5lLT5yaW5nX3JlZik7CisgICAgZGF0YXBsYW5lLT5yaW5nX3Jl
ZiA9IE5VTEw7CiB9CmRpZmYgLS1naXQgYS9ody9ibG9jay9kYXRhcGxhbmUveGVuLXFkaXNrLmgg
Yi9ody9ibG9jay9kYXRhcGxhbmUveGVuLXFkaXNrLmgKaW5kZXggMTZiY2Q1MDBiZi4uY2ZhNTU1
YWY2MSAxMDA2NDQKLS0tIGEvaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1xZGlzay5oCisrKyBiL2h3
L2Jsb2NrL2RhdGFwbGFuZS94ZW4tcWRpc2suaApAQCAtOSw3ICs5LDcgQEAKICNpbmNsdWRlICJo
dy94ZW4veGVuLWJ1cy5oIgogI2luY2x1ZGUgInN5c2VtdS9pb3RocmVhZC5oIgogCi10eXBlZGVm
IHN0cnVjdCBYZW5CbGtEZXYgWGVuUWRpc2tEYXRhUGxhbmU7Cit0eXBlZGVmIHN0cnVjdCBYZW5R
ZGlza0RhdGFQbGFuZSBYZW5RZGlza0RhdGFQbGFuZTsKIAogWGVuUWRpc2tEYXRhUGxhbmUgKnhl
bl9xZGlza19kYXRhcGxhbmVfY3JlYXRlKFhlbkRldmljZSAqeGVuZGV2LAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJsb2NrQ29uZiAqY29uZiwKLS0gCjIu
MTEuMAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fClhl
bi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBz
Oi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2ZWw=
