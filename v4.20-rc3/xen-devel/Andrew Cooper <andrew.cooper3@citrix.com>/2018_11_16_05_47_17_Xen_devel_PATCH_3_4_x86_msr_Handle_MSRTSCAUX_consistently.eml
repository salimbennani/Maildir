Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 16 Nov 2018 00:30:09 -0000
Received: from icoremail.net (unknown [209.85.210.175])
	by mail-app2 (Coremail) with SMTP id by_KCgDnX+8B6u1bCVKdAQ--.47493S3;
	Fri, 16 Nov 2018 05:49:53 +0800 (CST)
Received: from mail-pf1-f175.google.com (unknown [209.85.210.175])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwC3l0P86e1blb5FAA--.1183S3;
	Fri, 16 Nov 2018 05:49:48 +0800 (CST)
Received: by mail-pf1-f175.google.com with SMTP id b85so3501394pfc.3
        for <xuliker@zju.edu.cn>; Thu, 15 Nov 2018 13:49:48 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=BD91JXkEADB9oGhJi0q24B8e23r7KrSBBXbv0jmRkQU=;
        b=m8PP/M6E4+ph+EknKKhhGKdjCzNa06oYrmiV0O3f8MuCr27HP0MfzJznPx7CKfyyBI
         d1wBEwQMhTZ20QjRtn8fdZ9GbYmQPe+wBs5nokSNZvL1/WSoc/rQ2E6d77UxfX80CEvd
         TnHD3OifJxla8ZitZ4jygrZ2tm3GreFolHmtF1yyYCbYoLtAUXA7GMMzk/d0Mg1p6wzQ
         KvfsjgCdN+FcYmS/Tmh9NJbktGcjaOMzhL6lJCUReb8x7bmlBu3NgLr4YdGmxR0B3NLa
         iCwvJwmvxWBkelJVTVcPWzGkhd/7ISKiwK4i6h15jNvpYp55P/FYKyI19GkACQOThJMe
         sOEg==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gJhQihYk6T1r3FQVv5lFDk4Q9Gri3YzbGFC+ROdFD0NVBw294gb
	sg42p85/Vpy1JXqdQoDfCVmj/01s+edpF1U12XYS9ShYr2C5oeoDsw==
X-Received: by 2002:a63:4044:: with SMTP id n65mr7225105pga.90.1542318587816;
        Thu, 15 Nov 2018 13:49:47 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp1115271pju;
        Thu, 15 Nov 2018 13:49:46 -0800 (PST)
X-Google-Smtp-Source: AJdET5cvzPKWfaEv4g3X9PbxLsR4xRiwKtWBolYpJ8jWXMF9Hq84Jhr8662HD+Pi2UqimqJ00oYL
X-Received: by 2002:a81:150e:: with SMTP id 14-v6mr7678481ywv.23.1542318586430;
        Thu, 15 Nov 2018 13:49:46 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542318586; cv=none;
        d=google.com; s=arc-20160816;
        b=Y3NoZJLTKvLBB1Am9BelcDWLbMavytr8xdfWGQtQ58RQndp9rHFaKvGOYpxuUfAoQi
         Mj9YBQSl20+5zz4OeTxxu3E5clHSYFD96uCjrsm7NnwYEKK/3dtOxT6gFdVhuw2Ggd7L
         E1YIpXWnuq39OsSBQ7fxy9/ZnGSSjMhs6tP/yBxBhEMfNCJ5lvljRa+EkkWcqS+l8grZ
         9AlgenJM2eoVFxOFy/E5K615r25S4WBbDgTP9C3wbU0rk9DrzZhp5Tv5q6qTCRV1XiKc
         HpMzkAVlmmH85bBULzIP/o54QT1ko84UN4H9oeisadUg4gxY5hOrVvp/9nkq4k6PM9wt
         J6fA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=BD91JXkEADB9oGhJi0q24B8e23r7KrSBBXbv0jmRkQU=;
        b=gLxpo8z1fyAYKHWuixRwGX1ET6DQUVJfO7/7WiiABWlOoz+rMSlMkdzn0eioUZ8hW5
         6/Bq4btzZ8NxVMgh5i0P4yt8Ab174Qv2vviADd1Cw3rliRVg1pilIzbYvrPmIh0i+W45
         NaSUZc+2rgFL/srZJUlU2V/y3z4RHNAJNknANMi/+yQGgToN52r40bt8BHd/14a2tHf5
         c9BxHBlz63xvCqw6MnWXdUuzlZ+atynna1gefGNE45rbATbf8QB9lXbJlkzvmMB3qyW/
         Mg7vTAtlqr3dNc9P0gjdZwcN1cLQMCMLikxmKeEGSglj5qcbukCK3BNrIjCj9FE5K5k4
         ltMQ==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id x64-v6si16216567yba.58.2018.11.15.13.49.45
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Thu, 15 Nov 2018 13:49:46 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gNPU9-0000dB-SY; Thu, 15 Nov 2018 21:47:37 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=verr=n2=citrix.com=prvs=850f8f69e=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1gNPU8-0000ca-5h
 for xen-devel@lists.xen.org; Thu, 15 Nov 2018 21:47:36 +0000
X-Inumbo-ID: 0fdaf1a9-e920-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 0fdaf1a9-e920-11e8-9a16-bc764e045a96;
 Thu, 15 Nov 2018 21:47:34 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,237,1539648000"; d="scan'208";a="70715791"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xen.org>
Date: Thu, 15 Nov 2018 21:47:17 +0000
Message-ID: <1542318438-20319-4-git-send-email-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.1.4
In-Reply-To: <1542318438-20319-1-git-send-email-andrew.cooper3@citrix.com>
References: <1542318438-20319-1-git-send-email-andrew.cooper3@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 3/4] x86/msr: Handle MSR_TSC_AUX consistently
 for PV and HVM guests
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>, Wei Liu <wei.liu2@citrix.com>,
 Jan Beulich <JBeulich@suse.com>,
 Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>,
 Boris Ostrovsky <boris.ostrovsky@oracle.com>,
 Brian Woods <brian.woods@amd.com>,
 Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwC3l0P86e1blb5FAA--.1183S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoWxKFWfWrWfCFWxJrW3Zw4xJFb_yoWfWw1Dp3
	ZrArn5WrsFg3s5Jas3tF18uw15Ca95KFyxXr43uas8Z34qgwnIyr1rta1j9FyxZF4rAr1f
	Zr1jgr18W3W7Aw7anT9S1TB71UUUUUUqnTZGkaVYY2UrUUUUjbIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUl2b7Iv0xC_Cr1lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Xr0_Ar1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Gr0_Cr1l84ACjcxK6I8E
	87Iv67AKxVW0oVCq3wA2z4x0Y4vEx4A2jsIEc7CjxVAFwI0_GcCE3s1lnx0E6VACY4xI67
	k04243AVACY4xI67k04243AVAKzVAKj4xI6x02cVCv0xWle2I262IYc4CY6c8Ij28IcVAa
	Y2xG8wAqx4xG64xvF2IEw4CE5I8CrVC2j2WlYx0E2Ix0cI8IcVAFwI0_Jr0_Jr4lYx0Ex4
	A2jsIE14v26r4j6F4UMcvjeVCFs4IE7xkEbVWUJVW8JwACjcxG0xvY0x0EwIxGrwACY4xI
	67k04243AVAKzVAKj4xxMx02cVCv0xWlc7CjxVAKzI0EY4vE52x082I5MxkFs20EY4vE44
	CYbxCE4x80FwCY02Avz4vEIxC_CwCY0x0Ix7I2Y4AK64vIr41lcIIF0xvE2Ix0cI8IcVAF
	wI0_JFI_Gr1lcIIF0xvE2Ix0cI8IcVCY1x0267AKxVWUJVW8JwCYIxAIcVC2z280aVAFwI
	0_Gr1j6F4UJwCYIxAIcVC2z280aVCY1x0267AKxVW8Jr0_Cr1UMxAIw28IcxkI7VAKI48J
	MxAIw28IcVAKzI0EY4vE52x082I5MxCjnVCjjxCrMxC20s026xCaFVCjc4AY6r1j6r4UMI
	8I3I0E5I8CrVAFwI0_Jr0_Jr4lx2IqxVCjr7xvwVAFwI0_JrI_JrWlx4CE17CEb7AF67AK
	xVWUtVW8ZwCIc40Y0x0EwIxGrwCI42IY6xAIw20EY4v20xvaj40_Jr0_JF4l6VACY4xI67
	k04243AbIYCTnIWIevJa73UjIFyTuYvjxUhmL9UUUUU

V2l0aCBQVlJEVFNDUCBtb2RlIHJlbW92ZWQsIGhhbmRsaW5nIG9mIE1TUl9UU0NfQVVYIGNhbiBt
b3ZlIGludG8gdGhlIGNvbW1vbgpjb2RlLiAgTW92ZSBpdHMgc3RvcmFnZSBpbnRvIHN0cnVjdCB2
Y3B1X21zcnMgKGRyb3BwaW5nIHRoZSBIVk0tc3BlY2lmaWMKbXNyX3RzY19hdXgpLCBhbmQgYWRk
IGFuIFJEUElEIGZlYXR1cmUgY2hlY2sgYXMgdGhpcyBiaXQgYWxzbyBlbnVtZXJhdGVzIHRoZQpw
cmVzZW5jZSBvZiB0aGUgTVNSLgoKRHJvcCBodm1fbXNyX3RzY19hdXgoKSBlbnRpcmVseSwgYW5k
IHVzZSB2LT5hcmNoLm1zcnMtPnRzY19hdXggZGlyZWN0bHkuClVwZGF0ZSBodm1fbG9hZF9jcHVf
Y3R4dCgpIHRvIGNoZWNrIHRoYXQgdGhlIGluY29taW5nIGN0eHQubXNyX3RzY19hdXggaXNuJ3QK
b3V0IG9mIHJhbmdlLiAgSW4gcHJhY3RpY2UsIG5vIHByZXZpb3VzIHZlcnNpb24gb2YgWGVuIGV2
ZXIgd3JvdGUgYW4Kb3V0LW9mLXJhbmdlIHZhbHVlLiAgQWRkIE1TUl9UU0NfQVVYIHRvIHRoZSBs
aXN0IG9mIE1TUnMgbWlncmF0ZWQgZm9yIFBWCmd1ZXN0cy4KClNpZ25lZC1vZmYtYnk6IEFuZHJl
dyBDb29wZXIgPGFuZHJldy5jb29wZXIzQGNpdHJpeC5jb20+Ci0tLQpDQzogSmFuIEJldWxpY2gg
PEpCZXVsaWNoQHN1c2UuY29tPgpDQzogV2VpIExpdSA8d2VpLmxpdTJAY2l0cml4LmNvbT4KQ0M6
IFJvZ2VyIFBhdSBNb25uw6kgPHJvZ2VyLnBhdUBjaXRyaXguY29tPgpDQzogS29ucmFkIFJ6ZXN6
dXRlayBXaWxrIDxrb25yYWQud2lsa0BvcmFjbGUuY29tPgpDQzogSnVuIE5ha2FqaW1hIDxqdW4u
bmFrYWppbWFAaW50ZWwuY29tPgpDQzogS2V2aW4gVGlhbiA8a2V2aW4udGlhbkBpbnRlbC5jb20+
CkNDOiBCb3JpcyBPc3Ryb3Zza3kgPGJvcmlzLm9zdHJvdnNreUBvcmFjbGUuY29tPgpDQzogU3Vy
YXZlZSBTdXRoaWt1bHBhbml0IDxzdXJhdmVlLnN1dGhpa3VscGFuaXRAYW1kLmNvbT4KQ0M6IEJy
aWFuIFdvb2RzIDxicmlhbi53b29kc0BhbWQuY29tPgotLS0KIHhlbi9hcmNoL3g4Ni9kb21haW4u
YyAgICAgICAgICB8ICAzICstLQogeGVuL2FyY2gveDg2L2RvbWN0bC5jICAgICAgICAgIHwgIDIg
KysKIHhlbi9hcmNoL3g4Ni9odm0vaHZtLmMgICAgICAgICB8IDE4ICsrKysrLS0tLS0tLS0tLS0t
LQogeGVuL2FyY2gveDg2L2h2bS9zdm0vc3ZtLmMgICAgIHwgIDQgKystLQogeGVuL2FyY2gveDg2
L2h2bS92bXgvdm14LmMgICAgIHwgIDQgKystLQogeGVuL2FyY2gveDg2L21zci5jICAgICAgICAg
ICAgIHwgMTggKysrKysrKysrKysrKysrKysrCiB4ZW4vYXJjaC94ODYvcHYvZW11bC1wcml2LW9w
LmMgfCAgNCAtLS0tCiB4ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9odm0uaCAgfCAgNiAtLS0tLS0K
IHhlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3ZjcHUuaCB8ICAxIC0KIHhlbi9pbmNsdWRlL2FzbS14
ODYvbXNyLmggICAgICB8ICA4ICsrKysrKysrCiAxMCBmaWxlcyBjaGFuZ2VkLCAzOCBpbnNlcnRp
b25zKCspLCAzMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvZG9tYWlu
LmMgYi94ZW4vYXJjaC94ODYvZG9tYWluLmMKaW5kZXggMjk1YjEwYy4uMjA2N2EwYyAxMDA2NDQK
LS0tIGEveGVuL2FyY2gveDg2L2RvbWFpbi5jCisrKyBiL3hlbi9hcmNoL3g4Ni9kb21haW4uYwpA
QCAtMTU5Myw4ICsxNTkzLDcgQEAgdm9pZCBwYXJhdmlydF9jdHh0X3N3aXRjaF90byhzdHJ1Y3Qg
dmNwdSAqdikKICAgICAgICAgYWN0aXZhdGVfZGVidWdyZWdzKHYpOwogCiAgICAgaWYgKCBjcHVf
aGFzX3JkdHNjcCApCi0gICAgICAgIHdybXNyX3RzY19hdXgodi0+ZG9tYWluLT5hcmNoLnRzY19t
b2RlID09IFRTQ19NT0RFX1BWUkRUU0NQCi0gICAgICAgICAgICAgICAgICAgICAgPyB2LT5kb21h
aW4tPmFyY2guaW5jYXJuYXRpb24gOiAwKTsKKyAgICAgICAgd3Jtc3JfdHNjX2F1eCh2LT5hcmNo
Lm1zcnMtPnRzY19hdXgpOwogfQogCiAvKiBVcGRhdGUgcGVyLVZDUFUgZ3Vlc3QgcnVuc3RhdGUg
c2hhcmVkIG1lbW9yeSBhcmVhIChpZiByZWdpc3RlcmVkKS4gKi8KZGlmZiAtLWdpdCBhL3hlbi9h
cmNoL3g4Ni9kb21jdGwuYyBiL3hlbi9hcmNoL3g4Ni9kb21jdGwuYwppbmRleCA5N2VhNWQ4Li5i
OGQwNzk2IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvZG9tY3RsLmMKKysrIGIveGVuL2FyY2gv
eDg2L2RvbWN0bC5jCkBAIC0xMjc1LDYgKzEyNzUsNyBAQCBsb25nIGFyY2hfZG9fZG9tY3RsKAog
ICAgICAgICBzdGF0aWMgY29uc3QgdWludDMyX3QgbXNyc190b19zZW5kW10gPSB7CiAgICAgICAg
ICAgICBNU1JfU1BFQ19DVFJMLAogICAgICAgICAgICAgTVNSX0lOVEVMX01JU0NfRkVBVFVSRVNf
RU5BQkxFUywKKyAgICAgICAgICAgIE1TUl9UU0NfQVVYLAogICAgICAgICB9OwogICAgICAgICB1
aW50MzJfdCBucl9tc3JzID0gQVJSQVlfU0laRShtc3JzX3RvX3NlbmQpOwogCkBAIC0xMzk5LDYg
KzE0MDAsNyBAQCBsb25nIGFyY2hfZG9fZG9tY3RsKAogICAgICAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgICBjYXNlIE1TUl9TUEVDX0NUUkw6CiAgICAgICAgICAgICAgICAgY2FzZSBNU1Jf
SU5URUxfTUlTQ19GRUFUVVJFU19FTkFCTEVTOgorICAgICAgICAgICAgICAgIGNhc2UgTVNSX1RT
Q19BVVg6CiAgICAgICAgICAgICAgICAgICAgIGlmICggZ3Vlc3Rfd3Jtc3IodiwgbXNyLmluZGV4
LCBtc3IudmFsdWUpICE9IFg4NkVNVUxfT0tBWSApCiAgICAgICAgICAgICAgICAgICAgICAgICBi
cmVhazsKICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CmRpZmYgLS1naXQgYS94ZW4vYXJj
aC94ODYvaHZtL2h2bS5jIGIveGVuL2FyY2gveDg2L2h2bS9odm0uYwppbmRleCAwYmM2NzZjLi4x
ZTRmYzdkIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL2h2bS5jCisrKyBiL3hlbi9hcmNo
L3g4Ni9odm0vaHZtLmMKQEAgLTc3NCw3ICs3NzQsNyBAQCBzdGF0aWMgaW50IGh2bV9zYXZlX2Nw
dV9jdHh0KHN0cnVjdCB2Y3B1ICp2LCBodm1fZG9tYWluX2NvbnRleHRfdCAqaCkKICAgICBzdHJ1
Y3Qgc2VnbWVudF9yZWdpc3RlciBzZWc7CiAgICAgc3RydWN0IGh2bV9od19jcHUgY3R4dCA9IHsK
ICAgICAgICAgLnRzYyA9IGh2bV9nZXRfZ3Vlc3RfdHNjX2ZpeGVkKHYsIHYtPmRvbWFpbi0+YXJj
aC5odm0uc3luY190c2MpLAotICAgICAgICAubXNyX3RzY19hdXggPSBodm1fbXNyX3RzY19hdXgo
diksCisgICAgICAgIC5tc3JfdHNjX2F1eCA9IHYtPmFyY2gubXNycy0+dHNjX2F1eCwKICAgICAg
ICAgLnJheCA9IHYtPmFyY2gudXNlcl9yZWdzLnJheCwKICAgICAgICAgLnJieCA9IHYtPmFyY2gu
dXNlcl9yZWdzLnJieCwKICAgICAgICAgLnJjeCA9IHYtPmFyY2gudXNlcl9yZWdzLnJjeCwKQEAg
LTEwNDAsNyArMTA0MCwxMCBAQCBzdGF0aWMgaW50IGh2bV9sb2FkX2NwdV9jdHh0KHN0cnVjdCBk
b21haW4gKmQsIGh2bV9kb21haW5fY29udGV4dF90ICpoKQogICAgIGlmICggaHZtX2Z1bmNzLnRz
Y19zY2FsaW5nLnNldHVwICkKICAgICAgICAgaHZtX2Z1bmNzLnRzY19zY2FsaW5nLnNldHVwKHYp
OwogCi0gICAgdi0+YXJjaC5odm0ubXNyX3RzY19hdXggPSBjdHh0Lm1zcl90c2NfYXV4OworICAg
IGlmICggY3R4dC5tc3JfdHNjX2F1eCAhPSAodWludDMyX3QpY3R4dC5tc3JfdHNjX2F1eCApCisg
ICAgICAgIHJldHVybiAtRUlOVkFMOworCisgICAgdi0+YXJjaC5tc3JzLT50c2NfYXV4ID0gY3R4
dC5tc3JfdHNjX2F1eDsKIAogICAgIGh2bV9zZXRfZ3Vlc3RfdHNjX2ZpeGVkKHYsIGN0eHQudHNj
LCBkLT5hcmNoLmh2bS5zeW5jX3RzYyk7CiAKQEAgLTM0MDAsMTAgKzM0MDMsNiBAQCBpbnQgaHZt
X21zcl9yZWFkX2ludGVyY2VwdCh1bnNpZ25lZCBpbnQgbXNyLCB1aW50NjRfdCAqbXNyX2NvbnRl
bnQpCiAgICAgICAgICptc3JfY29udGVudCA9IHYtPmFyY2guaHZtLm1zcl90c2NfYWRqdXN0Owog
ICAgICAgICBicmVhazsKIAotICAgIGNhc2UgTVNSX1RTQ19BVVg6Ci0gICAgICAgICptc3JfY29u
dGVudCA9IGh2bV9tc3JfdHNjX2F1eCh2KTsKLSAgICAgICAgYnJlYWs7Ci0KICAgICBjYXNlIE1T
Ul9JQTMyX0FQSUNCQVNFOgogICAgICAgICAqbXNyX2NvbnRlbnQgPSB2Y3B1X3ZsYXBpYyh2KS0+
aHcuYXBpY19iYXNlX21zcjsKICAgICAgICAgYnJlYWs7CkBAIC0zNTU2LDEzICszNTU1LDYgQEAg
aW50IGh2bV9tc3Jfd3JpdGVfaW50ZXJjZXB0KHVuc2lnbmVkIGludCBtc3IsIHVpbnQ2NF90IG1z
cl9jb250ZW50LAogICAgICAgICBodm1fc2V0X2d1ZXN0X3RzY19hZGp1c3QodiwgbXNyX2NvbnRl
bnQpOwogICAgICAgICBicmVhazsKIAotICAgIGNhc2UgTVNSX1RTQ19BVVg6Ci0gICAgICAgIHYt
PmFyY2guaHZtLm1zcl90c2NfYXV4ID0gKHVpbnQzMl90KW1zcl9jb250ZW50OwotICAgICAgICBp
ZiAoIGNwdV9oYXNfcmR0c2NwCi0gICAgICAgICAgICAgJiYgKHYtPmRvbWFpbi0+YXJjaC50c2Nf
bW9kZSAhPSBUU0NfTU9ERV9QVlJEVFNDUCkgKQotICAgICAgICAgICAgd3Jtc3JfdHNjX2F1eCht
c3JfY29udGVudCk7Ci0gICAgICAgIGJyZWFrOwotCiAgICAgY2FzZSBNU1JfSUEzMl9BUElDQkFT
RToKICAgICAgICAgaWYgKCAhdmxhcGljX21zcl9zZXQodmNwdV92bGFwaWModiksIG1zcl9jb250
ZW50KSApCiAgICAgICAgICAgICBnb3RvIGdwX2ZhdWx0OwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gv
eDg2L2h2bS9zdm0vc3ZtLmMgYi94ZW4vYXJjaC94ODYvaHZtL3N2bS9zdm0uYwppbmRleCAzOTZl
ZTRhLi5lNDJlMTUyIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL3N2bS9zdm0uYworKysg
Yi94ZW4vYXJjaC94ODYvaHZtL3N2bS9zdm0uYwpAQCAtMTEzNiw3ICsxMTM2LDcgQEAgc3RhdGlj
IHZvaWQgc3ZtX2N0eHRfc3dpdGNoX3RvKHN0cnVjdCB2Y3B1ICp2KQogICAgIHN2bV90c2NfcmF0
aW9fbG9hZCh2KTsKIAogICAgIGlmICggY3B1X2hhc19yZHRzY3AgKQotICAgICAgICB3cm1zcl90
c2NfYXV4KGh2bV9tc3JfdHNjX2F1eCh2KSk7CisgICAgICAgIHdybXNyX3RzY19hdXgodi0+YXJj
aC5tc3JzLT50c2NfYXV4KTsKIH0KIAogc3RhdGljIHZvaWQgbm9yZXR1cm4gc3ZtX2RvX3Jlc3Vt
ZShzdHJ1Y3QgdmNwdSAqdikKQEAgLTMwNjMsNyArMzA2Myw3IEBAIHZvaWQgc3ZtX3ZtZXhpdF9o
YW5kbGVyKHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdzKQogICAgICAgICBicmVhazsKIAogICAg
IGNhc2UgVk1FWElUX1JEVFNDUDoKLSAgICAgICAgcmVncy0+cmN4ID0gaHZtX21zcl90c2NfYXV4
KHYpOworICAgICAgICByZWdzLT5yY3ggPSB2LT5hcmNoLm1zcnMtPnRzY19hdXg7CiAgICAgICAg
IC8qIGZhbGwgdGhyb3VnaCAqLwogICAgIGNhc2UgVk1FWElUX1JEVFNDOgogICAgICAgICBzdm1f
dm1leGl0X2RvX3JkdHNjKHJlZ3MpOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L2h2bS92bXgv
dm14LmMgYi94ZW4vYXJjaC94ODYvaHZtL3ZteC92bXguYwppbmRleCAzNjVlZWIyLi5lYTk2OTRh
IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvaHZtL3ZteC92bXguYworKysgYi94ZW4vYXJjaC94
ODYvaHZtL3ZteC92bXguYwpAQCAtNTEyLDcgKzUxMiw3IEBAIHN0YXRpYyB2b2lkIHZteF9yZXN0
b3JlX2d1ZXN0X21zcnMoc3RydWN0IHZjcHUgKnYpCiAgICAgd3Jtc3JsKE1TUl9TWVNDQUxMX01B
U0ssICAgdi0+YXJjaC5odm0udm14LnNmbWFzayk7CiAKICAgICBpZiAoIGNwdV9oYXNfcmR0c2Nw
ICkKLSAgICAgICAgd3Jtc3JfdHNjX2F1eChodm1fbXNyX3RzY19hdXgodikpOworICAgICAgICB3
cm1zcl90c2NfYXV4KHYtPmFyY2gubXNycy0+dHNjX2F1eCk7CiB9CiAKIHZvaWQgdm14X3VwZGF0
ZV9jcHVfZXhlY19jb250cm9sKHN0cnVjdCB2Y3B1ICp2KQpAQCAtMzk1Niw3ICszOTU2LDcgQEAg
dm9pZCB2bXhfdm1leGl0X2hhbmRsZXIoc3RydWN0IGNwdV91c2VyX3JlZ3MgKnJlZ3MpCiAgICAg
ICAgIHZteF9pbnZscGdfaW50ZXJjZXB0KGV4aXRfcXVhbGlmaWNhdGlvbik7CiAgICAgICAgIGJy
ZWFrOwogICAgIGNhc2UgRVhJVF9SRUFTT05fUkRUU0NQOgotICAgICAgICByZWdzLT5yY3ggPSBo
dm1fbXNyX3RzY19hdXgodik7CisgICAgICAgIHJlZ3MtPnJjeCA9IHYtPmFyY2gubXNycy0+dHNj
X2F1eDsKICAgICAgICAgLyogZmFsbCB0aHJvdWdoICovCiAgICAgY2FzZSBFWElUX1JFQVNPTl9S
RFRTQzoKICAgICAgICAgdXBkYXRlX2d1ZXN0X2VpcCgpOyAvKiBTYWZlOiBSRFRTQywgUkRUU0NQ
ICovCmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbXNyLmMgYi94ZW4vYXJjaC94ODYvbXNyLmMK
aW5kZXggYzllODdiMS4uYmExY2UyOSAxMDA2NDQKLS0tIGEveGVuL2FyY2gveDg2L21zci5jCisr
KyBiL3hlbi9hcmNoL3g4Ni9tc3IuYwpAQCAtMTU5LDYgKzE1OSwxMyBAQCBpbnQgZ3Vlc3RfcmRt
c3IoY29uc3Qgc3RydWN0IHZjcHUgKnYsIHVpbnQzMl90IG1zciwgdWludDY0X3QgKnZhbCkKICAg
ICAgICAgcmV0ID0gZ3Vlc3RfcmRtc3JfeGVuKHYsIG1zciwgdmFsKTsKICAgICAgICAgYnJlYWs7
CiAKKyAgICBjYXNlIE1TUl9UU0NfQVVYOgorICAgICAgICBpZiAoICFjcC0+ZXh0ZC5yZHRzY3Ag
JiYgIWNwLT5mZWF0LnJkcGlkICkKKyAgICAgICAgICAgIGdvdG8gZ3BfZmF1bHQ7CisKKyAgICAg
ICAgKnZhbCA9IG1zcnMtPnRzY19hdXg7CisgICAgICAgIGJyZWFrOworCiAgICAgZGVmYXVsdDoK
ICAgICAgICAgcmV0dXJuIFg4NkVNVUxfVU5IQU5ETEVBQkxFOwogICAgIH0KQEAgLTI4NSw2ICsy
OTIsMTcgQEAgaW50IGd1ZXN0X3dybXNyKHN0cnVjdCB2Y3B1ICp2LCB1aW50MzJfdCBtc3IsIHVp
bnQ2NF90IHZhbCkKICAgICAgICAgcmV0ID0gZ3Vlc3Rfd3Jtc3JfeGVuKHYsIG1zciwgdmFsKTsK
ICAgICAgICAgYnJlYWs7CiAKKyAgICBjYXNlIE1TUl9UU0NfQVVYOgorICAgICAgICBpZiAoICFj
cC0+ZXh0ZC5yZHRzY3AgJiYgIWNwLT5mZWF0LnJkcGlkICkKKyAgICAgICAgICAgIGdvdG8gZ3Bf
ZmF1bHQ7CisgICAgICAgIGlmICggdmFsICE9ICh1aW50MzJfdCl2YWwgKQorICAgICAgICAgICAg
Z290byBncF9mYXVsdDsKKworICAgICAgICBtc3JzLT50c2NfYXV4ID0gdmFsOworICAgICAgICBp
ZiAoIHYgPT0gY3VyciApCisgICAgICAgICAgICB3cm1zcl90c2NfYXV4KHZhbCk7CisgICAgICAg
IGJyZWFrOworCiAgICAgZGVmYXVsdDoKICAgICAgICAgcmV0dXJuIFg4NkVNVUxfVU5IQU5ETEVB
QkxFOwogICAgIH0KZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9wdi9lbXVsLXByaXYtb3AuYyBi
L3hlbi9hcmNoL3g4Ni9wdi9lbXVsLXByaXYtb3AuYwppbmRleCAzNjQxZDMxLi43YzJiNjM1IDEw
MDY0NAotLS0gYS94ZW4vYXJjaC94ODYvcHYvZW11bC1wcml2LW9wLmMKKysrIGIveGVuL2FyY2gv
eDg2L3B2L2VtdWwtcHJpdi1vcC5jCkBAIC04NDcsMTAgKzg0Nyw2IEBAIHN0YXRpYyBpbnQgcmVh
ZF9tc3IodW5zaWduZWQgaW50IHJlZywgdWludDY0X3QgKnZhbCwKICAgICAgICAgKnZhbCA9IGN1
cnJkLT5hcmNoLnZ0c2MgPyBwdl9zb2Z0X3JkdHNjKGN1cnIsIGN0eHQtPnJlZ3MpIDogcmR0c2Mo
KTsKICAgICAgICAgcmV0dXJuIFg4NkVNVUxfT0tBWTsKIAotICAgIGNhc2UgTVNSX1RTQ19BVVg6
Ci0gICAgICAgICp2YWwgPSAwOwotICAgICAgICByZXR1cm4gWDg2RU1VTF9PS0FZOwotCiAgICAg
Y2FzZSBNU1JfRUZFUjoKICAgICAgICAgLyogSGlkZSB1bmtub3duIGJpdHMsIGFuZCB1bmNvbmRp
dGlvbmFsbHkgaGlkZSBTVk1FIGZyb20gZ3Vlc3RzLiAqLwogICAgICAgICAqdmFsID0gcmVhZF9l
ZmVyKCkgJiBFRkVSX0tOT1dOX01BU0sgJiB+RUZFUl9TVk1FOwpkaWZmIC0tZ2l0IGEveGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9odm0vaHZtLmggYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9odm0uaApp
bmRleCAzZDMyNTBkLi4zYTkyYmIzIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20teDg2L2h2
bS9odm0uaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2h2bS9odm0uaApAQCAtNTYzLDEyICs1
NjMsNiBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaHZtX2ludmFsaWRhdGVfcmVnc19maWVsZHMoc3Ry
dWN0IGNwdV91c2VyX3JlZ3MgKnJlZ3MpCiAjZW5kaWYKIH0KIAotI2RlZmluZSBodm1fbXNyX3Rz
Y19hdXgodikgKHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFwKLSAgICBzdHJ1Y3QgZG9tYWluICpfX2QgPSAodiktPmRvbWFpbjsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBcCi0gICAgKF9fZC0+YXJjaC50c2NfbW9kZSA9PSBUU0Nf
TU9ERV9QVlJEVFNDUCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAotICAgICAgICA/
ICh1MzIpX19kLT5hcmNoLmluY2FybmF0aW9uIDogKHUzMikodiktPmFyY2guaHZtLm1zcl90c2Nf
YXV4OyAgICAgIFwKLX0pCi0KIC8qCiAgKiBOZXN0ZWQgSFZNCiAgKi8KZGlmZiAtLWdpdCBhL3hl
bi9pbmNsdWRlL2FzbS14ODYvaHZtL3ZjcHUuaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvaHZtL3Zj
cHUuaAppbmRleCBjNjYzMTU1Li4xZDJmNDA3IDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9hc20t
eDg2L2h2bS92Y3B1LmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9odm0vdmNwdS5oCkBAIC0x
NzEsNyArMTcxLDYgQEAgc3RydWN0IGh2bV92Y3B1IHsKIAogICAgIHN0cnVjdCBodm1fdmNwdV9h
c2lkIG4xYXNpZDsKIAotICAgIHUzMiAgICAgICAgICAgICAgICAgbXNyX3RzY19hdXg7CiAgICAg
dTY0ICAgICAgICAgICAgICAgICBtc3JfdHNjX2FkanVzdDsKICAgICB1NjQgICAgICAgICAgICAg
ICAgIG1zcl94c3M7CiAKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvbXNyLmggYi94
ZW4vaW5jbHVkZS9hc20teDg2L21zci5oCmluZGV4IGMxY2IzOGYuLjlkMGQ1MmIgMTAwNjQ0Ci0t
LSBhL3hlbi9pbmNsdWRlL2FzbS14ODYvbXNyLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9t
c3IuaApAQCAtMjg5LDYgKzI4OSwxNCBAQCBzdHJ1Y3QgdmNwdV9tc3JzCiAgICAgfSBtaXNjX2Zl
YXR1cmVzX2VuYWJsZXM7CiAKICAgICAvKgorICAgICAqIDB4YzAwMDAxMDMgLSBNU1JfVFNDX0FV
WAorICAgICAqCisgICAgICogVmFsdWUgaXMgZ3Vlc3QgY2hvc2VuLCBhbmQgZWFnZXJseSBsb2Fk
ZWQgaW4gZ3Vlc3QgY29udGV4dC4gIFRoZSB2YWx1ZQorICAgICAqIGlzIGFjY2Vzc2libGUgdG8g
dXNlcnNwYWNlIHdpdGggdGhlIFJEVFNDUCBhbmQgUkRQSUQgaW5zdHJ1Y3Rpb25zLgorICAgICAq
LworICAgIHVpbnQzMl90IHRzY19hdXg7CisKKyAgICAvKgogICAgICAqIDB4YzAwMTEwezI3LDE5
LTFifSBNU1JfQU1ENjRfRFJ7MC0zfV9BRERSRVNTX01BU0sKICAgICAgKiBUT0RPOiBOb3QgeWV0
IGhhbmRsZWQgYnkgZ3Vlc3Rfe3JkLHdyfW1zcigpIGluZnJhc3RydWN0dXJlLgogICAgICAqLwot
LSAKMi4xLjQKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpo
dHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs
