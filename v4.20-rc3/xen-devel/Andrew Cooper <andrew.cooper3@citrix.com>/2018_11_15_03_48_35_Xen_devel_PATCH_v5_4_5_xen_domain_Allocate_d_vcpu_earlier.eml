Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 15 Nov 2018 00:42:22 -0000
Received: from icoremail.net (unknown [209.85.210.173])
	by mail-app2 (Coremail) with SMTP id by_KCgCn35iEfOxbX7SSAQ--.43753S3;
	Thu, 15 Nov 2018 03:50:28 +0800 (CST)
Received: from mail-pf1-f173.google.com (unknown [209.85.210.173])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwCHb0t+fOxbKw5AAA--.7799S3;
	Thu, 15 Nov 2018 03:50:22 +0800 (CST)
Received: by mail-pf1-f173.google.com with SMTP id g7-v6so8419124pfo.10
        for <xuliker@zju.edu.cn>; Wed, 14 Nov 2018 11:50:22 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=QtPTWg5A0DTrbdjO2pkryIUP6WrmgTMuSym91H7TAlw=;
        b=gYKmFxbqgX94uUPCYXVUsmsXgTr1a4YbSmQ6rNHzQIHXPiQqmJgAM7l21J4dui7ifM
         uU2uBdMx8If0EvhQNX/Ad9neQy1wXgH4uJG442AWNu8SOmGVmlaBnt1IgmxKbIZkIqr+
         pD3T4K5QAk+w+YGQ2S21jShHHa0I9xecfz8Ahfpgk/e6TyaFs3g5OobjasuQ+GIJOmbO
         89PTxyFBotmO94O31vwjjN3pNOIkFt6MnihRxwDcDE0T3auAtjbOajNDFQufT1AGGRvA
         6Qtbk9IoOx4u0KhYTthMdL9I9+nZ3PKnWCiQUDTXJgNvIOzLvSD+ItX+zwVxw3dQHHDA
         BQIw==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gLXYk9LvwWP9rS1YM0HsTrgzxe+24x/AE8Uq9OKRf8VjIoMXSKq
	bsZYX8itQr+gA7IcOBoRXF3WQ/WoAeCvfSf2B/BmkdQCTYvGByMhew==
X-Received: by 2002:a62:5e83:: with SMTP id s125-v6mr3276922pfb.232.1542225022355;
        Wed, 14 Nov 2018 11:50:22 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:c304:0:0:0:0 with SMTP id g4-v6csp6238490pjt;
        Wed, 14 Nov 2018 11:50:21 -0800 (PST)
X-Google-Smtp-Source: AJdET5c/2NMO3y9itPml7SmJda6hyvj2MtKwA/rXqgrrIqIsSgXLhaEx1ylkTyZaETyk2mTh5arD
X-Received: by 2002:a5b:b09:: with SMTP id z9-v6mr2926148ybp.483.1542225021010;
        Wed, 14 Nov 2018 11:50:21 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542225020; cv=none;
        d=google.com; s=arc-20160816;
        b=YXLlxVqTX/cPYvRem3tDP52vka9z7Mgds6wHmRg3XK2cGrJl2dxx8BhdvSIy4Vc5vm
         Yg9iLMdnFkjcWByqn9CbOLdKcVVKe6u+3nBEKVixlujaqAfGLmKd/tl0ExlSqxblUCH/
         K20ZV8unWtoe1inw1BMYThw5vQ3tZjt1RhFu6yPdZEsZZmDmUef0zfvdHP2UJJsM+ZaZ
         ygnIgzBB9w8S7uhWZ09qutxoelKlP6C7uuKnhf5jiMczLstiWA/trq1TomPhuDPuRZd5
         vHKaqHOF4I5QQfAA3s1MAn6NuGdefwz41EDPduBBkKTMs+63zX/Fhzvo5MW5vB7DBXN6
         rGmw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=QtPTWg5A0DTrbdjO2pkryIUP6WrmgTMuSym91H7TAlw=;
        b=OIZY0Wn+72TqBY7ldQ/i8B5t9Ms06BKIoCaqsmsqtml8lDR7Cy9E9VshZcKQMZYL08
         krusRyJ5AY39E+zXDnfNfDyadtWo7tZWqGRuZmSxlqeOOXyqToaDnZ3m7Suh6wjIeNZN
         1cdYWw+r8lfrScOkYQGuHZyIbpa5ImDJUXnLeQYgHgd+7mZKMwhs1hE68T/8PLfAjstJ
         +gD1IdhUbPfnryJIOp32yW/oh6/t7s8zxG82BkVCERw3pSOxFwAYQYuGCgZuL9Jn8aOk
         rt9/t0ktXUHsuSoD7F0gZUp84bV6tB8nHgDcdpbYsuXKzNC1J4CM94lHYbfIauUGVK2s
         x5zA==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id u2-v6si14924940ywb.33.2018.11.14.11.50.20
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 14 Nov 2018 11:50:20 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gN19W-00039d-1I; Wed, 14 Nov 2018 19:48:42 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=xswa=nz=citrix.com=prvs=8491ce0b8=andrew.cooper3@srs-us1.protection.inumbo.net>)
 id 1gN19U-00039W-2f
 for xen-devel@lists.xen.org; Wed, 14 Nov 2018 19:48:40 +0000
X-Inumbo-ID: 47c2dc54-e846-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id 47c2dc54-e846-11e8-9a16-bc764e045a96;
 Wed, 14 Nov 2018 19:48:38 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,233,1539648000"; d="scan'208";a="70581241"
From: Andrew Cooper <andrew.cooper3@citrix.com>
To: Xen-devel <xen-devel@lists.xen.org>
Date: Wed, 14 Nov 2018 19:48:35 +0000
Message-ID: <1542224915-7856-1-git-send-email-andrew.cooper3@citrix.com>
X-Mailer: git-send-email 2.1.4
In-Reply-To: <9992702c-ab36-f0ea-9542-0d74e2a0b3be@citrix.com>
References: <9992702c-ab36-f0ea-9542-0d74e2a0b3be@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v5 4/5] xen/domain: Allocate d->vcpu[] earlier
 during domain_create()
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Andrew Cooper <andrew.cooper3@citrix.com>,
 Julien Grall <julien.grall@arm.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Wei Liu <wei.liu2@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwCHb0t+fOxbKw5AAA--.7799S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3KFyUCr17Zw1fCw1DGFW5trb_yoWkAw1Dpa
	1xZ340gw4fGr12gay5t3Z09F98K3s3GF1Fk3y3AryrJr9rK34DZr1vg3s8uryfZrWDZr1x
	Zr1fWF1Uu347AaDanT9S1TB71UUUUU7qnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlSb7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Xr0_Ar1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Gr0_Cr1l84ACjcxK6I8E
	87Iv67AKxVWxJr0_GcWl84ACjcxK6I8E87Iv6xkF7I0E14v26F4UJVW0owAa7VCE64xvF2
	IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x082IY
	62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUJVWUGwAv7V
	C2z280aVAFwI0_Jr0_Gr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VWrMxkI7II2jI8vz4vEwIxGrwCYIxAIcVC0I7IYx2IY
	67AKxVWUCVW8JwCYIxAIcVC0I7IYx2IY6xkF7I0E14v26r1j6r4UMxvI42IY6I8E87Iv67
	AKxVW8Jr0_Cr1UMxvI42IY6I8E87Iv6xkF7I0E14v26r4UJVWxJr1l42xK82IYc2Ij64vI
	r41l42xK82IY64kExVAvwVAq07x20xyl4x8a6x804xWl4I8I3I0E4IkC6x0Yz7v_Jr0_Gr
	1lx2IqxVAqx4xG67AKxVWUJVWUGwC20s026x8GjcxK67AKxVWUGVWUWwC2zVAF1VAY17CE
	14v26r126r1DMIIYrxkI7VAKI48JMIIF0xvE42xK8VAvwI8IcIk0rVW3JVWrJr1l6VACY4
	xI67k04243AbIYCTnIWIevJa73UjIFyTuYvjxUmUKsDUUUU

VGhlIEFSTSBjb2RlIGhhcyBhIGNoaWNrZW4tYW5kLWVnZyBwcm9ibGVtLiAgT25lIG9mIHRoZSB2
R0lDdjMgZW11bGF0aW9ucwp3YW50cyB0byBrbm93IGQtPm1heF92Y3B1cyB0byBiZSBhYmxlIHRv
IHNpemUgaXRzZWxmIGFwcHJvcHJpYXRlbHksIGJ1dCB0aGUKY3VycmVudCBvcmRlciBvZiBpbml0
aWFsaXNhdGlvbiByZXF1aXJlcyB0aGUgdkdJQyB0byBiZSBzZXQgdXAgYmVmb3JlIHRoZQpyZXF1
ZXN0ZWQgbnVtYmVyIG9mIHZjcHVzIGNhbiBiZSBjaGVja2VkLgoKTW92ZSB0aGUgcmFuZ2UgY2hl
Y2tpbmcgb2YgY29uZmlnLT5tYXhfdmNwdXMgaW50byBzYW5pdGlzZV9kb21haW5fY29uZmlnKCkK
cGF0aCwgd2hpY2ggYWxsb3dzIGZvciB0aGUgYWxsb2NhdGlvbiBvZiBkLT52Y3B1W10gYW5kIGQt
Pm1heF92Y3B1cyB0byBoYXBwZW4KZWFybGllciBkdXJpbmcgY3JlYXRlLCBhbmQgaW4gcGFydGlj
dWxhciwgYmVmb3JlIHRoZSBjYWxsIHRvCmFyY2hfZG9tYWluX2NyZWF0ZSgpLgoKVGhlIHg4NiBz
aWRlIGlzIGZhaXJseSBlYXN5LCBhbmQgaW1wbGVtZW50cyB0aGUgbG9naWNhbCBlcXVpdmFsZW50
IG9mCmRvbWFpbl9tYXhfdmNwdXMoKSBidXQgdXNpbmcgWEVOX0RPTUNUTF9DREZfaHZtX2d1ZXN0
IHJhdGhlciB0aGFuCmlzX2h2bV9kb21haW4oKS4KCkZvciB0aGUgQVJNIHNpZGUsIHJlLXB1cnBv
c2UgdmdpY19tYXhfdmNwdXMoKSB0byB0YWtlIGEgZG9tY3RsIHZHSUMgdmVyc2lvbiwKYW5kIHJl
dHVybiB0aGUgbWF4aW11bSBudW1iZXIgb2Ygc3VwcG9ydGVkIHZDUFVzLCByZXVzaW5nIDAgZm9y
ICJ2ZXJzaW9uIG5vdApzdXBwb3J0ZWQiLiAgVG8gYXZvaWQgZXhwb3J0aW5nIHRoZSB2Z2ljX29w
cyBzdHJ1Y3R1cmVzICh3aGljaCBhcmUgaW4gdGhlCnByb2Nlc3Mgb2YgYmVpbmcgcmVwbGFjZWQp
LCBoYXJkIGNvZGUgdGhlIHVwcGVyIGxpbWl0cy4KClRoaXMgYWxsb3dzIGZvciB0aGUgcmVtb3Zh
bCBvZiB0aGUgZG9tYWluX21heF92Y3B1cygpIGluZnJhc3RydWN0dXJlLCB3aGljaCBpcwpkb25l
IHRvIHByZXZlbnQgaXQgYmVpbmcgcmV1c2VkIGluY29ycmVjdGx5IGluIHRoZSBmdXR1cmUuCgpT
aWduZWQtb2ZmLWJ5OiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgpS
ZXZpZXdlZC1ieTogSmFuIEJldWxpY2ggPGpiZXVsaWNoQHN1c2UuY29tPgotLS0KQ0M6IFdlaSBM
aXUgPHdlaS5saXUyQGNpdHJpeC5jb20+CkNDOiBTdGVmYW5vIFN0YWJlbGxpbmkgPHNzdGFiZWxs
aW5pQGtlcm5lbC5vcmc+CkNDOiBKdWxpZW4gR3JhbGwgPGp1bGllbi5ncmFsbEBhcm0uY29tPgoK
djM6CiAqIEZpeCA0MDkyLzQwOTYgdHlwbwogKiBGaXggYnVpbGQgaW4gTkVXX1ZHSUMgY2FzZQp2
NDoKICogTW92ZSB0aGUgbWluKCkgaW50byBBUk0ncyBjb21tb24gYXJjaF9zYW5pdGlzZV9kb21h
aW5fY29uZmlnKCkKICAgaW1wbGVtZW50YXRpb24uICBTaW1wbGZ5IHRoZSBtaW4oKSBleHByZXNz
aW9uIGNvZGUgYnkgbWFraW5nIE1BWF9WSVJUX0NQVVMKICAgYmUgYW4gdW5zaWduZWQgY29uc3Rh
bnQuCnY1OgogKiBzL21heC9taW4KLS0tCiB4ZW4vYXJjaC9hcm0vZG9tYWluLmMgICAgICAgICB8
IDE4ICsrKysrKysrKysrKysrKysrKwogeGVuL2FyY2gvYXJtL3ZnaWMtdjIuYyAgICAgICAgfCAg
MSAtCiB4ZW4vYXJjaC9hcm0vdmdpYy12My5jICAgICAgICB8ICA1IC0tLS0tCiB4ZW4vYXJjaC9h
cm0vdmdpYy5jICAgICAgICAgICB8IDE2ICsrKysrKysrKysrKysrLS0KIHhlbi9hcmNoL2FybS92
Z2ljL3ZnaWMtaW5pdC5jIHwgIDMgLS0tCiB4ZW4vYXJjaC9hcm0vdmdpYy92Z2ljLmMgICAgICB8
IDE2ICsrKysrKy0tLS0tLS0tLS0KIHhlbi9hcmNoL3g4Ni9kb21haW4uYyAgICAgICAgIHwgMTAg
KysrKysrKysrKwogeGVuL2NvbW1vbi9kb21haW4uYyAgICAgICAgICAgfCAzMyArKysrKysrKysr
KysrKysrKysrKy0tLS0tLS0tLS0tLS0KIHhlbi9pbmNsdWRlL2FzbS1hcm0vY29uZmlnLmggIHwg
IDQgKystLQogeGVuL2luY2x1ZGUvYXNtLWFybS9kb21haW4uaCAgfCAgNiAtLS0tLS0KIHhlbi9p
bmNsdWRlL2FzbS1hcm0vdmdpYy5oICAgIHwgIDUgKystLS0KIHhlbi9pbmNsdWRlL2FzbS14ODYv
ZG9tYWluLmggIHwgIDIgLS0KIDEyIGZpbGVzIGNoYW5nZWQsIDcyIGluc2VydGlvbnMoKyksIDQ3
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS9kb21haW4uYyBiL3hlbi9h
cmNoL2FybS9kb21haW4uYwppbmRleCA3MWFkMWY5Li4xZDkyNmRjIDEwMDY0NAotLS0gYS94ZW4v
YXJjaC9hcm0vZG9tYWluLmMKKysrIGIveGVuL2FyY2gvYXJtL2RvbWFpbi5jCkBAIC02MDEsNiAr
NjAxLDggQEAgdm9pZCB2Y3B1X3N3aXRjaF90b19hYXJjaDY0X21vZGUoc3RydWN0IHZjcHUgKnYp
CiAKIGludCBhcmNoX3Nhbml0aXNlX2RvbWFpbl9jb25maWcoc3RydWN0IHhlbl9kb21jdGxfY3Jl
YXRlZG9tYWluICpjb25maWcpCiB7CisgICAgdW5zaWduZWQgaW50IG1heF92Y3B1czsKKwogICAg
IGlmICggY29uZmlnLT5mbGFncyAhPSAoWEVOX0RPTUNUTF9DREZfaHZtX2d1ZXN0IHwgWEVOX0RP
TUNUTF9DREZfaGFwKSApCiAgICAgewogICAgICAgICBkcHJpbnRrKFhFTkxPR19JTkZPLCAiVW5z
dXBwb3J0ZWQgY29uZmlndXJhdGlvbiAlI3hcbiIsIGNvbmZpZy0+ZmxhZ3MpOwpAQCAtNjI2LDYg
KzYyOCwyMiBAQCBpbnQgYXJjaF9zYW5pdGlzZV9kb21haW5fY29uZmlnKHN0cnVjdCB4ZW5fZG9t
Y3RsX2NyZWF0ZWRvbWFpbiAqY29uZmlnKQogICAgICAgICB9CiAgICAgfQogCisgICAgLyogbWF4
X3ZjcHVzIGRlcGVuZHMgb24gdGhlIEdJQyB2ZXJzaW9uLCBhbmQgWGVuJ3MgY29tcGlsZWQgbGlt
aXQuICovCisgICAgbWF4X3ZjcHVzID0gbWluKHZnaWNfbWF4X3ZjcHVzKGNvbmZpZy0+YXJjaC5n
aWNfdmVyc2lvbiksIE1BWF9WSVJUX0NQVVMpOworCisgICAgaWYgKCBtYXhfdmNwdXMgPT0gMCAp
CisgICAgeworICAgICAgICBkcHJpbnRrKFhFTkxPR19JTkZPLCAiVW5zdXBwb3J0ZWQgR0lDIHZl
cnNpb25cbiIpOworICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisKKyAgICBpZiAoIGNv
bmZpZy0+bWF4X3ZjcHVzID4gbWF4X3ZjcHVzICkKKyAgICB7CisgICAgICAgIGRwcmludGsoWEVO
TE9HX0lORk8sICJSZXF1ZXN0ZWQgdkNQVXMgKCV1KSBleGNlZWRzIG1heCAoJXUpXG4iLAorICAg
ICAgICAgICAgICAgIGNvbmZpZy0+bWF4X3ZjcHVzLCBtYXhfdmNwdXMpOworICAgICAgICByZXR1
cm4gLUVJTlZBTDsKKyAgICB9CisKICAgICByZXR1cm4gMDsKIH0KIApkaWZmIC0tZ2l0IGEveGVu
L2FyY2gvYXJtL3ZnaWMtdjIuYyBiL3hlbi9hcmNoL2FybS92Z2ljLXYyLmMKaW5kZXggYmY3Nzg5
OS4uNjRiMTQxZiAxMDA2NDQKLS0tIGEveGVuL2FyY2gvYXJtL3ZnaWMtdjIuYworKysgYi94ZW4v
YXJjaC9hcm0vdmdpYy12Mi5jCkBAIC03MjUsNyArNzI1LDYgQEAgc3RhdGljIGNvbnN0IHN0cnVj
dCB2Z2ljX29wcyB2Z2ljX3YyX29wcyA9IHsKICAgICAuZG9tYWluX2ZyZWUgPSB2Z2ljX3YyX2Rv
bWFpbl9mcmVlLAogICAgIC5scGlfdG9fcGVuZGluZyA9IHZnaWNfdjJfbHBpX3RvX3BlbmRpbmcs
CiAgICAgLmxwaV9nZXRfcHJpb3JpdHkgPSB2Z2ljX3YyX2xwaV9nZXRfcHJpb3JpdHksCi0gICAg
Lm1heF92Y3B1cyA9IDgsCiB9OwogCiBpbnQgdmdpY192Ml9pbml0KHN0cnVjdCBkb21haW4gKmQs
IGludCAqbW1pb19jb3VudCkKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL2FybS92Z2ljLXYzLmMgYi94
ZW4vYXJjaC9hcm0vdmdpYy12My5jCmluZGV4IGMxNGJjZDguLjUxOWNjNzIgMTAwNjQ0Ci0tLSBh
L3hlbi9hcmNoL2FybS92Z2ljLXYzLmMKKysrIGIveGVuL2FyY2gvYXJtL3ZnaWMtdjMuYwpAQCAt
MTgyMiwxMSArMTgyMiw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdmdpY19vcHMgdjNfb3BzID0g
ewogICAgIC5lbXVsYXRlX3JlZyAgPSB2Z2ljX3YzX2VtdWxhdGVfcmVnLAogICAgIC5scGlfdG9f
cGVuZGluZyA9IHZnaWNfdjNfbHBpX3RvX3BlbmRpbmcsCiAgICAgLmxwaV9nZXRfcHJpb3JpdHkg
PSB2Z2ljX3YzX2xwaV9nZXRfcHJpb3JpdHksCi0gICAgLyoKLSAgICAgKiBXZSB1c2UgYm90aCBB
RkYxIGFuZCBBRkYwIGluICh2KU1QSURSLiBUaHVzLCB0aGUgbWF4IG51bWJlciBvZiBDUFUKLSAg
ICAgKiB0aGF0IGNhbiBiZSBzdXBwb3J0ZWQgaXMgdXAgdG8gNDA5Nig9PTI1NioxNikgaW4gdGhl
b3J5LgotICAgICAqLwotICAgIC5tYXhfdmNwdXMgPSA0MDk2LAogfTsKIAogaW50IHZnaWNfdjNf
aW5pdChzdHJ1Y3QgZG9tYWluICpkLCBpbnQgKm1taW9fY291bnQpCmRpZmYgLS1naXQgYS94ZW4v
YXJjaC9hcm0vdmdpYy5jIGIveGVuL2FyY2gvYXJtL3ZnaWMuYwppbmRleCA1YTRmMDgyLi5mMjYw
OGIwIDEwMDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vdmdpYy5jCisrKyBiL3hlbi9hcmNoL2FybS92
Z2ljLmMKQEAgLTY2Nyw5ICs2NjcsMjEgQEAgdm9pZCB2Z2ljX2ZyZWVfdmlycShzdHJ1Y3QgZG9t
YWluICpkLCB1bnNpZ25lZCBpbnQgdmlycSkKICAgICBjbGVhcl9iaXQodmlycSwgZC0+YXJjaC52
Z2ljLmFsbG9jYXRlZF9pcnFzKTsKIH0KIAotdW5zaWduZWQgaW50IHZnaWNfbWF4X3ZjcHVzKGNv
bnN0IHN0cnVjdCBkb21haW4gKmQpCit1bnNpZ25lZCBpbnQgdmdpY19tYXhfdmNwdXModW5zaWdu
ZWQgaW50IGRvbWN0bF92Z2ljX3ZlcnNpb24pCiB7Ci0gICAgcmV0dXJuIG1pbl90KHVuc2lnbmVk
IGludCwgTUFYX1ZJUlRfQ1BVUywgZC0+YXJjaC52Z2ljLmhhbmRsZXItPm1heF92Y3B1cyk7Cisg
ICAgc3dpdGNoICggZG9tY3RsX3ZnaWNfdmVyc2lvbiApCisgICAgeworICAgIGNhc2UgWEVOX0RP
TUNUTF9DT05GSUdfR0lDX1YyOgorICAgICAgICByZXR1cm4gODsKKworI2lmZGVmIENPTkZJR19H
SUNWMworICAgIGNhc2UgWEVOX0RPTUNUTF9DT05GSUdfR0lDX1YzOgorICAgICAgICByZXR1cm4g
NDA5NjsKKyNlbmRpZgorCisgICAgZGVmYXVsdDoKKyAgICAgICAgcmV0dXJuIDA7CisgICAgfQog
fQogCiAvKgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL3ZnaWMvdmdpYy1pbml0LmMgYi94ZW4v
YXJjaC9hcm0vdmdpYy92Z2ljLWluaXQuYwppbmRleCBiZmQzZDA5Li42MmFlNTUzIDEwMDY0NAot
LS0gYS94ZW4vYXJjaC9hcm0vdmdpYy92Z2ljLWluaXQuYworKysgYi94ZW4vYXJjaC9hcm0vdmdp
Yy92Z2ljLWluaXQuYwpAQCAtMTEyLDkgKzExMiw2IEBAIGludCBkb21haW5fdmdpY19yZWdpc3Rl
cihzdHJ1Y3QgZG9tYWluICpkLCBpbnQgKm1taW9fY291bnQpCiAgICAgICAgIEJVRygpOwogICAg
IH0KIAotICAgIGlmICggZC0+bWF4X3ZjcHVzID4gZG9tYWluX21heF92Y3B1cyhkKSApCi0gICAg
ICAgIHJldHVybiAtRTJCSUc7Ci0KICAgICBkLT5hcmNoLnZnaWMudmdpY19kaXN0X2Jhc2UgPSBW
R0lDX0FERFJfVU5ERUY7CiAgICAgZC0+YXJjaC52Z2ljLnZnaWNfY3B1X2Jhc2UgPSBWR0lDX0FE
RFJfVU5ERUY7CiAgICAgZC0+YXJjaC52Z2ljLnZnaWNfcmVkaXN0X2Jhc2UgPSBWR0lDX0FERFJf
VU5ERUY7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vdmdpYy92Z2ljLmMgYi94ZW4vYXJjaC9h
cm0vdmdpYy92Z2ljLmMKaW5kZXggN2MzY2ZjNS4uZTI4NDRkYyAxMDA2NDQKLS0tIGEveGVuL2Fy
Y2gvYXJtL3ZnaWMvdmdpYy5jCisrKyBiL3hlbi9hcmNoL2FybS92Z2ljL3ZnaWMuYwpAQCAtOTQ5
LDIwICs5NDksMTYgQEAgdm9pZCB2Z2ljX3N5bmNfaGFyZHdhcmVfaXJxKHN0cnVjdCBkb21haW4g
KmQsCiAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGVzYy0+bG9jaywgZmxhZ3MpOwogfQog
Ci11bnNpZ25lZCBpbnQgdmdpY19tYXhfdmNwdXMoY29uc3Qgc3RydWN0IGRvbWFpbiAqZCkKK3Vu
c2lnbmVkIGludCB2Z2ljX21heF92Y3B1cyh1bnNpZ25lZCBpbnQgZG9tY3RsX3ZnaWNfdmVyc2lv
bikKIHsKLSAgICB1bnNpZ25lZCBpbnQgdmdpY192Y3B1X2xpbWl0OwotCi0gICAgc3dpdGNoICgg
ZC0+YXJjaC52Z2ljLnZlcnNpb24gKQorICAgIHN3aXRjaCAoIGRvbWN0bF92Z2ljX3ZlcnNpb24g
KQogICAgIHsKLSAgICBjYXNlIEdJQ19WMjoKLSAgICAgICAgdmdpY192Y3B1X2xpbWl0ID0gVkdJ
Q19WMl9NQVhfQ1BVUzsKLSAgICAgICAgYnJlYWs7CisgICAgY2FzZSBYRU5fRE9NQ1RMX0NPTkZJ
R19HSUNfVjI6CisgICAgICAgIHJldHVybiBWR0lDX1YyX01BWF9DUFVTOworCiAgICAgZGVmYXVs
dDoKLSAgICAgICAgQlVHKCk7CisgICAgICAgIHJldHVybiAwOwogICAgIH0KLQotICAgIHJldHVy
biBtaW5fdCh1bnNpZ25lZCBpbnQsIE1BWF9WSVJUX0NQVVMsIHZnaWNfdmNwdV9saW1pdCk7CiB9
CiAKICNpZmRlZiBDT05GSUdfR0lDVjMKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9kb21haW4u
YyBiL3hlbi9hcmNoL3g4Ni9kb21haW4uYwppbmRleCAyNzJmZDg0Li4yOTViMTBjIDEwMDY0NAot
LS0gYS94ZW4vYXJjaC94ODYvZG9tYWluLmMKKysrIGIveGVuL2FyY2gveDg2L2RvbWFpbi5jCkBA
IC00MjEsNiArNDIxLDcgQEAgdm9pZCBhcmNoX3ZjcHVfZGVzdHJveShzdHJ1Y3QgdmNwdSAqdikK
IGludCBhcmNoX3Nhbml0aXNlX2RvbWFpbl9jb25maWcoc3RydWN0IHhlbl9kb21jdGxfY3JlYXRl
ZG9tYWluICpjb25maWcpCiB7CiAgICAgYm9vbCBodm0gPSBjb25maWctPmZsYWdzICYgWEVOX0RP
TUNUTF9DREZfaHZtX2d1ZXN0OworICAgIHVuc2lnbmVkIGludCBtYXhfdmNwdXM7CiAKICAgICBp
ZiAoIGh2bSA/ICFodm1fZW5hYmxlZCA6ICFJU19FTkFCTEVEKENPTkZJR19QVikgKQogICAgIHsK
QEAgLTQyOCw2ICs0MjksMTUgQEAgaW50IGFyY2hfc2FuaXRpc2VfZG9tYWluX2NvbmZpZyhzdHJ1
Y3QgeGVuX2RvbWN0bF9jcmVhdGVkb21haW4gKmNvbmZpZykKICAgICAgICAgcmV0dXJuIC1FSU5W
QUw7CiAgICAgfQogCisgICAgbWF4X3ZjcHVzID0gaHZtID8gSFZNX01BWF9WQ1BVUyA6IE1BWF9W
SVJUX0NQVVM7CisKKyAgICBpZiAoIGNvbmZpZy0+bWF4X3ZjcHVzID4gbWF4X3ZjcHVzICkKKyAg
ICB7CisgICAgICAgIGRwcmludGsoWEVOTE9HX0lORk8sICJSZXF1ZXN0ZWQgdkNQVXMgKCV1KSBl
eGNlZWRzIG1heCAoJXUpXG4iLAorICAgICAgICAgICAgICAgIGNvbmZpZy0+bWF4X3ZjcHVzLCBt
YXhfdmNwdXMpOworICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisKICAgICByZXR1cm4g
MDsKIH0KIApkaWZmIC0tZ2l0IGEveGVuL2NvbW1vbi9kb21haW4uYyBiL3hlbi9jb21tb24vZG9t
YWluLmMKaW5kZXggZjY5ZjQwNS4uNzhjYzUyNCAxMDA2NDQKLS0tIGEveGVuL2NvbW1vbi9kb21h
aW4uYworKysgYi94ZW4vY29tbW9uL2RvbWFpbi5jCkBAIC0zMDAsNiArMzAwLDEyIEBAIHN0YXRp
YyBpbnQgc2FuaXRpc2VfZG9tYWluX2NvbmZpZyhzdHJ1Y3QgeGVuX2RvbWN0bF9jcmVhdGVkb21h
aW4gKmNvbmZpZykKICAgICAgICAgcmV0dXJuIC1FSU5WQUw7CiAgICAgfQogCisgICAgaWYgKCBj
b25maWctPm1heF92Y3B1cyA8IDEgKQorICAgIHsKKyAgICAgICAgZHByaW50ayhYRU5MT0dfSU5G
TywgIk5vIHZDUFVTXG4iKTsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorCiAgICAg
cmV0dXJuIGFyY2hfc2FuaXRpc2VfZG9tYWluX2NvbmZpZyhjb25maWcpOwogfQogCkBAIC0zNDUs
NiArMzUxLDIwIEBAIHN0cnVjdCBkb21haW4gKmRvbWFpbl9jcmVhdGUoZG9taWRfdCBkb21pZCwK
IAogICAgIFRSQUNFXzFEKFRSQ19ET00wX0RPTV9BREQsIGQtPmRvbWFpbl9pZCk7CiAKKyAgICAv
KgorICAgICAqIEFsbG9jYXRlIGQtPnZjcHVbXSBhbmQgc2V0IC0+bWF4X3ZjcHVzIHVwIGVhcmx5
LiAgVmFyaW91cyBwZXItZG9tYWluCisgICAgICogcmVzb3VyY2VzIHdhbnQgdG8gYmUgc2l6ZWQg
YmFzZWQgb24gbWF4X3ZjcHVzLgorICAgICAqLworICAgIGlmICggIWlzX3N5c3RlbV9kb21haW4o
ZCkgKQorICAgIHsKKyAgICAgICAgZXJyID0gLUVOT01FTTsKKyAgICAgICAgZC0+dmNwdSA9IHh6
YWxsb2NfYXJyYXkoc3RydWN0IHZjcHUgKiwgY29uZmlnLT5tYXhfdmNwdXMpOworICAgICAgICBp
ZiAoICFkLT52Y3B1ICkKKyAgICAgICAgICAgIGdvdG8gZmFpbDsKKworICAgICAgICBkLT5tYXhf
dmNwdXMgPSBjb25maWctPm1heF92Y3B1czsKKyAgICB9CisKICAgICBsb2NrX3Byb2ZpbGVfcmVn
aXN0ZXJfc3RydWN0KExPQ0tQUk9GX1RZUEVfUEVSRE9NLCBkLCBkb21pZCwgIkRvbWFpbiIpOwog
CiAgICAgaWYgKCAoZXJyID0geHNtX2FsbG9jX3NlY3VyaXR5X2RvbWFpbihkKSkgIT0gMCApCkBA
IC0zOTYsMTkgKzQxNiw2IEBAIHN0cnVjdCBkb21haW4gKmRvbWFpbl9jcmVhdGUoZG9taWRfdCBk
b21pZCwKIAogICAgIGlmICggIWlzX2lkbGVfZG9tYWluKGQpICkKICAgICB7Ci0gICAgICAgIC8q
IENoZWNrIGQtPm1heF92Y3B1cyBhbmQgYWxsb2NhdGUgZC0+dmNwdVtdLiAqLwotICAgICAgICBl
cnIgPSAtRUlOVkFMOwotICAgICAgICBpZiAoIGNvbmZpZy0+bWF4X3ZjcHVzIDwgMSB8fAotICAg
ICAgICAgICAgIGNvbmZpZy0+bWF4X3ZjcHVzID4gZG9tYWluX21heF92Y3B1cyhkKSApCi0gICAg
ICAgICAgICBnb3RvIGZhaWw7Ci0KLSAgICAgICAgZXJyID0gLUVOT01FTTsKLSAgICAgICAgZC0+
dmNwdSA9IHh6YWxsb2NfYXJyYXkoc3RydWN0IHZjcHUgKiwgY29uZmlnLT5tYXhfdmNwdXMpOwot
ICAgICAgICBpZiAoICFkLT52Y3B1ICkKLSAgICAgICAgICAgIGdvdG8gZmFpbDsKLQotICAgICAg
ICBkLT5tYXhfdmNwdXMgPSBjb25maWctPm1heF92Y3B1czsKLQogICAgICAgICB3YXRjaGRvZ19k
b21haW5faW5pdChkKTsKICAgICAgICAgaW5pdF9zdGF0dXMgfD0gSU5JVF93YXRjaGRvZzsKIApk
aWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLWFybS9jb25maWcuaCBiL3hlbi9pbmNsdWRlL2Fz
bS1hcm0vY29uZmlnLmgKaW5kZXggY2RhZThmNi4uYmM4OWU4NCAxMDA2NDQKLS0tIGEveGVuL2lu
Y2x1ZGUvYXNtLWFybS9jb25maWcuaAorKysgYi94ZW4vaW5jbHVkZS9hc20tYXJtL2NvbmZpZy5o
CkBAIC00MSw5ICs0MSw5IEBACiAjZGVmaW5lIE9QVF9DT05TT0xFX1NUUiAiZHR1YXJ0IgogCiAj
aWZkZWYgQ09ORklHX0FSTV82NAotI2RlZmluZSBNQVhfVklSVF9DUFVTIDEyOAorI2RlZmluZSBN
QVhfVklSVF9DUFVTIDEyOHUKICNlbHNlCi0jZGVmaW5lIE1BWF9WSVJUX0NQVVMgOAorI2RlZmlu
ZSBNQVhfVklSVF9DUFVTIDh1CiAjZW5kaWYKIAogI2RlZmluZSBJTlZBTElEX1ZDUFVfSUQgTUFY
X1ZJUlRfQ1BVUwpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLWFybS9kb21haW4uaCBiL3hl
bi9pbmNsdWRlL2FzbS1hcm0vZG9tYWluLmgKaW5kZXggZDY4MjMwNy4uMTc1ZGU0NCAxMDA2NDQK
LS0tIGEveGVuL2luY2x1ZGUvYXNtLWFybS9kb21haW4uaAorKysgYi94ZW4vaW5jbHVkZS9hc20t
YXJtL2RvbWFpbi5oCkBAIC0yMDgsMTIgKzIwOCw2IEBAIHZvaWQgdmNwdV9zaG93X2V4ZWN1dGlv
bl9zdGF0ZShzdHJ1Y3QgdmNwdSAqKTsKIHZvaWQgdmNwdV9zaG93X3JlZ2lzdGVycyhjb25zdCBz
dHJ1Y3QgdmNwdSAqKTsKIHZvaWQgdmNwdV9zd2l0Y2hfdG9fYWFyY2g2NF9tb2RlKHN0cnVjdCB2
Y3B1ICopOwogCi0vKiBPbiBBUk0sIHRoZSBudW1iZXIgb2YgVkNQVXMgaXMgbGltaXRlZCBieSB0
aGUgdHlwZSBvZiBHSUMgZW11bGF0ZWQuICovCi1zdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludCBk
b21haW5fbWF4X3ZjcHVzKGNvbnN0IHN0cnVjdCBkb21haW4gKmQpCi17Ci0gICAgcmV0dXJuIHZn
aWNfbWF4X3ZjcHVzKGQpOwotfQotCiAvKgogICogRHVlIHRvIHRoZSByZXN0cmljdGlvbiBvZiBH
SUN2MywgdGhlIG51bWJlciBvZiB2Q1BVcyBpbiBBRkYwIGlzCiAgKiBsaW1pdGVkIHRvIDE2LCB0
aHVzIG9ubHkgdGhlIGZpcnN0IDQgYml0cyBvZiBBRkYwIGFyZSBsZWdhbC4gV2Ugd2lsbApkaWZm
IC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLWFybS92Z2ljLmggYi94ZW4vaW5jbHVkZS9hc20tYXJt
L3ZnaWMuaAppbmRleCA1NmVkNWZlLi40NDdkMjRlIDEwMDY0NAotLS0gYS94ZW4vaW5jbHVkZS9h
c20tYXJtL3ZnaWMuaAorKysgYi94ZW4vaW5jbHVkZS9hc20tYXJtL3ZnaWMuaApAQCAtMjM0LDgg
KzIzNCw2IEBAIHN0cnVjdCB2Z2ljX29wcyB7CiAgICAgLyogbG9va3VwIHRoZSBzdHJ1Y3QgcGVu
ZGluZ19pcnEgZm9yIGEgZ2l2ZW4gTFBJIGludGVycnVwdCAqLwogICAgIHN0cnVjdCBwZW5kaW5n
X2lycSAqKCpscGlfdG9fcGVuZGluZykoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgaW50IHZs
cGkpOwogICAgIGludCAoKmxwaV9nZXRfcHJpb3JpdHkpKHN0cnVjdCBkb21haW4gKmQsIHVpbnQz
Ml90IHZscGkpOwotICAgIC8qIE1heGltdW0gbnVtYmVyIG9mIHZDUFUgc3VwcG9ydGVkICovCi0g
ICAgY29uc3QgdW5zaWduZWQgaW50IG1heF92Y3B1czsKIH07CiAKIC8qIE51bWJlciBvZiByYW5r
cyBvZiBpbnRlcnJ1cHQgcmVnaXN0ZXJzIGZvciBhIGRvbWFpbiAqLwpAQCAtMzUwLDcgKzM0OCw4
IEBAIGV4dGVybiB2b2lkIHZnaWNfY2xlYXJfcGVuZGluZ19pcnFzKHN0cnVjdCB2Y3B1ICp2KTsK
IAogZXh0ZXJuIGJvb2wgdmdpY19lbXVsYXRlKHN0cnVjdCBjcHVfdXNlcl9yZWdzICpyZWdzLCB1
bmlvbiBoc3IgaHNyKTsKIAotdW5zaWduZWQgaW50IHZnaWNfbWF4X3ZjcHVzKGNvbnN0IHN0cnVj
dCBkb21haW4gKmQpOworLyogTWF4aW11bSB2Q1BVcyBmb3IgYSBzcGVjaWZpYyB2R0lDIHZlcnNp
b24sIG9yIDAgZm9yIHVuc3VwcG9ydGVkLiAqLwordW5zaWduZWQgaW50IHZnaWNfbWF4X3ZjcHVz
KHVuc2lnbmVkIGludCBkb21jdGxfdmdpY192ZXJzaW9uKTsKIAogdm9pZCB2Z2ljX3YyX3NldHVw
X2h3KHBhZGRyX3QgZGJhc2UsIHBhZGRyX3QgY2Jhc2UsIHBhZGRyX3QgY3NpemUsCiAgICAgICAg
ICAgICAgICAgICAgICAgcGFkZHJfdCB2YmFzZSwgdWludDMyX3QgYWxpYXNlZF9vZmZzZXQpOwpk
aWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9kb21haW4uaCBiL3hlbi9pbmNsdWRlL2Fz
bS14ODYvZG9tYWluLmgKaW5kZXggNjQzZTY5YS4uMjc3Zjk5ZiAxMDA2NDQKLS0tIGEveGVuL2lu
Y2x1ZGUvYXNtLXg4Ni9kb21haW4uaAorKysgYi94ZW4vaW5jbHVkZS9hc20teDg2L2RvbWFpbi5o
CkBAIC02NjQsOCArNjY0LDYgQEAgdW5zaWduZWQgbG9uZyBwdl9ndWVzdF9jcjRfdG9fcmVhbF9j
cjQoY29uc3Qgc3RydWN0IHZjcHUgKnYpOwogICAgICAgICAgICAgIFg4Nl9DUjRfT1NYU0FWRSB8
IFg4Nl9DUjRfU01FUCB8ICAgICAgICAgICAgICAgXAogICAgICAgICAgICAgIFg4Nl9DUjRfRlNH
U0JBU0UgfCBYODZfQ1I0X1NNQVAgfCBYODZfQ1I0X1BDSURFKSkKIAotI2RlZmluZSBkb21haW5f
bWF4X3ZjcHVzKGQpIChpc19odm1fZG9tYWluKGQpID8gSFZNX01BWF9WQ1BVUyA6IE1BWF9WSVJU
X0NQVVMpCi0KIHN0YXRpYyBpbmxpbmUgc3RydWN0IHZjcHVfZ3Vlc3RfY29udGV4dCAqYWxsb2Nf
dmNwdV9ndWVzdF9jb250ZXh0KHZvaWQpCiB7CiAgICAgcmV0dXJuIHZtYWxsb2Moc2l6ZW9mKHN0
cnVjdCB2Y3B1X2d1ZXN0X2NvbnRleHQpKTsKLS0gCjIuMS40CgoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4t
ZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9t
YWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==
