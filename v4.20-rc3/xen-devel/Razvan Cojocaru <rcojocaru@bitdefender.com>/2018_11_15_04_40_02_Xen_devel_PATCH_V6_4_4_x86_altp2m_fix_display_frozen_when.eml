Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 15 Nov 2018 00:42:39 -0000
Received: from icoremail.net (unknown [209.85.214.173])
	by mail-app2 (Coremail) with SMTP id by_KCgD3_5vviOxbqgiTAQ--.43527S3;
	Thu, 15 Nov 2018 04:43:28 +0800 (CST)
Received: from mail-pl1-f173.google.com (unknown [209.85.214.173])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwAH7knqiOxbMD9AAA--.1993S3;
	Thu, 15 Nov 2018 04:43:22 +0800 (CST)
Received: by mail-pl1-f173.google.com with SMTP id y6-v6so765853plt.3
        for <xuliker@zju.edu.cn>; Wed, 14 Nov 2018 12:43:22 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:subject:precedence
         :list-id:list-unsubscribe:list-post:list-help:list-subscribe:cc
         :mime-version:content-transfer-encoding:errors-to:sender;
        bh=8o732//kQpMAgpFlJXEa0zxP+TGViUguR5icEZebDf0=;
        b=cJAX9GmwGI+mkeDtazWtKVcRg5BUhSnbYDj286C4Rl0/aNx8l0687LM4fU9QzHJ/Nk
         WLxFzNao4aFw2povV3cLDEuITEOgyXlYWmCmDh70r2Qe+xIncZOvkZQ+k72nsTjBitXc
         dpIS5YTHavpSVC2lXpXvzO9ivoCjz7VtioV2pPPEtFyHUNsYOk1wtjA+gooyf/iv3o4P
         iW1+Qo04K55485DQfRf4FwDLrFog/sqQaJlLygv0G1FVY6lxwiWXDv2tyK9SjYSvrBCU
         GXdzhXPQbfKQycpWZWjKdc3c8bZLwthXujAAmhcIfN7PoyRkxlxxNElROM4gOrMEBA48
         xHpw==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gLzJVCUzD8a3Ip9YC2a93XQAsWA16PdfCu5zjYCgdqcku7SdhDl
	Yu1vkDGhcmypGBBmzYK7XhNhz13+zNw6VX8XAw6d1UFT6gd6BqCF2g==
X-Received: by 2002:a17:902:6686:: with SMTP id e6-v6mr3349259plk.173.1542228202264;
        Wed, 14 Nov 2018 12:43:22 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:c304:0:0:0:0 with SMTP id g4-v6csp6292438pjt;
        Wed, 14 Nov 2018 12:43:21 -0800 (PST)
X-Google-Smtp-Source: AJdET5c/CJ1qpqyYIoiLuwMA/TlPoZxUftcfEK2Xjhg5AlKnD9+BDBwDiXr2bV5YCkxeEeGtCWif
X-Received: by 2002:a25:6642:: with SMTP id z2-v6mr3205160ybm.221.1542228201177;
        Wed, 14 Nov 2018 12:43:21 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542228201; cv=none;
        d=google.com; s=arc-20160816;
        b=Ke9Flg37HCUtZEcj+xTerT2ShgDveYs3Dw6aMV72fjKO74UFpOkQIQz7+M4u8rnMPD
         M4/8zyXasMiAeJAD5mN27wNXcla7qvGh+cc1unzaf6Of3zjZA9JddqFc1dNsxypaAslx
         MEPtGGsquesW8uoLVLVcX4PrL0Rcm4LkGEo+KOYNLRSUlFjax67ZS727lr4+Tt9HHYpj
         9jNGOGyW2UITqqfTPWPN4wa21tt5PxBsRyiXM+TaRfi9KVEHqf6lmIpMy4ctwOZ5JQki
         omSQPc/kgVXUn81CVNlCcGdhgXQFpUPzsQA7KXDt7K/kmi/Yr5ILbYLgwMwrqnsCxBe2
         1g1g==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:mime-version:cc
         :list-subscribe:list-help:list-post:list-unsubscribe:list-id
         :precedence:subject:references:in-reply-to:message-id:date:to:from;
        bh=8o732//kQpMAgpFlJXEa0zxP+TGViUguR5icEZebDf0=;
        b=cWOZqecrEbD3WmGi02soW6L2SHQSafgQuUECyptmSjlxt7ZfxHM7OBmn0FLay/MeWS
         Nnu1f5iTReNEsqCizgHGcmlzCNPbCH8VRFiwGjtmTZngcn2j28G1Tthf+d3fU2g8Px1G
         6VYPY5sAMl9kQUFaEsEtL3DMq6cXS34riShuSvmERoOSWglPAaH2+Ds4hNoT674B0PSd
         W7CgyW/EG2gwUW17Abqm2i7PUlhZHPqNy8CwNZ5IljTWmX8qZqwdS/xUTNOgAOLS0sJ8
         +86YjOXBqrR7X0k1wzL09fKzh4hHRLGh1/syb0nW9Lx1H+XHw9nExjDsKH+r9+TYHt+I
         699w==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id m22-v6si2601035ywd.171.2018.11.14.12.43.20
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 14 Nov 2018 12:43:21 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gN1xP-0008Vg-CX; Wed, 14 Nov 2018 20:40:15 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=MAvx=NZ=bitdefender.com=rcojocaru@srs-us1.protection.inumbo.net>)
 id 1gN1xN-0008V8-Nz
 for xen-devel@lists.xenproject.org; Wed, 14 Nov 2018 20:40:13 +0000
X-Inumbo-ID: 7b0ea6dc-e84d-11e8-b9c9-12d6303a7972
Received: from mx01.bbu.dsd.mx.bitdefender.com (unknown [91.199.104.161])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 7b0ea6dc-e84d-11e8-b9c9-12d6303a7972;
 Wed, 14 Nov 2018 20:40:11 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 77A92305FFBD; Wed, 14 Nov 2018 22:40:10 +0200 (EET)
Received: from rcojocaru.npunix.bitdefender.biz (unknown [10.17.12.174])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 6528B3084EF3;
 Wed, 14 Nov 2018 22:40:10 +0200 (EET)
From: Razvan Cojocaru <rcojocaru@bitdefender.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 14 Nov 2018 22:40:02 +0200
Message-Id: <1542228002-21075-5-git-send-email-rcojocaru@bitdefender.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1542228002-21075-1-git-send-email-rcojocaru@bitdefender.com>
References: <1542228002-21075-1-git-send-email-rcojocaru@bitdefender.com>
Subject: [Xen-devel] [PATCH V6 4/4] x86/altp2m: fix display frozen when
 switching to a new view early
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>, Wei Liu <wei.liu2@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>,
 Razvan Cojocaru <rcojocaru@bitdefender.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwAH7knqiOxbMD9AAA--.1993S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3Jr45XFW5XFW7ZF18Jr1DZFb_yoWfGryUpF
	n0yrn8WF45tFW2g3WfGws8ur4Yk3y8WFn5GFZYk345t342qFnrGr409w1UCr18CF93ZF1S
	yFyfKr17uayjy3DanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlab7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Ar0_tr1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Gr0_Cr1l84ACjcxK6I8E
	87Iv67AKxVWxJr0_GcWl84ACjcxK6I8E87Iv6xkF7I0E14v26F4UJVW0owAa7VCE64xvF2
	IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x082IY
	62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUJVWUGwAv7V
	C2z280aVAFwI0_Jr0_Gr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VW7MxkI7II2jI8vz4vEwIxGrwCYIxAIcVC0I7IYx2IY
	67AKxVWUCVW8JwCYIxAIcVC0I7IYx2IY6xkF7I0E14v26r1j6r4UMxvI42IY6I8E87Iv67
	AKxVW8Jr0_Cr1UMxvI42IY6I8E87Iv6xkF7I0E14v26r4UJVWxJr1l42xK82IYc2Ij64vI
	r41l42xK82IY64kExVAvwVAq07x20xyl4x8a6x804xWl4I8I3I0E4IkC6x0Yz7v_Jr0_Gr
	1lx2IqxVAqx4xG67AKxVWUJVWUGwC20s026x8GjcxK67AKxVWUGVWUWwC2zVAF1VAY17CE
	14v26r1q6r43MIIYrxkI7VAKI48JMIIF0xvE42xK8VAvwI8IcIk0rVW8JVW3JwCE64xvF2
	IEb7IF0Fy7YxBIdaVFxhVjvjDU0xZFpf9x07b6R6cUUUUU=

V2hlbiBhbiBuZXcgYWx0cDJtIHZpZXcgaXMgY3JlYXRlZCB2ZXJ5IGVhcmx5IG9uIGd1ZXN0IGJv
b3QsIHRoZQpkaXNwbGF5IHdpbGwgZnJlZXplIChhbHRob3VnaCB0aGUgZ3Vlc3Qgd2lsbCBydW4g
bm9ybWFsbHkpLiBUaGlzCm1heSBhbHNvIGhhcHBlbiBvbiByZXNpemluZyB0aGUgZGlzcGxheS4g
VGhlIHJlYXNvbiBpcyB0aGUgd2F5ClhlbiBjdXJyZW50bHkgKG1pcyloYW5kbGVzIGxvZ2RpcnR5
IFZHQTogaXQgaW50ZW50aW9uYWxseQptaXNjb25maWd1cmVzIFZHQSBwYWdlcyBzbyB0aGF0IHRo
ZXkgd2lsbCBmYXVsdC4KClRoZSBwcm9ibGVtIGlzIHRoYXQgaXQgb25seSBkb2VzIHRoaXMgaW4g
dGhlIGhvc3QgcDJtLiBPbmNlIHdlCnN3aXRjaCB0byBhIG5ldyBhbHRwMm0sIHRoZSBtaXNjb25m
aWd1cmVkIGVudHJpZXMgd2lsbCBubyBsb25nZXIKZmF1bHQsIHNvIHRoZSBkaXNwbGF5IHdpbGwg
bm90IGJlIHVwZGF0ZWQuCgpUaGlzIHBhdGNoOgoqIHVwZGF0ZXMgZXB0X2hhbmRsZV9taXNjb25m
aWcoKSB0byB1c2UgdGhlIGFjdGl2ZSBhbHRwMm0gaW5zdGVhZAogIG9mIHRoZSBob3N0cDJtOwoq
IG1vZGlmaWVzIHAybV9jaGFuZ2VfZW50cnlfdHlwZV9nbG9iYWwoKSwgcDJtX21lbW9yeV90eXBl
X2NoYW5nZWQKICBhbmQgcDJtX2NoYW5nZV90eXBlX3JhbmdlKCkgdG8gcHJvcGFnYXRlIHRoZWly
IGNoYW5nZXMgdG8gYWxsCiAgdmFsaWQgYWx0cDJtcy4KCldpdGggdGhlIGludHJvZHVjdGlvbiBv
ZiBhbHRwMm0gZmllbGRzIGluIHAybV9tZW1vcnlfdHlwZV9jaGFuZ2VkKCkKdGhlIHdob2xlIGZ1
bmN0aW9uIGhhcyBiZWVuIHB1dCB1bmRlciBDT05GSUdfSFZNLgoKU2lnbmVkLW9mZi1ieTogUmF6
dmFuIENvam9jYXJ1IDxyY29qb2NhcnVAYml0ZGVmZW5kZXIuY29tPgpTdWdnZXN0ZWQtYnk6IEdl
b3JnZSBEdW5sYXAgPGdlb3JnZS5kdW5sYXBAY2l0cml4LmNvbT4KUmV2aWV3ZWQtYnk6IEtldmlu
IFRpYW4gPGtldmluLnRpYW5AaW50ZWwuY29tPgoKLS0tCkNDOiBKdW4gTmFrYWppbWEgPGp1bi5u
YWthamltYUBpbnRlbC5jb20+CkNDOiBLZXZpbiBUaWFuIDxrZXZpbi50aWFuQGludGVsLmNvbT4K
Q0M6IEdlb3JnZSBEdW5sYXAgPGdlb3JnZS5kdW5sYXBAZXUuY2l0cml4LmNvbT4KQ0M6IEphbiBC
ZXVsaWNoIDxqYmV1bGljaEBzdXNlLmNvbT4KQ0M6IEFuZHJldyBDb29wZXIgPGFuZHJldy5jb29w
ZXIzQGNpdHJpeC5jb20+CkNDOiBXZWkgTGl1IDx3ZWkubGl1MkBjaXRyaXguY29tPgoKLS0tCkNo
YW5nZXMgc2luY2UgVjU6CiAtIEFkZGVkIEtldmluJ3MgUmV2aWV3ZWQtYnkuCiAtIEFkZGVkIGEg
bm90ZSBvbiBwMm1fbWVtb3J5X3R5cGVfY2hhbmdlZCgpIGJlaW5nIHVuZGVyIENPTkZJR19IVk0u
Ci0tLQogeGVuL2FyY2gveDg2L21tL3AybS1lcHQuYyB8ICAgOCArKysrCiB4ZW4vYXJjaC94ODYv
bW0vcDJtLXB0LmMgIHwgICA4ICsrKysKIHhlbi9hcmNoL3g4Ni9tbS9wMm0uYyAgICAgfCAxMTUg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLQogeGVuL2luY2x1
ZGUvYXNtLXg4Ni9wMm0uaCB8ICAgNiArLS0KIDQgZmlsZXMgY2hhbmdlZCwgMTE0IGluc2VydGlv
bnMoKyksIDIzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9wMm0t
ZXB0LmMgYi94ZW4vYXJjaC94ODYvbW0vcDJtLWVwdC5jCmluZGV4IGZhYmNkMDYuLmU2ZmE4NWYg
MTAwNjQ0Ci0tLSBhL3hlbi9hcmNoL3g4Ni9tbS9wMm0tZXB0LmMKKysrIGIveGVuL2FyY2gveDg2
L21tL3AybS1lcHQuYwpAQCAtNjU3LDYgKzY1Nyw5IEBAIGJvb2xfdCBlcHRfaGFuZGxlX21pc2Nv
bmZpZyh1aW50NjRfdCBncGEpCiAgICAgYm9vbF90IHNwdXJpb3VzOwogICAgIGludCByYzsKIAor
ICAgIGlmICggYWx0cDJtX2FjdGl2ZShjdXJyLT5kb21haW4pICkKKyAgICAgICAgcDJtID0gcDJt
X2dldF9hbHRwMm0oY3Vycik7CisKICAgICBwMm1fbG9jayhwMm0pOwogCiAgICAgc3B1cmlvdXMg
PSBjdXJyLT5hcmNoLmh2bS52bXguZXB0X3NwdXJpb3VzX21pc2NvbmZpZzsKQEAgLTE0NDAsNiAr
MTQ0MywxMSBAQCB2b2lkIHAybV9pbml0X2FsdHAybV9lcHQoc3RydWN0IGRvbWFpbiAqZCwgdW5z
aWduZWQgaW50IGkpCiAgICAgc3RydWN0IHAybV9kb21haW4gKmhvc3RwMm0gPSBwMm1fZ2V0X2hv
c3RwMm0oZCk7CiAgICAgc3RydWN0IGVwdF9kYXRhICplcHQ7CiAKKyAgICBwMm0tPm1heF9tYXBw
ZWRfcGZuID0gaG9zdHAybS0+bWF4X21hcHBlZF9wZm47CisgICAgcDJtLT5kZWZhdWx0X2FjY2Vz
cyA9IGhvc3RwMm0tPmRlZmF1bHRfYWNjZXNzOworICAgIHAybS0+ZG9tYWluID0gaG9zdHAybS0+
ZG9tYWluOworCisgICAgcDJtLT5nbG9iYWxfbG9nZGlydHkgPSBob3N0cDJtLT5nbG9iYWxfbG9n
ZGlydHk7CiAgICAgcDJtLT5lcHQuYWQgPSBob3N0cDJtLT5lcHQuYWQ7CiAgICAgcDJtLT5taW5f
cmVtYXBwZWRfZ2ZuID0gZ2ZuX3goSU5WQUxJRF9HRk4pOwogICAgIHAybS0+bWF4X3JlbWFwcGVk
X2dmbiA9IDA7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLXB0LmMgYi94ZW4vYXJj
aC94ODYvbW0vcDJtLXB0LmMKaW5kZXggNTVkZjE4NS4uMzgyODA4OCAxMDA2NDQKLS0tIGEveGVu
L2FyY2gveDg2L21tL3AybS1wdC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0tcHQuYwpAQCAt
MjksNiArMjksNyBAQAogI2luY2x1ZGUgPHhlbi9ldmVudC5oPgogI2luY2x1ZGUgPHhlbi90cmFj
ZS5oPgogI2luY2x1ZGUgPHB1YmxpYy92bV9ldmVudC5oPgorI2luY2x1ZGUgPGFzbS9hbHRwMm0u
aD4KICNpbmNsdWRlIDxhc20vZG9tYWluLmg+CiAjaW5jbHVkZSA8YXNtL3BhZ2UuaD4KICNpbmNs
dWRlIDxhc20vcGFnaW5nLmg+CkBAIC00NjQsNiArNDY1LDEzIEBAIGludCBwMm1fcHRfaGFuZGxl
X2RlZmVycmVkX2NoYW5nZXModWludDY0X3QgZ3BhKQogICAgIHN0cnVjdCBwMm1fZG9tYWluICpw
Mm0gPSBwMm1fZ2V0X2hvc3RwMm0oY3VycmVudC0+ZG9tYWluKTsKICAgICBpbnQgcmM7CiAKKyAg
ICAvKgorICAgICAqIFNob3VsZCBhbHRwMm0gZXZlciBiZSBlbmFibGVkIGZvciBOUFQgLyBzaGFk
b3cgdXNlLCB0aGlzIGNvZGUKKyAgICAgKiBzaG91bGQgYmUgdXBkYXRlZCB0byBtYWtlIHVzZSBv
ZiB0aGUgYWN0aXZlIGFsdHAybSwgbGlrZQorICAgICAqIGVwdF9oYW5kbGVfbWlzY29uZmlnKCku
CisgICAgICovCisgICAgQVNTRVJUKCFhbHRwMm1fYWN0aXZlKGN1cnJlbnQtPmRvbWFpbikpOwor
CiAgICAgcDJtX2xvY2socDJtKTsKICAgICByYyA9IGRvX3JlY2FsYyhwMm0sIFBGTl9ET1dOKGdw
YSkpOwogICAgIHAybV91bmxvY2socDJtKTsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9w
Mm0uYyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYwppbmRleCBhYmRmNDQzLi5jNDAxODA2IDEwMDY0
NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vcDJtLmMKKysrIGIveGVuL2FyY2gveDg2L21tL3AybS5j
CkBAIC0yNzcsNyArMjc3LDYgQEAgaW50IHAybV9pbml0KHN0cnVjdCBkb21haW4gKmQpCiBpbnQg
cDJtX2lzX2xvZ2RpcnR5X3JhbmdlKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sIHVuc2lnbmVkIGxv
bmcgc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZW5kKQog
ewotICAgIEFTU0VSVChwMm1faXNfaG9zdHAybShwMm0pKTsKICAgICBpZiAoIHAybS0+Z2xvYmFs
X2xvZ2RpcnR5IHx8CiAgICAgICAgICByYW5nZXNldF9jb250YWluc19yYW5nZShwMm0tPmxvZ2Rp
cnR5X3Jhbmdlcywgc3RhcnQsIGVuZCkgKQogICAgICAgICByZXR1cm4gMTsKQEAgLTI4NiwzMSAr
Mjg1LDc5IEBAIGludCBwMm1faXNfbG9nZGlydHlfcmFuZ2Uoc3RydWN0IHAybV9kb21haW4gKnAy
bSwgdW5zaWduZWQgbG9uZyBzdGFydCwKICAgICByZXR1cm4gMDsKIH0KIAorc3RhdGljIHZvaWQg
Y2hhbmdlX2VudHJ5X3R5cGVfZ2xvYmFsKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJtX3R5cGVfdCBvdCwgcDJtX3R5cGVfdCBu
dCkKK3sKKyAgICBwMm0tPmNoYW5nZV9lbnRyeV90eXBlX2dsb2JhbChwMm0sIG90LCBudCk7Cisg
ICAgcDJtLT5nbG9iYWxfbG9nZGlydHkgPSAobnQgPT0gcDJtX3JhbV9sb2dkaXJ0eSk7Cit9CisK
IHZvaWQgcDJtX2NoYW5nZV9lbnRyeV90eXBlX2dsb2JhbChzdHJ1Y3QgZG9tYWluICpkLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAybV90eXBlX3Qgb3QsIHAybV90eXBlX3Qg
bnQpCiB7Ci0gICAgc3RydWN0IHAybV9kb21haW4gKnAybSA9IHAybV9nZXRfaG9zdHAybShkKTsK
KyAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqaG9zdHAybSA9IHAybV9nZXRfaG9zdHAybShkKTsKIAog
ICAgIEFTU0VSVChvdCAhPSBudCk7CiAgICAgQVNTRVJUKHAybV9pc19jaGFuZ2VhYmxlKG90KSAm
JiBwMm1faXNfY2hhbmdlYWJsZShudCkpOwogCi0gICAgcDJtX2xvY2socDJtKTsKLSAgICBwMm0t
PmNoYW5nZV9lbnRyeV90eXBlX2dsb2JhbChwMm0sIG90LCBudCk7Ci0gICAgcDJtLT5nbG9iYWxf
bG9nZGlydHkgPSAobnQgPT0gcDJtX3JhbV9sb2dkaXJ0eSk7Ci0gICAgcDJtX3VubG9jayhwMm0p
OworICAgIHAybV9sb2NrKGhvc3RwMm0pOworCisgICAgY2hhbmdlX2VudHJ5X3R5cGVfZ2xvYmFs
KGhvc3RwMm0sIG90LCBudCk7CisKKyNpZmRlZiBDT05GSUdfSFZNCisgICAgaWYgKCB1bmxpa2Vs
eShhbHRwMm1fYWN0aXZlKGQpKSApCisgICAgeworICAgICAgICB1bnNpZ25lZCBpbnQgaTsKKwor
ICAgICAgICBmb3IgKCBpID0gMDsgaSA8IE1BWF9BTFRQMk07IGkrKyApCisgICAgICAgICAgICBp
ZiAoIGQtPmFyY2guYWx0cDJtX2VwdHBbaV0gIT0gbWZuX3goSU5WQUxJRF9NRk4pICkKKyAgICAg
ICAgICAgIHsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqYWx0cDJtID0gZC0+
YXJjaC5hbHRwMm1fcDJtW2ldOworCisgICAgICAgICAgICAgICAgcDJtX2xvY2soYWx0cDJtKTsK
KyAgICAgICAgICAgICAgICBjaGFuZ2VfZW50cnlfdHlwZV9nbG9iYWwoYWx0cDJtLCBvdCwgbnQp
OworICAgICAgICAgICAgICAgIHAybV91bmxvY2soYWx0cDJtKTsKKyAgICAgICAgICAgIH0KKyAg
ICB9CisjZW5kaWYKKworICAgIHAybV91bmxvY2soaG9zdHAybSk7Cit9CisKKyNpZmRlZiBDT05G
SUdfSFZNCisvKiBUaGVyZSdzIGFscmVhZHkgYSBtZW1vcnlfdHlwZV9jaGFuZ2VkKCkgaW4gYXNt
L210cnIuaC4gKi8KK3N0YXRpYyB2b2lkIF9tZW1vcnlfdHlwZV9jaGFuZ2VkKHN0cnVjdCBwMm1f
ZG9tYWluICpwMm0pCit7CisgICAgaWYgKCBwMm0tPm1lbW9yeV90eXBlX2NoYW5nZWQgKQorICAg
ICAgICBwMm0tPm1lbW9yeV90eXBlX2NoYW5nZWQocDJtKTsKIH0KIAogdm9pZCBwMm1fbWVtb3J5
X3R5cGVfY2hhbmdlZChzdHJ1Y3QgZG9tYWluICpkKQogewotICAgIHN0cnVjdCBwMm1fZG9tYWlu
ICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CisgICAgc3RydWN0IHAybV9kb21haW4gKmhvc3Rw
Mm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CiAKLSAgICBpZiAoIHAybS0+bWVtb3J5X3R5cGVfY2hh
bmdlZCApCisgICAgcDJtX2xvY2soaG9zdHAybSk7CisKKyAgICBfbWVtb3J5X3R5cGVfY2hhbmdl
ZChob3N0cDJtKTsKKworICAgIGlmICggdW5saWtlbHkoYWx0cDJtX2FjdGl2ZShkKSkgKQogICAg
IHsKLSAgICAgICAgcDJtX2xvY2socDJtKTsKLSAgICAgICAgcDJtLT5tZW1vcnlfdHlwZV9jaGFu
Z2VkKHAybSk7Ci0gICAgICAgIHAybV91bmxvY2socDJtKTsKKyAgICAgICAgdW5zaWduZWQgaW50
IGk7CisKKyAgICAgICAgZm9yICggaSA9IDA7IGkgPCBNQVhfQUxUUDJNOyBpKysgKQorICAgICAg
ICAgICAgaWYgKCBkLT5hcmNoLmFsdHAybV9lcHRwW2ldICE9IG1mbl94KElOVkFMSURfTUZOKSAp
CisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgc3RydWN0IHAybV9kb21haW4gKmFsdHAy
bSA9IGQtPmFyY2guYWx0cDJtX3AybVtpXTsKKworICAgICAgICAgICAgICAgIHAybV9sb2NrKGFs
dHAybSk7CisgICAgICAgICAgICAgICAgX21lbW9yeV90eXBlX2NoYW5nZWQoYWx0cDJtKTsKKyAg
ICAgICAgICAgICAgICBwMm1fdW5sb2NrKGFsdHAybSk7CisgICAgICAgICAgICB9CiAgICAgfQor
CisgICAgcDJtX3VubG9jayhob3N0cDJtKTsKIH0KKyNlbmRpZgogCiBpbnQgcDJtX3NldF9pb3Jl
cV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgZmxhZ3MsCkBAIC05OTEsMTggKzEwMzgsMTQgQEAgaW50IHAybV9jaGFuZ2VfdHlw
ZV9vbmUoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm5fbCwKIH0KIAogLyogTW9k
aWZ5IHRoZSBwMm0gdHlwZSBvZiBhIHJhbmdlIG9mIGdmbnMgZnJvbSBvdCB0byBudC4gKi8KLXZv
aWQgcDJtX2NoYW5nZV90eXBlX3JhbmdlKHN0cnVjdCBkb21haW4gKmQsIAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBzdGFydCwgdW5zaWduZWQgbG9uZyBlbmQsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICBwMm1fdHlwZV90IG90LCBwMm1fdHlwZV90IG50KQor
c3RhdGljIHZvaWQgY2hhbmdlX3R5cGVfcmFuZ2Uoc3RydWN0IHAybV9kb21haW4gKnAybSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgc3RhcnQsIHVuc2lnbmVk
IGxvbmcgZW5kLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJtX3R5cGVfdCBvdCwg
cDJtX3R5cGVfdCBudCkKIHsKICAgICB1bnNpZ25lZCBsb25nIGdmbiA9IHN0YXJ0OwotICAgIHN0
cnVjdCBwMm1fZG9tYWluICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CisgICAgc3RydWN0IGRv
bWFpbiAqZCA9IHAybS0+ZG9tYWluOwogICAgIGludCByYyA9IDA7CiAKLSAgICBBU1NFUlQob3Qg
IT0gbnQpOwotICAgIEFTU0VSVChwMm1faXNfY2hhbmdlYWJsZShvdCkgJiYgcDJtX2lzX2NoYW5n
ZWFibGUobnQpKTsKLQotICAgIHAybV9sb2NrKHAybSk7CiAgICAgcDJtLT5kZWZlcl9uZXN0ZWRf
Zmx1c2ggPSAxOwogCiAgICAgaWYgKCB1bmxpa2VseShlbmQgPiBwMm0tPm1heF9tYXBwZWRfcGZu
KSApCkBAIC0xMDQ2LDcgKzEwODksMzkgQEAgdm9pZCBwMm1fY2hhbmdlX3R5cGVfcmFuZ2Uoc3Ry
dWN0IGRvbWFpbiAqZCwKICAgICBwMm0tPmRlZmVyX25lc3RlZF9mbHVzaCA9IDA7CiAgICAgaWYg
KCBuZXN0ZWRodm1fZW5hYmxlZChkKSApCiAgICAgICAgIHAybV9mbHVzaF9uZXN0ZWRwMm0oZCk7
Ci0gICAgcDJtX3VubG9jayhwMm0pOworfQorCit2b2lkIHAybV9jaGFuZ2VfdHlwZV9yYW5nZShz
dHJ1Y3QgZG9tYWluICpkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9u
ZyBzdGFydCwgdW5zaWduZWQgbG9uZyBlbmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBw
Mm1fdHlwZV90IG90LCBwMm1fdHlwZV90IG50KQoreworICAgIHN0cnVjdCBwMm1fZG9tYWluICpo
b3N0cDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOworCisgICAgQVNTRVJUKG90ICE9IG50KTsKKyAg
ICBBU1NFUlQocDJtX2lzX2NoYW5nZWFibGUob3QpICYmIHAybV9pc19jaGFuZ2VhYmxlKG50KSk7
CisKKyAgICBwMm1fbG9jayhob3N0cDJtKTsKKworICAgIGNoYW5nZV90eXBlX3JhbmdlKGhvc3Rw
Mm0sIHN0YXJ0LCBlbmQsIG90LCBudCk7CisKKyNpZmRlZiBDT05GSUdfSFZNCisgICAgaWYgKCB1
bmxpa2VseShhbHRwMm1fYWN0aXZlKGQpKSApCisgICAgeworICAgICAgICB1bnNpZ25lZCBpbnQg
aTsKKworICAgICAgICBmb3IgKCBpID0gMDsgaSA8IE1BWF9BTFRQMk07IGkrKyApCisgICAgICAg
ICAgICBpZiAoIGQtPmFyY2guYWx0cDJtX2VwdHBbaV0gIT0gbWZuX3goSU5WQUxJRF9NRk4pICkK
KyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqYWx0cDJt
ID0gZC0+YXJjaC5hbHRwMm1fcDJtW2ldOworCisgICAgICAgICAgICAgICAgcDJtX2xvY2soYWx0
cDJtKTsKKyAgICAgICAgICAgICAgICBjaGFuZ2VfdHlwZV9yYW5nZShhbHRwMm0sIHN0YXJ0LCBl
bmQsIG90LCBudCk7CisgICAgICAgICAgICAgICAgcDJtX3VubG9jayhhbHRwMm0pOworICAgICAg
ICAgICAgfQorICAgIH0KKyNlbmRpZgorCisgICAgcDJtX3VubG9jayhob3N0cDJtKTsKIH0KIAog
LyoKZGlmZiAtLWdpdCBhL3hlbi9pbmNsdWRlL2FzbS14ODYvcDJtLmggYi94ZW4vaW5jbHVkZS9h
c20teDg2L3AybS5oCmluZGV4IGM3ZjU3MTAuLmJlNWI3YTIgMTAwNjQ0Ci0tLSBhL3hlbi9pbmNs
dWRlL2FzbS14ODYvcDJtLmgKKysrIGIveGVuL2luY2x1ZGUvYXNtLXg4Ni9wMm0uaApAQCAtNjMw
LDkgKzYzMCw2IEBAIGludCBwMm1fZmluaXNoX3R5cGVfY2hhbmdlKHN0cnVjdCBkb21haW4gKmQs
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZm5fdCBmaXJzdF9nZm4sCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIG1heF9ucik7CiAKLS8qIFJlcG9ydCBhIGNo
YW5nZSBhZmZlY3RpbmcgbWVtb3J5IHR5cGVzLiAqLwotdm9pZCBwMm1fbWVtb3J5X3R5cGVfY2hh
bmdlZChzdHJ1Y3QgZG9tYWluICpkKTsKLQogaW50IHAybV9pc19sb2dkaXJ0eV9yYW5nZShzdHJ1
Y3QgcDJtX2RvbWFpbiAqLCB1bnNpZ25lZCBsb25nIHN0YXJ0LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICB1bnNpZ25lZCBsb25nIGVuZCk7CiAKQEAgLTY2Myw2ICs2NjAsOSBAQCB2b2lkIHAy
bV9wb2RfZHVtcF9kYXRhKHN0cnVjdCBkb21haW4gKmQpOwogCiAjaWZkZWYgQ09ORklHX0hWTQog
CisvKiBSZXBvcnQgYSBjaGFuZ2UgYWZmZWN0aW5nIG1lbW9yeSB0eXBlcy4gKi8KK3ZvaWQgcDJt
X21lbW9yeV90eXBlX2NoYW5nZWQoc3RydWN0IGRvbWFpbiAqZCk7CisKIC8qIENhbGxlZCBieSBw
Mm0gY29kZSB3aGVuIGRlbWFuZC1wb3B1bGF0aW5nIGEgUG9EIHBhZ2UgKi8KIGJvb2wKIHAybV9w
b2RfZGVtYW5kX3BvcHVsYXRlKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sIGdmbl90IGdmbiwgdW5z
aWduZWQgaW50IG9yZGVyKTsKLS0gCjIuNy40CgoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVsIG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlz
dHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xp
c3RpbmZvL3hlbi1kZXZlbA==
