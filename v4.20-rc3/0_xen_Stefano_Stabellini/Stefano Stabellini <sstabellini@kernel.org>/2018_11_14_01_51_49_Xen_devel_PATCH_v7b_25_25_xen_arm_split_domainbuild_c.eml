Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 14 Nov 2018 00:35:49 -0000
Received: from icoremail.net (unknown [209.85.214.177])
	by mail-app2 (Coremail) with SMTP id by_KCgDHH7bPD+tbcuiHAQ--.41146S3;
	Wed, 14 Nov 2018 01:54:24 +0800 (CST)
Received: from mail-pl1-f177.google.com (unknown [209.85.214.177])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwBXMj7KD+tb4Zg5AA--.4087S3;
	Wed, 14 Nov 2018 01:54:18 +0800 (CST)
Received: by mail-pl1-f177.google.com with SMTP id p4-v6so6377056plo.5
        for <xuliker@zju.edu.cn>; Tue, 13 Nov 2018 09:54:18 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:delivered-to:dkim-signature:from:to:date
         :message-id:in-reply-to:references:subject:precedence:list-id
         :list-unsubscribe:list-post:list-help:list-subscribe:cc:mime-version
         :content-transfer-encoding:errors-to:sender;
        bh=J6+WiVdTn3/nL07aOaw//GBKgb71+mxaoMdeco6L4A0=;
        b=DMrboed+nf6+IwFc70Xti9e3gI1eU+xSZd2vcQk56KKpFpDCe/O0CNe6cuM9jpUMZF
         3O+aquLDrgnovQHE7nNDJ+LOewMeBBrt48hb/NnsC1PCHjry3mFlp8xzMMGxGjgXn7sc
         ffrzonfSBKjOB8JkIcZPKZvEporpPmsDk0zSEQjXVa+yvZEQLzq5jce9KwublgdQb2VU
         LiZArkF0PP5F7SK1dXFNRELEsdoVqAkhVLGPPtcmRAIdSvxBhrtZOQrxX5LNZxPwkTl+
         LrZh+y2GuxvW0btZmmljL1+gZGjpK4p1GroUHz0Y3Uix16owCsBUFVyfRG29Lilr9VgF
         IKXQ==
X-Gm-Message-State: AGRZ1gJosVRgyrRzMiJofxWvi/NoaucmC9vN2H29htXAkWAyU3ZFvn5e
	jSFTOkpgbE3HsDvm/RIKWvN9NJQbNGRS0zqkhuN8WqyrJJMolmJOyw==
X-Received: by 2002:a17:902:560f:: with SMTP id h15-v6mr6220386pli.160.1542131657911;
        Tue, 13 Nov 2018 09:54:17 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:c304:0:0:0:0 with SMTP id g4-v6csp4784078pjt;
        Tue, 13 Nov 2018 09:54:15 -0800 (PST)
X-Google-Smtp-Source: AJdET5fuikMCVHDYGTDD3ojvnvfhuP4tcq0vM1+t/SEoKvv/MkMUDPyQv53JVQFegxx8GuWMSMNo
X-Received: by 2002:a25:4a88:: with SMTP id x130-v6mr5818906yba.97.1542131655499;
        Tue, 13 Nov 2018 09:54:15 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542131655; cv=none;
        d=google.com; s=arc-20160816;
        b=NIeUArTSAP4LSqRzqrW5/SBp1zbevNFFhJCN8iAL09hTlDeuJWWlGDOt6LnuynuXPZ
         6RJ97FxVMRUlIWT7nQ9T0Gv9mnfxUE/Qq62kkRCxj7q5neFpu0Qhuixf26PeOW4i+GSo
         gwsAvENPj5OMWWlbN7wuYj0dlw7Z1CqBc3j3ygMyfbH+nbLEqytez/hyw3wgld/NYXJz
         s9HQBD8V8uElSfoGbys8eGzp5FrzUqxhfHvCNYcZiQRAEtzj7aTAVp/fhiMwQigFlKHI
         cCr2+2a3YtbgI3x/fzRg7fNxODch7tz8C41WcOeY3RgFRe3cv6J8vpR5nMFSYLb+ja39
         N8Ng==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:mime-version:cc
         :list-subscribe:list-help:list-post:list-unsubscribe:list-id
         :precedence:subject:references:in-reply-to:message-id:date:to:from
         :dkim-signature;
        bh=J6+WiVdTn3/nL07aOaw//GBKgb71+mxaoMdeco6L4A0=;
        b=DzSsocxgx7v5p0HRBdchZipwOjpZvvEDFY9VqYCyuVKIQl2BXSc9IOUPjKdN5STwFl
         t5uWD2iPoL7Ji5I7rSMRjsJVxvYL3TY1Z/3uS2rr9KEK7LrlArQaHTPwwLvIg3KHmDzQ
         h9eV09RcVLrFnMl/ocTzlzoDtpTIc32FJ+v+1I+6ohlY8pSXKFO4/T+feItDLtf7QeQj
         eNQ8kqL2o0Jdfp0WM5E9wRInFSkqt5c/M+iq2y2kOM0Qa+kjq7YpJKlWNtdi9GMN/6nY
         /DeEYyPIpSU4votQ8YxATWkNcsNqS8wTb5yOHOFX2ydYS/BNl2UYw6/Y9fiXpT2liIOf
         igEQ==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=neutral (body hash did not verify) header.i=@kernel.org header.s=default header.b=XPU+HebJ;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org;
       dmarc=fail (p=NONE sp=NONE dis=NONE) header.from=kernel.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id 85-v6si12471207ywn.30.2018.11.13.09.54.14
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Tue, 13 Nov 2018 09:54:15 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gMcrD-0003ni-Nz; Tue, 13 Nov 2018 17:52:11 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=+wyv=ny=kernel.org=sstabellini@srs-us1.protection.inumbo.net>)
 id 1gMcr8-0003ds-Un
 for xen-devel@lists.xen.org; Tue, 13 Nov 2018 17:52:07 +0000
X-Inumbo-ID: d4fee2c4-e76c-11e8-9205-12d6303a7972
Received: from mail.kernel.org (unknown [198.145.29.99])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id d4fee2c4-e76c-11e8-9205-12d6303a7972;
 Tue, 13 Nov 2018 17:52:05 +0000 (UTC)
Received: from sstabellini-ThinkPad-X260.xilinx.com
 (c-67-164-102-47.hsd1.ca.comcast.net [67.164.102.47])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id 82E3A22507;
 Tue, 13 Nov 2018 17:52:04 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=default; t=1542131524;
 bh=sEa3SHjCRlGvSdENUNwqB7PmxFnMc2BcdPPLn1z9QDI=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=XPU+HebJR0RIzIqnpZGJarsIwbud9BkDMRQNv8ny5dmLybNU2oQNmnKEHbMw220dO
 nDDY9UkFsJO08s9/QOgLA8gaRmAEDaujl3Fe3kqYnm8lqE5cVFTr2acEMSvzdeXxV9
 Y9DjDb+96MJHqJWcQB5Dp/RVZu6MVZsyg1QPtSrY=
From: Stefano Stabellini <sstabellini@kernel.org>
To: julien.grall@arm.com
Date: Tue, 13 Nov 2018 09:51:49 -0800
Message-Id: <1542131509-17661-25-git-send-email-sstabellini@kernel.org>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <alpine.DEB.2.10.1811130950520.8259@sstabellini-ThinkPad-X260>
References: <alpine.DEB.2.10.1811130950520.8259@sstabellini-ThinkPad-X260>
Subject: [Xen-devel] [PATCH v7b 25/25] xen/arm: split domain_build.c
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Stefano Stabellini <stefanos@xilinx.com>, Achin.Gupta@arm.com,
 sstabellini@kernel.org, andrii_anisov@epam.com, xen-devel@lists.xen.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwBXMj7KD+tb4Zg5AA--.4087S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvAXoWftFWrJryxKFWUKrW8WFW3ZFb_yoW5KF4Uuo
	ZrX3Z8Xw48WryfGrWDG34qga4UZ3Z5G3ZxA3yrAFsxX3WkJr45JF4fCa15Aaya9F13KF4k
	ZFW7tw17Jw4xKF4fn29KB7ZKAUJUUUUU529EdanIXcx71UUUUj7v73VFW2AGmfu7jjvjm3
	AaLaJ3UjIYCTnIWjp_UUUo37k0a2IF6w4kM7kC6x804xWl14x267AKxVWUJVW8JwAFIxvE
	14AKwVWUJVWUGwA2ocxC64kIII0Yj41l84x0c7CEw4AK67xGY2AK021l84ACjcxK6xIIjx
	v20xvE14v26F1j6w1UM28EF7xvwVC0I7IYx2IY6xkF7I0E14v26r4j6F4UM28EF7xvwVC2
	z280aVAFwI0_Gr1j6F4UJwA2z4x0Y4vEx4A2jsIEc7CjxVAFwI0_Gr1j6F4UJwAa7VCE64
	xvF2IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x0
	82IY62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUJVWUGw
	Av7VC2z280aVAFwI0_Jr0_Gr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48J
	M4xvF2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8V
	AvwVCFzxkY4VCF77xAMxkIecxEwVCI4VW8MxkI7II2jI8vz4vEwIxGrwCYIxAIcVC0I7IY
	x2IY67AKxVW8JVW5JwCYIxAIcVC0I7IYx2IY6xkF7I0E14v26r4j6F4UMxvI42IY6I8E87
	Iv67AKxVW8Jr0_Cr1UMxvI42IY6I8E87Iv6xkF7I0E14v26r4UJVWxJr1l42xK82IYc2Ij
	64vIr41l42xK82IY64kExVAvwVAq07x20xyl4x8a6x804xWl4I8I3I0E4IkC6x0Yz7v_Jr
	0_Gr1lx2IqxVAqx4xG67AKxVWUJVWUGwC20s026x8GjcxK67AKxVWUGVWUWwC2zVAF1VAY
	17CE14v26r126r1DMIIYrxkI7VAKI48JMIIF0xvE42xK8VAvwI8IcIk0rVW8JVW3JwCE64
	xvF2IEb7IF0Fy7YxBIdaVFxhVjvjDU0xZFpf9x07bfL0OUUUUU=

ZG9tYWluX2J1aWxkLmMgaXMgdG9vIGxhcmdlLgoKTW92ZSBhbGwgdGhlIEFDUEkgc3BlY2lmaWMg
ZGV2aWNlIHRyZWUgZ2VuZXJhdGluZyBmdW5jdGlvbnMgZnJvbQpkb21haW5fYnVpbGQuYyB0byBh
Y3BpL2RvbWFpbl9idWlsZC5jLgoKU2lnbmVkLW9mZi1ieTogU3RlZmFubyBTdGFiZWxsaW5pIDxz
dGVmYW5vc0B4aWxpbnguY29tPgpBY2tlZC1ieTogSnVsaWVuIEdyYWxsIDxqdWxpZW4uZ3JhbGxA
YXJtLmNvbT4KLS0tCgpDaGFuZ2VzIGluIHY3OgotIGJ1aWxkIGRvbWFpbl9idWlsZC5pbml0Lm8K
LSByZW1vdmUgInN0YXRpYyIgZnJvbSBwcmVwYXJlX2FjcGkgaW1wbGVtZW50YXRpb24KCkNoYW5n
ZXMgaW4gdjY6Ci0gZml4IGxpY2Vuc2UKCkNoYW5nZXMgaW4gdjQ6Ci0gcmVuYW1lIGFjcGlfZHRf
YnVpbGQgdG8gZG9tYWluX2J1aWxkLmMKLSBhZGQgY29weXJpZ2h0IGhlYWRlcgotIHJlbW92ZSB1
c2VsZXNzICNpbmNsdWRlCi0gcmVtb3ZlIGFjcGlfZHRfYnVpbGQuaCwgYWRkIGRvbWFpbl9idWls
ZC5oCi0tLQogeGVuL2FyY2gvYXJtL2FjcGkvTWFrZWZpbGUgICAgICAgICB8ICAgMSArCiB4ZW4v
YXJjaC9hcm0vYWNwaS9kb21haW5fYnVpbGQuYyAgIHwgNTkxICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysKIHhlbi9hcmNoL2FybS9kb21haW5fYnVpbGQuYyAgICAgICAgfCA1
ODUgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiB4ZW4vaW5jbHVkZS9hc20t
YXJtL2RvbWFpbl9idWlsZC5oIHwgIDMxICsrCiA0IGZpbGVzIGNoYW5nZWQsIDYyOCBpbnNlcnRp
b25zKCspLCA1ODAgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgeGVuL2FyY2gvYXJt
L2FjcGkvZG9tYWluX2J1aWxkLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCB4ZW4vaW5jbHVkZS9hc20t
YXJtL2RvbWFpbl9idWlsZC5oCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gvYXJtL2FjcGkvTWFrZWZp
bGUgYi94ZW4vYXJjaC9hcm0vYWNwaS9NYWtlZmlsZQppbmRleCAyMzk2M2Y4Li4yNzRkYzJlIDEw
MDY0NAotLS0gYS94ZW4vYXJjaC9hcm0vYWNwaS9NYWtlZmlsZQorKysgYi94ZW4vYXJjaC9hcm0v
YWNwaS9NYWtlZmlsZQpAQCAtMSwyICsxLDMgQEAKIG9iai15ICs9IGxpYi5vCitvYmoteSArPSBk
b21haW5fYnVpbGQuaW5pdC5vCiBvYmoteSArPSBib290LmluaXQubwpkaWZmIC0tZ2l0IGEveGVu
L2FyY2gvYXJtL2FjcGkvZG9tYWluX2J1aWxkLmMgYi94ZW4vYXJjaC9hcm0vYWNwaS9kb21haW5f
YnVpbGQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi41YWFlMzJhCi0tLSAv
ZGV2L251bGwKKysrIGIveGVuL2FyY2gvYXJtL2FjcGkvZG9tYWluX2J1aWxkLmMKQEAgLTAsMCAr
MSw1OTEgQEAKKy8qCisgKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiBy
ZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQorICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRo
ZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgYXMKKyAqIHB1Ymxpc2hlZCBi
eSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLgorICoKKyAqIFRoaXMgcHJvZ3JhbSBpcyBk
aXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAorICogYnV0IFdJ
VEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YK
KyAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4g
IFNlZSB0aGUKKyAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMu
CisgKi8KKworI2luY2x1ZGUgPHhlbi9tbS5oPgorI2luY2x1ZGUgPHhlbi9zY2hlZC5oPgorI2lu
Y2x1ZGUgPHhlbi9hY3BpLmg+CisjaW5jbHVkZSA8eGVuL2V2ZW50Lmg+CisjaW5jbHVkZSA8eGVu
L2lvY2FwLmg+CisjaW5jbHVkZSA8eGVuL2RldmljZV90cmVlLmg+CisjaW5jbHVkZSA8eGVuL2xp
YmZkdC9saWJmZHQuaD4KKyNpbmNsdWRlIDxhY3BpL2FjdGFibGVzLmg+CisjaW5jbHVkZSA8YXNt
L2tlcm5lbC5oPgorI2luY2x1ZGUgPGFzbS9kb21haW5fYnVpbGQuaD4KKworLyogT3ZlcnJpZGUg
bWFjcm9zIGZyb20gYXNtL3BhZ2UuaCB0byBtYWtlIHRoZW0gd29yayB3aXRoIG1mbl90ICovCisj
dW5kZWYgdmlydF90b19tZm4KKyNkZWZpbmUgdmlydF90b19tZm4odmEpIF9tZm4oX192aXJ0X3Rv
X21mbih2YSkpCisKKyNkZWZpbmUgQUNQSV9ET00wX0ZEVF9NSU5fU0laRSA0MDk2CisKK3N0YXRp
YyBpbnQgX19pbml0IGFjcGlfaW9tZW1fZGVueV9hY2Nlc3Moc3RydWN0IGRvbWFpbiAqZCkKK3sK
KyAgICBhY3BpX3N0YXR1cyBzdGF0dXM7CisgICAgc3RydWN0IGFjcGlfdGFibGVfc3BjciAqc3Bj
ciA9IE5VTEw7CisgICAgdW5zaWduZWQgbG9uZyBtZm47CisgICAgaW50IHJjOworCisgICAgLyog
Rmlyc3RseSBwZXJtaXQgZnVsbCBNTUlPIGNhcGFiaWxpdGllcy4gKi8KKyAgICByYyA9IGlvbWVt
X3Blcm1pdF9hY2Nlc3MoZCwgMFVMLCB+MFVMKTsKKyAgICBpZiAoIHJjICkKKyAgICAgICAgcmV0
dXJuIHJjOworCisgICAgLyogVE9ETzogRGVueSBNTUlPIGFjY2VzcyBmb3IgU01NVSwgR0lDIElU
UyAqLworICAgIHN0YXR1cyA9IGFjcGlfZ2V0X3RhYmxlKEFDUElfU0lHX1NQQ1IsIDAsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgKHN0cnVjdCBhY3BpX3RhYmxlX2hlYWRlciAqKikmc3Bj
cik7CisKKyAgICBpZiAoIEFDUElfRkFJTFVSRShzdGF0dXMpICkKKyAgICB7CisgICAgICAgIHBy
aW50aygiRmFpbGVkIHRvIGdldCBTUENSIHRhYmxlXG4iKTsKKyAgICAgICAgcmV0dXJuIC1FSU5W
QUw7CisgICAgfQorCisgICAgbWZuID0gc3Bjci0+c2VyaWFsX3BvcnQuYWRkcmVzcyA+PiBQQUdF
X1NISUZUOworICAgIC8qIERlbnkgTU1JTyBhY2Nlc3MgZm9yIFVBUlQgKi8KKyAgICByYyA9IGlv
bWVtX2RlbnlfYWNjZXNzKGQsIG1mbiwgbWZuICsgMSk7CisgICAgaWYgKCByYyApCisgICAgICAg
IHJldHVybiByYzsKKworICAgIC8qIERlbnkgTU1JTyBhY2Nlc3MgZm9yIEdJQyByZWdpb25zICov
CisgICAgcmV0dXJuIGdpY19pb21lbV9kZW55X2FjY2VzcyhkKTsKK30KKworc3RhdGljIGludCBf
X2luaXQgYWNwaV9yb3V0ZV9zcGlzKHN0cnVjdCBkb21haW4gKmQpCit7CisgICAgaW50IGksIHJl
czsKKyAgICBzdHJ1Y3QgaXJxX2Rlc2MgKmRlc2M7CisKKyAgICAvKgorICAgICAqIFJvdXRlIHRo
ZSBJUlEgdG8gaGFyZHdhcmUgZG9tYWluIGFuZCBwZXJtaXQgdGhlIGFjY2Vzcy4KKyAgICAgKiBU
aGUgaW50ZXJydXB0IHR5cGUgd2lsbCBiZSBzZXQgYnkgc2V0IGJ5IHRoZSBoYXJkd2FyZSBkb21h
aW4uCisgICAgICovCisgICAgZm9yKCBpID0gTlJfTE9DQUxfSVJRUzsgaSA8IHZnaWNfbnVtX2ly
cXMoZCk7IGkrKyApCisgICAgeworICAgICAgICAvKgorICAgICAgICAgKiBUT0RPOiBFeGNsdWRl
IHRoZSBTUElzIFNNTVUgdXNlcyB3aGljaCBzaG91bGQgbm90IGJlIHJvdXRlZCB0bworICAgICAg
ICAgKiB0aGUgaGFyZHdhcmUgZG9tYWluLgorICAgICAgICAgKi8KKyAgICAgICAgZGVzYyA9IGly
cV90b19kZXNjKGkpOworICAgICAgICBpZiAoIGRlc2MtPmFjdGlvbiAhPSBOVUxMKQorICAgICAg
ICAgICAgY29udGludWU7CisKKyAgICAgICAgLyogWFhYOiBTaGFsbCB3ZSB1c2UgYSBwcm9wZXIg
ZGV2bmFtZT8gKi8KKyAgICAgICAgcmVzID0gbWFwX2lycV90b19kb21haW4oZCwgaSwgdHJ1ZSwg
IkFDUEkiKTsKKyAgICAgICAgaWYgKCByZXMgKQorICAgICAgICAgICAgcmV0dXJuIHJlczsKKyAg
ICB9CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCBfX2luaXQgYWNwaV9tYWtlX2h5
cGVydmlzb3Jfbm9kZShjb25zdCBzdHJ1Y3Qga2VybmVsX2luZm8gKmtpbmZvLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgbWVtYmFuayB0YmxfYWRk
W10pCit7CisgICAgY29uc3QgY2hhciBjb21wYXRbXSA9CisgICAgICAgICJ4ZW4seGVuLSJfX3N0
cmluZ2lmeShYRU5fVkVSU0lPTikiLiJfX3N0cmluZ2lmeShYRU5fU1VCVkVSU0lPTikiXDAiCisg
ICAgICAgICJ4ZW4seGVuIjsKKyAgICBpbnQgcmVzOworICAgIC8qIENvbnZlbmllbmNlIGFsaWFz
ICovCisgICAgdm9pZCAqZmR0ID0ga2luZm8tPmZkdDsKKworICAgIGR0X2RwcmludGsoIkNyZWF0
ZSBoeXBlcnZpc29yIG5vZGVcbiIpOworCisgICAgLyogU2VlIGxpbnV4IERvY3VtZW50YXRpb24v
ZGV2aWNldHJlZS9iaW5kaW5ncy9hcm0veGVuLnR4dCAqLworICAgIHJlcyA9IGZkdF9iZWdpbl9u
b2RlKGZkdCwgImh5cGVydmlzb3IiKTsKKyAgICBpZiAoIHJlcyApCisgICAgICAgIHJldHVybiBy
ZXM7CisKKyAgICAvKiBDYW5ub3QgdXNlIGZkdF9wcm9wZXJ0eV9zdHJpbmcgZHVlIHRvIGVtYmVk
ZGVkIG51bGxzICovCisgICAgcmVzID0gZmR0X3Byb3BlcnR5KGZkdCwgImNvbXBhdGlibGUiLCBj
b21wYXQsIHNpemVvZihjb21wYXQpKTsKKyAgICBpZiAoIHJlcyApCisgICAgICAgIHJldHVybiBy
ZXM7CisKKyAgICByZXMgPSBhY3BpX21ha2VfZWZpX25vZGVzKGZkdCwgdGJsX2FkZCk7CisgICAg
aWYgKCByZXMgKQorICAgICAgICByZXR1cm4gcmVzOworCisgICAgcmVzID0gZmR0X2VuZF9ub2Rl
KGZkdCk7CisKKyAgICByZXR1cm4gcmVzOworfQorCisvKgorICogUHJlcGFyZSBhIG1pbmltYWwg
RFRCIGZvciBEb20wIHdoaWNoIGNvbnRhaW5zIGJvb3RhcmdzLCBpbml0cmQsIG1lbW9yeQorICog
aW5mb3JtYXRpb24sIEVGSSB0YWJsZS4KKyAqLworc3RhdGljIGludCBfX2luaXQgY3JlYXRlX2Fj
cGlfZHRiKHN0cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8sCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IG1lbWJhbmsgdGJsX2FkZFtdKQoreworICAgIGludCBuZXdfc2l6
ZTsKKyAgICBpbnQgcmV0OworCisgICAgZHRfZHByaW50aygiUHJlcGFyZSBhIG1pbiBEVEIgZm9y
IERPTTBcbiIpOworCisgICAgLyogQWxsb2NhdGUgbWluIHNpemUgZm9yIERUICovCisgICAgbmV3
X3NpemUgPSBBQ1BJX0RPTTBfRkRUX01JTl9TSVpFOworICAgIGtpbmZvLT5mZHQgPSB4bWFsbG9j
X2J5dGVzKG5ld19zaXplKTsKKworICAgIGlmICgga2luZm8tPmZkdCA9PSBOVUxMICkKKyAgICAg
ICAgcmV0dXJuIC1FTk9NRU07CisKKyAgICAvKiBDcmVhdGUgYSBuZXcgZW1wdHkgRFQgZm9yIERP
TTAgKi8KKyAgICByZXQgPSBmZHRfY3JlYXRlKGtpbmZvLT5mZHQsIG5ld19zaXplKTsKKyAgICBp
ZiAoIHJldCA8IDAgKQorICAgICAgICBnb3RvIGVycjsKKworICAgIHJldCA9IGZkdF9maW5pc2hf
cmVzZXJ2ZW1hcChraW5mby0+ZmR0KTsKKyAgICBpZiAoIHJldCA8IDAgKQorICAgICAgICBnb3Rv
IGVycjsKKworICAgIHJldCA9IGZkdF9iZWdpbl9ub2RlKGtpbmZvLT5mZHQsICIvIik7CisgICAg
aWYgKCByZXQgPCAwICkKKyAgICAgICAgZ290byBlcnI7CisKKyAgICByZXQgPSBmZHRfcHJvcGVy
dHlfY2VsbChraW5mby0+ZmR0LCAiI2FkZHJlc3MtY2VsbHMiLCAyKTsKKyAgICBpZiAoIHJldCAp
CisgICAgICAgIHJldHVybiByZXQ7CisKKyAgICByZXQgPSBmZHRfcHJvcGVydHlfY2VsbChraW5m
by0+ZmR0LCAiI3NpemUtY2VsbHMiLCAxKTsKKyAgICBpZiAoIHJldCApCisgICAgICAgIHJldHVy
biByZXQ7CisKKyAgICAvKiBDcmVhdGUgYSBjaG9zZW4gbm9kZSBmb3IgRE9NMCAqLworICAgIHJl
dCA9IG1ha2VfY2hvc2VuX25vZGUoa2luZm8pOworICAgIGlmICggcmV0ICkKKyAgICAgICAgZ290
byBlcnI7CisKKyAgICByZXQgPSBhY3BpX21ha2VfaHlwZXJ2aXNvcl9ub2RlKGtpbmZvLCB0Ymxf
YWRkKTsKKyAgICBpZiAoIHJldCApCisgICAgICAgIGdvdG8gZXJyOworCisgICAgcmV0ID0gZmR0
X2VuZF9ub2RlKGtpbmZvLT5mZHQpOworICAgIGlmICggcmV0IDwgMCApCisgICAgICAgIGdvdG8g
ZXJyOworCisgICAgcmV0ID0gZmR0X2ZpbmlzaChraW5mby0+ZmR0KTsKKyAgICBpZiAoIHJldCA8
IDAgKQorICAgICAgICBnb3RvIGVycjsKKworICAgIHJldHVybiAwOworCisgIGVycjoKKyAgICBw
cmludGsoIkRldmljZSB0cmVlIGdlbmVyYXRpb24gZmFpbGVkICglZCkuXG4iLCByZXQpOworICAg
IHhmcmVlKGtpbmZvLT5mZHQpOworICAgIHJldHVybiAtRUlOVkFMOworfQorCitzdGF0aWMgdm9p
ZCBfX2luaXQgYWNwaV9tYXBfb3RoZXJfdGFibGVzKHN0cnVjdCBkb21haW4gKmQpCit7CisgICAg
aW50IGk7CisgICAgdW5zaWduZWQgbG9uZyByZXM7CisgICAgdTY0IGFkZHIsIHNpemU7CisKKyAg
ICAvKiBNYXAgYWxsIEFDUEkgdGFibGVzIHRvIERvbTAgdXNpbmcgMToxIG1hcHBpbmdzLiAqLwor
ICAgIGZvciggaSA9IDA7IGkgPCBhY3BpX2dibF9yb290X3RhYmxlX2xpc3QuY291bnQ7IGkrKyAp
CisgICAgeworICAgICAgICBhZGRyID0gYWNwaV9nYmxfcm9vdF90YWJsZV9saXN0LnRhYmxlc1tp
XS5hZGRyZXNzOworICAgICAgICBzaXplID0gYWNwaV9nYmxfcm9vdF90YWJsZV9saXN0LnRhYmxl
c1tpXS5sZW5ndGg7CisgICAgICAgIHJlcyA9IG1hcF9yZWdpb25zX3AybXQoZCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBnYWRkcl90b19nZm4oYWRkciksCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgUEZOX1VQKHNpemUpLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIG1hZGRyX3RvX21mbihhZGRyKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBwMm1fbW1pb19kaXJlY3RfYyk7CisgICAgICAgIGlmICggcmVzICkKKyAgICAgICAgeworICAg
ICAgICAgICAgIHBhbmljKFhFTkxPR19FUlIgIlVuYWJsZSB0byBtYXAgQUNQSSByZWdpb24gMHgl
IlBSSXg2NAorICAgICAgICAgICAgICAgICAgICIgLSAweCUiUFJJeDY0IiBpbiBkb21haW5cbiIs
CisgICAgICAgICAgICAgICAgICAgYWRkciAmIFBBR0VfTUFTSywgUEFHRV9BTElHTihhZGRyICsg
c2l6ZSkgLSAxKTsKKyAgICAgICAgfQorICAgIH0KK30KKworc3RhdGljIGludCBfX2luaXQgYWNw
aV9jcmVhdGVfcnNkcChzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3QgbWVtYmFuayB0YmxfYWRkW10p
Cit7CisKKyAgICBzdHJ1Y3QgYWNwaV90YWJsZV9yc2RwICpyc2RwID0gTlVMTDsKKyAgICB1NjQg
YWRkcjsKKyAgICB1NjQgdGFibGVfc2l6ZSA9IHNpemVvZihzdHJ1Y3QgYWNwaV90YWJsZV9yc2Rw
KTsKKyAgICB1OCAqYmFzZV9wdHI7CisgICAgdTggY2hlY2tzdW07CisKKyAgICBhZGRyID0gYWNw
aV9vc19nZXRfcm9vdF9wb2ludGVyKCk7CisgICAgaWYgKCAhYWRkciAgKQorICAgIHsKKyAgICAg
ICAgcHJpbnRrKCJVbmFibGUgdG8gZ2V0IGFjcGkgcm9vdCBwb2ludGVyXG4iKTsKKyAgICAgICAg
cmV0dXJuIC1FSU5WQUw7CisgICAgfQorICAgIHJzZHAgPSBhY3BpX29zX21hcF9tZW1vcnkoYWRk
ciwgdGFibGVfc2l6ZSk7CisgICAgYmFzZV9wdHIgPSBkLT5hcmNoLmVmaV9hY3BpX3RhYmxlCisg
ICAgICAgICAgICAgICArIGFjcGlfZ2V0X3RhYmxlX29mZnNldCh0YmxfYWRkLCBUQkxfUlNEUCk7
CisgICAgbWVtY3B5KGJhc2VfcHRyLCByc2RwLCB0YWJsZV9zaXplKTsKKyAgICBhY3BpX29zX3Vu
bWFwX21lbW9yeShyc2RwLCB0YWJsZV9zaXplKTsKKworICAgIHJzZHAgPSAoc3RydWN0IGFjcGlf
dGFibGVfcnNkcCAqKWJhc2VfcHRyOworICAgIC8qIFJlcGxhY2UgeHNkdF9waHlzaWNhbF9hZGRy
ZXNzICovCisgICAgcnNkcC0+eHNkdF9waHlzaWNhbF9hZGRyZXNzID0gdGJsX2FkZFtUQkxfWFNE
VF0uc3RhcnQ7CisgICAgY2hlY2tzdW0gPSBhY3BpX3RiX2NoZWNrc3VtKEFDUElfQ0FTVF9QVFIo
dTgsIHJzZHApLCB0YWJsZV9zaXplKTsKKyAgICByc2RwLT5jaGVja3N1bSA9IHJzZHAtPmNoZWNr
c3VtIC0gY2hlY2tzdW07CisKKyAgICB0YmxfYWRkW1RCTF9SU0RQXS5zdGFydCA9IGQtPmFyY2gu
ZWZpX2FjcGlfZ3BhCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGFjcGlfZ2V0X3Rh
YmxlX29mZnNldCh0YmxfYWRkLCBUQkxfUlNEUCk7CisgICAgdGJsX2FkZFtUQkxfUlNEUF0uc2l6
ZSA9IHRhYmxlX3NpemU7CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgX19pbml0
IGFjcGlfeHNkdF9tb2RpZnlfZW50cnkodTY0IGVudHJ5W10sCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIGVudHJ5X2NvdW50LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhciAqc2lnbmF0dXJlLCB1NjQg
YWRkcikKK3sKKyAgICBpbnQgaTsKKyAgICBzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIgKnRhYmxl
OworICAgIHU2NCBzaXplID0gc2l6ZW9mKHN0cnVjdCBhY3BpX3RhYmxlX2hlYWRlcik7CisKKyAg
ICBmb3IoIGkgPSAwOyBpIDwgZW50cnlfY291bnQ7IGkrKyApCisgICAgeworICAgICAgICB0YWJs
ZSA9IGFjcGlfb3NfbWFwX21lbW9yeShlbnRyeVtpXSwgc2l6ZSk7CisgICAgICAgIGlmICggQUNQ
SV9DT01QQVJFX05BTUUodGFibGUtPnNpZ25hdHVyZSwgc2lnbmF0dXJlKSApCisgICAgICAgIHsK
KyAgICAgICAgICAgIGVudHJ5W2ldID0gYWRkcjsKKyAgICAgICAgICAgIGFjcGlfb3NfdW5tYXBf
bWVtb3J5KHRhYmxlLCBzaXplKTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICB9CisgICAg
ICAgIGFjcGlfb3NfdW5tYXBfbWVtb3J5KHRhYmxlLCBzaXplKTsKKyAgICB9Cit9CisKK3N0YXRp
YyBpbnQgX19pbml0IGFjcGlfY3JlYXRlX3hzZHQoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IG1l
bWJhbmsgdGJsX2FkZFtdKQoreworICAgIHN0cnVjdCBhY3BpX3RhYmxlX2hlYWRlciAqdGFibGUg
PSBOVUxMOworICAgIHN0cnVjdCBhY3BpX3RhYmxlX3JzZHAgKnJzZHBfdGJsOworICAgIHN0cnVj
dCBhY3BpX3RhYmxlX3hzZHQgKnhzZHQgPSBOVUxMOworICAgIHU2NCB0YWJsZV9zaXplLCBhZGRy
OworICAgIHVuc2lnbmVkIGxvbmcgZW50cnlfY291bnQ7CisgICAgdTggKmJhc2VfcHRyOworICAg
IHU4IGNoZWNrc3VtOworCisgICAgYWRkciA9IGFjcGlfb3NfZ2V0X3Jvb3RfcG9pbnRlcigpOwor
ICAgIGlmICggIWFkZHIgKQorICAgIHsKKyAgICAgICAgcHJpbnRrKCJVbmFibGUgdG8gZ2V0IGFj
cGkgcm9vdCBwb2ludGVyXG4iKTsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorICAg
IHJzZHBfdGJsID0gYWNwaV9vc19tYXBfbWVtb3J5KGFkZHIsIHNpemVvZihzdHJ1Y3QgYWNwaV90
YWJsZV9yc2RwKSk7CisgICAgdGFibGUgPSBhY3BpX29zX21hcF9tZW1vcnkocnNkcF90YmwtPnhz
ZHRfcGh5c2ljYWxfYWRkcmVzcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXpl
b2Yoc3RydWN0IGFjcGlfdGFibGVfaGVhZGVyKSk7CisKKyAgICAvKiBBZGQgcGxhY2UgZm9yIFNU
QU8gdGFibGUgaW4gWFNEVCB0YWJsZSAqLworICAgIHRhYmxlX3NpemUgPSB0YWJsZS0+bGVuZ3Ro
ICsgc2l6ZW9mKHU2NCk7CisgICAgZW50cnlfY291bnQgPSAodGFibGUtPmxlbmd0aCAtIHNpemVv
ZihzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIpKQorICAgICAgICAgICAgICAgICAgLyBzaXplb2Yo
dTY0KTsKKyAgICBiYXNlX3B0ciA9IGQtPmFyY2guZWZpX2FjcGlfdGFibGUKKyAgICAgICAgICAg
ICAgICsgYWNwaV9nZXRfdGFibGVfb2Zmc2V0KHRibF9hZGQsIFRCTF9YU0RUKTsKKyAgICBtZW1j
cHkoYmFzZV9wdHIsIHRhYmxlLCB0YWJsZS0+bGVuZ3RoKTsKKyAgICBhY3BpX29zX3VubWFwX21l
bW9yeSh0YWJsZSwgc2l6ZW9mKHN0cnVjdCBhY3BpX3RhYmxlX2hlYWRlcikpOworICAgIGFjcGlf
b3NfdW5tYXBfbWVtb3J5KHJzZHBfdGJsLCBzaXplb2Yoc3RydWN0IGFjcGlfdGFibGVfcnNkcCkp
OworCisgICAgeHNkdCA9IChzdHJ1Y3QgYWNwaV90YWJsZV94c2R0ICopYmFzZV9wdHI7CisgICAg
YWNwaV94c2R0X21vZGlmeV9lbnRyeSh4c2R0LT50YWJsZV9vZmZzZXRfZW50cnksIGVudHJ5X2Nv
dW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNQSV9TSUdfRkFEVCwgdGJsX2FkZFtU
QkxfRkFEVF0uc3RhcnQpOworICAgIGFjcGlfeHNkdF9tb2RpZnlfZW50cnkoeHNkdC0+dGFibGVf
b2Zmc2V0X2VudHJ5LCBlbnRyeV9jb3VudCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIEFD
UElfU0lHX01BRFQsIHRibF9hZGRbVEJMX01BRFRdLnN0YXJ0KTsKKyAgICB4c2R0LT50YWJsZV9v
ZmZzZXRfZW50cnlbZW50cnlfY291bnRdID0gdGJsX2FkZFtUQkxfU1RBT10uc3RhcnQ7CisKKyAg
ICB4c2R0LT5oZWFkZXIubGVuZ3RoID0gdGFibGVfc2l6ZTsKKyAgICBjaGVja3N1bSA9IGFjcGlf
dGJfY2hlY2tzdW0oQUNQSV9DQVNUX1BUUih1OCwgeHNkdCksIHRhYmxlX3NpemUpOworICAgIHhz
ZHQtPmhlYWRlci5jaGVja3N1bSAtPSBjaGVja3N1bTsKKworICAgIHRibF9hZGRbVEJMX1hTRFRd
LnN0YXJ0ID0gZC0+YXJjaC5lZmlfYWNwaV9ncGEKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICsgYWNwaV9nZXRfdGFibGVfb2Zmc2V0KHRibF9hZGQsIFRCTF9YU0RUKTsKKyAgICB0Ymxf
YWRkW1RCTF9YU0RUXS5zaXplID0gdGFibGVfc2l6ZTsKKworICAgIHJldHVybiAwOworfQorCitz
dGF0aWMgaW50IF9faW5pdCBhY3BpX2NyZWF0ZV9zdGFvKHN0cnVjdCBkb21haW4gKmQsIHN0cnVj
dCBtZW1iYW5rIHRibF9hZGRbXSkKK3sKKyAgICBzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIgKnRh
YmxlID0gTlVMTDsKKyAgICBzdHJ1Y3QgYWNwaV90YWJsZV9zdGFvICpzdGFvID0gTlVMTDsKKyAg
ICB1MzIgdGFibGVfc2l6ZSA9IHNpemVvZihzdHJ1Y3QgYWNwaV90YWJsZV9zdGFvKTsKKyAgICB1
MzIgb2Zmc2V0ID0gYWNwaV9nZXRfdGFibGVfb2Zmc2V0KHRibF9hZGQsIFRCTF9TVEFPKTsKKyAg
ICBhY3BpX3N0YXR1cyBzdGF0dXM7CisgICAgdTggKmJhc2VfcHRyLCBjaGVja3N1bTsKKworICAg
IC8qIENvcHkgT0VNIGFuZCBBU0wgY29tcGlsZXIgZmllbGRzIGZyb20gYW5vdGhlciB0YWJsZSwg
dXNlIE1BRFQgKi8KKyAgICBzdGF0dXMgPSBhY3BpX2dldF90YWJsZShBQ1BJX1NJR19NQURULCAw
LCAmdGFibGUpOworCisgICAgaWYgKCBBQ1BJX0ZBSUxVUkUoc3RhdHVzKSApCisgICAgeworICAg
ICAgICBjb25zdCBjaGFyICptc2cgPSBhY3BpX2Zvcm1hdF9leGNlcHRpb24oc3RhdHVzKTsKKwor
ICAgICAgICBwcmludGsoIlNUQU86IEZhaWxlZCB0byBnZXQgTUFEVCB0YWJsZSwgJXNcbiIsIG1z
Zyk7CisgICAgICAgIHJldHVybiAtRUlOVkFMOworICAgIH0KKworICAgIGJhc2VfcHRyID0gZC0+
YXJjaC5lZmlfYWNwaV90YWJsZSArIG9mZnNldDsKKyAgICBtZW1jcHkoYmFzZV9wdHIsIHRhYmxl
LCBzaXplb2Yoc3RydWN0IGFjcGlfdGFibGVfaGVhZGVyKSk7CisKKyAgICBzdGFvID0gKHN0cnVj
dCBhY3BpX3RhYmxlX3N0YW8gKiliYXNlX3B0cjsKKyAgICBtZW1jcHkoc3Rhby0+aGVhZGVyLnNp
Z25hdHVyZSwgQUNQSV9TSUdfU1RBTywgNCk7CisgICAgc3Rhby0+aGVhZGVyLnJldmlzaW9uID0g
MTsKKyAgICBzdGFvLT5oZWFkZXIubGVuZ3RoID0gdGFibGVfc2l6ZTsKKyAgICBzdGFvLT5pZ25v
cmVfdWFydCA9IDE7CisgICAgY2hlY2tzdW0gPSBhY3BpX3RiX2NoZWNrc3VtKEFDUElfQ0FTVF9Q
VFIodTgsIHN0YW8pLCB0YWJsZV9zaXplKTsKKyAgICBzdGFvLT5oZWFkZXIuY2hlY2tzdW0gLT0g
Y2hlY2tzdW07CisKKyAgICB0YmxfYWRkW1RCTF9TVEFPXS5zdGFydCA9IGQtPmFyY2guZWZpX2Fj
cGlfZ3BhICsgb2Zmc2V0OworICAgIHRibF9hZGRbVEJMX1NUQU9dLnNpemUgPSB0YWJsZV9zaXpl
OworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgX19pbml0IGFjcGlfY3JlYXRlX21h
ZHQoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IG1lbWJhbmsgdGJsX2FkZFtdKQoreworICAgIHN0
cnVjdCBhY3BpX3RhYmxlX2hlYWRlciAqdGFibGUgPSBOVUxMOworICAgIHN0cnVjdCBhY3BpX3Rh
YmxlX21hZHQgKm1hZHQgPSBOVUxMOworICAgIHN0cnVjdCBhY3BpX3N1YnRhYmxlX2hlYWRlciAq
aGVhZGVyOworICAgIHN0cnVjdCBhY3BpX21hZHRfZ2VuZXJpY19kaXN0cmlidXRvciAqZ2ljZDsK
KyAgICB1MzIgdGFibGVfc2l6ZSA9IHNpemVvZihzdHJ1Y3QgYWNwaV90YWJsZV9tYWR0KTsKKyAg
ICB1MzIgb2Zmc2V0ID0gYWNwaV9nZXRfdGFibGVfb2Zmc2V0KHRibF9hZGQsIFRCTF9NQURUKTsK
KyAgICBpbnQgcmV0OworICAgIGFjcGlfc3RhdHVzIHN0YXR1czsKKyAgICB1OCAqYmFzZV9wdHIs
IGNoZWNrc3VtOworCisgICAgc3RhdHVzID0gYWNwaV9nZXRfdGFibGUoQUNQSV9TSUdfTUFEVCwg
MCwgJnRhYmxlKTsKKworICAgIGlmICggQUNQSV9GQUlMVVJFKHN0YXR1cykgKQorICAgIHsKKyAg
ICAgICAgY29uc3QgY2hhciAqbXNnID0gYWNwaV9mb3JtYXRfZXhjZXB0aW9uKHN0YXR1cyk7CisK
KyAgICAgICAgcHJpbnRrKCJGYWlsZWQgdG8gZ2V0IE1BRFQgdGFibGUsICVzXG4iLCBtc2cpOwor
ICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisKKyAgICBiYXNlX3B0ciA9IGQtPmFyY2gu
ZWZpX2FjcGlfdGFibGUgKyBvZmZzZXQ7CisgICAgbWVtY3B5KGJhc2VfcHRyLCB0YWJsZSwgdGFi
bGVfc2l6ZSk7CisKKyAgICAvKiBBZGQgR2VuZXJpYyBEaXN0cmlidXRvci4gKi8KKyAgICBoZWFk
ZXIgPSBhY3BpX3RhYmxlX2dldF9lbnRyeV9tYWR0KEFDUElfTUFEVF9UWVBFX0dFTkVSSUNfRElT
VFJJQlVUT1IsIDApOworICAgIGlmICggIWhlYWRlciApCisgICAgeworICAgICAgICBwcmludGso
IkNhbid0IGdldCBHSUNEIGVudHJ5XG4iKTsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAg
fQorICAgIGdpY2QgPSBjb250YWluZXJfb2YoaGVhZGVyLCBzdHJ1Y3QgYWNwaV9tYWR0X2dlbmVy
aWNfZGlzdHJpYnV0b3IsIGhlYWRlcik7CisgICAgbWVtY3B5KGJhc2VfcHRyICsgdGFibGVfc2l6
ZSwgZ2ljZCwKKyAgICAgICAgICAgICAgICBzaXplb2Yoc3RydWN0IGFjcGlfbWFkdF9nZW5lcmlj
X2Rpc3RyaWJ1dG9yKSk7CisgICAgdGFibGVfc2l6ZSArPSBzaXplb2Yoc3RydWN0IGFjcGlfbWFk
dF9nZW5lcmljX2Rpc3RyaWJ1dG9yKTsKKworICAgIC8qIEFkZCBvdGhlciBzdWJ0YWJsZXMuICov
CisgICAgcmV0ID0gZ2ljX21ha2VfaHdkb21fbWFkdChkLCBvZmZzZXQgKyB0YWJsZV9zaXplKTsK
KyAgICBpZiAoIHJldCA8IDAgKQorICAgIHsKKyAgICAgICAgcHJpbnRrKCJGYWlsZWQgdG8gZ2V0
IG90aGVyIHN1YnRhYmxlc1xuIik7CisgICAgICAgIHJldHVybiAtRUlOVkFMOworICAgIH0KKyAg
ICB0YWJsZV9zaXplICs9IHJldDsKKworICAgIG1hZHQgPSAoc3RydWN0IGFjcGlfdGFibGVfbWFk
dCAqKWJhc2VfcHRyOworICAgIG1hZHQtPmhlYWRlci5sZW5ndGggPSB0YWJsZV9zaXplOworICAg
IGNoZWNrc3VtID0gYWNwaV90Yl9jaGVja3N1bShBQ1BJX0NBU1RfUFRSKHU4LCBtYWR0KSwgdGFi
bGVfc2l6ZSk7CisgICAgbWFkdC0+aGVhZGVyLmNoZWNrc3VtIC09IGNoZWNrc3VtOworCisgICAg
dGJsX2FkZFtUQkxfTUFEVF0uc3RhcnQgPSBkLT5hcmNoLmVmaV9hY3BpX2dwYSArIG9mZnNldDsK
KyAgICB0YmxfYWRkW1RCTF9NQURUXS5zaXplID0gdGFibGVfc2l6ZTsKKworICAgIHJldHVybiAw
OworfQorCitzdGF0aWMgaW50IF9faW5pdCBhY3BpX2NyZWF0ZV9mYWR0KHN0cnVjdCBkb21haW4g
KmQsIHN0cnVjdCBtZW1iYW5rIHRibF9hZGRbXSkKK3sKKyAgICBzdHJ1Y3QgYWNwaV90YWJsZV9o
ZWFkZXIgKnRhYmxlID0gTlVMTDsKKyAgICBzdHJ1Y3QgYWNwaV90YWJsZV9mYWR0ICpmYWR0ID0g
TlVMTDsKKyAgICB1NjQgdGFibGVfc2l6ZTsKKyAgICBhY3BpX3N0YXR1cyBzdGF0dXM7CisgICAg
dTggKmJhc2VfcHRyOworICAgIHU4IGNoZWNrc3VtOworCisgICAgc3RhdHVzID0gYWNwaV9nZXRf
dGFibGUoQUNQSV9TSUdfRkFEVCwgMCwgJnRhYmxlKTsKKworICAgIGlmICggQUNQSV9GQUlMVVJF
KHN0YXR1cykgKQorICAgIHsKKyAgICAgICAgY29uc3QgY2hhciAqbXNnID0gYWNwaV9mb3JtYXRf
ZXhjZXB0aW9uKHN0YXR1cyk7CisKKyAgICAgICAgcHJpbnRrKCJGYWlsZWQgdG8gZ2V0IEZBRFQg
dGFibGUsICVzXG4iLCBtc2cpOworICAgICAgICByZXR1cm4gLUVJTlZBTDsKKyAgICB9CisKKyAg
ICB0YWJsZV9zaXplID0gdGFibGUtPmxlbmd0aDsKKyAgICBiYXNlX3B0ciA9IGQtPmFyY2guZWZp
X2FjcGlfdGFibGUKKyAgICAgICAgICAgICAgICsgYWNwaV9nZXRfdGFibGVfb2Zmc2V0KHRibF9h
ZGQsIFRCTF9GQURUKTsKKyAgICBtZW1jcHkoYmFzZV9wdHIsIHRhYmxlLCB0YWJsZV9zaXplKTsK
KyAgICBmYWR0ID0gKHN0cnVjdCBhY3BpX3RhYmxlX2ZhZHQgKiliYXNlX3B0cjsKKworICAgIC8q
IFNldCBQU0NJX0NPTVBMSUFOVCBhbmQgUFNDSV9VU0VfSFZDICovCisgICAgZmFkdC0+YXJtX2Jv
b3RfZmxhZ3MgfD0gKEFDUElfRkFEVF9QU0NJX0NPTVBMSUFOVCB8IEFDUElfRkFEVF9QU0NJX1VT
RV9IVkMpOworICAgIGNoZWNrc3VtID0gYWNwaV90Yl9jaGVja3N1bShBQ1BJX0NBU1RfUFRSKHU4
LCBmYWR0KSwgdGFibGVfc2l6ZSk7CisgICAgZmFkdC0+aGVhZGVyLmNoZWNrc3VtIC09IGNoZWNr
c3VtOworCisgICAgdGJsX2FkZFtUQkxfRkFEVF0uc3RhcnQgPSBkLT5hcmNoLmVmaV9hY3BpX2dw
YQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBhY3BpX2dldF90YWJsZV9vZmZzZXQo
dGJsX2FkZCwgVEJMX0ZBRFQpOworICAgIHRibF9hZGRbVEJMX0ZBRFRdLnNpemUgPSB0YWJsZV9z
aXplOworCisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgX19pbml0IGVzdGltYXRlX2Fj
cGlfZWZpX3NpemUoc3RydWN0IGRvbWFpbiAqZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbykKK3sKKyAgICBzaXplX3Qg
ZWZpX3NpemUsIGFjcGlfc2l6ZSwgbWFkdF9zaXplOworICAgIHU2NCBhZGRyOworICAgIHN0cnVj
dCBhY3BpX3RhYmxlX3JzZHAgKnJzZHBfdGJsOworICAgIHN0cnVjdCBhY3BpX3RhYmxlX2hlYWRl
ciAqdGFibGU7CisKKyAgICBlZmlfc2l6ZSA9IGVzdGltYXRlX2VmaV9zaXplKGtpbmZvLT5tZW0u
bnJfYmFua3MpOworCisgICAgYWNwaV9zaXplID0gUk9VTkRVUChzaXplb2Yoc3RydWN0IGFjcGlf
dGFibGVfZmFkdCksIDgpOworICAgIGFjcGlfc2l6ZSArPSBST1VORFVQKHNpemVvZihzdHJ1Y3Qg
YWNwaV90YWJsZV9zdGFvKSwgOCk7CisKKyAgICBtYWR0X3NpemUgPSBnaWNfZ2V0X2h3ZG9tX21h
ZHRfc2l6ZShkKTsKKyAgICBhY3BpX3NpemUgKz0gUk9VTkRVUChtYWR0X3NpemUsIDgpOworCisg
ICAgYWRkciA9IGFjcGlfb3NfZ2V0X3Jvb3RfcG9pbnRlcigpOworICAgIGlmICggIWFkZHIgKQor
ICAgIHsKKyAgICAgICAgcHJpbnRrKCJVbmFibGUgdG8gZ2V0IGFjcGkgcm9vdCBwb2ludGVyXG4i
KTsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorCisgICAgcnNkcF90YmwgPSBhY3Bp
X29zX21hcF9tZW1vcnkoYWRkciwgc2l6ZW9mKHN0cnVjdCBhY3BpX3RhYmxlX3JzZHApKTsKKyAg
ICBpZiAoICFyc2RwX3RibCApCisgICAgeworICAgICAgICBwcmludGsoIlVuYWJsZSB0byBtYXAg
UlNEUCB0YWJsZVxuIik7CisgICAgICAgIHJldHVybiAtRUlOVkFMOworICAgIH0KKworICAgIHRh
YmxlID0gYWNwaV9vc19tYXBfbWVtb3J5KHJzZHBfdGJsLT54c2R0X3BoeXNpY2FsX2FkZHJlc3Ms
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHN0cnVjdCBhY3BpX3RhYmxl
X2hlYWRlcikpOworICAgIGFjcGlfb3NfdW5tYXBfbWVtb3J5KHJzZHBfdGJsLCBzaXplb2Yoc3Ry
dWN0IGFjcGlfdGFibGVfcnNkcCkpOworICAgIGlmICggIXRhYmxlICkKKyAgICB7CisgICAgICAg
IHByaW50aygiVW5hYmxlIHRvIG1hcCBYU0RUIHRhYmxlXG4iKTsKKyAgICAgICAgcmV0dXJuIC1F
SU5WQUw7CisgICAgfQorCisgICAgLyogQWRkIHBsYWNlIGZvciBTVEFPIHRhYmxlIGluIFhTRFQg
dGFibGUgKi8KKyAgICBhY3BpX3NpemUgKz0gUk9VTkRVUCh0YWJsZS0+bGVuZ3RoICsgc2l6ZW9m
KHU2NCksIDgpOworICAgIGFjcGlfb3NfdW5tYXBfbWVtb3J5KHRhYmxlLCBzaXplb2Yoc3RydWN0
IGFjcGlfdGFibGVfaGVhZGVyKSk7CisKKyAgICBhY3BpX3NpemUgKz0gUk9VTkRVUChzaXplb2Yo
c3RydWN0IGFjcGlfdGFibGVfcnNkcCksIDgpOworICAgIGQtPmFyY2guZWZpX2FjcGlfbGVuID0g
UEFHRV9BTElHTihST1VORFVQKGVmaV9zaXplLCA4KQorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICArIFJPVU5EVVAoYWNwaV9zaXplLCA4KSk7CisKKyAgICByZXR1cm4gMDsK
K30KKworaW50IF9faW5pdCBwcmVwYXJlX2FjcGkoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGtl
cm5lbF9pbmZvICpraW5mbykKK3sKKyAgICBpbnQgcmMgPSAwOworICAgIGludCBvcmRlcjsKKyAg
ICBzdHJ1Y3QgbWVtYmFuayB0YmxfYWRkW1RCTF9NTUFYXSA9IHt9OworCisgICAgcmMgPSBlc3Rp
bWF0ZV9hY3BpX2VmaV9zaXplKGQsIGtpbmZvKTsKKyAgICBpZiAoIHJjICE9IDAgKQorICAgICAg
ICByZXR1cm4gcmM7CisKKyAgICBvcmRlciA9IGdldF9vcmRlcl9mcm9tX2J5dGVzKGQtPmFyY2gu
ZWZpX2FjcGlfbGVuKTsKKyAgICBkLT5hcmNoLmVmaV9hY3BpX3RhYmxlID0gYWxsb2NfeGVuaGVh
cF9wYWdlcyhvcmRlciwgMCk7CisgICAgaWYgKCBkLT5hcmNoLmVmaV9hY3BpX3RhYmxlID09IE5V
TEwgKQorICAgIHsKKyAgICAgICAgcHJpbnRrKCJ1bmFibGUgdG8gYWxsb2NhdGUgbWVtb3J5IVxu
Iik7CisgICAgICAgIHJldHVybiAtRU5PTUVNOworICAgIH0KKyAgICBtZW1zZXQoZC0+YXJjaC5l
ZmlfYWNwaV90YWJsZSwgMCwgZC0+YXJjaC5lZmlfYWNwaV9sZW4pOworCisgICAgLyoKKyAgICAg
KiBGb3IgQUNQSSwgRG9tMCBkb2Vzbid0IHVzZSBraW5mby0+Z250dGFiX3N0YXJ0IHRvIGdldCB0
aGUgZ3JhbnQgdGFibGUKKyAgICAgKiByZWdpb24uIFNvIHdlIHVzZSBpdCBhcyB0aGUgQUNQSSB0
YWJsZSBtYXBwZWQgYWRkcmVzcy4gQWxzbyBpdCBuZWVkcyB0bworICAgICAqIGNoZWNrIGlmIHRo
ZSBzaXplIG9mIGdyYW50IHRhYmxlIHJlZ2lvbiBpcyBlbm91Z2ggZm9yIHRob3NlIEFDUEkgdGFi
bGVzLgorICAgICAqLworICAgIGQtPmFyY2guZWZpX2FjcGlfZ3BhID0ga2luZm8tPmdudHRhYl9z
dGFydDsKKyAgICBpZiAoIGtpbmZvLT5nbnR0YWJfc2l6ZSA8IGQtPmFyY2guZWZpX2FjcGlfbGVu
ICkKKyAgICB7CisgICAgICAgIHByaW50aygiVGhlIGdyYW50IHRhYmxlIHJlZ2lvbiBpcyBub3Qg
ZW5vdWdoIHRvIGZpdCB0aGUgQUNQSSB0YWJsZXMhXG4iKTsKKyAgICAgICAgcmV0dXJuIC1FSU5W
QUw7CisgICAgfQorCisgICAgcmMgPSBhY3BpX2NyZWF0ZV9mYWR0KGQsIHRibF9hZGQpOworICAg
IGlmICggcmMgIT0gMCApCisgICAgICAgIHJldHVybiByYzsKKworICAgIHJjID0gYWNwaV9jcmVh
dGVfbWFkdChkLCB0YmxfYWRkKTsKKyAgICBpZiAoIHJjICE9IDAgKQorICAgICAgICByZXR1cm4g
cmM7CisKKyAgICByYyA9IGFjcGlfY3JlYXRlX3N0YW8oZCwgdGJsX2FkZCk7CisgICAgaWYgKCBy
YyAhPSAwICkKKyAgICAgICAgcmV0dXJuIHJjOworCisgICAgcmMgPSBhY3BpX2NyZWF0ZV94c2R0
KGQsIHRibF9hZGQpOworICAgIGlmICggcmMgIT0gMCApCisgICAgICAgIHJldHVybiByYzsKKwor
ICAgIHJjID0gYWNwaV9jcmVhdGVfcnNkcChkLCB0YmxfYWRkKTsKKyAgICBpZiAoIHJjICE9IDAg
KQorICAgICAgICByZXR1cm4gcmM7CisKKyAgICBhY3BpX21hcF9vdGhlcl90YWJsZXMoZCk7Cisg
ICAgYWNwaV9jcmVhdGVfZWZpX3N5c3RlbV90YWJsZShkLCB0YmxfYWRkKTsKKyAgICBhY3BpX2Ny
ZWF0ZV9lZmlfbW1hcF90YWJsZShkLCAma2luZm8tPm1lbSwgdGJsX2FkZCk7CisKKyAgICAvKiBN
YXAgdGhlIEVGSSBhbmQgQUNQSSB0YWJsZXMgdG8gRG9tMCAqLworICAgIHJjID0gbWFwX3JlZ2lv
bnNfcDJtdChkLAorICAgICAgICAgICAgICAgICAgICAgICAgICBnYWRkcl90b19nZm4oZC0+YXJj
aC5lZmlfYWNwaV9ncGEpLAorICAgICAgICAgICAgICAgICAgICAgICAgICBQRk5fVVAoZC0+YXJj
aC5lZmlfYWNwaV9sZW4pLAorICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0X3RvX21mbihk
LT5hcmNoLmVmaV9hY3BpX3RhYmxlKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgcDJtX21t
aW9fZGlyZWN0X2MpOworICAgIGlmICggcmMgIT0gMCApCisgICAgeworICAgICAgICBwcmludGso
WEVOTE9HX0VSUiAiVW5hYmxlIHRvIG1hcCBFRkkvQUNQSSB0YWJsZSAweCUiUFJJeDY0CisgICAg
ICAgICAgICAgICAiIC0gMHglIlBSSXg2NCIgaW4gZG9tYWluICVkXG4iLAorICAgICAgICAgICAg
ICAgZC0+YXJjaC5lZmlfYWNwaV9ncGEgJiBQQUdFX01BU0ssCisgICAgICAgICAgICAgICBQQUdF
X0FMSUdOKGQtPmFyY2guZWZpX2FjcGlfZ3BhICsgZC0+YXJjaC5lZmlfYWNwaV9sZW4pIC0gMSwK
KyAgICAgICAgICAgICAgIGQtPmRvbWFpbl9pZCk7CisgICAgICAgIHJldHVybiByYzsKKyAgICB9
CisKKyAgICAvKgorICAgICAqIEZsdXNoIHRoZSBjYWNoZSBmb3IgdGhpcyByZWdpb24sIG90aGVy
d2lzZSBET00wIG1heSByZWFkIHdyb25nIGRhdGEgd2hlbgorICAgICAqIHRoZSBjYWNoZSBpcyBk
aXNhYmxlZC4KKyAgICAgKi8KKyAgICBjbGVhbl9hbmRfaW52YWxpZGF0ZV9kY2FjaGVfdmFfcmFu
Z2UoZC0+YXJjaC5lZmlfYWNwaV90YWJsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZC0+YXJjaC5lZmlfYWNwaV9sZW4pOworCisgICAgcmMgPSBjcmVhdGVfYWNw
aV9kdGIoa2luZm8sIHRibF9hZGQpOworICAgIGlmICggcmMgIT0gMCApCisgICAgICAgIHJldHVy
biByYzsKKworICAgIHJjID0gYWNwaV9yb3V0ZV9zcGlzKGQpOworICAgIGlmICggcmMgIT0gMCAp
CisgICAgICAgIHJldHVybiByYzsKKworICAgIHJjID0gYWNwaV9pb21lbV9kZW55X2FjY2Vzcyhk
KTsKKyAgICBpZiAoIHJjICE9IDAgKQorICAgICAgICByZXR1cm4gcmM7CisKKyAgICAvKgorICAg
ICAqIEFsbCBQUElzIGhhdmUgYmVlbiByZWdpc3RlcmVkLCBhbGxvY2F0ZSB0aGUgZXZlbnQgY2hh
bm5lbAorICAgICAqIGludGVycnVwdHMuCisgICAgICovCisgICAgZXZ0Y2huX2FsbG9jYXRlKGQp
OworCisgICAgcmV0dXJuIDA7Cit9CmRpZmYgLS1naXQgYS94ZW4vYXJjaC9hcm0vZG9tYWluX2J1
aWxkLmMgYi94ZW4vYXJjaC9hcm0vZG9tYWluX2J1aWxkLmMKaW5kZXggNGZjODFlNC4uZWQ5MGVk
YiAxMDA2NDQKLS0tIGEveGVuL2FyY2gvYXJtL2RvbWFpbl9idWlsZC5jCisrKyBiL3hlbi9hcmNo
L2FybS9kb21haW5fYnVpbGQuYwpAQCAtMjMsNiArMjMsNyBAQAogI2luY2x1ZGUgPGFzbS9wc2Np
Lmg+CiAjaW5jbHVkZSA8YXNtL3NldHVwLmg+CiAjaW5jbHVkZSA8YXNtL2NwdWZlYXR1cmUuaD4K
KyNpbmNsdWRlIDxhc20vZG9tYWluX2J1aWxkLmg+CiAKICNpbmNsdWRlIDx4ZW4vaXJxLmg+CiAj
aW5jbHVkZSA8eGVuL2dyYW50X3RhYmxlLmg+CkBAIC02NzgsOCArNjc5LDYgQEAgc3RhdGljIGlu
dCBfX2luaXQgbWFrZV9tZW1vcnlfbm9kZShjb25zdCBzdHJ1Y3QgZG9tYWluICpkLAogICAgIHJl
dHVybiByZXM7CiB9CiAKLXN0YXRpYyB2b2lkIGV2dGNobl9hbGxvY2F0ZShzdHJ1Y3QgZG9tYWlu
ICpkKTsKLQogc3RhdGljIGludCBfX2luaXQgbWFrZV9oeXBlcnZpc29yX25vZGUoc3RydWN0IGRv
bWFpbiAqZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0
cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpbnQgYWRkcmNlbGxzLCBpbnQgc2l6ZWNlbGxzKQpAQCAtMTA0MCw3ICsxMDM5LDcg
QEAgc3RhdGljIGludCBfX2luaXQgbWFrZV90aW1lcl9ub2RlKGNvbnN0IHN0cnVjdCBkb21haW4g
KmQsIHZvaWQgKmZkdCwKICAqIG9uIEFDUEkgc3lzdGVtcywgYW5kIERvbVVzIHN0YXJ0ZWQgZGly
ZWN0bHkgZnJvbSBYZW4gYmFzZWQgb24gZGV2aWNlCiAgKiB0cmVlIGluZm9ybWF0aW9uLgogICov
Ci1zdGF0aWMgaW50IF9faW5pdCBtYWtlX2Nob3Nlbl9ub2RlKGNvbnN0IHN0cnVjdCBrZXJuZWxf
aW5mbyAqa2luZm8pCitpbnQgX19pbml0IG1ha2VfY2hvc2VuX25vZGUoY29uc3Qgc3RydWN0IGtl
cm5lbF9pbmZvICpraW5mbykKIHsKICAgICBpbnQgcmVzOwogICAgIGNvbnN0IGNoYXIgKmJvb3Rh
cmdzID0gTlVMTDsKQEAgLTEwODEsOCArMTA4MCw4IEBAIHN0YXRpYyBpbnQgX19pbml0IG1ha2Vf
Y2hvc2VuX25vZGUoY29uc3Qgc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbykKICAgICByZXR1cm4g
cmVzOwogfQogCi1zdGF0aWMgaW50IF9faW5pdCBtYXBfaXJxX3RvX2RvbWFpbihzdHJ1Y3QgZG9t
YWluICpkLCB1bnNpZ25lZCBpbnQgaXJxLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYm9vbCBuZWVkX21hcHBpbmcsIGNvbnN0IGNoYXIgKmRldm5hbWUpCitpbnQgX19pbml0
IG1hcF9pcnFfdG9fZG9tYWluKHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGludCBpcnEsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgbmVlZF9tYXBwaW5nLCBjb25zdCBjaGFy
ICpkZXZuYW1lKQogewogICAgIGludCByZXM7CiAKQEAgLTE3OTYsNTgwICsxNzk1LDYgQEAgc3Rh
dGljIGludCBfX2luaXQgcHJlcGFyZV9kdGJfaHdkb20oc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0
IGtlcm5lbF9pbmZvICpraW5mbykKICAgICByZXR1cm4gLUVJTlZBTDsKIH0KIAotI2lmZGVmIENP
TkZJR19BQ1BJCi0jZGVmaW5lIEFDUElfRE9NMF9GRFRfTUlOX1NJWkUgNDA5NgotCi1zdGF0aWMg
aW50IF9faW5pdCBhY3BpX2lvbWVtX2RlbnlfYWNjZXNzKHN0cnVjdCBkb21haW4gKmQpCi17Ci0g
ICAgYWNwaV9zdGF0dXMgc3RhdHVzOwotICAgIHN0cnVjdCBhY3BpX3RhYmxlX3NwY3IgKnNwY3Ig
PSBOVUxMOwotICAgIHVuc2lnbmVkIGxvbmcgbWZuOwotICAgIGludCByYzsKLQotICAgIC8qIEZp
cnN0bHkgcGVybWl0IGZ1bGwgTU1JTyBjYXBhYmlsaXRpZXMuICovCi0gICAgcmMgPSBpb21lbV9w
ZXJtaXRfYWNjZXNzKGQsIDBVTCwgfjBVTCk7Ci0gICAgaWYgKCByYyApCi0gICAgICAgIHJldHVy
biByYzsKLQotICAgIC8qIFRPRE86IERlbnkgTU1JTyBhY2Nlc3MgZm9yIFNNTVUsIEdJQyBJVFMg
Ki8KLSAgICBzdGF0dXMgPSBhY3BpX2dldF90YWJsZShBQ1BJX1NJR19TUENSLCAwLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIChzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIgKiopJnNwY3Ip
OwotCi0gICAgaWYgKCBBQ1BJX0ZBSUxVUkUoc3RhdHVzKSApCi0gICAgewotICAgICAgICBwcmlu
dGsoIkZhaWxlZCB0byBnZXQgU1BDUiB0YWJsZVxuIik7Ci0gICAgICAgIHJldHVybiAtRUlOVkFM
OwotICAgIH0KLQotICAgIG1mbiA9IHNwY3ItPnNlcmlhbF9wb3J0LmFkZHJlc3MgPj4gUEFHRV9T
SElGVDsKLSAgICAvKiBEZW55IE1NSU8gYWNjZXNzIGZvciBVQVJUICovCi0gICAgcmMgPSBpb21l
bV9kZW55X2FjY2VzcyhkLCBtZm4sIG1mbiArIDEpOwotICAgIGlmICggcmMgKQotICAgICAgICBy
ZXR1cm4gcmM7Ci0KLSAgICAvKiBEZW55IE1NSU8gYWNjZXNzIGZvciBHSUMgcmVnaW9ucyAqLwot
ICAgIHJldHVybiBnaWNfaW9tZW1fZGVueV9hY2Nlc3MoZCk7Ci19Ci0KLXN0YXRpYyBpbnQgX19p
bml0IGFjcGlfcm91dGVfc3BpcyhzdHJ1Y3QgZG9tYWluICpkKQotewotICAgIGludCBpLCByZXM7
Ci0gICAgc3RydWN0IGlycV9kZXNjICpkZXNjOwotCi0gICAgLyoKLSAgICAgKiBSb3V0ZSB0aGUg
SVJRIHRvIGhhcmR3YXJlIGRvbWFpbiBhbmQgcGVybWl0IHRoZSBhY2Nlc3MuCi0gICAgICogVGhl
IGludGVycnVwdCB0eXBlIHdpbGwgYmUgc2V0IGJ5IHNldCBieSB0aGUgaGFyZHdhcmUgZG9tYWlu
LgotICAgICAqLwotICAgIGZvciggaSA9IE5SX0xPQ0FMX0lSUVM7IGkgPCB2Z2ljX251bV9pcnFz
KGQpOyBpKysgKQotICAgIHsKLSAgICAgICAgLyoKLSAgICAgICAgICogVE9ETzogRXhjbHVkZSB0
aGUgU1BJcyBTTU1VIHVzZXMgd2hpY2ggc2hvdWxkIG5vdCBiZSByb3V0ZWQgdG8KLSAgICAgICAg
ICogdGhlIGhhcmR3YXJlIGRvbWFpbi4KLSAgICAgICAgICovCi0gICAgICAgIGRlc2MgPSBpcnFf
dG9fZGVzYyhpKTsKLSAgICAgICAgaWYgKCBkZXNjLT5hY3Rpb24gIT0gTlVMTCkKLSAgICAgICAg
ICAgIGNvbnRpbnVlOwotCi0gICAgICAgIC8qIFhYWDogU2hhbGwgd2UgdXNlIGEgcHJvcGVyIGRl
dm5hbWU/ICovCi0gICAgICAgIHJlcyA9IG1hcF9pcnFfdG9fZG9tYWluKGQsIGksIHRydWUsICJB
Q1BJIik7Ci0gICAgICAgIGlmICggcmVzICkKLSAgICAgICAgICAgIHJldHVybiByZXM7Ci0gICAg
fQotCi0gICAgcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgX19pbml0IGFjcGlfbWFrZV9oeXBl
cnZpc29yX25vZGUoY29uc3Qgc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbywKLSAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IG1lbWJhbmsgdGJsX2FkZFtd
KQotewotICAgIGNvbnN0IGNoYXIgY29tcGF0W10gPQotICAgICAgICAieGVuLHhlbi0iX19zdHJp
bmdpZnkoWEVOX1ZFUlNJT04pIi4iX19zdHJpbmdpZnkoWEVOX1NVQlZFUlNJT04pIlwwIgotICAg
ICAgICAieGVuLHhlbiI7Ci0gICAgaW50IHJlczsKLSAgICAvKiBDb252ZW5pZW5jZSBhbGlhcyAq
LwotICAgIHZvaWQgKmZkdCA9IGtpbmZvLT5mZHQ7Ci0KLSAgICBkdF9kcHJpbnRrKCJDcmVhdGUg
aHlwZXJ2aXNvciBub2RlXG4iKTsKLQotICAgIC8qIFNlZSBsaW51eCBEb2N1bWVudGF0aW9uL2Rl
dmljZXRyZWUvYmluZGluZ3MvYXJtL3hlbi50eHQgKi8KLSAgICByZXMgPSBmZHRfYmVnaW5fbm9k
ZShmZHQsICJoeXBlcnZpc29yIik7Ci0gICAgaWYgKCByZXMgKQotICAgICAgICByZXR1cm4gcmVz
OwotCi0gICAgLyogQ2Fubm90IHVzZSBmZHRfcHJvcGVydHlfc3RyaW5nIGR1ZSB0byBlbWJlZGRl
ZCBudWxscyAqLwotICAgIHJlcyA9IGZkdF9wcm9wZXJ0eShmZHQsICJjb21wYXRpYmxlIiwgY29t
cGF0LCBzaXplb2YoY29tcGF0KSk7Ci0gICAgaWYgKCByZXMgKQotICAgICAgICByZXR1cm4gcmVz
OwotCi0gICAgcmVzID0gYWNwaV9tYWtlX2VmaV9ub2RlcyhmZHQsIHRibF9hZGQpOwotICAgIGlm
ICggcmVzICkKLSAgICAgICAgcmV0dXJuIHJlczsKLQotICAgIHJlcyA9IGZkdF9lbmRfbm9kZShm
ZHQpOwotCi0gICAgcmV0dXJuIHJlczsKLX0KLQotLyoKLSAqIFByZXBhcmUgYSBtaW5pbWFsIERU
QiBmb3IgRG9tMCB3aGljaCBjb250YWlucyBib290YXJncywgaW5pdHJkLCBtZW1vcnkKLSAqIGlu
Zm9ybWF0aW9uLCBFRkkgdGFibGUuCi0gKi8KLXN0YXRpYyBpbnQgX19pbml0IGNyZWF0ZV9hY3Bp
X2R0YihzdHJ1Y3Qga2VybmVsX2luZm8gKmtpbmZvLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCBtZW1iYW5rIHRibF9hZGRbXSkKLXsKLSAgICBpbnQgbmV3X3NpemU7
Ci0gICAgaW50IHJldDsKLQotICAgIGR0X2RwcmludGsoIlByZXBhcmUgYSBtaW4gRFRCIGZvciBE
T00wXG4iKTsKLQotICAgIC8qIEFsbG9jYXRlIG1pbiBzaXplIGZvciBEVCAqLwotICAgIG5ld19z
aXplID0gQUNQSV9ET00wX0ZEVF9NSU5fU0laRTsKLSAgICBraW5mby0+ZmR0ID0geG1hbGxvY19i
eXRlcyhuZXdfc2l6ZSk7Ci0KLSAgICBpZiAoIGtpbmZvLT5mZHQgPT0gTlVMTCApCi0gICAgICAg
IHJldHVybiAtRU5PTUVNOwotCi0gICAgLyogQ3JlYXRlIGEgbmV3IGVtcHR5IERUIGZvciBET00w
ICovCi0gICAgcmV0ID0gZmR0X2NyZWF0ZShraW5mby0+ZmR0LCBuZXdfc2l6ZSk7Ci0gICAgaWYg
KCByZXQgPCAwICkKLSAgICAgICAgZ290byBlcnI7Ci0KLSAgICByZXQgPSBmZHRfZmluaXNoX3Jl
c2VydmVtYXAoa2luZm8tPmZkdCk7Ci0gICAgaWYgKCByZXQgPCAwICkKLSAgICAgICAgZ290byBl
cnI7Ci0KLSAgICByZXQgPSBmZHRfYmVnaW5fbm9kZShraW5mby0+ZmR0LCAiLyIpOwotICAgIGlm
ICggcmV0IDwgMCApCi0gICAgICAgIGdvdG8gZXJyOwotCi0gICAgcmV0ID0gZmR0X3Byb3BlcnR5
X2NlbGwoa2luZm8tPmZkdCwgIiNhZGRyZXNzLWNlbGxzIiwgMik7Ci0gICAgaWYgKCByZXQgKQot
ICAgICAgICByZXR1cm4gcmV0OwotCi0gICAgcmV0ID0gZmR0X3Byb3BlcnR5X2NlbGwoa2luZm8t
PmZkdCwgIiNzaXplLWNlbGxzIiwgMSk7Ci0gICAgaWYgKCByZXQgKQotICAgICAgICByZXR1cm4g
cmV0OwotCi0gICAgLyogQ3JlYXRlIGEgY2hvc2VuIG5vZGUgZm9yIERPTTAgKi8KLSAgICByZXQg
PSBtYWtlX2Nob3Nlbl9ub2RlKGtpbmZvKTsKLSAgICBpZiAoIHJldCApCi0gICAgICAgIGdvdG8g
ZXJyOwotCi0gICAgcmV0ID0gYWNwaV9tYWtlX2h5cGVydmlzb3Jfbm9kZShraW5mbywgdGJsX2Fk
ZCk7Ci0gICAgaWYgKCByZXQgKQotICAgICAgICBnb3RvIGVycjsKLQotICAgIHJldCA9IGZkdF9l
bmRfbm9kZShraW5mby0+ZmR0KTsKLSAgICBpZiAoIHJldCA8IDAgKQotICAgICAgICBnb3RvIGVy
cjsKLQotICAgIHJldCA9IGZkdF9maW5pc2goa2luZm8tPmZkdCk7Ci0gICAgaWYgKCByZXQgPCAw
ICkKLSAgICAgICAgZ290byBlcnI7Ci0KLSAgICByZXR1cm4gMDsKLQotICBlcnI6Ci0gICAgcHJp
bnRrKCJEZXZpY2UgdHJlZSBnZW5lcmF0aW9uIGZhaWxlZCAoJWQpLlxuIiwgcmV0KTsKLSAgICB4
ZnJlZShraW5mby0+ZmR0KTsKLSAgICByZXR1cm4gLUVJTlZBTDsKLX0KLQotc3RhdGljIHZvaWQg
X19pbml0IGFjcGlfbWFwX290aGVyX3RhYmxlcyhzdHJ1Y3QgZG9tYWluICpkKQotewotICAgIGlu
dCBpOwotICAgIHVuc2lnbmVkIGxvbmcgcmVzOwotICAgIHU2NCBhZGRyLCBzaXplOwotCi0gICAg
LyogTWFwIGFsbCBBQ1BJIHRhYmxlcyB0byBEb20wIHVzaW5nIDE6MSBtYXBwaW5ncy4gKi8KLSAg
ICBmb3IoIGkgPSAwOyBpIDwgYWNwaV9nYmxfcm9vdF90YWJsZV9saXN0LmNvdW50OyBpKysgKQot
ICAgIHsKLSAgICAgICAgYWRkciA9IGFjcGlfZ2JsX3Jvb3RfdGFibGVfbGlzdC50YWJsZXNbaV0u
YWRkcmVzczsKLSAgICAgICAgc2l6ZSA9IGFjcGlfZ2JsX3Jvb3RfdGFibGVfbGlzdC50YWJsZXNb
aV0ubGVuZ3RoOwotICAgICAgICByZXMgPSBtYXBfcmVnaW9uc19wMm10KGQsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZ2FkZHJfdG9fZ2ZuKGFkZHIpLAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFBGTl9VUChzaXplKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtYWRkcl90b19tZm4oYWRkciksCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cDJtX21taW9fZGlyZWN0X2MpOwotICAgICAgICBpZiAoIHJlcyApCi0gICAgICAgIHsKLSAgICAg
ICAgICAgICBwYW5pYyhYRU5MT0dfRVJSICJVbmFibGUgdG8gbWFwIEFDUEkgcmVnaW9uIDB4JSJQ
Ukl4NjQKLSAgICAgICAgICAgICAgICAgICAiIC0gMHglIlBSSXg2NCIgaW4gZG9tYWluXG4iLAot
ICAgICAgICAgICAgICAgICAgIGFkZHIgJiBQQUdFX01BU0ssIFBBR0VfQUxJR04oYWRkciArIHNp
emUpIC0gMSk7Ci0gICAgICAgIH0KLSAgICB9Ci19Ci0KLXN0YXRpYyBpbnQgX19pbml0IGFjcGlf
Y3JlYXRlX3JzZHAoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IG1lbWJhbmsgdGJsX2FkZFtdKQot
ewotCi0gICAgc3RydWN0IGFjcGlfdGFibGVfcnNkcCAqcnNkcCA9IE5VTEw7Ci0gICAgdTY0IGFk
ZHI7Ci0gICAgdTY0IHRhYmxlX3NpemUgPSBzaXplb2Yoc3RydWN0IGFjcGlfdGFibGVfcnNkcCk7
Ci0gICAgdTggKmJhc2VfcHRyOwotICAgIHU4IGNoZWNrc3VtOwotCi0gICAgYWRkciA9IGFjcGlf
b3NfZ2V0X3Jvb3RfcG9pbnRlcigpOwotICAgIGlmICggIWFkZHIgICkKLSAgICB7Ci0gICAgICAg
IHByaW50aygiVW5hYmxlIHRvIGdldCBhY3BpIHJvb3QgcG9pbnRlclxuIik7Ci0gICAgICAgIHJl
dHVybiAtRUlOVkFMOwotICAgIH0KLSAgICByc2RwID0gYWNwaV9vc19tYXBfbWVtb3J5KGFkZHIs
IHRhYmxlX3NpemUpOwotICAgIGJhc2VfcHRyID0gZC0+YXJjaC5lZmlfYWNwaV90YWJsZQotICAg
ICAgICAgICAgICAgKyBhY3BpX2dldF90YWJsZV9vZmZzZXQodGJsX2FkZCwgVEJMX1JTRFApOwot
ICAgIG1lbWNweShiYXNlX3B0ciwgcnNkcCwgdGFibGVfc2l6ZSk7Ci0gICAgYWNwaV9vc191bm1h
cF9tZW1vcnkocnNkcCwgdGFibGVfc2l6ZSk7Ci0KLSAgICByc2RwID0gKHN0cnVjdCBhY3BpX3Rh
YmxlX3JzZHAgKiliYXNlX3B0cjsKLSAgICAvKiBSZXBsYWNlIHhzZHRfcGh5c2ljYWxfYWRkcmVz
cyAqLwotICAgIHJzZHAtPnhzZHRfcGh5c2ljYWxfYWRkcmVzcyA9IHRibF9hZGRbVEJMX1hTRFRd
LnN0YXJ0OwotICAgIGNoZWNrc3VtID0gYWNwaV90Yl9jaGVja3N1bShBQ1BJX0NBU1RfUFRSKHU4
LCByc2RwKSwgdGFibGVfc2l6ZSk7Ci0gICAgcnNkcC0+Y2hlY2tzdW0gPSByc2RwLT5jaGVja3N1
bSAtIGNoZWNrc3VtOwotCi0gICAgdGJsX2FkZFtUQkxfUlNEUF0uc3RhcnQgPSBkLT5hcmNoLmVm
aV9hY3BpX2dwYQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBhY3BpX2dldF90YWJs
ZV9vZmZzZXQodGJsX2FkZCwgVEJMX1JTRFApOwotICAgIHRibF9hZGRbVEJMX1JTRFBdLnNpemUg
PSB0YWJsZV9zaXplOwotCi0gICAgcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIF9faW5pdCBh
Y3BpX3hzZHRfbW9kaWZ5X2VudHJ5KHU2NCBlbnRyeVtdLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBlbnRyeV9jb3VudCwKLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgKnNpZ25hdHVyZSwgdTY0IGFk
ZHIpCi17Ci0gICAgaW50IGk7Ci0gICAgc3RydWN0IGFjcGlfdGFibGVfaGVhZGVyICp0YWJsZTsK
LSAgICB1NjQgc2l6ZSA9IHNpemVvZihzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIpOwotCi0gICAg
Zm9yKCBpID0gMDsgaSA8IGVudHJ5X2NvdW50OyBpKysgKQotICAgIHsKLSAgICAgICAgdGFibGUg
PSBhY3BpX29zX21hcF9tZW1vcnkoZW50cnlbaV0sIHNpemUpOwotICAgICAgICBpZiAoIEFDUElf
Q09NUEFSRV9OQU1FKHRhYmxlLT5zaWduYXR1cmUsIHNpZ25hdHVyZSkgKQotICAgICAgICB7Ci0g
ICAgICAgICAgICBlbnRyeVtpXSA9IGFkZHI7Ci0gICAgICAgICAgICBhY3BpX29zX3VubWFwX21l
bW9yeSh0YWJsZSwgc2l6ZSk7Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgfQotICAgICAg
ICBhY3BpX29zX3VubWFwX21lbW9yeSh0YWJsZSwgc2l6ZSk7Ci0gICAgfQotfQotCi1zdGF0aWMg
aW50IF9faW5pdCBhY3BpX2NyZWF0ZV94c2R0KHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBtZW1i
YW5rIHRibF9hZGRbXSkKLXsKLSAgICBzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIgKnRhYmxlID0g
TlVMTDsKLSAgICBzdHJ1Y3QgYWNwaV90YWJsZV9yc2RwICpyc2RwX3RibDsKLSAgICBzdHJ1Y3Qg
YWNwaV90YWJsZV94c2R0ICp4c2R0ID0gTlVMTDsKLSAgICB1NjQgdGFibGVfc2l6ZSwgYWRkcjsK
LSAgICB1bnNpZ25lZCBsb25nIGVudHJ5X2NvdW50OwotICAgIHU4ICpiYXNlX3B0cjsKLSAgICB1
OCBjaGVja3N1bTsKLQotICAgIGFkZHIgPSBhY3BpX29zX2dldF9yb290X3BvaW50ZXIoKTsKLSAg
ICBpZiAoICFhZGRyICkKLSAgICB7Ci0gICAgICAgIHByaW50aygiVW5hYmxlIHRvIGdldCBhY3Bp
IHJvb3QgcG9pbnRlclxuIik7Ci0gICAgICAgIHJldHVybiAtRUlOVkFMOwotICAgIH0KLSAgICBy
c2RwX3RibCA9IGFjcGlfb3NfbWFwX21lbW9yeShhZGRyLCBzaXplb2Yoc3RydWN0IGFjcGlfdGFi
bGVfcnNkcCkpOwotICAgIHRhYmxlID0gYWNwaV9vc19tYXBfbWVtb3J5KHJzZHBfdGJsLT54c2R0
X3BoeXNpY2FsX2FkZHJlc3MsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9m
KHN0cnVjdCBhY3BpX3RhYmxlX2hlYWRlcikpOwotCi0gICAgLyogQWRkIHBsYWNlIGZvciBTVEFP
IHRhYmxlIGluIFhTRFQgdGFibGUgKi8KLSAgICB0YWJsZV9zaXplID0gdGFibGUtPmxlbmd0aCAr
IHNpemVvZih1NjQpOwotICAgIGVudHJ5X2NvdW50ID0gKHRhYmxlLT5sZW5ndGggLSBzaXplb2Yo
c3RydWN0IGFjcGlfdGFibGVfaGVhZGVyKSkKLSAgICAgICAgICAgICAgICAgIC8gc2l6ZW9mKHU2
NCk7Ci0gICAgYmFzZV9wdHIgPSBkLT5hcmNoLmVmaV9hY3BpX3RhYmxlCi0gICAgICAgICAgICAg
ICArIGFjcGlfZ2V0X3RhYmxlX29mZnNldCh0YmxfYWRkLCBUQkxfWFNEVCk7Ci0gICAgbWVtY3B5
KGJhc2VfcHRyLCB0YWJsZSwgdGFibGUtPmxlbmd0aCk7Ci0gICAgYWNwaV9vc191bm1hcF9tZW1v
cnkodGFibGUsIHNpemVvZihzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIpKTsKLSAgICBhY3BpX29z
X3VubWFwX21lbW9yeShyc2RwX3RibCwgc2l6ZW9mKHN0cnVjdCBhY3BpX3RhYmxlX3JzZHApKTsK
LQotICAgIHhzZHQgPSAoc3RydWN0IGFjcGlfdGFibGVfeHNkdCAqKWJhc2VfcHRyOwotICAgIGFj
cGlfeHNkdF9tb2RpZnlfZW50cnkoeHNkdC0+dGFibGVfb2Zmc2V0X2VudHJ5LCBlbnRyeV9jb3Vu
dCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDUElfU0lHX0ZBRFQsIHRibF9hZGRbVEJM
X0ZBRFRdLnN0YXJ0KTsKLSAgICBhY3BpX3hzZHRfbW9kaWZ5X2VudHJ5KHhzZHQtPnRhYmxlX29m
ZnNldF9lbnRyeSwgZW50cnlfY291bnQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBBQ1BJ
X1NJR19NQURULCB0YmxfYWRkW1RCTF9NQURUXS5zdGFydCk7Ci0gICAgeHNkdC0+dGFibGVfb2Zm
c2V0X2VudHJ5W2VudHJ5X2NvdW50XSA9IHRibF9hZGRbVEJMX1NUQU9dLnN0YXJ0OwotCi0gICAg
eHNkdC0+aGVhZGVyLmxlbmd0aCA9IHRhYmxlX3NpemU7Ci0gICAgY2hlY2tzdW0gPSBhY3BpX3Ri
X2NoZWNrc3VtKEFDUElfQ0FTVF9QVFIodTgsIHhzZHQpLCB0YWJsZV9zaXplKTsKLSAgICB4c2R0
LT5oZWFkZXIuY2hlY2tzdW0gLT0gY2hlY2tzdW07Ci0KLSAgICB0YmxfYWRkW1RCTF9YU0RUXS5z
dGFydCA9IGQtPmFyY2guZWZpX2FjcGlfZ3BhCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICArIGFjcGlfZ2V0X3RhYmxlX29mZnNldCh0YmxfYWRkLCBUQkxfWFNEVCk7Ci0gICAgdGJsX2Fk
ZFtUQkxfWFNEVF0uc2l6ZSA9IHRhYmxlX3NpemU7Ci0KLSAgICByZXR1cm4gMDsKLX0KLQotc3Rh
dGljIGludCBfX2luaXQgYWNwaV9jcmVhdGVfc3RhbyhzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1Y3Qg
bWVtYmFuayB0YmxfYWRkW10pCi17Ci0gICAgc3RydWN0IGFjcGlfdGFibGVfaGVhZGVyICp0YWJs
ZSA9IE5VTEw7Ci0gICAgc3RydWN0IGFjcGlfdGFibGVfc3RhbyAqc3RhbyA9IE5VTEw7Ci0gICAg
dTMyIHRhYmxlX3NpemUgPSBzaXplb2Yoc3RydWN0IGFjcGlfdGFibGVfc3Rhbyk7Ci0gICAgdTMy
IG9mZnNldCA9IGFjcGlfZ2V0X3RhYmxlX29mZnNldCh0YmxfYWRkLCBUQkxfU1RBTyk7Ci0gICAg
YWNwaV9zdGF0dXMgc3RhdHVzOwotICAgIHU4ICpiYXNlX3B0ciwgY2hlY2tzdW07Ci0KLSAgICAv
KiBDb3B5IE9FTSBhbmQgQVNMIGNvbXBpbGVyIGZpZWxkcyBmcm9tIGFub3RoZXIgdGFibGUsIHVz
ZSBNQURUICovCi0gICAgc3RhdHVzID0gYWNwaV9nZXRfdGFibGUoQUNQSV9TSUdfTUFEVCwgMCwg
JnRhYmxlKTsKLQotICAgIGlmICggQUNQSV9GQUlMVVJFKHN0YXR1cykgKQotICAgIHsKLSAgICAg
ICAgY29uc3QgY2hhciAqbXNnID0gYWNwaV9mb3JtYXRfZXhjZXB0aW9uKHN0YXR1cyk7Ci0KLSAg
ICAgICAgcHJpbnRrKCJTVEFPOiBGYWlsZWQgdG8gZ2V0IE1BRFQgdGFibGUsICVzXG4iLCBtc2cp
OwotICAgICAgICByZXR1cm4gLUVJTlZBTDsKLSAgICB9Ci0KLSAgICBiYXNlX3B0ciA9IGQtPmFy
Y2guZWZpX2FjcGlfdGFibGUgKyBvZmZzZXQ7Ci0gICAgbWVtY3B5KGJhc2VfcHRyLCB0YWJsZSwg
c2l6ZW9mKHN0cnVjdCBhY3BpX3RhYmxlX2hlYWRlcikpOwotCi0gICAgc3RhbyA9IChzdHJ1Y3Qg
YWNwaV90YWJsZV9zdGFvICopYmFzZV9wdHI7Ci0gICAgbWVtY3B5KHN0YW8tPmhlYWRlci5zaWdu
YXR1cmUsIEFDUElfU0lHX1NUQU8sIDQpOwotICAgIHN0YW8tPmhlYWRlci5yZXZpc2lvbiA9IDE7
Ci0gICAgc3Rhby0+aGVhZGVyLmxlbmd0aCA9IHRhYmxlX3NpemU7Ci0gICAgc3Rhby0+aWdub3Jl
X3VhcnQgPSAxOwotICAgIGNoZWNrc3VtID0gYWNwaV90Yl9jaGVja3N1bShBQ1BJX0NBU1RfUFRS
KHU4LCBzdGFvKSwgdGFibGVfc2l6ZSk7Ci0gICAgc3Rhby0+aGVhZGVyLmNoZWNrc3VtIC09IGNo
ZWNrc3VtOwotCi0gICAgdGJsX2FkZFtUQkxfU1RBT10uc3RhcnQgPSBkLT5hcmNoLmVmaV9hY3Bp
X2dwYSArIG9mZnNldDsKLSAgICB0YmxfYWRkW1RCTF9TVEFPXS5zaXplID0gdGFibGVfc2l6ZTsK
LQotICAgIHJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IF9faW5pdCBhY3BpX2NyZWF0ZV9tYWR0
KHN0cnVjdCBkb21haW4gKmQsIHN0cnVjdCBtZW1iYW5rIHRibF9hZGRbXSkKLXsKLSAgICBzdHJ1
Y3QgYWNwaV90YWJsZV9oZWFkZXIgKnRhYmxlID0gTlVMTDsKLSAgICBzdHJ1Y3QgYWNwaV90YWJs
ZV9tYWR0ICptYWR0ID0gTlVMTDsKLSAgICBzdHJ1Y3QgYWNwaV9zdWJ0YWJsZV9oZWFkZXIgKmhl
YWRlcjsKLSAgICBzdHJ1Y3QgYWNwaV9tYWR0X2dlbmVyaWNfZGlzdHJpYnV0b3IgKmdpY2Q7Ci0g
ICAgdTMyIHRhYmxlX3NpemUgPSBzaXplb2Yoc3RydWN0IGFjcGlfdGFibGVfbWFkdCk7Ci0gICAg
dTMyIG9mZnNldCA9IGFjcGlfZ2V0X3RhYmxlX29mZnNldCh0YmxfYWRkLCBUQkxfTUFEVCk7Ci0g
ICAgaW50IHJldDsKLSAgICBhY3BpX3N0YXR1cyBzdGF0dXM7Ci0gICAgdTggKmJhc2VfcHRyLCBj
aGVja3N1bTsKLQotICAgIHN0YXR1cyA9IGFjcGlfZ2V0X3RhYmxlKEFDUElfU0lHX01BRFQsIDAs
ICZ0YWJsZSk7Ci0KLSAgICBpZiAoIEFDUElfRkFJTFVSRShzdGF0dXMpICkKLSAgICB7Ci0gICAg
ICAgIGNvbnN0IGNoYXIgKm1zZyA9IGFjcGlfZm9ybWF0X2V4Y2VwdGlvbihzdGF0dXMpOwotCi0g
ICAgICAgIHByaW50aygiRmFpbGVkIHRvIGdldCBNQURUIHRhYmxlLCAlc1xuIiwgbXNnKTsKLSAg
ICAgICAgcmV0dXJuIC1FSU5WQUw7Ci0gICAgfQotCi0gICAgYmFzZV9wdHIgPSBkLT5hcmNoLmVm
aV9hY3BpX3RhYmxlICsgb2Zmc2V0OwotICAgIG1lbWNweShiYXNlX3B0ciwgdGFibGUsIHRhYmxl
X3NpemUpOwotCi0gICAgLyogQWRkIEdlbmVyaWMgRGlzdHJpYnV0b3IuICovCi0gICAgaGVhZGVy
ID0gYWNwaV90YWJsZV9nZXRfZW50cnlfbWFkdChBQ1BJX01BRFRfVFlQRV9HRU5FUklDX0RJU1RS
SUJVVE9SLCAwKTsKLSAgICBpZiAoICFoZWFkZXIgKQotICAgIHsKLSAgICAgICAgcHJpbnRrKCJD
YW4ndCBnZXQgR0lDRCBlbnRyeVxuIik7Ci0gICAgICAgIHJldHVybiAtRUlOVkFMOwotICAgIH0K
LSAgICBnaWNkID0gY29udGFpbmVyX29mKGhlYWRlciwgc3RydWN0IGFjcGlfbWFkdF9nZW5lcmlj
X2Rpc3RyaWJ1dG9yLCBoZWFkZXIpOwotICAgIG1lbWNweShiYXNlX3B0ciArIHRhYmxlX3NpemUs
IGdpY2QsCi0gICAgICAgICAgICAgICAgc2l6ZW9mKHN0cnVjdCBhY3BpX21hZHRfZ2VuZXJpY19k
aXN0cmlidXRvcikpOwotICAgIHRhYmxlX3NpemUgKz0gc2l6ZW9mKHN0cnVjdCBhY3BpX21hZHRf
Z2VuZXJpY19kaXN0cmlidXRvcik7Ci0KLSAgICAvKiBBZGQgb3RoZXIgc3VidGFibGVzLiAqLwot
ICAgIHJldCA9IGdpY19tYWtlX2h3ZG9tX21hZHQoZCwgb2Zmc2V0ICsgdGFibGVfc2l6ZSk7Ci0g
ICAgaWYgKCByZXQgPCAwICkKLSAgICB7Ci0gICAgICAgIHByaW50aygiRmFpbGVkIHRvIGdldCBv
dGhlciBzdWJ0YWJsZXNcbiIpOwotICAgICAgICByZXR1cm4gLUVJTlZBTDsKLSAgICB9Ci0gICAg
dGFibGVfc2l6ZSArPSByZXQ7Ci0KLSAgICBtYWR0ID0gKHN0cnVjdCBhY3BpX3RhYmxlX21hZHQg
KiliYXNlX3B0cjsKLSAgICBtYWR0LT5oZWFkZXIubGVuZ3RoID0gdGFibGVfc2l6ZTsKLSAgICBj
aGVja3N1bSA9IGFjcGlfdGJfY2hlY2tzdW0oQUNQSV9DQVNUX1BUUih1OCwgbWFkdCksIHRhYmxl
X3NpemUpOwotICAgIG1hZHQtPmhlYWRlci5jaGVja3N1bSAtPSBjaGVja3N1bTsKLQotICAgIHRi
bF9hZGRbVEJMX01BRFRdLnN0YXJ0ID0gZC0+YXJjaC5lZmlfYWNwaV9ncGEgKyBvZmZzZXQ7Ci0g
ICAgdGJsX2FkZFtUQkxfTUFEVF0uc2l6ZSA9IHRhYmxlX3NpemU7Ci0KLSAgICByZXR1cm4gMDsK
LX0KLQotc3RhdGljIGludCBfX2luaXQgYWNwaV9jcmVhdGVfZmFkdChzdHJ1Y3QgZG9tYWluICpk
LCBzdHJ1Y3QgbWVtYmFuayB0YmxfYWRkW10pCi17Ci0gICAgc3RydWN0IGFjcGlfdGFibGVfaGVh
ZGVyICp0YWJsZSA9IE5VTEw7Ci0gICAgc3RydWN0IGFjcGlfdGFibGVfZmFkdCAqZmFkdCA9IE5V
TEw7Ci0gICAgdTY0IHRhYmxlX3NpemU7Ci0gICAgYWNwaV9zdGF0dXMgc3RhdHVzOwotICAgIHU4
ICpiYXNlX3B0cjsKLSAgICB1OCBjaGVja3N1bTsKLQotICAgIHN0YXR1cyA9IGFjcGlfZ2V0X3Rh
YmxlKEFDUElfU0lHX0ZBRFQsIDAsICZ0YWJsZSk7Ci0KLSAgICBpZiAoIEFDUElfRkFJTFVSRShz
dGF0dXMpICkKLSAgICB7Ci0gICAgICAgIGNvbnN0IGNoYXIgKm1zZyA9IGFjcGlfZm9ybWF0X2V4
Y2VwdGlvbihzdGF0dXMpOwotCi0gICAgICAgIHByaW50aygiRmFpbGVkIHRvIGdldCBGQURUIHRh
YmxlLCAlc1xuIiwgbXNnKTsKLSAgICAgICAgcmV0dXJuIC1FSU5WQUw7Ci0gICAgfQotCi0gICAg
dGFibGVfc2l6ZSA9IHRhYmxlLT5sZW5ndGg7Ci0gICAgYmFzZV9wdHIgPSBkLT5hcmNoLmVmaV9h
Y3BpX3RhYmxlCi0gICAgICAgICAgICAgICArIGFjcGlfZ2V0X3RhYmxlX29mZnNldCh0YmxfYWRk
LCBUQkxfRkFEVCk7Ci0gICAgbWVtY3B5KGJhc2VfcHRyLCB0YWJsZSwgdGFibGVfc2l6ZSk7Ci0g
ICAgZmFkdCA9IChzdHJ1Y3QgYWNwaV90YWJsZV9mYWR0ICopYmFzZV9wdHI7Ci0KLSAgICAvKiBT
ZXQgUFNDSV9DT01QTElBTlQgYW5kIFBTQ0lfVVNFX0hWQyAqLwotICAgIGZhZHQtPmFybV9ib290
X2ZsYWdzIHw9IChBQ1BJX0ZBRFRfUFNDSV9DT01QTElBTlQgfCBBQ1BJX0ZBRFRfUFNDSV9VU0Vf
SFZDKTsKLSAgICBjaGVja3N1bSA9IGFjcGlfdGJfY2hlY2tzdW0oQUNQSV9DQVNUX1BUUih1OCwg
ZmFkdCksIHRhYmxlX3NpemUpOwotICAgIGZhZHQtPmhlYWRlci5jaGVja3N1bSAtPSBjaGVja3N1
bTsKLQotICAgIHRibF9hZGRbVEJMX0ZBRFRdLnN0YXJ0ID0gZC0+YXJjaC5lZmlfYWNwaV9ncGEK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgYWNwaV9nZXRfdGFibGVfb2Zmc2V0KHRi
bF9hZGQsIFRCTF9GQURUKTsKLSAgICB0YmxfYWRkW1RCTF9GQURUXS5zaXplID0gdGFibGVfc2l6
ZTsKLQotICAgIHJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IF9faW5pdCBlc3RpbWF0ZV9hY3Bp
X2VmaV9zaXplKHN0cnVjdCBkb21haW4gKmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHN0cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8pCi17Ci0gICAgc2l6ZV90IGVm
aV9zaXplLCBhY3BpX3NpemUsIG1hZHRfc2l6ZTsKLSAgICB1NjQgYWRkcjsKLSAgICBzdHJ1Y3Qg
YWNwaV90YWJsZV9yc2RwICpyc2RwX3RibDsKLSAgICBzdHJ1Y3QgYWNwaV90YWJsZV9oZWFkZXIg
KnRhYmxlOwotCi0gICAgZWZpX3NpemUgPSBlc3RpbWF0ZV9lZmlfc2l6ZShraW5mby0+bWVtLm5y
X2JhbmtzKTsKLQotICAgIGFjcGlfc2l6ZSA9IFJPVU5EVVAoc2l6ZW9mKHN0cnVjdCBhY3BpX3Rh
YmxlX2ZhZHQpLCA4KTsKLSAgICBhY3BpX3NpemUgKz0gUk9VTkRVUChzaXplb2Yoc3RydWN0IGFj
cGlfdGFibGVfc3RhbyksIDgpOwotCi0gICAgbWFkdF9zaXplID0gZ2ljX2dldF9od2RvbV9tYWR0
X3NpemUoZCk7Ci0gICAgYWNwaV9zaXplICs9IFJPVU5EVVAobWFkdF9zaXplLCA4KTsKLQotICAg
IGFkZHIgPSBhY3BpX29zX2dldF9yb290X3BvaW50ZXIoKTsKLSAgICBpZiAoICFhZGRyICkKLSAg
ICB7Ci0gICAgICAgIHByaW50aygiVW5hYmxlIHRvIGdldCBhY3BpIHJvb3QgcG9pbnRlclxuIik7
Ci0gICAgICAgIHJldHVybiAtRUlOVkFMOwotICAgIH0KLQotICAgIHJzZHBfdGJsID0gYWNwaV9v
c19tYXBfbWVtb3J5KGFkZHIsIHNpemVvZihzdHJ1Y3QgYWNwaV90YWJsZV9yc2RwKSk7Ci0gICAg
aWYgKCAhcnNkcF90YmwgKQotICAgIHsKLSAgICAgICAgcHJpbnRrKCJVbmFibGUgdG8gbWFwIFJT
RFAgdGFibGVcbiIpOwotICAgICAgICByZXR1cm4gLUVJTlZBTDsKLSAgICB9Ci0KLSAgICB0YWJs
ZSA9IGFjcGlfb3NfbWFwX21lbW9yeShyc2RwX3RibC0+eHNkdF9waHlzaWNhbF9hZGRyZXNzLAot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihzdHJ1Y3QgYWNwaV90YWJsZV9o
ZWFkZXIpKTsKLSAgICBhY3BpX29zX3VubWFwX21lbW9yeShyc2RwX3RibCwgc2l6ZW9mKHN0cnVj
dCBhY3BpX3RhYmxlX3JzZHApKTsKLSAgICBpZiAoICF0YWJsZSApCi0gICAgewotICAgICAgICBw
cmludGsoIlVuYWJsZSB0byBtYXAgWFNEVCB0YWJsZVxuIik7Ci0gICAgICAgIHJldHVybiAtRUlO
VkFMOwotICAgIH0KLQotICAgIC8qIEFkZCBwbGFjZSBmb3IgU1RBTyB0YWJsZSBpbiBYU0RUIHRh
YmxlICovCi0gICAgYWNwaV9zaXplICs9IFJPVU5EVVAodGFibGUtPmxlbmd0aCArIHNpemVvZih1
NjQpLCA4KTsKLSAgICBhY3BpX29zX3VubWFwX21lbW9yeSh0YWJsZSwgc2l6ZW9mKHN0cnVjdCBh
Y3BpX3RhYmxlX2hlYWRlcikpOwotCi0gICAgYWNwaV9zaXplICs9IFJPVU5EVVAoc2l6ZW9mKHN0
cnVjdCBhY3BpX3RhYmxlX3JzZHApLCA4KTsKLSAgICBkLT5hcmNoLmVmaV9hY3BpX2xlbiA9IFBB
R0VfQUxJR04oUk9VTkRVUChlZmlfc2l6ZSwgOCkKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgKyBST1VORFVQKGFjcGlfc2l6ZSwgOCkpOwotCi0gICAgcmV0dXJuIDA7Ci19
Ci0KLXN0YXRpYyBpbnQgX19pbml0IHByZXBhcmVfYWNwaShzdHJ1Y3QgZG9tYWluICpkLCBzdHJ1
Y3Qga2VybmVsX2luZm8gKmtpbmZvKQotewotICAgIGludCByYyA9IDA7Ci0gICAgaW50IG9yZGVy
OwotICAgIHN0cnVjdCBtZW1iYW5rIHRibF9hZGRbVEJMX01NQVhdID0ge307Ci0KLSAgICByYyA9
IGVzdGltYXRlX2FjcGlfZWZpX3NpemUoZCwga2luZm8pOwotICAgIGlmICggcmMgIT0gMCApCi0g
ICAgICAgIHJldHVybiByYzsKLQotICAgIG9yZGVyID0gZ2V0X29yZGVyX2Zyb21fYnl0ZXMoZC0+
YXJjaC5lZmlfYWNwaV9sZW4pOwotICAgIGQtPmFyY2guZWZpX2FjcGlfdGFibGUgPSBhbGxvY194
ZW5oZWFwX3BhZ2VzKG9yZGVyLCAwKTsKLSAgICBpZiAoIGQtPmFyY2guZWZpX2FjcGlfdGFibGUg
PT0gTlVMTCApCi0gICAgewotICAgICAgICBwcmludGsoInVuYWJsZSB0byBhbGxvY2F0ZSBtZW1v
cnkhXG4iKTsKLSAgICAgICAgcmV0dXJuIC1FTk9NRU07Ci0gICAgfQotICAgIG1lbXNldChkLT5h
cmNoLmVmaV9hY3BpX3RhYmxlLCAwLCBkLT5hcmNoLmVmaV9hY3BpX2xlbik7Ci0KLSAgICAvKgot
ICAgICAqIEZvciBBQ1BJLCBEb20wIGRvZXNuJ3QgdXNlIGtpbmZvLT5nbnR0YWJfc3RhcnQgdG8g
Z2V0IHRoZSBncmFudCB0YWJsZQotICAgICAqIHJlZ2lvbi4gU28gd2UgdXNlIGl0IGFzIHRoZSBB
Q1BJIHRhYmxlIG1hcHBlZCBhZGRyZXNzLiBBbHNvIGl0IG5lZWRzIHRvCi0gICAgICogY2hlY2sg
aWYgdGhlIHNpemUgb2YgZ3JhbnQgdGFibGUgcmVnaW9uIGlzIGVub3VnaCBmb3IgdGhvc2UgQUNQ
SSB0YWJsZXMuCi0gICAgICovCi0gICAgZC0+YXJjaC5lZmlfYWNwaV9ncGEgPSBraW5mby0+Z250
dGFiX3N0YXJ0OwotICAgIGlmICgga2luZm8tPmdudHRhYl9zaXplIDwgZC0+YXJjaC5lZmlfYWNw
aV9sZW4gKQotICAgIHsKLSAgICAgICAgcHJpbnRrKCJUaGUgZ3JhbnQgdGFibGUgcmVnaW9uIGlz
IG5vdCBlbm91Z2ggdG8gZml0IHRoZSBBQ1BJIHRhYmxlcyFcbiIpOwotICAgICAgICByZXR1cm4g
LUVJTlZBTDsKLSAgICB9Ci0KLSAgICByYyA9IGFjcGlfY3JlYXRlX2ZhZHQoZCwgdGJsX2FkZCk7
Ci0gICAgaWYgKCByYyAhPSAwICkKLSAgICAgICAgcmV0dXJuIHJjOwotCi0gICAgcmMgPSBhY3Bp
X2NyZWF0ZV9tYWR0KGQsIHRibF9hZGQpOwotICAgIGlmICggcmMgIT0gMCApCi0gICAgICAgIHJl
dHVybiByYzsKLQotICAgIHJjID0gYWNwaV9jcmVhdGVfc3RhbyhkLCB0YmxfYWRkKTsKLSAgICBp
ZiAoIHJjICE9IDAgKQotICAgICAgICByZXR1cm4gcmM7Ci0KLSAgICByYyA9IGFjcGlfY3JlYXRl
X3hzZHQoZCwgdGJsX2FkZCk7Ci0gICAgaWYgKCByYyAhPSAwICkKLSAgICAgICAgcmV0dXJuIHJj
OwotCi0gICAgcmMgPSBhY3BpX2NyZWF0ZV9yc2RwKGQsIHRibF9hZGQpOwotICAgIGlmICggcmMg
IT0gMCApCi0gICAgICAgIHJldHVybiByYzsKLQotICAgIGFjcGlfbWFwX290aGVyX3RhYmxlcyhk
KTsKLSAgICBhY3BpX2NyZWF0ZV9lZmlfc3lzdGVtX3RhYmxlKGQsIHRibF9hZGQpOwotICAgIGFj
cGlfY3JlYXRlX2VmaV9tbWFwX3RhYmxlKGQsICZraW5mby0+bWVtLCB0YmxfYWRkKTsKLQotICAg
IC8qIE1hcCB0aGUgRUZJIGFuZCBBQ1BJIHRhYmxlcyB0byBEb20wICovCi0gICAgcmMgPSBtYXBf
cmVnaW9uc19wMm10KGQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgIGdhZGRyX3RvX2dmbihk
LT5hcmNoLmVmaV9hY3BpX2dwYSksCi0gICAgICAgICAgICAgICAgICAgICAgICAgIFBGTl9VUChk
LT5hcmNoLmVmaV9hY3BpX2xlbiksCi0gICAgICAgICAgICAgICAgICAgICAgICAgIHZpcnRfdG9f
bWZuKGQtPmFyY2guZWZpX2FjcGlfdGFibGUpLAotICAgICAgICAgICAgICAgICAgICAgICAgICBw
Mm1fbW1pb19kaXJlY3RfYyk7Ci0gICAgaWYgKCByYyAhPSAwICkKLSAgICB7Ci0gICAgICAgIHBy
aW50ayhYRU5MT0dfRVJSICJVbmFibGUgdG8gbWFwIEVGSS9BQ1BJIHRhYmxlIDB4JSJQUkl4NjQK
LSAgICAgICAgICAgICAgICIgLSAweCUiUFJJeDY0IiBpbiBkb21haW4gJWRcbiIsCi0gICAgICAg
ICAgICAgICBkLT5hcmNoLmVmaV9hY3BpX2dwYSAmIFBBR0VfTUFTSywKLSAgICAgICAgICAgICAg
IFBBR0VfQUxJR04oZC0+YXJjaC5lZmlfYWNwaV9ncGEgKyBkLT5hcmNoLmVmaV9hY3BpX2xlbikg
LSAxLAotICAgICAgICAgICAgICAgZC0+ZG9tYWluX2lkKTsKLSAgICAgICAgcmV0dXJuIHJjOwot
ICAgIH0KLQotICAgIC8qCi0gICAgICogRmx1c2ggdGhlIGNhY2hlIGZvciB0aGlzIHJlZ2lvbiwg
b3RoZXJ3aXNlIERPTTAgbWF5IHJlYWQgd3JvbmcgZGF0YSB3aGVuCi0gICAgICogdGhlIGNhY2hl
IGlzIGRpc2FibGVkLgotICAgICAqLwotICAgIGNsZWFuX2FuZF9pbnZhbGlkYXRlX2RjYWNoZV92
YV9yYW5nZShkLT5hcmNoLmVmaV9hY3BpX3RhYmxlLAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBkLT5hcmNoLmVmaV9hY3BpX2xlbik7Ci0KLSAgICByYyA9IGNyZWF0
ZV9hY3BpX2R0YihraW5mbywgdGJsX2FkZCk7Ci0gICAgaWYgKCByYyAhPSAwICkKLSAgICAgICAg
cmV0dXJuIHJjOwotCi0gICAgcmMgPSBhY3BpX3JvdXRlX3NwaXMoZCk7Ci0gICAgaWYgKCByYyAh
PSAwICkKLSAgICAgICAgcmV0dXJuIHJjOwotCi0gICAgcmMgPSBhY3BpX2lvbWVtX2RlbnlfYWNj
ZXNzKGQpOwotICAgIGlmICggcmMgIT0gMCApCi0gICAgICAgIHJldHVybiByYzsKLQotICAgIC8q
Ci0gICAgICogQWxsIFBQSXMgaGF2ZSBiZWVuIHJlZ2lzdGVyZWQsIGFsbG9jYXRlIHRoZSBldmVu
dCBjaGFubmVsCi0gICAgICogaW50ZXJydXB0cy4KLSAgICAgKi8KLSAgICBldnRjaG5fYWxsb2Nh
dGUoZCk7Ci0KLSAgICByZXR1cm4gMDsKLX0KLSNlbHNlCi1zdGF0aWMgaW50IF9faW5pdCBwcmVw
YXJlX2FjcGkoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbykKLXsK
LSAgICAvKiBPbmx5IGJvb3Rpbmcgd2l0aCBBQ1BJIHdpbGwgaGl0IGhlcmUgKi8KLSAgICBCVUco
KTsKLSAgICByZXR1cm4gLUVJTlZBTDsKLX0KLSNlbmRpZgogc3RhdGljIHZvaWQgX19pbml0IGR0
Yl9sb2FkKHN0cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8pCiB7CiAgICAgdW5zaWduZWQgbG9uZyBs
ZWZ0OwpAQCAtMjQ0Miw3ICsxODY3LDcgQEAgc3RhdGljIHZvaWQgX19pbml0IGluaXRyZF9sb2Fk
KHN0cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8pCiAgKiBOb3RlIHRoYXQgdGhpcyBzaG91bGQgb25s
eSBiZSBjYWxsZWQgb25jZSBhbGwgUFBJcyB1c2VkIGJ5IHRoZQogICogaGFyZHdhcmUgZG9tYWlu
IGhhdmUgYmVlbiByZWdpc3RlcmVkLgogICovCi1zdGF0aWMgdm9pZCBfX2luaXQgZXZ0Y2huX2Fs
bG9jYXRlKHN0cnVjdCBkb21haW4gKmQpCit2b2lkIF9faW5pdCBldnRjaG5fYWxsb2NhdGUoc3Ry
dWN0IGRvbWFpbiAqZCkKIHsKICAgICBpbnQgcmVzOwogICAgIHU2NCB2YWw7CmRpZmYgLS1naXQg
YS94ZW4vaW5jbHVkZS9hc20tYXJtL2RvbWFpbl9idWlsZC5oIGIveGVuL2luY2x1ZGUvYXNtLWFy
bS9kb21haW5fYnVpbGQuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi4zNGNl
ZGRjCi0tLSAvZGV2L251bGwKKysrIGIveGVuL2luY2x1ZGUvYXNtLWFybS9kb21haW5fYnVpbGQu
aApAQCAtMCwwICsxLDMxIEBACisjaWZuZGVmIF9fQVNNX0RPTUFJTl9CVUlMRF9IX18KKyNkZWZp
bmUgX19BU01fRE9NQUlOX0JVSUxEX0hfXworCisjaW5jbHVkZSA8eGVuL3NjaGVkLmg+CisjaW5j
bHVkZSA8YXNtL2tlcm5lbC5oPgorCitpbnQgbWFwX2lycV90b19kb21haW4oc3RydWN0IGRvbWFp
biAqZCwgdW5zaWduZWQgaW50IGlycSwKKyAgICAgICAgICAgICAgICAgICAgICBib29sIG5lZWRf
bWFwcGluZywgY29uc3QgY2hhciAqZGV2bmFtZSk7CitpbnQgbWFrZV9jaG9zZW5fbm9kZShjb25z
dCBzdHJ1Y3Qga2VybmVsX2luZm8gKmtpbmZvKTsKK3ZvaWQgZXZ0Y2huX2FsbG9jYXRlKHN0cnVj
dCBkb21haW4gKmQpOworCisjaWZuZGVmIENPTkZJR19BQ1BJCitzdGF0aWMgaW5saW5lIGludCBw
cmVwYXJlX2FjcGkoc3RydWN0IGRvbWFpbiAqZCwgc3RydWN0IGtlcm5lbF9pbmZvICpraW5mbykK
K3sKKyAgICAvKiBPbmx5IGJvb3Rpbmcgd2l0aCBBQ1BJIHdpbGwgaGl0IGhlcmUgKi8KKyAgICBC
VUcoKTsKKyAgICByZXR1cm4gLUVJTlZBTDsKK30KKyNlbHNlCitpbnQgcHJlcGFyZV9hY3BpKHN0
cnVjdCBkb21haW4gKmQsIHN0cnVjdCBrZXJuZWxfaW5mbyAqa2luZm8pOworI2VuZGlmCisjZW5k
aWYKKworLyoKKyAqIExvY2FsIHZhcmlhYmxlczoKKyAqIG1vZGU6IEMKKyAqIGMtZmlsZS1zdHls
ZTogIkJTRCIKKyAqIGMtYmFzaWMtb2Zmc2V0OiA0CisgKiBpbmRlbnQtdGFicy1tb2RlOiBuaWwK
KyAqIEVuZDoKKyAqLwotLSAKMS45LjEKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54
ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGlu
Zm8veGVuLWRldmVs
