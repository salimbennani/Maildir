Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 13 Nov 2018 00:33:32 -0000
Received: from icoremail.net (unknown [209.85.215.175])
	by mail-app2 (Coremail) with SMTP id by_KCgDnX_vdsulbzQR_AQ--.38508S3;
	Tue, 13 Nov 2018 01:05:37 +0800 (CST)
Received: from mail-pg1-f175.google.com (unknown [209.85.215.175])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwBHHTmpselbj_QyAA--.3747S3;
	Tue, 13 Nov 2018 01:00:25 +0800 (CST)
Received: by mail-pg1-f175.google.com with SMTP id 17so4073125pgg.1
        for <xuliker@zju.edu.cn>; Mon, 12 Nov 2018 09:00:25 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=m+PItqqM0fxjfMkQHVjdfduzGDTc507xdZKad94XhYI=;
        b=EE5SUv5p+nKFtR//4wsn8d8Qwms1yuahT6HQBAU9NP1+7XQMGQ8ASa7/40bYJhiTcr
         u0U2WNzSJe1GTowzVvj3TqniLnH1yBcie4xnbngvg2pHSAuaQKOwtdy3Qc9/KW6DPxn/
         67BCFS9k4aI0LA80HLV6PsI44OnPRSogELe2Rq2BmgMtLCkt38QNqjkwkvUBD0IYcmpU
         K8QYVaudVA2thqLdZx8foDXgvnHFbpsdMogygNqQKRuwkZlW974e9t2vbo8ha/FHKDhm
         XujVCax8Qja6/mDK2Uo5Gk5t7qEDWYImXAnsbOdi3YdiamsDR37PJzXvbKzjGMWefo8j
         CtsA==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gKFydOs8mtZPYHk4TAw3JLFphxJNTWA7cQFDBpiObgEJYhihBLa
	lRjXqnCSOBS9C7RhBQTICv+QVjS2Tzy8+MQPoe9nQyH4qzxujaW6kw==
X-Received: by 2002:a62:d084:: with SMTP id p126-v6mr1691302pfg.147.1542042025021;
        Mon, 12 Nov 2018 09:00:25 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:c304:0:0:0:0 with SMTP id g4-v6csp3430553pjt;
        Mon, 12 Nov 2018 09:00:23 -0800 (PST)
X-Google-Smtp-Source: AJdET5fph8wKJjxMacP1+A7PvKQfxL5xUqLQbapWVx6YysGIVTkE2lJjvnP920Dc3HBaEPIQ1bel
X-Received: by 2002:a81:4901:: with SMTP id w1-v6mr1575815ywa.86.1542042023523;
        Mon, 12 Nov 2018 09:00:23 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542042023; cv=none;
        d=google.com; s=arc-20160816;
        b=DR543I+Ngwrkjj0H76++0cT85aevKi89pOb8CWdrrTFuxHTZ9L1smPfNlQ5OJD0JMv
         fE0aNjDAulmdAUUKy02D41hhtl9yPKZCAiKt1uxdTXhe1WIg4sanVTPRFPiiR9YFeKxH
         TlW7p8M+9PdeJji/q4GOgQ+BhEeB8EdMJ0mtfrW+VRz4HiPeFbg7mm7x41UD319X7s2X
         jfdle/zttm3uGyIxqxdRipWKnX/wzNZBuZHrzZYM4XhwpeqviSury8ISn5c2uCBQEYtk
         wbdqCILr7G6ldsKV9PHXpWEsf/O3dF/RraPNzA6ul9ZlU9Yp+C2Sw31hVao8DXMOiWlh
         jl0w==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=m+PItqqM0fxjfMkQHVjdfduzGDTc507xdZKad94XhYI=;
        b=dRmDA6TK6Ee9qsuGN+oQyz4ezGEimdIh09nhR/tB/xoSbH2/I0zI3b0qio6at/5YFL
         aA479POFBOX3CJJ2DenYYyZu85YSLP6WojfjR4qhZa59WVBi3g0iIQDhzsb1xzBw3OgS
         tRwdK0gDqfTRQkcyet1ACowDhn0eSnp1Bgg5a3nb+pNm/XLPxcCKOXrhSXUKY0Q7Y16a
         cC90OXQplIbYbXVC9BYiHeGddZYCjck/XSu41HoxmufzLvjTnNaHw76XmDLhFd55RxoK
         iACa98Vr5pMPhKpZrR5ec9xseJ+SDCA5E4nauKgYdmcGySGGHq6KMOZOZ598+CTDuxWt
         lCQQ==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id 202-v6si5459067ywz.277.2018.11.12.09.00.22
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Mon, 12 Nov 2018 09:00:23 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gMFY0-00035M-3R; Mon, 12 Nov 2018 16:58:48 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=rjzm=nx=citrix.com=prvs=8477fb41c=anthony.perard@srs-us1.protection.inumbo.net>)
 id 1gMFXz-00034v-0N
 for xen-devel@lists.xenproject.org; Mon, 12 Nov 2018 16:58:47 +0000
X-Inumbo-ID: 37d70dd0-e69c-11e8-a2da-12d6303a7972
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 37d70dd0-e69c-11e8-a2da-12d6303a7972;
 Mon, 12 Nov 2018 16:58:46 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.54,495,1534809600"; d="scan'208";a="70323327"
From: Anthony PERARD <anthony.perard@citrix.com>
To: <xen-devel@lists.xenproject.org>
Date: Mon, 12 Nov 2018 16:49:30 +0000
Message-ID: <20181112164930.25893-12-anthony.perard@citrix.com>
X-Mailer: git-send-email 2.19.1
In-Reply-To: <20181112164930.25893-1-anthony.perard@citrix.com>
References: <20181112164930.25893-1-anthony.perard@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH v6 11/11] libxl: Re-implement
 domain_suspend_device_model using libxl__ev_qmp
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Anthony PERARD <anthony.perard@citrix.com>,
 Ian Jackson <ian.jackson@eu.citrix.com>, Wei Liu <wei.liu2@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwBHHTmpselbj_QyAA--.3747S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3tF43uryfKry8tF4UKw45ZFb_yoWDWw1kpr
	WkWa9xW348JF4xAws5Ar1rWF1Yyrs3t3y7AayrAr4Ika17Zw15G34vyr1YyryUWrWfJrWU
	ZrW8CF47Aa18KFUanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlmb7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_tr0E3s1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Gr1j6F4UJwA2z4x0Y4vE
	x4A2jsIE14v26r4UJVWxJr1l84ACjcxK6I8E87Iv6xkF7I0E14v26r4UJVWxJr1lnx0E6V
	ACY4xI67k04243AVACY4xI67k04243AVAKzVAKj4xI6x02cVCv0xWle2I262IYc4CY6c8I
	j28IcVAaY2xG8wAqx4xG64xvF2IEw4CE5I8CrVC2j2WlYx0E2Ix0cI8IcVAFwI0_JrI_Jr
	ylYx0Ex4A2jsIE14v26r1j6r4UMcvjeVCFs4IE7xkEbVWUJVW8JwACjcxG0xvY0x0EwIxG
	rwACY4xI67k04243AVAKzVAKj4xxMx02cVCv0xWlc7CjxVAKzI0EY4vE52x082I5MxkFs2
	0EY4vE44CYbxCE4x80FwCY02Avz4vEIxC_GwCY0x0Ix7I2Y4AK64vIr41lcIIF0xvE2Ix0
	cI8IcVAFwI0_Xr0_Ar1lcIIF0xvE2Ix0cI8IcVCY1x0267AKxVW8JVWxJwCYIxAIcVC2z2
	80aVAFwI0_Gr1j6F4UJwCYIxAIcVC2z280aVCY1x0267AKxVW8Jr0_Cr1UMxAIw28IcxkI
	7VAKI48JMxAIw28IcVAKzI0EY4vE52x082I5MxCjnVCjjxCrMxC20s026xCaFVCjc4AY6r
	1j6r4UMI8I3I0E5I8CrVAFwI0_Jr0_Jr4lx2IqxVCjr7xvwVAFwI0_JrI_JrWlx4CE17CE
	b7AF67AKxVWUAVWUtwCIc40Y0x0EwIxGrwCI42IY6xAIw20EY4v20xvaj40_Gr0_Zr1l6V
	ACY4xI67k04243AbIYCTnIWIevJa73UjIFyTuYvjxU9k9NDUUUU

VGhlIHJlLWltcGxlbWVudGF0aW9uIGlzIGRvbmUgYmVjYXVzZSB3ZSB3YW50IHRvIGJlIGFibGUg
dG8gc2VuZCB0aGUKZmlsZSBkZXNjcmlwdGlvbiB0aGF0IFFFTVUgY2FuIHVzZSB0byBzYXZlIGl0
cyBzdGF0ZS4gV2hlbiBRRU1VIGlzCnJlc3RyaWN0ZWQsIGl0IHdvdWxkIG5vdCBiZSBhYmxlIHRv
IHdyaXRlIHRvIGEgcGF0aC4KClRoaXMgcmVwbGFjZSBib3RoIGxpYnhsX19xbXBfc3RvcCgpIGFu
ZCBsaWJ4bF9fcW1wX3NhdmUoKS4KCnFtcF9xZW11X2NoZWNrX3ZlcnNpb24oKSB3YXMgb25seSB1
c2VkIGJ5IGxpYnhsX19xbXBfc2F2ZSgpLCBzbyBpdCBpcwpyZXBsYWNlIGJ5IGEgdmVyc2lvbiB1
c2luZyBsaWJ4bF9fZXZfcW1wIGluc3RlYWQuCgpDb2Rpbmcgc3R5bGUgZml4ZWQgaW4gbGlieGxf
X2RvbWFpbl9zdXNwZW5kX2RldmljZV9tb2RlbCgpIGZvciB0aGUKcmV0dXJuIHZhbHVlLgoKU2ln
bmVkLW9mZi1ieTogQW50aG9ueSBQRVJBUkQgPGFudGhvbnkucGVyYXJkQGNpdHJpeC5jb20+Ci0t
LQoKTm90ZXM6CiAgICB2NjoKICAgICAgICBleHRyYWN0IG9wZW4gY2FsbCBmcm9tIGxpYnhsX19j
YXJlZmRfb3BlbmVkIHRvIHJlc3BlY3QgY29kaW5nIHN0eWxlCiAgICAgICAgbGlieGxfX3FtcF9z
dXNwZW5kX3NhdmUgbm93IGFsd2F5cyByZXBvcnQgc3VjY2Vzcy9lcnJvcgogICAgICAgICAgICB2
aWEgZHNwcy0+Y2FsbGJhY2tfZGV2aWNlX21vZGVsX2RvbmUKICAgIAogICAgdjU6CiAgICAgICAg
cmVuYW1lIGdvdG8gJ291dCcgbGFiZWwgdG8gJ2Vycm9yJywgYXMgaXQgaXMgdXNlIG9ubHkgZm9y
IGVycm9ycy4KICAgICAgICByZS1hZGQva2VlcCB0aGUgY29tbWVudCBhYm91dCB0aGUgImxpdmUi
IHBhcmFtZXRlciBpbiBkbV9zdGF0ZV9mZF9yZWFkeQogICAgICAgIHVzZSBsaWJ4bF9fcmVtb3Zl
X2ZpbGUgaW5zdGVhZCBvZiBwbGFpbiB1bmxpbmsKICAgIAogICAgdjQ6CiAgICAgICAgVGhpcyBw
YXRjaCByZXBsYWNlIHRoZSBwYXRjaCAibGlieGxfcW1wOiBIYXZlIFFFTVUgc2F2ZSBpdHMgc3Rh
dGUgdG8gYSBmaWxlCiAgICAgICAgZGVzY3JpcHRvciIgZnJvbSBwcmV2aW91cyB2ZXJzaW9uIG9m
IHRoZSBzZXJpZS4KICAgICAgICBJdCB1c2VzIGxpYnhsX19ldl9xbXAgaW5zdGVhZC4KCiB0b29s
cy9saWJ4bC9saWJ4bF9kb21fc3VzcGVuZC5jIHwgIDE5ICstLS0KIHRvb2xzL2xpYnhsL2xpYnhs
X2ludGVybmFsLmggICAgfCAgMTAgKy0KIHRvb2xzL2xpYnhsL2xpYnhsX3FtcC5jICAgICAgICAg
fCAxNTkgKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwg
MTM3IGluc2VydGlvbnMoKyksIDUxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xzL2xp
YnhsL2xpYnhsX2RvbV9zdXNwZW5kLmMgYi90b29scy9saWJ4bC9saWJ4bF9kb21fc3VzcGVuZC5j
CmluZGV4IGY4ZmY1Y2YwYzUuLmQxYWYzYTY1NzMgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2xpYnhsL2xp
YnhsX2RvbV9zdXNwZW5kLmMKKysrIGIvdG9vbHMvbGlieGwvbGlieGxfZG9tX3N1c3BlbmQuYwpA
QCAtMzQsNiArMzQsNyBAQCBpbnQgbGlieGxfX2RvbWFpbl9zdXNwZW5kX2luaXQobGlieGxfX2Vn
YyAqZWdjLAogICAgIGxpYnhsX19ldl9ldnRjaG5faW5pdCgmZHNwcy0+Z3Vlc3RfZXZ0Y2huKTsK
ICAgICBsaWJ4bF9fZXZfeHN3YXRjaF9pbml0KCZkc3BzLT5ndWVzdF93YXRjaCk7CiAgICAgbGli
eGxfX2V2X3RpbWVfaW5pdCgmZHNwcy0+Z3Vlc3RfdGltZW91dCk7CisgICAgbGlieGxfX2V2X3Ft
cF9pbml0KCZkc3BzLT5xbXApOwogCiAgICAgaWYgKHR5cGUgPT0gTElCWExfRE9NQUlOX1RZUEVf
SU5WQUxJRCkgZ290byBvdXQ7CiAgICAgZHNwcy0+dHlwZSA9IHR5cGU7CkBAIC03Miw3ICs3Myw2
IEBAIHZvaWQgbGlieGxfX2RvbWFpbl9zdXNwZW5kX2RldmljZV9tb2RlbChsaWJ4bF9fZWdjICpl
Z2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWlu
X3N1c3BlbmRfc3RhdGUgKmRzcHMpCiB7CiAgICAgU1RBVEVfQU9fR0MoZHNwcy0+YW8pOwotICAg
IGludCByZXQgPSAwOwogICAgIGludCByYyA9IDA7CiAgICAgdWludDMyX3QgY29uc3QgZG9taWQg
PSBkc3BzLT5kb21pZDsKICAgICBjb25zdCBjaGFyICpjb25zdCBmaWxlbmFtZSA9IGRzcHMtPmRt
X3NhdmVmaWxlOwpAQCAtODUsMTkgKzg1LDkgQEAgdm9pZCBsaWJ4bF9fZG9tYWluX3N1c3BlbmRf
ZGV2aWNlX21vZGVsKGxpYnhsX19lZ2MgKmVnYywKICAgICAgICAgYnJlYWs7CiAgICAgfQogICAg
IGNhc2UgTElCWExfREVWSUNFX01PREVMX1ZFUlNJT05fUUVNVV9YRU46Ci0gICAgICAgIHJldCA9
IGxpYnhsX19xbXBfc3RvcChnYywgZG9taWQpOwotICAgICAgICBpZiAocmV0KSB7Ci0gICAgICAg
ICAgICByYyA9IEVSUk9SX0ZBSUw7Ci0gICAgICAgICAgICBnb3RvIG91dDsKLSAgICAgICAgfQot
ICAgICAgICAvKiBTYXZlIERNIHN0YXRlIGludG8gZmlsZW5hbWUgKi8KLSAgICAgICAgcmV0ID0g
bGlieGxfX3FtcF9zYXZlKGdjLCBkb21pZCwgZmlsZW5hbWUsIGRzcHMtPmxpdmUpOwotICAgICAg
ICBpZiAocmV0KSB7Ci0gICAgICAgICAgICByYyA9IEVSUk9SX0ZBSUw7Ci0gICAgICAgICAgICB1
bmxpbmsoZmlsZW5hbWUpOwotICAgICAgICAgICAgZ290byBvdXQ7Ci0gICAgICAgIH0KLSAgICAg
ICAgYnJlYWs7CisgICAgICAgIC8qIGNhbGxzIGRzcHMtPmNhbGxiYWNrX2RldmljZV9tb2RlbF9k
b25lIHdoZW4gZG9uZSAqLworICAgICAgICBsaWJ4bF9fcW1wX3N1c3BlbmRfc2F2ZShlZ2MsIGRz
cHMpOyAvKiBtdXN0IGJlIGxhc3QgKi8KKyAgICAgICAgcmV0dXJuOwogICAgIGRlZmF1bHQ6CiAg
ICAgICAgIHJjID0gRVJST1JfSU5WQUw7CiAgICAgICAgIGdvdG8gb3V0OwpAQCAtNDA2LDYgKzM5
Niw3IEBAIHN0YXRpYyB2b2lkIGRvbWFpbl9zdXNwZW5kX2NvbW1vbl9kb25lKGxpYnhsX19lZ2Mg
KmVnYywKICAgICBsaWJ4bF9fZXZfZXZ0Y2huX2NhbmNlbChnYywgJmRzcHMtPmd1ZXN0X2V2dGNo
bik7CiAgICAgbGlieGxfX2V2X3hzd2F0Y2hfZGVyZWdpc3RlcihnYywgJmRzcHMtPmd1ZXN0X3dh
dGNoKTsKICAgICBsaWJ4bF9fZXZfdGltZV9kZXJlZ2lzdGVyKGdjLCAmZHNwcy0+Z3Vlc3RfdGlt
ZW91dCk7CisgICAgbGlieGxfX2V2X3FtcF9kaXNwb3NlKGdjLCAmZHNwcy0+cW1wKTsKICAgICBk
c3BzLT5jYWxsYmFja19jb21tb25fZG9uZShlZ2MsIGRzcHMsIHJjKTsKIH0KIApkaWZmIC0tZ2l0
IGEvdG9vbHMvbGlieGwvbGlieGxfaW50ZXJuYWwuaCBiL3Rvb2xzL2xpYnhsL2xpYnhsX2ludGVy
bmFsLmgKaW5kZXggMjhhZjZkODY2Yy4uNmVjMzNmNmViNiAxMDA2NDQKLS0tIGEvdG9vbHMvbGli
eGwvbGlieGxfaW50ZXJuYWwuaAorKysgYi90b29scy9saWJ4bC9saWJ4bF9pbnRlcm5hbC5oCkBA
IC0xOTQ3LDEzICsxOTQ3LDggQEAgX2hpZGRlbiBpbnQgbGlieGxfX3FtcF9wY2lfZGVsKGxpYnhs
X19nYyAqZ2MsIGludCBkb21pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4
bF9kZXZpY2VfcGNpICpwY2lkZXYpOwogLyogUmVzdW1lIGh2bSBkb21haW4gKi8KIF9oaWRkZW4g
aW50IGxpYnhsX19xbXBfc3lzdGVtX3dha2V1cChsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQpOwot
LyogU3VzcGVuZCBRRU1VLiAqLwotX2hpZGRlbiBpbnQgbGlieGxfX3FtcF9zdG9wKGxpYnhsX19n
YyAqZ2MsIGludCBkb21pZCk7CiAvKiBSZXN1bWUgUUVNVS4gKi8KIF9oaWRkZW4gaW50IGxpYnhs
X19xbXBfcmVzdW1lKGxpYnhsX19nYyAqZ2MsIGludCBkb21pZCk7Ci0vKiBTYXZlIGN1cnJlbnQg
UUVNVSBzdGF0ZSBpbnRvIGZkLiAqLwotX2hpZGRlbiBpbnQgbGlieGxfX3FtcF9zYXZlKGxpYnhs
X19nYyAqZ2MsIGludCBkb21pZCwgY29uc3QgY2hhciAqZmlsZW5hbWUsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgYm9vbCBsaXZlKTsKIC8qIExvYWQgY3VycmVudCBRRU1VIHN0YXRlIGZy
b20gZmlsZS4gKi8KIF9oaWRkZW4gaW50IGxpYnhsX19xbXBfcmVzdG9yZShsaWJ4bF9fZ2MgKmdj
LCBpbnQgZG9taWQsIGNvbnN0IGNoYXIgKmZpbGVuYW1lKTsKIC8qIFNldCBkaXJ0eSBiaXRtYXAg
bG9nZ2luZyBzdGF0dXMgKi8KQEAgLTM0MTIsNiArMzQwNyw3IEBAIHN0cnVjdCBsaWJ4bF9fZG9t
YWluX3N1c3BlbmRfc3RhdGUgewogICAgIGxpYnhsX194c3dhaXRfc3RhdGUgcHZjb250cm9sOwog
ICAgIGxpYnhsX19ldl94c3dhdGNoIGd1ZXN0X3dhdGNoOwogICAgIGxpYnhsX19ldl90aW1lIGd1
ZXN0X3RpbWVvdXQ7CisgICAgbGlieGxfX2V2X3FtcCBxbXA7CiAKICAgICBjb25zdCBjaGFyICpk
bV9zYXZlZmlsZTsKICAgICB2b2lkICgqY2FsbGJhY2tfZGV2aWNlX21vZGVsX2RvbmUpKGxpYnhs
X19lZ2MqLApAQCAtMzQyMyw2ICszNDE5LDEwIEBAIGludCBsaWJ4bF9fZG9tYWluX3N1c3BlbmRf
aW5pdChsaWJ4bF9fZWdjICplZ2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGli
eGxfX2RvbWFpbl9zdXNwZW5kX3N0YXRlICpkc3BzLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGxpYnhsX2RvbWFpbl90eXBlIHR5cGUpOwogCisvKiBjYWxscyBkc3BzLT5jYWxsYmFj
a19kZXZpY2VfbW9kZWxfZG9uZSB3aGVuIGRvbmUgKi8KK19oaWRkZW4gdm9pZCBsaWJ4bF9fcW1w
X3N1c3BlbmRfc2F2ZShsaWJ4bF9fZWdjICplZ2MsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbGlieGxfX2RvbWFpbl9zdXNwZW5kX3N0YXRlICpkc3BzKTsKKwogc3RydWN0
IGxpYnhsX19kb21haW5fc2F2ZV9zdGF0ZSB7CiAgICAgLyogc2V0IGJ5IGNhbGxlciBvZiBsaWJ4
bF9fZG9tYWluX3NhdmUgKi8KICAgICBsaWJ4bF9fYW8gKmFvOwpkaWZmIC0tZ2l0IGEvdG9vbHMv
bGlieGwvbGlieGxfcW1wLmMgYi90b29scy9saWJ4bC9saWJ4bF9xbXAuYwppbmRleCA1ZDM5ODRl
NmE1Li5iN2UwMTE5NDBmIDEwMDY0NAotLS0gYS90b29scy9saWJ4bC9saWJ4bF9xbXAuYworKysg
Yi90b29scy9saWJ4bC9saWJ4bF9xbXAuYwpAQCAtNDA1LDEyICs0MDUsMTIgQEAgc3RhdGljIGlu
dCBxbXBfaGFuZGxlX3Jlc3BvbnNlKGxpYnhsX19nYyAqZ2MsIGxpYnhsX19xbXBfaGFuZGxlciAq
cW1wLAogICogICA9IDAgIGlmIHFlbXUncyB2ZXJzaW9uID09IGFza2VkIHZlcnNpb24KICAqICAg
PiAwICBpZiBxZW11J3MgdmVyc2lvbiA+ICBhc2tlZCB2ZXJzaW9uCiAgKi8KLXN0YXRpYyBpbnQg
cW1wX3FlbXVfY29tcGFyZV92ZXJzaW9uKGxpYnhsX19xbXBfaGFuZGxlciAqcW1wLCBpbnQgbWFq
b3IsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgbWlub3IsIGludCBt
aWNybykKK3N0YXRpYyBpbnQgcW1wX2V2X3FlbXVfY29tcGFyZV92ZXJzaW9uKGxpYnhsX19ldl9x
bXAgKmV2LCBpbnQgbWFqb3IsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpbnQgbWlub3IsIGludCBtaWNybykKIHsKICNkZWZpbmUgQ0hFQ0tfVkVSU0lPTihsZXZlbCkg
ZG8geyBcCi0gICAgaWYgKHFtcC0+dmVyc2lvbi5sZXZlbCA+IChsZXZlbCkpIHJldHVybiArMTsg
XAotICAgIGlmIChxbXAtPnZlcnNpb24ubGV2ZWwgPCAobGV2ZWwpKSByZXR1cm4gLTE7IFwKKyAg
ICBpZiAoZXYtPnFlbXVfdmVyc2lvbi5sZXZlbCA+IChsZXZlbCkpIHJldHVybiArMTsgXAorICAg
IGlmIChldi0+cWVtdV92ZXJzaW9uLmxldmVsIDwgKGxldmVsKSkgcmV0dXJuIC0xOyBcCiB9IHdo
aWxlICgwKQogCiAgICAgQ0hFQ0tfVkVSU0lPTihtYWpvcik7CkBAIC0xMDI3LDI5ICsxMDI3LDYg
QEAgaW50IGxpYnhsX19xbXBfc3lzdGVtX3dha2V1cChsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9taWQp
CiAgICAgcmV0dXJuIHFtcF9ydW5fY29tbWFuZChnYywgZG9taWQsICJzeXN0ZW1fd2FrZXVwIiwg
TlVMTCwgTlVMTCwgTlVMTCk7CiB9CiAKLWludCBsaWJ4bF9fcW1wX3NhdmUobGlieGxfX2djICpn
YywgaW50IGRvbWlkLCBjb25zdCBjaGFyICpmaWxlbmFtZSwgYm9vbCBsaXZlKQotewotICAgIGxp
YnhsX19qc29uX29iamVjdCAqYXJncyA9IE5VTEw7Ci0gICAgbGlieGxfX3FtcF9oYW5kbGVyICpx
bXAgPSBOVUxMOwotICAgIGludCByYzsKLQotICAgIHFtcCA9IGxpYnhsX19xbXBfaW5pdGlhbGl6
ZShnYywgZG9taWQpOwotICAgIGlmICghcW1wKQotICAgICAgICByZXR1cm4gRVJST1JfRkFJTDsK
LQotICAgIHFtcF9wYXJhbWV0ZXJzX2FkZF9zdHJpbmcoZ2MsICZhcmdzLCAiZmlsZW5hbWUiLCAo
Y2hhciAqKWZpbGVuYW1lKTsKLQotICAgIC8qIGxpdmUgcGFyYW1ldGVyIHdhcyBhZGRlZCB0byBR
RU1VIDIuMTEuIEl0IHNpZ25hbCBRRU1VIHRoYXQgdGhlIHNhdmUKLSAgICAgKiBvcGVyYXRpb24g
aXMgZm9yIGEgbGl2ZSBtaWdyYXRpb24gcmF0aGVyIHRoYXQgZm9yIHRha2luZyBhIHNuYXBzaG90
LiAqLwotICAgIGlmIChxbXBfcWVtdV9jb21wYXJlX3ZlcnNpb24ocW1wLCAyLCAxMSwgMCkgPj0g
MCkKLSAgICAgICAgcW1wX3BhcmFtZXRlcnNfYWRkX2Jvb2woZ2MsICZhcmdzLCAibGl2ZSIsIGxp
dmUpOwotCi0gICAgcmMgPSBxbXBfc3luY2hyb25vdXNfc2VuZChxbXAsICJ4ZW4tc2F2ZS1kZXZp
Y2VzLXN0YXRlIiwgYXJncywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsIE5V
TEwsIHFtcC0+dGltZW91dCk7Ci0gICAgbGlieGxfX3FtcF9jbG9zZShxbXApOwotICAgIHJldHVy
biByYzsKLX0KLQogaW50IGxpYnhsX19xbXBfcmVzdG9yZShsaWJ4bF9fZ2MgKmdjLCBpbnQgZG9t
aWQsIGNvbnN0IGNoYXIgKnN0YXRlX2ZpbGUpCiB7CiAgICAgbGlieGxfX2pzb25fb2JqZWN0ICph
cmdzID0gTlVMTDsKQEAgLTEwNzgsMTEgKzEwNTUsNiBAQCBzdGF0aWMgaW50IHFtcF9jaGFuZ2Uo
bGlieGxfX2djICpnYywgbGlieGxfX3FtcF9oYW5kbGVyICpxbXAsCiAgICAgcmV0dXJuIHJjOwog
fQogCi1pbnQgbGlieGxfX3FtcF9zdG9wKGxpYnhsX19nYyAqZ2MsIGludCBkb21pZCkKLXsKLSAg
ICByZXR1cm4gcW1wX3J1bl9jb21tYW5kKGdjLCBkb21pZCwgInN0b3AiLCBOVUxMLCBOVUxMLCBO
VUxMKTsKLX0KLQogaW50IGxpYnhsX19xbXBfcmVzdW1lKGxpYnhsX19nYyAqZ2MsIGludCBkb21p
ZCkKIHsKICAgICByZXR1cm4gcW1wX3J1bl9jb21tYW5kKGdjLCBkb21pZCwgImNvbnQiLCBOVUxM
LCBOVUxMLCBOVUxMKTsKQEAgLTEzMjIsNiArMTI5NCwxMjkgQEAgaW50IGxpYnhsX19xbXBfaW5p
dGlhbGl6YXRpb25zKGxpYnhsX19nYyAqZ2MsIHVpbnQzMl90IGRvbWlkLAogICAgIHJldHVybiBy
ZXQ7CiB9CiAKKworLyoKKyAqIEZ1bmN0aW9uIHVzaW5nIGxpYnhsX19ldl9xbXAKKyAqLworCitz
dGF0aWMgdm9pZCBkbV9zdG9wcGVkKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqZXYs
CisgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpYnhsX19qc29uX29iamVjdCAqcmVzcG9u
c2UsIGludCByYyk7CitzdGF0aWMgdm9pZCBkbV9zdGF0ZV9mZF9yZWFkeShsaWJ4bF9fZWdjICpl
Z2MsIGxpYnhsX19ldl9xbXAgKmV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
c3QgbGlieGxfX2pzb25fb2JqZWN0ICpyZXNwb25zZSwgaW50IHJjKTsKK3N0YXRpYyB2b2lkIGRt
X3N0YXRlX3NhdmVkKGxpYnhsX19lZ2MgKmVnYywgbGlieGxfX2V2X3FtcCAqZXYsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjb25zdCBsaWJ4bF9fanNvbl9vYmplY3QgKnJlc3BvbnNlLCBp
bnQgcmMpOworCisvKiBjYWxscyBkc3BzLT5jYWxsYmFja19kZXZpY2VfbW9kZWxfZG9uZSB3aGVu
IGRvbmUgKi8KK3ZvaWQgbGlieGxfX3FtcF9zdXNwZW5kX3NhdmUobGlieGxfX2VnYyAqZWdjLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJ4bF9fZG9tYWluX3N1c3BlbmRfc3RhdGUg
KmRzcHMpCit7CisgICAgRUdDX0dDOworICAgIGludCByYzsKKyAgICBsaWJ4bF9fZXZfcW1wICpl
diA9ICZkc3BzLT5xbXA7CisKKyAgICBldi0+ZG9taWQgPSBkc3BzLT5kb21pZDsKKyAgICBldi0+
Y2FsbGJhY2sgPSBkbV9zdG9wcGVkOworICAgIGV2LT5mZCA9IC0xOworCisgICAgcmMgPSBsaWJ4
bF9fZXZfcW1wX3NlbmQoZ2MsIGV2LCAic3RvcCIsIE5VTEwpOworICAgIGlmIChyYykKKyAgICAg
ICAgZ290byBlcnJvcjsKKworICAgIHJldHVybjsKKworZXJyb3I6CisgICAgZHNwcy0+Y2FsbGJh
Y2tfZGV2aWNlX21vZGVsX2RvbmUoZWdjLCBkc3BzLCByYyk7Cit9CisKK3N0YXRpYyB2b2lkIGRt
X3N0b3BwZWQobGlieGxfX2VnYyAqZWdjLCBsaWJ4bF9fZXZfcW1wICpldiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgY29uc3QgbGlieGxfX2pzb25fb2JqZWN0ICpyZXNwb25zZSwgaW50IHJjKQor
eworICAgIEVHQ19HQzsKKyAgICBsaWJ4bF9fZG9tYWluX3N1c3BlbmRfc3RhdGUgKmRzcHMgPSBD
T05UQUlORVJfT0YoZXYsICpkc3BzLCBxbXApOworICAgIGNvbnN0IGNoYXIgKmNvbnN0IGZpbGVu
YW1lID0gZHNwcy0+ZG1fc2F2ZWZpbGU7CisKKyAgICBpZiAocmMpCisgICAgICAgIGdvdG8gZXJy
b3I7CisKKyAgICBldi0+ZmQgPSBvcGVuKGZpbGVuYW1lLCBPX1dST05MWSB8IE9fQ1JFQVQsIDA2
MDApOworICAgIGlmIChldi0+ZmQgPCAwKSB7CisgICAgICAgIExPR0VEKEVSUk9SLCBldi0+ZG9t
aWQsCisgICAgICAgICAgICAgICJGYWlsZWQgdG8gb3BlbiBmaWxlICVzIGZvciBRRU1VIiwgZmls
ZW5hbWUpOworICAgICAgICByYyA9IEVSUk9SX0ZBSUw7CisgICAgICAgIGdvdG8gZXJyb3I7Cisg
ICAgfQorCisgICAgZXYtPmNhbGxiYWNrID0gZG1fc3RhdGVfZmRfcmVhZHk7CisgICAgcmMgPSBs
aWJ4bF9fZXZfcW1wX3NlbmQoZ2MsIGV2LCAiYWRkLWZkIiwgTlVMTCk7CisgICAgaWYgKHJjKQor
ICAgICAgICBnb3RvIGVycm9yOworCisgICAgcmV0dXJuOworCitlcnJvcjoKKyAgICBpZiAoZXYt
PmZkID49IDApIHsKKyAgICAgICAgY2xvc2UoZXYtPmZkKTsKKyAgICAgICAgdW5saW5rKGZpbGVu
YW1lKTsKKyAgICAgICAgZXYtPmZkID0gLTE7CisgICAgfQorICAgIGRzcHMtPmNhbGxiYWNrX2Rl
dmljZV9tb2RlbF9kb25lKGVnYywgZHNwcywgcmMpOworfQorCitzdGF0aWMgdm9pZCBkbV9zdGF0
ZV9mZF9yZWFkeShsaWJ4bF9fZWdjICplZ2MsIGxpYnhsX19ldl9xbXAgKmV2LAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlieGxfX2pzb25fb2JqZWN0ICpyZXNwb25zZSwg
aW50IHJjKQoreworICAgIEVHQ19HQzsKKyAgICBpbnQgZmRzZXQ7CisgICAgY29uc3QgbGlieGxf
X2pzb25fb2JqZWN0ICpvOworICAgIGxpYnhsX19qc29uX29iamVjdCAqYXJncyA9IE5VTEw7Cisg
ICAgbGlieGxfX2RvbWFpbl9zdXNwZW5kX3N0YXRlICpkc3BzID0gQ09OVEFJTkVSX09GKGV2LCAq
ZHNwcywgcW1wKTsKKworICAgIGNsb3NlKGV2LT5mZCk7CisgICAgZXYtPmZkID0gLTE7CisKKyAg
ICBpZiAocmMpCisgICAgICAgIGdvdG8gZXJyb3I7CisKKyAgICBvID0gbGlieGxfX2pzb25fbWFw
X2dldCgiZmRzZXQtaWQiLCByZXNwb25zZSwgSlNPTl9JTlRFR0VSKTsKKyAgICBpZiAoIW8pIHsK
KyAgICAgICAgcmMgPSBFUlJPUl9RRU1VX0FQSTsKKyAgICAgICAgZ290byBlcnJvcjsKKyAgICB9
CisgICAgZmRzZXQgPSBsaWJ4bF9fanNvbl9vYmplY3RfZ2V0X2ludGVnZXIobyk7CisKKyAgICBl
di0+Y2FsbGJhY2sgPSBkbV9zdGF0ZV9zYXZlZDsKKworICAgIC8qIFRoZSBgbGl2ZWAgcGFyYW1l
dGVyIHdhcyBhZGRlZCB0byBRRU1VIDIuMTEuIEl0IHNpZ25hbHMgUUVNVSB0aGF0CisgICAgICog
dGhlIHNhdmUgb3BlcmF0aW9uIGlzIGZvciBhIGxpdmUgbWlncmF0aW9uIHJhdGhlciB0aGFuIGZv
ciB0YWtpbmcgYQorICAgICAqIHNuYXBzaG90LiAqLworICAgIGlmIChxbXBfZXZfcWVtdV9jb21w
YXJlX3ZlcnNpb24oZXYsIDIsIDExLCAwKSA+PSAwKQorICAgICAgICBxbXBfcGFyYW1ldGVyc19h
ZGRfYm9vbChnYywgJmFyZ3MsICJsaXZlIiwgZHNwcy0+bGl2ZSk7CisgICAgUU1QX1BBUkFNRVRF
UlNfU1BSSU5URigmYXJncywgImZpbGVuYW1lIiwgIi9kZXYvZmRzZXQvJWQiLCBmZHNldCk7Cisg
ICAgcmMgPSBsaWJ4bF9fZXZfcW1wX3NlbmQoZ2MsIGV2LCAieGVuLXNhdmUtZGV2aWNlcy1zdGF0
ZSIsIGFyZ3MpOworICAgIGlmIChyYykKKyAgICAgICAgZ290byBlcnJvcjsKKworICAgIHJldHVy
bjsKKworZXJyb3I6CisgICAgaWYgKHJjKQorICAgICAgICBsaWJ4bF9fcmVtb3ZlX2ZpbGUoZ2Ms
IGRzcHMtPmRtX3NhdmVmaWxlKTsKKyAgICBkc3BzLT5jYWxsYmFja19kZXZpY2VfbW9kZWxfZG9u
ZShlZ2MsIGRzcHMsIHJjKTsKK30KKworc3RhdGljIHZvaWQgZG1fc3RhdGVfc2F2ZWQobGlieGxf
X2VnYyAqZWdjLCBsaWJ4bF9fZXZfcW1wICpldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNvbnN0IGxpYnhsX19qc29uX29iamVjdCAqcmVzcG9uc2UsIGludCByYykKK3sKKyAgICBFR0Nf
R0M7CisgICAgbGlieGxfX2RvbWFpbl9zdXNwZW5kX3N0YXRlICpkc3BzID0gQ09OVEFJTkVSX09G
KGV2LCAqZHNwcywgcW1wKTsKKworICAgIGlmIChyYykKKyAgICAgICAgdW5saW5rKGRzcHMtPmRt
X3NhdmVmaWxlKTsKKworICAgIGRzcHMtPmNhbGxiYWNrX2RldmljZV9tb2RlbF9kb25lKGVnYywg
ZHNwcywgcmMpOworfQorCisKIC8qIC0tLS0tLS0tLS0tLSBJbXBsZW1lbnRhdGlvbiBvZiBsaWJ4
bF9fZXZfcW1wIC0tLS0tLS0tLS0tLS0tLS0gKi8KIAogLyoKLS0gCkFudGhvbnkgUEVSQVJECgoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KWGVuLWRldmVs
IG1haWxpbmcgbGlzdApYZW4tZGV2ZWxAbGlzdHMueGVucHJvamVjdC5vcmcKaHR0cHM6Ly9saXN0
cy54ZW5wcm9qZWN0Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL3hlbi1kZXZlbA==
