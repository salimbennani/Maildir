Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 30 Nov 2018 08:43:32 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga005.jf.intel.com (orsmga005.jf.intel.com [10.7.209.41])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id F1ED85802E4;
	Thu, 29 Nov 2018 06:21:11 -0800 (PST)
Received: from orsmga101.jf.intel.com ([10.7.208.22])
  by orsmga005-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 29 Nov 2018 06:21:11 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AbOZrrRB25T3kJm/QJkUjUyQJP3N1i/DPJgcQr6Af?=
 =?us-ascii?q?oPdwSP7+ocqwAkXT6L1XgUPTWs2DsrQY07qQ6/iocFdDyK7JiGoFfp1IWk1Nou?=
 =?us-ascii?q?QttCtkPvS4D1bmJuXhdS0wEZcKflZk+3amLRodQ56mNBXdrXKo8DEdBAj0OxZr?=
 =?us-ascii?q?KeTpAI7SiNm82/yv95HJbAhEmDmwbaluIBmqsA7cqtQYjYx+J6gr1xDHuGFIe+?=
 =?us-ascii?q?NYxWNpIVKcgRPx7dqu8ZBg7ipdpesv+9ZPXqvmcas4S6dYDCk9PGAu+MLrrxjD?=
 =?us-ascii?q?QhCR6XYaT24bjwBHAwnB7BH9Q5fxri73vfdz1SWGIcH7S60/VC+85Kl3VhDnlC?=
 =?us-ascii?q?YHNyY48G7JjMxwkLlbqw+lqxBm3oLYfJ2ZOP94c6zaYN0aWHFBXt5PWCNdHoOy?=
 =?us-ascii?q?YYwPD+8bMuZZqYn2ul8CoBS6CAWpAu7k1z1GiWLs3aAi0+ovDxzI0gIjEdwJsn?=
 =?us-ascii?q?vUotv6O6gOXu6616nI1TfOYuhK2Tr+5oXEbgosrOuOUL92bMHfyVMvFwTAjliI?=
 =?us-ascii?q?qILlJS2a1usQuGae9epgUvigi24+pw9zuDev3NssiozTiYIT11vJ8ip5wJwrKt?=
 =?us-ascii?q?23S057YcWpEJ9RtyGcKot3Tc0iQ2Z1uCY817IJo4K7fCkNyJQh3RLfbOaHc4eR?=
 =?us-ascii?q?7x/lSe2fLzB4hHd/d7K+gRa/6VKvyvXkVsmvyFZKqTZFnsPQuXAK0hze7NWMRP?=
 =?us-ascii?q?hl/kq5xzqDywTe5vtZLU06i6bXMYMtz70smpYJsEnOHDf6lUb4gaOMdUgp+/Kk?=
 =?us-ascii?q?5ufjb7n8u5OQK415hwfjOao0gMO/G/43Mg0WUmib5+u80Lrj8FXnQLVFkPI2iL?=
 =?us-ascii?q?PVsJPEKsQBoK62HQtV3pwk6xalADeqyNUYnX8ZI1JZYB+LkZTlNlXULPzlA/qz?=
 =?us-ascii?q?nU6gnCpoyvzaJLHsA5fAImDGkLj7fLZ970BcyBA0zdBa/59UDrABIPTuWk7+rd?=
 =?us-ascii?q?DYDQE2Mxayw+n5DNVxz4QeWGyJAqCHKqPfqkGI5u0xLOmWfoMVuyjyK+Ij5/Hw?=
 =?us-ascii?q?iX81g1gdfbOm3ZcPcnC3AuxmI1mFYXrrmtoBFWYKvgkgQ+Dwh1yCTCVeZ3KzX6?=
 =?us-ascii?q?I6+zE6B5iqDYbFRoCxnrOB2D23EYFRZmBDElqMC2vnd52YW/cQbyKfOs9hnSYF?=
 =?us-ascii?q?Vbi9UYAh0guitA/ny7V9KOrU9TYVtZbi1Nhz+u3Smgs+9T1yD8SBzW6NS3t4kX?=
 =?us-ascii?q?8PRz8zxKp/u1Byyk+f0ahkhPxVDd5T5/RXXQsgNp7cyOp6C9b1Wg/aeteJSVCm?=
 =?us-ascii?q?QsipAD0rT9IxxcMObFh5G9m4kh/D2C+qCacPl7OXHJw07r7c33/pKsln0HbG1K?=
 =?us-ascii?q?4hj1o8TstVL2KmhLVy9wzSB47PjkWYmLymdaUa3C7R6miDyXCCs11fUA51Sa/F?=
 =?us-ascii?q?R2wQZlPKrdTl4UPPV7yuBq4hMgdbzc6CK7FFatvmjVhdQPfjOdLeY3++mmuqBB?=
 =?us-ascii?q?aIwK+MY5Tue2kHwCrdD00EmRgJ/XmaLQg+Gjuho2XGATNzD13vfV3j/fN+qHyh?=
 =?us-ascii?q?SE801B+Fb0tm27qx+R4VgPicRugX3rIFvichtjp1EEy839LQF9qPuQ5hcL9Abt?=
 =?us-ascii?q?M65VdNzXjZuBBlPpy8M6BigUYTfBltsEPwyRp7EIVAntIsrHMx0gVyL7mV0FdA?=
 =?us-ascii?q?dzOewJDxNafbKmj0/BCzdaHW3kvS38qR+qcK8P44sUnsvBm1Fko+9HVqy8VV03?=
 =?us-ascii?q?qZ5pXNEAoSUZLwXlwr9xRgoLHaeC0954LS1X1jKqS0tj7C29Q0BOoq0BqgftFf?=
 =?us-ascii?q?ML+aGw/2CcEVG8+uKOkykVizch0EJPxS9LIzP86+bfSG3LCkPel+kzOml2hI+5?=
 =?us-ascii?q?193V+W+Cp6Se7I2IgFzuqc3guGUTf8kVigvtr2mYBCeTEdAG6/xTL4C45WY614?=
 =?us-ascii?q?ZZwLBnu2I82r2tV+gIbgWn5F9FK5G1wKws6oeRqIYFz70g1dzkAXoX2hmSulwD?=
 =?us-ascii?q?14iTAprqyD3CPQx+TubgYIOmlORGN6l1fjPZC0j8wGXEivdwUpjhql6lrgyKhB?=
 =?us-ascii?q?uat/KHPfQUFWcCjsLmFuS7e/uaCGY8FS9pwoqyJXUOKnbFCeS779pQYa0iz5E2?=
 =?us-ascii?q?tfwjA7ay+lupHjkxNmj2KdKW55rGDFdsFo2Rff+NvcSOZR3zoHXiV5iSPbBkOh?=
 =?us-ascii?q?P9mv5tiUk5bDsuajV2OuTJFTcC/rzZ+euyu//2FlHRq/n/WrkN39DQc6yTP718?=
 =?us-ascii?q?VtVSjQrhbzeJPr16e5MeJgZEVoH0Xz68l5GoF/lIs/mpcQ1GMehpWU+3oHjGjy?=
 =?us-ascii?q?Pc9a2aL4cHoCWzoLz8TJ7wji3U1pNmiJyJ7hVnWB3sthYMG3Y2MM1SI69cxKCq?=
 =?us-ascii?q?aU7LpfkCtxo1q4qx/RYPdnkjccz/su9GAVg+UTtAUxySWdB6gYHVNEMiz0ixSI?=
 =?us-ascii?q?89e+ob1UZGm1cLi8zkp+nc27A7GErQFRQ3L5epYkHS9t4cRzKlPM0Hvv6o76fN?=
 =?us-ascii?q?ncd84cthqRkx3YlehaNIoxluYWhSpgIW/9uHwly+0hghB005C1opOHK3lz86Kj?=
 =?us-ascii?q?GRFXKCf1Z8wI9zHpjKZemNuW3o+1EpVgHDULQIXnTfayHD0OsvTnMh6EECcgpX?=
 =?us-ascii?q?eDBbrfAQif5V96r3LIFpCnLXCWK2MfzdV/XxmdP01fjRsQXDU7mJ45Cw+ryNbg?=
 =?us-ascii?q?cEd/+jAe+Fr4pgFQxeJvMhn1Sn3fqxuwajcoVJifKwJb4RpY6EfSNcye8/h/Hy?=
 =?us-ascii?q?VF/pC6qAyNK2qbZxlHDG0TW0yEAUzjMaeq5dXa7+eYAe++JePUYbqSsexeS+uI?=
 =?us-ascii?q?xZW334tk5TmMM9uAPmJ4A/0nwEZDXm15G8fEmzUJUSMXjDnAb8qapBe65y12od?=
 =?us-ascii?q?qz8PXtWALz+4SPD6FePslo+xCzma2DLfKfhD5lKTZE0ZMB3X/JyL8C3F4LliFh?=
 =?us-ascii?q?bT+tHa4btS7KSqLQlbRaDxoaayN1KctJ4Lgw3ghLOc7HlNz10qR0geIyC1dATV?=
 =?us-ascii?q?bhgN2mZdQWI2GhM1PKHEaLO6qHJT3IwMH3YLmwSb5KjOVTuB2/pyybE1L4PjmY?=
 =?us-ascii?q?kznpVhavMfxDjS2BPRxevp29fQhpCWT5UN3mbRi7OsdtjTIq2b00mm/KNWkEPD?=
 =?us-ascii?q?dmbkNCtaeQ4j1Yg/llH2xB72FoLe2Fmyaf8unZJYwasfptAiRoie1a5G42xKdS?=
 =?us-ascii?q?7CFBXPZ1gjfdrsZyo1G6lemC0iZnUBtLqjpRmI2Hp1ltOaXH+ZlGQnvE+BMN7W?=
 =?us-ascii?q?ONCxUFvddlC9vvu7xOxdjLjq78NDBC89fM98sGG8fUMN6HMGYmMRfxGD/bFg0F?=
 =?us-ascii?q?TTuqNWHZn0NckfGS+WeTrpg1sZXsnJsOSrlGVF06DP8aC0JlHMAcL5dzRD8rjb?=
 =?us-ascii?q?mbjMtbrUa5+R3QQthK+5PKTPSfBd3xJzuDy7pJfR0FxfX/N4tAGJf83hlNcFR1?=
 =?us-ascii?q?1KfQHEPQGPBEuDFkZwl89EpX/Xd9TkU32kT4eg2q/XkfHOK1mRhwjRFxN7d+vA?=
 =?us-ascii?q?zw6ks6cwKZ7BA7l1M8zJC42D0=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AQAADP9P9bh0O0hNFkHAEBAQQBAQcEA?=
 =?us-ascii?q?QGBUQcBAQsBgmmBAieDeYgYX4spgg0UlzCBcBcYDQYBh3QiNAkNAQMBAQEBAQE?=
 =?us-ascii?q?CARMBAQEIDQkIKSMMgjYkgmMDAwECIA8BDQEBNwEFCQEBHwUCBSECAgMMSBkFg?=
 =?us-ascii?q?xwBggEEAQqlFnCBCCeCdgEBBYcoAwWBC4Zggw+BHBeBf4dBBBiBEIEEgjeCV4k?=
 =?us-ascii?q?tlngJhn6KKSOBWoUQijIsjSyKdoFGgg0zGggoCIMnghuDbYUUhUA/Mgp4AwEBI?=
 =?us-ascii?q?ROKOYJNAQE?=
X-IPAS-Result: =?us-ascii?q?A0AQAADP9P9bh0O0hNFkHAEBAQQBAQcEAQGBUQcBAQsBgmm?=
 =?us-ascii?q?BAieDeYgYX4spgg0UlzCBcBcYDQYBh3QiNAkNAQMBAQEBAQECARMBAQEIDQkIK?=
 =?us-ascii?q?SMMgjYkgmMDAwECIA8BDQEBNwEFCQEBHwUCBSECAgMMSBkFgxwBggEEAQqlFnC?=
 =?us-ascii?q?BCCeCdgEBBYcoAwWBC4Zggw+BHBeBf4dBBBiBEIEEgjeCV4ktlngJhn6KKSOBW?=
 =?us-ascii?q?oUQijIsjSyKdoFGgg0zGggoCIMnghuDbYUUhUA/Mgp4AwEBIROKOYJNAQE?=
X-IronPort-AV: E=Sophos;i="5.56,294,1539673200"; 
   d="scan'208";a="42821304"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 29 Nov 2018 06:21:10 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1731428AbeK3B0O (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Thu, 29 Nov 2018 20:26:14 -0500
Received: from mail.kernel.org ([198.145.29.99]:50002 "EHLO mail.kernel.org"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1728883AbeK3B0N (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 29 Nov 2018 20:26:13 -0500
Received: from localhost (5356596B.cm-6-7b.dynamic.ziggo.nl [83.86.89.107])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by mail.kernel.org (Postfix) with ESMTPSA id 0ABAB20868;
        Thu, 29 Nov 2018 14:20:41 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=default; t=1543501242;
        bh=8GLP3rvwogVkyvQ4N6GvtYSk5KCTR78fLWy0Db3bWCE=;
        h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
        b=MgUUAi61ir9evGeDxlv3Rs+K5o5Ddjm1g96cT+P/odE1HNe3zw4URfVMDGZuAanLB
         I20N21RzpHXuz45+wkBIKA9Ym4TKayczFKdF3pUAVvkj9zoWpaR0UURh564FdoudSp
         C9rf/q5J7IRStXG27eZ+rAJJ0Kif868LMYGMiaoA=
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: linux-kernel@vger.kernel.org
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        stable@vger.kernel.org,
        Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>,
        syzbot <syzbot+ac488b9811036cea7ea0@syzkaller.appspotmail.com>,
        Paul Moore <paul@paul-moore.com>
Subject: [PATCH 4.9 11/92] selinux: Add __GFP_NOWARN to allocation at str_read()
Date: Thu, 29 Nov 2018 15:11:40 +0100
Message-Id: <20181129140107.401413560@linuxfoundation.org>
X-Mailer: git-send-email 2.19.2
In-Reply-To: <20181129140106.520639693@linuxfoundation.org>
References: <20181129140106.520639693@linuxfoundation.org>
User-Agent: quilt/0.65
X-stable: review
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

4.9-stable review patch.  If anyone has any objections, please let me know.

------------------

From: Tetsuo Handa <penguin-kernel@i-love.sakura.ne.jp>

commit 4458bba09788e70e8fb39ad003f087cd9dfbd6ac upstream.

syzbot is hitting warning at str_read() [1] because len parameter can
become larger than KMALLOC_MAX_SIZE. We don't need to emit warning for
this case.

[1] https://syzkaller.appspot.com/bug?id=7f2f5aad79ea8663c296a2eedb81978401a908f0

Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Reported-by: syzbot <syzbot+ac488b9811036cea7ea0@syzkaller.appspotmail.com>
Signed-off-by: Paul Moore <paul@paul-moore.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

---
 security/selinux/ss/policydb.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/security/selinux/ss/policydb.c
+++ b/security/selinux/ss/policydb.c
@@ -1097,7 +1097,7 @@ static int str_read(char **strp, gfp_t f
 	if ((len == 0) || (len == (u32)-1))
 		return -EINVAL;
 
-	str = kmalloc(len + 1, flags);
+	str = kmalloc(len + 1, flags | __GFP_NOWARN);
 	if (!str)
 		return -ENOMEM;
 


