Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 30 Nov 2018 08:45:17 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga003.jf.intel.com (orsmga003.jf.intel.com [10.7.209.27])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 6843F580213;
	Thu, 29 Nov 2018 06:47:06 -0800 (PST)
Received: from orsmga103.jf.intel.com ([10.7.208.35])
  by orsmga003-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 29 Nov 2018 06:47:06 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3At0ZkxxOUHqONh7YbxqQl6mtUPXoX/o7sNwtQ0KIM?=
 =?us-ascii?q?zox0KPn9ocbcNUDSrc9gkEXOFd2Cra4c26yO6+jJYi8p2d65qncMcZhBBVcuqP?=
 =?us-ascii?q?49uEgeOvODElDxN/XwbiY3T4xoXV5h+GynYwAOQJ6tL1LdrWev4jEMBx7xKRR6?=
 =?us-ascii?q?JvjvGo7Vks+7y/2+94fcbglUhzexe69+IAmrpgjNq8cahpdvJLwswRXTuHtIfO?=
 =?us-ascii?q?pWxWJsJV2Nmhv3+9m98p1+/SlOovwt78FPX7n0cKQ+VrxYES8pM3sp683xtBnM?=
 =?us-ascii?q?VhWA630BWWgLiBVIAgzF7BbnXpfttybxq+Rw1DWGMcDwULs5Qiqp4bt1RxD0iS?=
 =?us-ascii?q?cHLz85/3/Risxsl6JQvRatqwViz4LIfI2ZMfxzcaTAc9MHXmpBRtheWDBdAo2y?=
 =?us-ascii?q?aIsPCvAOPeder4Lgo1cDoh+zCQyqCejyyDFHm2X20LU63eo/DA/I0g8uEdUMv3?=
 =?us-ascii?q?Taotr6O7sdX++uzKnQzzjOdO9W1DTz5YTUaB0su/OBULRtesTR00kvEAbFg02R?=
 =?us-ascii?q?p4z/ITyV2fkGvW2B7+pnT+2vi3crpQNrrTi12scsj5PGhoQIwV3D+iV52pg6Jd?=
 =?us-ascii?q?K7SE57etOkFJpQtyeHN4p5TMMiRHxouCAnxbIcpZ67fS8KyJI9yx7YcfyHfJGF?=
 =?us-ascii?q?7xT+X+ifJjd4gWhqeLO5hxuq60eg0vX8VtKs0FZNsipJiMXDtncI1xHV98OJSe?=
 =?us-ascii?q?N981+/1TqT0w3f8PxILE4qmabBNpIswaI8moASvEnBBiP7m0v7gLWVe0gl4OSl?=
 =?us-ascii?q?6ODqbq/7qpOANYJ5jBz1PL40lcylG+s4NxADX2iF9uS4073u5VP5QLpUgf0siK?=
 =?us-ascii?q?XZs47VJd4dpqGnBw9ZyIEj6wywDzu+0dQYm2cILE5ddR6Zk4TkP0vCLO32APuh?=
 =?us-ascii?q?mVigjTRmy+zcMrDgAJjBNn3Dn63gfbZ55U5c0g0zzdVH6pJQC7EBJu/zW0DouN?=
 =?us-ascii?q?zbEBA5KQq0zPjjCNlk0YMfV2SPDbGDMK7Jr1+I6fwgI/OWaI8Wpjn9Mf4l6ODq?=
 =?us-ascii?q?jXMjnl8dZ6ap0YMNaH+kBvRmP1mZYX30j9cFEGcKvRQxQPbliV2fSjNTY3eyX6?=
 =?us-ascii?q?Qh5jA0Eo6mDIHDRpyzj7yFxiu0AppWZmVeAFCWDXjob5mEW+sLaC+KIs9uiD0E?=
 =?us-ascii?q?VaS7RI8mzx2utBL6xKBhLurb4SAYsZPj1N5o5+zcjx0y9Dp0D9iD3GGJVW17gm?=
 =?us-ascii?q?QIRzou1qBlvUN90kuD0bR/g/FAF9xT4O1GXh05NZ7byex6DdfyVxnFfteITlam?=
 =?us-ascii?q?X9qnDSswTtI3398BfUJ9F8++gRDE2iqgG6UVmKCTBJwo7qLc2GD8KNxmy3bG06?=
 =?us-ascii?q?khjEMqQtFVOm2knaN/8wnTB4jUk0SWjaqqdKIc3DLT+2eH12aBoEZYUAtoW6Xf?=
 =?us-ascii?q?QX8fflfWrcj+5k7aTL+hE7InPhFFyc6DMKRKbNLpgE5CRPfiPtTefm2wl32xBR?=
 =?us-ascii?q?aO2rODco7qd38B0yXaDUgOixoT8mqeNQgiGiehpHrTAyF0GlLxfUzg6+l+p2m9?=
 =?us-ascii?q?Tk8v0Q6KaUpt1762+h4QgfyRUPcT3rMCuCc8pDR4Ble939TKC9WeowptZrlTYd?=
 =?us-ascii?q?Q44F1fz2LWqxR9PoC8L6BlnlMRbh54v13w2BltCoVPi84qrGg0wwp0Mq+Y1FJB?=
 =?us-ascii?q?dzWF3ZH/ILHXK2/y/AyxZK7SwF3RzNGW+qIX4vQit1rjpB2pFlYl83h/z9lV0n?=
 =?us-ascii?q?6c5pLWDAoSUZP9SFo3+wJ9p7HAZik95oXU1XJ3PKmwsz/C3c8pBeQ/xhaheddf?=
 =?us-ascii?q?LL2LFAvoH8IGAMiuLfQgm0K1YRIcIOBS6Kk0Mtu8ePuCxqGqM/hvnTK8gWtc/Y?=
 =?us-ascii?q?Byz1iD9yx/Su7PwZYI2PWY3gqBVzfhg1atqMH3mYZYZT4MGmqz0zTrBIlUZqdq?=
 =?us-ascii?q?Z4YEFX+uI9GrxtV5n5PsW2NY+ES/CF8c2c6peQCdb1ry3QBL0UQXoHqnmTa3zj?=
 =?us-ascii?q?BukjEpqLaf0zLKw+j4aBUHPWtLTnF4jVjwOYi0k8waXE+wYggzlRuq+Vz1x7JG?=
 =?us-ascii?q?q6R4NWXTR1lHfzL3L217TqS/rL6CbNNR55MytiVXVv+xYVSbSr77vhsb3DnvH2?=
 =?us-ascii?q?pYxDAnaT6qvo/1kAB9iGKYNHxztmbWedlsxRfD49zRXf5Q3jscSCh4kzXXHUW8?=
 =?us-ascii?q?P9+y8NWQlpfDtP2+Vm27Wp1Sdynr0Z2PtC+h6WJ2Bh2/mui5msf7HggizS/7y9?=
 =?us-ascii?q?5qWD3KrBnmeInr1Ke6MeV9cklzHlD86Ml6GoB4koQugpEdwnwahpST/Xoanmb/?=
 =?us-ascii?q?K9Rb2aTibHUTQT4H2cLa4A/g2Ed7NHKG25r5VmmBwstmf9S7YnkZ2iUn48BICa?=
 =?us-ascii?q?eU6qdJnS90olq+sALQbuJxnjYbyfsy9nEah/sFtxYqziWYGroSB1VXPTTwlxSU?=
 =?us-ascii?q?6NCztKZXa3yucbSq1Ep+gMquDLeNogxHXHb5e5EiHTJ/78llMVLM1mHz5Z/geN?=
 =?us-ascii?q?XKcd0TsRiUmQ/aj+dJMJIxiuYKhS1/NGL4vH0lyPQ0gQZg3J6kp4iHN3ti/Lii?=
 =?us-ascii?q?DRFGLD31aNge+jXsjaZYg8aX0JqjHpRnGjUXQpToSeikHy4VtfTiLwyOCiEzqm?=
 =?us-ascii?q?+HGbrDGg+S8Ftmr3XKE5yxNnCYPn8Zzch5RBmGJUxSmwQUXDQ8np4kGQGm3s3h?=
 =?us-ascii?q?cEFl5j8P4l70sAdDyuVtNxPnSGfQuB+oaisoSJiYNBdZ9RtN50DRMcyD9O5zGz?=
 =?us-ascii?q?xY84alrAyMLGybegtJAXsIWkyCG1DsIL2u6cPc/OifA+q0N+HObqmWqexCS/eI?=
 =?us-ascii?q?woqi0ol88DaJKMqPJWNuD+Eh1kpAQHB5GNnZmzMVRCwMjC/Na8+bpBGh+ix4tM?=
 =?us-ascii?q?y/8fLrWB7x6ouLEbddLdJv+xWui6eZK+GQnDp5KSpf1p4UxX7Iz6Uf3EcPiy50?=
 =?us-ascii?q?cTmhC68AtSnLTKLfgaJXCx8bayVuNMpH9a483w9NOdLFhdPxzLJ3kvk1C1JdX1?=
 =?us-ascii?q?z7hs6pfdAKI326NF7fBEaEKrWGJT7Iw8H2e6+8SqdQjOJbtxKuozabDlTjMy+H?=
 =?us-ascii?q?lznoURCvLO5NgDuaPBxYpIGybBJtBXL/Q9Lhbx2xKMV3giEuwb0omnPKMnYRPi?=
 =?us-ascii?q?Jhc0xWtL2f8yNZju97G2xA9XdlKeiEmyCE7+jXMJoWsP1rAjhqmOJe+ng117xV?=
 =?us-ascii?q?7CRcTvxvhCTStsJuo02hkuSX1jpnUR9OpixXi46RoUpiObvW9p9bVHbA/RIN63?=
 =?us-ascii?q?iQChsQq9tkDN3vp75fytzVmK3vLzdC9sre/dEACMjMNMKHLH0hPALpGTHOCgsF?=
 =?us-ascii?q?SD+rNWfHiE1ckPGd7HuVrpchp5jomZoOTKJbVVMvGvMbDERlAMINIJNtUjw4lr?=
 =?us-ascii?q?6biZ1A2X3rqBjXWdUfvZ3dUP+WKevgJSzfjrReYRYMh7TiItc9LIr+jmN4Z1Yy?=
 =?us-ascii?q?v57NEkqVfdlXvihoaEdgr19A/3t+Zmky3V/1ZASw5nMaCf+zmFgxkAQoMrdlzy?=
 =?us-ascii?q?vl/1pifgmCnyA3ikRk3Ii8jA=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AQAABm+/9bh0O0hNFkHAEBAQQBAQcEA?=
 =?us-ascii?q?QGBUQcBAQsBgmmBAieDeYgYX4spgg0UlzCBcBcYDQYBh3QiNAkNAQMBAQEBAQE?=
 =?us-ascii?q?CARMBAQEIDQkIKSMMgjYkgmMDAwECIA8BDQEBNwEFCQEBHwUCBSECAgMMSBkFg?=
 =?us-ascii?q?xwBggEEAQqlFXCBCCeCdgEBBYcoAwWBC4Zggw+BHBeBf4dBBBiBEIEEgjeCV4k?=
 =?us-ascii?q?tlngJhn6KKSOBWoUQijIsjSyKdoFGgg0zGggoCIMnghuDbYUUhUA/Mgp4AwEBI?=
 =?us-ascii?q?ROKOYJNAQE?=
X-IPAS-Result: =?us-ascii?q?A0AQAABm+/9bh0O0hNFkHAEBAQQBAQcEAQGBUQcBAQsBgmm?=
 =?us-ascii?q?BAieDeYgYX4spgg0UlzCBcBcYDQYBh3QiNAkNAQMBAQEBAQECARMBAQEIDQkIK?=
 =?us-ascii?q?SMMgjYkgmMDAwECIA8BDQEBNwEFCQEBHwUCBSECAgMMSBkFgxwBggEEAQqlFXC?=
 =?us-ascii?q?BCCeCdgEBBYcoAwWBC4Zggw+BHBeBf4dBBBiBEIEEgjeCV4ktlngJhn6KKSOBW?=
 =?us-ascii?q?oUQijIsjSyKdoFGgg0zGggoCIMnghuDbYUUhUA/Mgp4AwEBIROKOYJNAQE?=
X-IronPort-AV: E=Sophos;i="5.56,295,1539673200"; 
   d="scan'208";a="54234130"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 29 Nov 2018 06:46:56 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1732811AbeK3Ba3 (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Thu, 29 Nov 2018 20:30:29 -0500
Received: from mail.kernel.org ([198.145.29.99]:57524 "EHLO mail.kernel.org"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1732149AbeK3Ba2 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 29 Nov 2018 20:30:28 -0500
Received: from localhost (5356596B.cm-6-7b.dynamic.ziggo.nl [83.86.89.107])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by mail.kernel.org (Postfix) with ESMTPSA id 367E42145D;
        Thu, 29 Nov 2018 14:24:56 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
        s=default; t=1543501496;
        bh=f9Yz0k8FiFQWVIMEatl4pb6toGklidIF/dY9lvcu9qw=;
        h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
        b=ANkyxc3i1tN28TTXZSxWzZG1f7RmlSTYzfEqSBj7lOUYmqy5vGKcvjnoBZCJcryG6
         Af9HV9bhZgAyXXwNYYoGkaTEz/6LsVSsnzFtn+qb8AT/bp37K0xvknQclkPqrj4sCo
         1JUx5yqNxQPU/6Iy4kPpo4wk1aA7N9msDLyhxzeY=
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: linux-kernel@vger.kernel.org
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        stable@vger.kernel.org,
        Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>,
        syzbot <syzbot+ac488b9811036cea7ea0@syzkaller.appspotmail.com>,
        Paul Moore <paul@paul-moore.com>
Subject: [PATCH 4.14 022/100] selinux: Add __GFP_NOWARN to allocation at str_read()
Date: Thu, 29 Nov 2018 15:11:52 +0100
Message-Id: <20181129140100.661463680@linuxfoundation.org>
X-Mailer: git-send-email 2.19.2
In-Reply-To: <20181129140058.768942700@linuxfoundation.org>
References: <20181129140058.768942700@linuxfoundation.org>
User-Agent: quilt/0.65
X-stable: review
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

4.14-stable review patch.  If anyone has any objections, please let me know.

------------------

From: Tetsuo Handa <penguin-kernel@i-love.sakura.ne.jp>

commit 4458bba09788e70e8fb39ad003f087cd9dfbd6ac upstream.

syzbot is hitting warning at str_read() [1] because len parameter can
become larger than KMALLOC_MAX_SIZE. We don't need to emit warning for
this case.

[1] https://syzkaller.appspot.com/bug?id=7f2f5aad79ea8663c296a2eedb81978401a908f0

Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Reported-by: syzbot <syzbot+ac488b9811036cea7ea0@syzkaller.appspotmail.com>
Signed-off-by: Paul Moore <paul@paul-moore.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

---
 security/selinux/ss/policydb.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/security/selinux/ss/policydb.c
+++ b/security/selinux/ss/policydb.c
@@ -1099,7 +1099,7 @@ static int str_read(char **strp, gfp_t f
 	if ((len == 0) || (len == (u32)-1))
 		return -EINVAL;
 
-	str = kmalloc(len + 1, flags);
+	str = kmalloc(len + 1, flags | __GFP_NOWARN);
 	if (!str)
 		return -ENOMEM;
 


