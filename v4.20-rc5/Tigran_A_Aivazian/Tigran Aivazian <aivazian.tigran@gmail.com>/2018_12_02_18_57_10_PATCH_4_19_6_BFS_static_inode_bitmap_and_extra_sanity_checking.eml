Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 03 Dec 2018 08:41:15 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga002.jf.intel.com (orsmga002.jf.intel.com [10.7.209.21])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 18574580224;
	Sun,  2 Dec 2018 10:57:40 -0800 (PST)
Received: from orsmga103.jf.intel.com ([10.7.208.35])
  by orsmga002-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 02 Dec 2018 10:57:39 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AqrWgqR1ze/9z9ZyHsmDT+DRfVm0co7zxezQtwd8Z?=
 =?us-ascii?q?segSKPTxwZ3uMQTl6Ol3ixeRBMOHs6IC07KempujcFRI2YyGvnEGfc4EfD4+ou?=
 =?us-ascii?q?JSoTYdBtWYA1bwNv/gYn9yNs1DUFh44yPzahANS47xaFLIv3K98yMZFAnhOgpp?=
 =?us-ascii?q?POT1HZPZg9iq2+yo9JDffwZFiCChbb9uMR67sRjfus4KjIV4N60/0AHJonxGe+?=
 =?us-ascii?q?RXwWNnO1eelAvi68mz4ZBu7T1et+ou+MBcX6r6eb84TaFDAzQ9L281/szrugLd?=
 =?us-ascii?q?QgaJ+3ART38ZkhtMAwjC8RH6QpL8uTb0u+ZhxCWXO9D9QLYpUjqg8qhrUgflhy?=
 =?us-ascii?q?gJNzE78G/ZhM9+gr9Frh29vBx/24zZbZqQNPZiZK7QZ88WSXZDU8tXSidPApm8?=
 =?us-ascii?q?b4wKD+cZI+hYrob9p0EUohu4GAKhGOLvyiFSiX733K01yeIhGhzB0QM6HtIOrm?=
 =?us-ascii?q?7brdT0NKgIV+C51rXIzTTMb/NMwzj97pPFch8kof6WXLJwddDdxlUoFwPAl1id?=
 =?us-ascii?q?r5HuMTCN1ukVrWSX8+5tWfiyh2MptQ19uCWjy8QwhoXTh48YyEjI+TtlzIsxP9?=
 =?us-ascii?q?G1S052bcS6HJdOqi2WLYp7T8IkTmp1oig10KcGtoS+fCUSyJQo2Rrfa/uffoiW?=
 =?us-ascii?q?7RLsSvyRLS17hH17YrK/gQi98Uy6xu37TMm0305GritDktbSqnAAzwLf5tSDR/?=
 =?us-ascii?q?dn40us1yiD2xrO5uxHPUw4j6vWJpw5zr41jJUTsEDDHiHsmEXxia+bbkEk+umu?=
 =?us-ascii?q?6+T6bbTqv5ycOJFuigH4LKsuntWzAeM2MwgIQWeb4/+x1KPs/ULnWrVGlP42nb?=
 =?us-ascii?q?fDsJDcO8sborS1AwhP0oYs8xq/FSup0MwEnXkbK1JIYBaHj4nqO17QOvz5Auq/?=
 =?us-ascii?q?jk+okDdqwfDGI7LgDo/MLnjFjLfuY7J951RAxwo0yNBV/4hUBa0ZIPLvRk/xs8?=
 =?us-ascii?q?TVDh8jPAy13+boEtJ92pkeWWKSGKCZNqzSvESM5uIuJemMeYAUtCz8K/gj+/7h?=
 =?us-ascii?q?k3s5lUUBcqmu2JsdcGq4Eeh+I0WFfXrshc8MEWUNvgUgVuDqi1qCUThVZ3a1RK?=
 =?us-ascii?q?884jA7CIS7DYbMXIytgbqB3DulEZ1SfGxJFleMEXLwfYWeR/gMcD6SItNmkjEc?=
 =?us-ascii?q?T7ehUI8h1RattAPg0bpoNOjU9zYctZLi0th1+uLSmQsz9TxyE8SSzWWNQ3tokW?=
 =?us-ascii?q?MPQj88xLp/rlBlylefzah4hORVFd9J6PNPSAs6MZ/cwPZ8C9D9QQ/BetaJSFC7?=
 =?us-ascii?q?QtSpGz0xT9Qxw8MQbEZ5AdmtkhfD3y+yCb8Pi7OLHIA08r7b33XpOsly0WjG27?=
 =?us-ascii?q?c7g1kmWMRPM3amibB59wTUA47JkECZl6KxeKQY3S7N8nqDzGWUsEFZVg5wTbvK?=
 =?us-ascii?q?XXQFakTKqtT541vIT6WyBrQ/LgtB1cmCJ7NXZdLzk1VJWu3vONTEbGK3gGe/Gx?=
 =?us-ascii?q?CIy6iIbIrrfWUdwSrcBFIFkwAV4XaJKww+Cj29rGLZCTxkDUjvbF/08elitHO7?=
 =?us-ascii?q?SVc5zx2Lb01k0Lq15h4VhPyGR/MPxL4Evz0hqzF1HFa70NLbEN6ApwtnfKVBbt?=
 =?us-ascii?q?Ix+lZH1WTFtwNjOpysNbxthlkbcw5vpUPhyw13CplckcgttH4l1g5yJryX0Vxf?=
 =?us-ascii?q?dzKUx4v/OqDKJWbo+hCvaKnW2k/F3daS+6cP7uk4qlr5sAGoEEoi72to091P33?=
 =?us-ascii?q?SA4ZXKCRIYUYjtXUYv6xh6u7babzE95oPJz3FjLbO4sz7C290zAuslxQ2tf9Ne?=
 =?us-ascii?q?MKOCCQ/zHNcWB8moKOw2hVepaggIM/xV9K4xJ8mmbeeJ2La3POZ8mzKrlX5H4I?=
 =?us-ascii?q?Fh3U2W7SpzV+nI04wDw/6GxAuHVi7wg0u7vcDzhI9LeysSHm25ySX/AI5RZ6ty?=
 =?us-ascii?q?fZsECGu0Is23wMl+iIDpW3JC6FGjAFYG0tezeRWOd1z9wRFQ1UMPrH2nmCu01T?=
 =?us-ascii?q?x1nysyrqqC2izD2ODidBsBOm5WS2hul1bsIY6oj98EWEikdRQmlByg5Uzi3ahU?=
 =?us-ascii?q?uLx/L3XPQUdPZyX2LXttUrGztrqBZM5D8ogovj9UUOS/YFCaTKDyox0B3iPnHm?=
 =?us-ascii?q?tewi07dj6wtpX4mRx6lHySLHJpoHXFfsFwwA/V5MbASv5JwjoGWC54hCHXB1em?=
 =?us-ascii?q?ONml59eUl5bFsu2lU2KhV5tTcTTkzI+atSu743FqDgO7n/yphtLnFg062zfh19?=
 =?us-ascii?q?Z2TSXIsAr8Yo7z2qS5K+1nf1NkBF/h68VgHIF+nZA9hJUR2Xgcm5WU8mALkWb1?=
 =?us-ascii?q?MdVHx63+aGABSiIMw97Q+ALlwlFsLmqVx4LlUXWQ2s5hZ9i5YmwMwC484d5FCL?=
 =?us-ascii?q?yI7LNahyt6uUS3rRjeYfVmmjcdyP0u6GMVgu0TuQotyDmdDa4WHUVCISPskBGI?=
 =?us-ascii?q?5cikrKpLfGavbaSw1E1mkNC9C7GCpxtQWXfjdZckAC9w9d5/MFPX3X3364Hkfs?=
 =?us-ascii?q?TQbN0Juh2VlRfAk/ZaKJYrmvUWgipnPHr3vWc5xO4jkRxuwZa6sZCcJGp3+6K5?=
 =?us-ascii?q?BgNYOifxZ8MO4TztiadensCL34GgBJlhGzMLXIf2QvKsCj4dqfPnNwOWGj0mtn?=
 =?us-ascii?q?ibAabfHROY6Ep+rXLACZWrOG+MJHUD0dVuXhqdJFFcgAAJWjU1hIU5GxuuxMzg?=
 =?us-ascii?q?dkd5+z8Q6kT5qhtK1uJnKR3/Xn3Dqwevbzc+UIKfIwZO7gFe+0fVNtST7+J0Hy?=
 =?us-ascii?q?FF552hsRaCKmqBawRTCmEJXEOECkvnPrmv49nA7ueZCvC/L/vIfbWBt+heW+2U?=
 =?us-ascii?q?ypKo14ts5yyMOdmXPnl+E/073VJOXXBnFMTYmDUPSC0XmzjOb86Boxe89TN4rt?=
 =?us-ascii?q?qi8PTwQw/v4YqPC71PMdRg4Ry2gKGDN/KOiyZ9MzpXypQMxXrQwrgFwFESkz1u?=
 =?us-ascii?q?dyWqEbkYryHNUbnfmrVJAB8bcS9zMMpI4rk43glMP87bl9z02qR5jv4zF1dKS1?=
 =?us-ascii?q?jhltu1aswNJmG3LEnHC1qTNLSaOT3LxNn6Yb+9Sb1Vlulbqwe8tiqbE0D9ODSO?=
 =?us-ascii?q?jD3pVxGpMeFRgyCXJh1euIehchlzDWjvVs7pahq+MNVvlz053aU0hm/WNW4bKT?=
 =?us-ascii?q?V9c1lCrruV7SNZhPVwA21A7np/IumClCaU9O3YKpcQsft2DSV4jeNa4HImy7RL?=
 =?us-ascii?q?6CFIXuB6mCzXro0mn1bznfOCxTlneB5PrCtbioWWu0lrJaTe8N9HQ3mX0ggK6D?=
 =?us-ascii?q?CsChsQrt0tI9zxsrJRw96HwKvyNj5Q8tvSu9cdCNLdLuqINXMgNVziHzuCX1hN?=
 =?us-ascii?q?diKiKWyK3x8Vq/qV7HDA9pU=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AZAABJKgRch0O0hNFiHQEBBQEHBQGBU?=
 =?us-ascii?q?QgBCwGDayeDeYEdhnuMCIINFJc0FIFiKRMBhECDNiI0CQ0BAwEBAQEBAQIBEwE?=
 =?us-ascii?q?BAQoLCQgpIwyCNiKCZAEDAwECIAQZARsdAQMCCQEBBRAKAisCAgIBHgEBEQEFA?=
 =?us-ascii?q?RQIGQWDHAGBaAEDFQWWPzyLDXwWBQEXgncFhC4KGScNXYEwBwIGEowKghaBEAG?=
 =?us-ascii?q?FaYFvFUyCXoJXAokwCZZBGC4HAoQkgXQnh0+DLhhefYURgyWHFYoHhG2GSYMhM?=
 =?us-ascii?q?IElgg1NI4EBgjuCGwkag0qKUz8zgQUBAYliASQHgiABAQ?=
X-IPAS-Result: =?us-ascii?q?A0AZAABJKgRch0O0hNFiHQEBBQEHBQGBUQgBCwGDayeDeYE?=
 =?us-ascii?q?dhnuMCIINFJc0FIFiKRMBhECDNiI0CQ0BAwEBAQEBAQIBEwEBAQoLCQgpIwyCN?=
 =?us-ascii?q?iKCZAEDAwECIAQZARsdAQMCCQEBBRAKAisCAgIBHgEBEQEFARQIGQWDHAGBaAE?=
 =?us-ascii?q?DFQWWPzyLDXwWBQEXgncFhC4KGScNXYEwBwIGEowKghaBEAGFaYFvFUyCXoJXA?=
 =?us-ascii?q?okwCZZBGC4HAoQkgXQnh0+DLhhefYURgyWHFYoHhG2GSYMhMIElgg1NI4EBgju?=
 =?us-ascii?q?CGwkag0qKUz8zgQUBAYliASQHgiABAQ?=
X-IronPort-AV: E=Sophos;i="5.56,307,1539673200"; 
   d="scan'208";a="54589967"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 02 Dec 2018 10:57:38 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1725774AbeLBS53 (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sun, 2 Dec 2018 13:57:29 -0500
Received: from mail-wr1-f66.google.com ([209.85.221.66]:35728 "EHLO
        mail-wr1-f66.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725535AbeLBS52 (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 2 Dec 2018 13:57:28 -0500
Received: by mail-wr1-f66.google.com with SMTP id 96so9951963wrb.2;
        Sun, 02 Dec 2018 10:57:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc;
        bh=n7Z32mDUvvneJZhHVELRsEYfSgYFOIzCnXfYRa2vZpM=;
        b=u0qxBGjgp1sSAaVMHpy+bF/3VyWGC5pxSrs+ZYpjwGIM5WVnyvPt9nH5sDIC8ITbpA
         hzxOCf5mY/qy++GA3belNXNNxDt9AT0PrwsNhJoS/P82oXOIOE+fnfFVK7gbVvdq3wCs
         AqFR2wYs4t9eQBd8yMhzXaVc09wqeA7/q9MI+MzNILAQtK34gR3eaiEvRcZ+njLbVqC4
         ty0CW512r1JQo4lOwU7Jky9IRVQvqzxTH71q5dpTszYyNGlC3Vt8dCXIwGJZFn1LteJP
         TDuQNJjmUXNcIukS+0qXTBPolkEAHJAjkyG5w35CLI3BxV0lCYByJQXcAsmSLyGr1txe
         giyw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=n7Z32mDUvvneJZhHVELRsEYfSgYFOIzCnXfYRa2vZpM=;
        b=RVMsyILPG6KF6RLmUJDl3GOOD4/HV3/h1OMTI97CX/KR2HPbjilBBvhC9taVBKoild
         9ErW4UX9qDYthl19Fzm2he8n87dEC3Z76Lf7p+3ZGKyz6WhIK0h50VkeLZnotw5YnLCJ
         KqRovyjTqnPR/PSH0wCn3k13/Jnlizk3B39aqhGOOmV+7QzI4c5wGIMFji88sBK//QZH
         XhrP0pM9sTKDbtwG8KIskrS2OnXX5u+9pLbw/0pOKNSxd52EQkiMPvTiGF6hkHGkCfgu
         Zv1OuoKhGycixNC9FEFPoP/14SfKJ4cyLBT3K1m6JUzoyFfA3SfzXJQo6xnKsjYv0fJB
         gVOQ==
X-Gm-Message-State: AA+aEWZCWBuYVNfd+GAPEazNOd76p4T0QQ78GxTFtBuDy2/eNp2qsdc9
        3QW+Oxg5aDvs5IEeBhg6IoB2OeantGgNGYNsaeQ=
X-Google-Smtp-Source: AFSGD/X1CYgfL6yqkpy/Mq5Nj0ogT6H7+bEgzNJHKl4OlzExdnpRSjtwimrJHLVhBqCLo7pCyvYpCnq2ba94vK0jeZA=
X-Received: by 2002:adf:b102:: with SMTP id l2mr11063479wra.296.1543777042130;
 Sun, 02 Dec 2018 10:57:22 -0800 (PST)
MIME-Version: 1.0
References: <20181129135921.231283053@linuxfoundation.org> <20181129135922.602882966@linuxfoundation.org>
 <CAK+_RLmVyVzL3G6++xOxfyEqEHL=bfZZx_Yj-TFNf5a7_oUoXw@mail.gmail.com>
 <20181129160722.GA31919@kroah.com> <CAK+_RLnbpu+nYsr8sVpHBVUcATDbqQoeH=+tu=tK1EKTHk6L9A@mail.gmail.com>
 <20181129171038.GA4651@kroah.com> <CAK+_RLk4cxamNasZyvLRunR23CTR-fASvF3=Ryt9WGeFoBVtqQ@mail.gmail.com>
In-Reply-To: <CAK+_RLk4cxamNasZyvLRunR23CTR-fASvF3=Ryt9WGeFoBVtqQ@mail.gmail.com>
From: Tigran Aivazian <aivazian.tigran@gmail.com>
Date: Sun, 2 Dec 2018 18:57:10 +0000
Message-ID: <CAK+_RLmt0ba_ARo+SrOGJph-SPn3kBRybRqncki=Oqz1TcF21Q@mail.gmail.com>
Subject: [PATCH 4.19.6] BFS: static inode bitmap and extra sanity checking
To: gregkh@linuxfoundation.org
Cc: LKML <linux-kernel@vger.kernel.org>, stable@vger.kernel.org,
        Tetsuo Handa <penguin-kernel@i-love.sakura.ne.jp>,
        syzbot <syzbot+71c6b5d68e91149fc8a4@syzkaller.appspotmail.com>,
        Andrew Morton <akpm@linux-foundation.org>, willy@infradead.org,
        torvalds@linux-foundation.org
Content-Type: multipart/mixed; boundary="000000000000359b96057c0e9a94"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

--000000000000359b96057c0e9a94
Content-Type: text/plain; charset="UTF-8"

Hello,

Please find a patch attached which contains the following changes:

1. Simplifies inode bitmap allocation by making it static.
2. Supersedes the changes to BFS that went into 4.19.6 with stronger checking.
3. Other changes are trivial (like whitespace cleanup, warning messages etc).

Fully tested under 4.19.6 kernel.

Kind regards,
Tigran

--000000000000359b96057c0e9a94
Content-Type: text/x-patch; charset="US-ASCII"; name="bfs-4.19.6.patch"
Content-Disposition: attachment; filename="bfs-4.19.6.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_jp78yz7g0>
X-Attachment-Id: f_jp78yz7g0

RnJvbTogVGlncmFuIEFpdmF6aWFuIDxhaXZhemlhbi50aWdyYW5AZ21haWwuY29tPgpTdWJqZWN0
OiBbUEFUQ0ggNC4xOS42XSBCRlM6IHN0YXRpYyBpbm9kZSBiaXRtYXAgYW5kIGV4dHJhIHNhbml0
eSBjaGVja2luZwoKU3RyZW5ndGhlbiB2YWxpZGF0aW9uIG9mIEJGUyBzdXBlcmJsb2NrIGFnYWlu
c3QgY29ycnVwdGlvbi4KTWFrZSBpbi1jb3JlIGlub2RlIGJpdG1hcCBzdGF0aWMgcGFydCBvZiBz
dXBlcmJsb2NrIGluZm8gc3RydWN0dXJlLgpQcmludCBhIHdhcm5pbmcgd2hlbiBtb3VudGluZyBh
IEJGUyBmaWxlc3lzdGVtIGNyZWF0ZWQgd2l0aCAiLU4gNTEyIgpvcHRpb24gYXMgb25seSA1MTAg
ZmlsZXMgY2FuIGJlIGNyZWF0ZWQgaW4gdGhlIHJvb3QgZGlyZWN0b3J5LgpNYWtlIHRoZSBrZXJu
ZWwgbWVzc2FnZXMgbW9yZSB1bmlmb3JtLiBVcGRhdGUgdGhlICdwcmVmaXgnIHBhc3NlZCB0bwpi
ZnNfZHVtcF9pbWFwKCkgdG8gbWF0Y2ggdGhlIGN1cnJlbnQgbmFtaW5nIG9mIG9wZXJhdGlvbnMu
CldoaXRlIHNwYWNlIGFuZCBjb21tZW50cyBjbGVhbnVwLgoKU2lnbmVkLW9mZi1ieTogVGlncmFu
IEFpdmF6aWFuIDxhaXZhemlhbi50aWdyYW5AZ21haWwuY29tPgpDYzogVGV0c3VvIEhhbmRhIDxw
ZW5ndWluLWtlcm5lbEBpLWxvdmUuc2FrdXJhLm5lLmpwPgpDYzogQW5kcmV3IE1vcnRvbiA8YWtw
bUBsaW51eC1mb3VuZGF0aW9uLm9yZz4KQ2M6IE1hdHRoZXcgV2lsY294IDx3aWxseUBpbmZyYWRl
YWQub3JnPgpDYzogTGludXMgVG9ydmFsZHMgPHRvcnZhbGRzQGxpbnV4LWZvdW5kYXRpb24ub3Jn
PgpDYzogR3JlZyBLcm9haC1IYXJ0bWFuIDxncmVna2hAbGludXhmb3VuZGF0aW9uLm9yZz4KLS0t
CgogZnMvYmZzL2Jmcy5oICAgICAgICAgICAgICAgIHwgICAxMSArKysrKystCiBmcy9iZnMvZGly
LmMgICAgICAgICAgICAgICAgfCAgICA0ICstCiBmcy9iZnMvZmlsZS5jICAgICAgICAgICAgICAg
fCAgICAyIC0KIGZzL2Jmcy9pbm9kZS5jICAgICAgICAgICAgICB8ICAgNjUgKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGluY2x1ZGUvdWFwaS9saW51eC9iZnNf
ZnMuaCB8ICAgIDIgLQogNSBmaWxlcyBjaGFuZ2VkLCA0MSBpbnNlcnRpb25zKCspLCA0MyBkZWxl
dGlvbnMoLSkKCi0tLSBpbmNsdWRlL3VhcGkvbGludXgvYmZzX2ZzLmguMAkyMDE4LTExLTEzIDE5
OjE5OjU1Ljk0MTI2NzM0MiArMDAwMAorKysgaW5jbHVkZS91YXBpL2xpbnV4L2Jmc19mcy5oCTIw
MTgtMTEtMTMgMTk6MjA6MjQuMTAxMTgyMzU3ICswMDAwCkBAIC0xLDcgKzEsNyBAQAogLyogU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgV0lUSCBMaW51eC1zeXNjYWxsLW5vdGUgKi8K
IC8qCiAgKglpbmNsdWRlL2xpbnV4L2Jmc19mcy5oIC0gQkZTIGRhdGEgc3RydWN0dXJlcyBvbiBk
aXNrLgotICoJQ29weXJpZ2h0IChDKSAxOTk5IFRpZ3JhbiBBaXZhemlhbiA8dGlncmFuQHZlcml0
YXMuY29tPgorICoJQ29weXJpZ2h0IChDKSAxOTk5LTIwMTggVGlncmFuIEFpdmF6aWFuIDxhaXZh
emlhbi50aWdyYW5AZ21haWwuY29tPgogICovCiAKICNpZm5kZWYgX0xJTlVYX0JGU19GU19ICi0t
LSBmcy9iZnMvYmZzLmguMAkyMDE4LTExLTEzIDE5OjIwOjQwLjE1MTE2MTA0NCArMDAwMAorKysg
ZnMvYmZzL2Jmcy5oCTIwMTgtMTEtMTMgMTk6MjE6MzIuOTI5NzQwNjU2ICswMDAwCkBAIC0xLDEz
ICsxLDIwIEBACiAvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCAqLwogLyoKICAq
CWZzL2Jmcy9iZnMuaAotICoJQ29weXJpZ2h0IChDKSAxOTk5IFRpZ3JhbiBBaXZhemlhbiA8dGln
cmFuQHZlcml0YXMuY29tPgorICoJQ29weXJpZ2h0IChDKSAxOTk5LTIwMTggVGlncmFuIEFpdmF6
aWFuIDxhaXZhemlhbi50aWdyYW5AZ21haWwuY29tPgogICovCiAjaWZuZGVmIF9GU19CRlNfQkZT
X0gKICNkZWZpbmUgX0ZTX0JGU19CRlNfSAogCiAjaW5jbHVkZSA8bGludXgvYmZzX2ZzLmg+CiAK
Ky8qIEluIHRoZW9yeSBCRlMgc3VwcG9ydHMgdXAgdG8gNTEyIGlub2RlcywgbnVtYmVyZWQgZnJv
bSAyIChmb3IgLykgdXAgdG8gNTEzIGluY2x1c2l2ZS4KKyAgIEluIGFjdHVhbCBmYWN0LCBhdHRl
bXB0aW5nIHRvIGNyZWF0ZSB0aGUgNTEydGggaW5vZGUgKGkuZS4gaW5vZGUgTm8uIDUxMyBvciBm
aWxlIE5vLiA1MTEpCisgICB3aWxsIGZhaWwgd2l0aCBFTk9TUEMgaW4gYmZzX2FkZF9lbnRyeSgp
OiB0aGUgcm9vdCBkaXJlY3RvcnkgY2Fubm90IGNvbnRhaW4gc28gbWFueSBlbnRyaWVzLCBjb3Vu
dGluZyAnLi4nLgorICAgU28sIG1rZnMuYmZzKDgpIHNob3VsZCByZWFsbHkgbGltaXQgaXRzIC1O
IG9wdGlvbiB0byA1MTEgYW5kIG5vdCA1MTIuIEZvciBub3csIHdlIGp1c3QgcHJpbnQgYSB3YXJu
aW5nCisgICBpZiBhIGZpbGVzeXN0ZW0gaXMgbW91bnRlZCB3aXRoIHN1Y2ggImltcG9zc2libGUg
dG8gZmlsbCB1cCIgbnVtYmVyIG9mIGlub2RlcyAqLworI2RlZmluZSBCRlNfTUFYX0xBU1RJCTUx
MworCiAvKgogICogQkZTIGZpbGUgc3lzdGVtIGluLWNvcmUgc3VwZXJibG9jayBpbmZvCiAgKi8K
QEAgLTE3LDcgKzI0LDcgQEAKIAl1bnNpZ25lZCBsb25nIHNpX2ZyZWVpOwogCXVuc2lnbmVkIGxv
bmcgc2lfbGZfZWJsazsKIAl1bnNpZ25lZCBsb25nIHNpX2xhc3RpOwotCXVuc2lnbmVkIGxvbmcg
KnNpX2ltYXA7CisJREVDTEFSRV9CSVRNQVAoc2lfaW1hcCwgQkZTX01BWF9MQVNUSSsxKTsKIAlz
dHJ1Y3QgbXV0ZXggYmZzX2xvY2s7CiB9OwogCi0tLSBmcy9iZnMvZGlyLmMuMAkyMDE4LTExLTEz
IDE5OjI5OjMyLjM2MTI1OTI3MiArMDAwMAorKysgZnMvYmZzL2Rpci5jCTIwMTgtMTEtMTMgMTk6
MzA6MDEuMzgwNjgzODU4ICswMDAwCkBAIC0yLDggKzIsOCBAQAogLyoKICAqCWZzL2Jmcy9kaXIu
YwogICoJQkZTIGRpcmVjdG9yeSBvcGVyYXRpb25zLgotICoJQ29weXJpZ2h0IChDKSAxOTk5LDIw
MDAgIFRpZ3JhbiBBaXZhemlhbiA8dGlncmFuQHZlcml0YXMuY29tPgotICogICAgICBNYWRlIGVu
ZGlhbm5lc3MtY2xlYW4gYnkgQW5kcmV3IFN0cmliYmxlaGlsbCA8YWRzQHdvbXBvbS5vcmc+IDIw
MDUKKyAqCUNvcHlyaWdodCAoQykgMTk5OS0yMDE4IFRpZ3JhbiBBaXZhemlhbiA8YWl2YXppYW4u
dGlncmFuQGdtYWlsLmNvbT4KKyAqICBNYWRlIGVuZGlhbm5lc3MtY2xlYW4gYnkgQW5kcmV3IFN0
cmliYmxlaGlsbCA8YWRzQHdvbXBvbS5vcmc+IDIwMDUKICAqLwogCiAjaW5jbHVkZSA8bGludXgv
dGltZS5oPgotLS0gZnMvYmZzL2ZpbGUuYy4wCTIwMTgtMTEtMTMgMTk6MzA6MTEuNzYwNDg5OTU3
ICswMDAwCisrKyBmcy9iZnMvZmlsZS5jCTIwMTgtMTEtMTMgMTk6MzA6MjcuMDIwMjE0ODQ1ICsw
MDAwCkBAIC0yLDcgKzIsNyBAQAogLyoKICAqCWZzL2Jmcy9maWxlLmMKICAqCUJGUyBmaWxlIG9w
ZXJhdGlvbnMuCi0gKglDb3B5cmlnaHQgKEMpIDE5OTksMjAwMCBUaWdyYW4gQWl2YXppYW4gPHRp
Z3JhbkB2ZXJpdGFzLmNvbT4KKyAqCUNvcHlyaWdodCAoQykgMTk5OS0yMDE4IFRpZ3JhbiBBaXZh
emlhbiA8YWl2YXppYW4udGlncmFuQGdtYWlsLmNvbT4KICAqCiAgKglNYWtlIHRoZSBmaWxlIGJs
b2NrIGFsbG9jYXRpb24gYWxnb3JpdGhtIHVuZGVyc3RhbmQgdGhlIHNpemUKICAqCW9mIHRoZSB1
bmRlcmx5aW5nIGJsb2NrIGRldmljZS4KLS0tIGZzL2Jmcy9pbm9kZS5jLjAJMjAxOC0xMi0wMiAx
ODoyNTowMC40NTIwMDA2ODYgKzAwMDAKKysrIGZzL2Jmcy9pbm9kZS5jCTIwMTgtMTItMDIgMTg6
MzI6MjEuNzUxNzg2NzAxICswMDAwCkBAIC0xLDEwICsxLDkgQEAKIC8qCiAgKglmcy9iZnMvaW5v
ZGUuYwogICoJQkZTIHN1cGVyYmxvY2sgYW5kIGlub2RlIG9wZXJhdGlvbnMuCi0gKglDb3B5cmln
aHQgKEMpIDE5OTktMjAwNiBUaWdyYW4gQWl2YXppYW4gPGFpdmF6aWFuLnRpZ3JhbkBnbWFpbC5j
b20+CisgKglDb3B5cmlnaHQgKEMpIDE5OTktMjAxOCBUaWdyYW4gQWl2YXppYW4gPGFpdmF6aWFu
LnRpZ3JhbkBnbWFpbC5jb20+CiAgKglGcm9tIGZzL21pbml4LCBDb3B5cmlnaHQgKEMpIDE5OTEs
IDE5OTIgTGludXMgVG9ydmFsZHMuCi0gKgotICogICAgICBNYWRlIGVuZGlhbm5lc3MtY2xlYW4g
YnkgQW5kcmV3IFN0cmliYmxlaGlsbCA8YWRzQHdvbXBvbS5vcmc+LCAyMDA1LgorICoJTWFkZSBl
bmRpYW5uZXNzLWNsZWFuIGJ5IEFuZHJldyBTdHJpYmJsZWhpbGwgPGFkc0B3b21wb20ub3JnPiwg
MjAwNS4KICAqLwogCiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CkBAIC0xMTgsMTIgKzExNywx
MiBAQAogewogCXN0cnVjdCBiZnNfc2JfaW5mbyAqaW5mbyA9IEJGU19TQihpbm9kZS0+aV9zYik7
CiAJdW5zaWduZWQgaW50IGlubyA9ICh1MTYpaW5vZGUtPmlfaW5vOwotICAgICAgICB1bnNpZ25l
ZCBsb25nIGlfc2Jsb2NrOworCXVuc2lnbmVkIGxvbmcgaV9zYmxvY2s7CiAJc3RydWN0IGJmc19p
bm9kZSAqZGk7CiAJc3RydWN0IGJ1ZmZlcl9oZWFkICpiaDsKIAlpbnQgZXJyID0gMDsKIAotICAg
ICAgICBkcHJpbnRmKCJpbm89JTA4eFxuIiwgaW5vKTsKKwlkcHJpbnRmKCJpbm89JTA4eFxuIiwg
aW5vKTsKIAogCWRpID0gZmluZF9pbm9kZShpbm9kZS0+aV9zYiwgaW5vLCAmYmgpOwogCWlmIChJ
U19FUlIoZGkpKQpAQCAtMTQ0LDcgKzE0Myw3IEBACiAJZGktPmlfYXRpbWUgPSBjcHVfdG9fbGUz
Mihpbm9kZS0+aV9hdGltZS50dl9zZWMpOwogCWRpLT5pX210aW1lID0gY3B1X3RvX2xlMzIoaW5v
ZGUtPmlfbXRpbWUudHZfc2VjKTsKIAlkaS0+aV9jdGltZSA9IGNwdV90b19sZTMyKGlub2RlLT5p
X2N0aW1lLnR2X3NlYyk7Ci0gICAgICAgIGlfc2Jsb2NrID0gQkZTX0koaW5vZGUpLT5pX3NibG9j
azsKKwlpX3NibG9jayA9IEJGU19JKGlub2RlKS0+aV9zYmxvY2s7CiAJZGktPmlfc2Jsb2NrID0g
Y3B1X3RvX2xlMzIoaV9zYmxvY2spOwogCWRpLT5pX2VibG9jayA9IGNwdV90b19sZTMyKEJGU19J
KGlub2RlKS0+aV9lYmxvY2spOwogCWRpLT5pX2VvZmZzZXQgPSBjcHVfdG9fbGUzMihpX3NibG9j
ayAqIEJGU19CU0laRSArIGlub2RlLT5pX3NpemUgLSAxKTsKQEAgLTE4OCwxMyArMTg3LDEzIEBA
CiAJbWFya19idWZmZXJfZGlydHkoYmgpOwogCWJyZWxzZShiaCk7CiAKLSAgICAgICAgaWYgKGJp
LT5pX2Rza19pbm8pIHsKKwlpZiAoYmktPmlfZHNrX2lubykgewogCQlpZiAoYmktPmlfc2Jsb2Nr
KQogCQkJaW5mby0+c2lfZnJlZWIgKz0gYmktPmlfZWJsb2NrICsgMSAtIGJpLT5pX3NibG9jazsK
IAkJaW5mby0+c2lfZnJlZWkrKzsKIAkJY2xlYXJfYml0KGlubywgaW5mby0+c2lfaW1hcCk7Ci0J
CWJmc19kdW1wX2ltYXAoImRlbGV0ZV9pbm9kZSIsIHMpOwotICAgICAgICB9CisJCWJmc19kdW1w
X2ltYXAoImV2aWN0X2lub2RlIiwgcyk7CisJfQogCiAJLyoKIAkgKiBJZiB0aGlzIHdhcyB0aGUg
bGFzdCBmaWxlLCBtYWtlIHRoZSBwcmV2aW91cyBibG9jawpAQCAtMjE0LDcgKzIxMyw2IEBACiAJ
CXJldHVybjsKIAogCW11dGV4X2Rlc3Ryb3koJmluZm8tPmJmc19sb2NrKTsKLQlrZnJlZShpbmZv
LT5zaV9pbWFwKTsKIAlrZnJlZShpbmZvKTsKIAlzLT5zX2ZzX2luZm8gPSBOVUxMOwogfQpAQCAt
MzExLDggKzMwOSw3IEBACiAJCWVsc2UKIAkJCXN0cmNhdCh0bXBidWYsICIwIik7CiAJfQotCXBy
aW50ZigiQkZTLWZzOiAlczogbGFzdGk9JTA4bHggPCVzPlxuIiwKLQkJCQlwcmVmaXgsIEJGU19T
QihzKS0+c2lfbGFzdGksIHRtcGJ1Zik7CisJcHJpbnRmKCIlczogbGFzdGk9JTA4bHggPCVzPlxu
IiwgcHJlZml4LCBCRlNfU0IocyktPnNpX2xhc3RpLCB0bXBidWYpOwogCWZyZWVfcGFnZSgodW5z
aWduZWQgbG9uZyl0bXBidWYpOwogI2VuZGlmCiB9CkBAIC0zMjIsNyArMzE5LDcgQEAKIAlzdHJ1
Y3QgYnVmZmVyX2hlYWQgKmJoLCAqc2JoOwogCXN0cnVjdCBiZnNfc3VwZXJfYmxvY2sgKmJmc19z
YjsKIAlzdHJ1Y3QgaW5vZGUgKmlub2RlOwotCXVuc2lnbmVkIGksIGltYXBfbGVuOworCXVuc2ln
bmVkIGk7CiAJc3RydWN0IGJmc19zYl9pbmZvICppbmZvOwogCWludCByZXQgPSAtRUlOVkFMOwog
CXVuc2lnbmVkIGxvbmcgaV9zYmxvY2ssIGlfZWJsb2NrLCBpX2VvZmYsIHNfc2l6ZTsKQEAgLTM0
MSw4ICszMzgsNyBAQAogCWJmc19zYiA9IChzdHJ1Y3QgYmZzX3N1cGVyX2Jsb2NrICopc2JoLT5i
X2RhdGE7CiAJaWYgKGxlMzJfdG9fY3B1KGJmc19zYi0+c19tYWdpYykgIT0gQkZTX01BR0lDKSB7
CiAJCWlmICghc2lsZW50KQotCQkJcHJpbnRmKCJObyBCRlMgZmlsZXN5c3RlbSBvbiAlcyAobWFn
aWM9JTA4eClcbiIsIAotCQkJCXMtPnNfaWQsICBsZTMyX3RvX2NwdShiZnNfc2ItPnNfbWFnaWMp
KTsKKwkJCXByaW50ZigiTm8gQkZTIGZpbGVzeXN0ZW0gb24gJXMgKG1hZ2ljPSUwOHgpXG4iLCBz
LT5zX2lkLCAgbGUzMl90b19jcHUoYmZzX3NiLT5zX21hZ2ljKSk7CiAJCWdvdG8gb3V0MTsKIAl9
CiAJaWYgKEJGU19VTkNMRUFOKGJmc19zYiwgcykgJiYgIXNpbGVudCkKQEAgLTM1MSwxOCArMzQ3
LDE2IEBACiAJcy0+c19tYWdpYyA9IEJGU19NQUdJQzsKIAogCWlmIChsZTMyX3RvX2NwdShiZnNf
c2ItPnNfc3RhcnQpID4gbGUzMl90b19jcHUoYmZzX3NiLT5zX2VuZCkgfHwKLQkgICAgbGUzMl90
b19jcHUoYmZzX3NiLT5zX3N0YXJ0KSA8IEJGU19CU0laRSkgewotCQlwcmludGYoIlN1cGVyYmxv
Y2sgaXMgY29ycnVwdGVkXG4iKTsKKwkgICAgbGUzMl90b19jcHUoYmZzX3NiLT5zX3N0YXJ0KSA8
IHNpemVvZihzdHJ1Y3QgYmZzX3N1cGVyX2Jsb2NrKSArIHNpemVvZihzdHJ1Y3QgYmZzX2RpcmVu
dCkpIHsKKwkJcHJpbnRmKCJTdXBlcmJsb2NrIGlzIGNvcnJ1cHRlZCBvbiAlc1xuIiwgcy0+c19p
ZCk7CiAJCWdvdG8gb3V0MTsKIAl9CiAKLQlpbmZvLT5zaV9sYXN0aSA9IChsZTMyX3RvX2NwdShi
ZnNfc2ItPnNfc3RhcnQpIC0gQkZTX0JTSVpFKSAvCi0JCQkJCXNpemVvZihzdHJ1Y3QgYmZzX2lu
b2RlKQotCQkJCQkrIEJGU19ST09UX0lOTyAtIDE7Ci0JaW1hcF9sZW4gPSAoaW5mby0+c2lfbGFz
dGkgLyA4KSArIDE7Ci0JaW5mby0+c2lfaW1hcCA9IGt6YWxsb2MoaW1hcF9sZW4sIEdGUF9LRVJO
RUwgfCBfX0dGUF9OT1dBUk4pOwotCWlmICghaW5mby0+c2lfaW1hcCkgewotCQlwcmludGYoIkNh
bm5vdCBhbGxvY2F0ZSAldSBieXRlc1xuIiwgaW1hcF9sZW4pOworCWluZm8tPnNpX2xhc3RpID0g
KGxlMzJfdG9fY3B1KGJmc19zYi0+c19zdGFydCkgLSBCRlNfQlNJWkUpIC8gc2l6ZW9mKHN0cnVj
dCBiZnNfaW5vZGUpICsgQkZTX1JPT1RfSU5PIC0gMTsKKwlpZiAoaW5mby0+c2lfbGFzdGkgPT0g
QkZTX01BWF9MQVNUSSkKKwkJcHJpbnRmKCJXQVJOSU5HOiBmaWxlc3lzdGVtICVzIHdhcyBjcmVh
dGVkIHdpdGggNTEyIGlub2RlcywgdGhlIHJlYWwgbWF4aW11bSBpcyA1MTEsIG1vdW50aW5nIGFu
eXdheVxuIiwgcy0+c19pZCk7CisJZWxzZSBpZiAoaW5mby0+c2lfbGFzdGkgPiBCRlNfTUFYX0xB
U1RJKSB7CisJCXByaW50ZigiSW1wb3NzaWJsZSBsYXN0IGlub2RlIG51bWJlciAlbHUgPiAlZCBv
biAlc1xuIiwgaW5mby0+c2lfbGFzdGksIEJGU19NQVhfTEFTVEksIHMtPnNfaWQpOwogCQlnb3Rv
IG91dDE7CiAJfQogCWZvciAoaSA9IDA7IGkgPCBCRlNfUk9PVF9JTk87IGkrKykKQEAgLTM3Miwy
NiArMzY2LDI1IEBACiAJaW5vZGUgPSBiZnNfaWdldChzLCBCRlNfUk9PVF9JTk8pOwogCWlmIChJ
U19FUlIoaW5vZGUpKSB7CiAJCXJldCA9IFBUUl9FUlIoaW5vZGUpOwotCQlnb3RvIG91dDI7CisJ
CWdvdG8gb3V0MTsKIAl9CiAJcy0+c19yb290ID0gZF9tYWtlX3Jvb3QoaW5vZGUpOwogCWlmICgh
cy0+c19yb290KSB7CiAJCXJldCA9IC1FTk9NRU07Ci0JCWdvdG8gb3V0MjsKKwkJZ290byBvdXQx
OwogCX0KIAogCWluZm8tPnNpX2Jsb2NrcyA9IChsZTMyX3RvX2NwdShiZnNfc2ItPnNfZW5kKSAr
IDEpID4+IEJGU19CU0laRV9CSVRTOwotCWluZm8tPnNpX2ZyZWViID0gKGxlMzJfdG9fY3B1KGJm
c19zYi0+c19lbmQpICsgMQotCQkJLSBsZTMyX3RvX2NwdShiZnNfc2ItPnNfc3RhcnQpKSA+PiBC
RlNfQlNJWkVfQklUUzsKKwlpbmZvLT5zaV9mcmVlYiA9IChsZTMyX3RvX2NwdShiZnNfc2ItPnNf
ZW5kKSArIDEgLSBsZTMyX3RvX2NwdShiZnNfc2ItPnNfc3RhcnQpKSA+PiBCRlNfQlNJWkVfQklU
UzsKIAlpbmZvLT5zaV9mcmVlaSA9IDA7CiAJaW5mby0+c2lfbGZfZWJsayA9IDA7CiAKIAkvKiBj
YW4gd2UgcmVhZCB0aGUgbGFzdCBibG9jaz8gKi8KIAliaCA9IHNiX2JyZWFkKHMsIGluZm8tPnNp
X2Jsb2NrcyAtIDEpOwogCWlmICghYmgpIHsKLQkJcHJpbnRmKCJMYXN0IGJsb2NrIG5vdCBhdmFp
bGFibGU6ICVsdVxuIiwgaW5mby0+c2lfYmxvY2tzIC0gMSk7CisJCXByaW50ZigiTGFzdCBibG9j
ayBub3QgYXZhaWxhYmxlIG9uICVzOiAlbHVcbiIsIHMtPnNfaWQsIGluZm8tPnNpX2Jsb2NrcyAt
IDEpOwogCQlyZXQgPSAtRUlPOwotCQlnb3RvIG91dDM7CisJCWdvdG8gb3V0MjsKIAl9CiAJYnJl
bHNlKGJoKTsKIApAQCAtNDI1LDExICs0MTgsMTEgQEAKIAkJCShpX2VvZmYgIT0gbGUzMl90b19j
cHUoLTEpICYmIGlfZW9mZiA+IHNfc2l6ZSkgfHwKIAkJCWlfc2Jsb2NrICogQkZTX0JTSVpFID4g
aV9lb2ZmKSB7CiAKLQkJCXByaW50ZigiSW5vZGUgMHglMDh4IGNvcnJ1cHRlZFxuIiwgaSk7CisJ
CQlwcmludGYoIklub2RlIDB4JTA4eCBjb3JydXB0ZWQgb24gJXNcbiIsIGksIHMtPnNfaWQpOwog
CiAJCQlicmVsc2UoYmgpOwogCQkJcmV0ID0gLUVJTzsKLQkJCWdvdG8gb3V0MzsKKwkJCWdvdG8g
b3V0MjsKIAkJfQogCiAJCWlmICghZGktPmlfaW5vKSB7CkBAIC00NDUsMTQgKzQzOCwxMiBAQAog
CX0KIAlicmVsc2UoYmgpOwogCWJyZWxzZShzYmgpOwotCWJmc19kdW1wX2ltYXAoInJlYWRfc3Vw
ZXIiLCBzKTsKKwliZnNfZHVtcF9pbWFwKCJmaWxsX3N1cGVyIiwgcyk7CiAJcmV0dXJuIDA7CiAK
LW91dDM6CitvdXQyOgogCWRwdXQocy0+c19yb290KTsKIAlzLT5zX3Jvb3QgPSBOVUxMOwotb3V0
MjoKLQlrZnJlZShpbmZvLT5zaV9pbWFwKTsKIG91dDE6CiAJYnJlbHNlKHNiaCk7CiBvdXQ6CkBA
IC00ODIsNyArNDczLDcgQEAKIAlpbnQgZXJyID0gaW5pdF9pbm9kZWNhY2hlKCk7CiAJaWYgKGVy
cikKIAkJZ290byBvdXQxOwotICAgICAgICBlcnIgPSByZWdpc3Rlcl9maWxlc3lzdGVtKCZiZnNf
ZnNfdHlwZSk7CisJZXJyID0gcmVnaXN0ZXJfZmlsZXN5c3RlbSgmYmZzX2ZzX3R5cGUpOwogCWlm
IChlcnIpCiAJCWdvdG8gb3V0OwogCXJldHVybiAwOwo=
--000000000000359b96057c0e9a94--
