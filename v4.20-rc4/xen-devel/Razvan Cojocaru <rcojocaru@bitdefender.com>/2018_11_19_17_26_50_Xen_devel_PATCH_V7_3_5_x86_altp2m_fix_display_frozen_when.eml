Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 20 Nov 2018 00:34:01 -0000
Received: from icoremail.net (unknown [209.85.210.174])
	by mail-app2 (Coremail) with SMTP id by_KCgDHH0Lp8vJb+bK6AQ--.55377S3;
	Tue, 20 Nov 2018 01:29:14 +0800 (CST)
Received: from mail-pf1-f174.google.com (unknown [209.85.210.174])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwAX_knj8vJbQoRZAA--.3726S3;
	Tue, 20 Nov 2018 01:29:07 +0800 (CST)
Received: by mail-pf1-f174.google.com with SMTP id b7so1948356pfi.8
        for <xuliker@zju.edu.cn>; Mon, 19 Nov 2018 09:29:07 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:subject:precedence
         :list-id:list-unsubscribe:list-post:list-help:list-subscribe:cc
         :mime-version:content-transfer-encoding:errors-to:sender;
        bh=DuclWtFABmZOKevFUZ5wRtDn5uq4pa9ZmPDbPxaEl2Y=;
        b=b2T9bjzeo9m49f2Y33UQL6i0C25B7IV8w+xfDF/n7GSdTm7Yqbnb59t8rYhtEfAOm4
         GmpubVOczHtQ+Jy7IYS1mTIZnYQx3Egd0IluTBMpIYZpy0u76NHCZ3e4JBFVmAcBp8Y+
         pV7ayg0+ZURVQnQ0uVhdJNOtUHnexrKA4Ys0ys558wE8Jr0VtlpB+dErf9PWp8GSRtt7
         oRqeR3ZQW71jWhaZi4rTRIivtvTF2K5bxofvKfZQHdeqDAlZj/4S7iVcNJoAJ6yoaTbP
         UWkea1pdDd9QIjuMCTdPTdorjYRMxc+4JcO5oA110i0yPzl1FBWwZxDxWr777l7JAvqX
         MAhA==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AGRZ1gI2MIl4r9W0OqW1H7ext+fOoUYZSx6psFhcMX9ab+n9lehCiVbh
	RojIABDU9lek3KIgJwlWUrqx4mB7T42NgRpxaHhI9Bg4Mm/qZL8=
X-Received: by 2002:a63:1e17:: with SMTP id e23mr20678524pge.130.1542648547076;
        Mon, 19 Nov 2018 09:29:07 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp2949335pju;
        Mon, 19 Nov 2018 09:29:05 -0800 (PST)
X-Google-Smtp-Source: AJdET5d3VjaXjZM5HdwSIR3qN5yTpRe3gbE05Mi4VK5evUIxg/rApgI3xvJSrRnTmu8Sgbjp6I/v
X-Received: by 2002:a0d:f5c2:: with SMTP id e185-v6mr21301316ywf.170.1542648545140;
        Mon, 19 Nov 2018 09:29:05 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542648545; cv=none;
        d=google.com; s=arc-20160816;
        b=zRdYARCfM8gTDyNGCWOmDcaoIzRu7CxA4CiDuzvcm6CEbp2/P7ZKrYISEPd1UlbuXn
         KKolJuC3BuLxSzNrZ2ZGuSeecV501ZjFQc9r7pxXWDWeKMwzakwsVLtIwMi19yvBJh/q
         YSuTU9v42px6WNryDxv4tluLgEHrjU+fNNCXB37MChKenoBQJrwIDrwhLF6XhGZSKqdn
         YcC1msBsVZGa0NN9+zG1KVfCbquRwQwO5oNOmO4n0k9lu9gmpBXIEzxDZenpjjM0CEX7
         8leRUtmotbTTPzNedCX8S/DrBfwGhJdektchiErZwA+9JPCVtOjFojciUvniCMYXCwF0
         zcDw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:mime-version:cc
         :list-subscribe:list-help:list-post:list-unsubscribe:list-id
         :precedence:subject:references:in-reply-to:message-id:date:to:from;
        bh=DuclWtFABmZOKevFUZ5wRtDn5uq4pa9ZmPDbPxaEl2Y=;
        b=RNcIhetHmQOd0Tnf6bsYwdc8JWhal26NeTSO6aeV3T089ubflmsVL/TtxQ5TTQ7Zv3
         n/NpfY2xPKsFcYtyUaT0/9T3h8jpPelX3oo9la9OgLYvhg2LmwTMsxT8InSvVp4/3ic4
         95WUjxh8pJEyW6jwjbEIVsLQRbd5qWPi8FCavDlDAI9KF0so3e40r2Y28ZvYMrJISYZl
         BaZPqhvTFdUkZhSwRL2x3/7h7UPDcMEf0p61bhtgDQmli+k5QYsgTMl19zTc3oU9X6z2
         y8+jeJxKkeJ2ne2HIN98o4I0FO7V7GF1JwBOo0RSQmVOdCG1BXM0HlMvhyboB8nBC3JS
         Gf7A==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id c81-v6si14384419ybb.363.2018.11.19.09.28.55
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Mon, 19 Nov 2018 09:29:05 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gOnK9-0003Rz-P1; Mon, 19 Nov 2018 17:27:01 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=mWzq=N6=bitdefender.com=rcojocaru@srs-us1.protection.inumbo.net>)
 id 1gOnK8-0003RT-C0
 for xen-devel@lists.xenproject.org; Mon, 19 Nov 2018 17:27:00 +0000
X-Inumbo-ID: 50ff1062-ec20-11e8-a1e4-12d6303a7972
Received: from mx01.bbu.dsd.mx.bitdefender.com (unknown [91.199.104.161])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 50ff1062-ec20-11e8-a1e4-12d6303a7972;
 Mon, 19 Nov 2018 17:26:58 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 5305F305FFA6; Mon, 19 Nov 2018 19:26:57 +0200 (EET)
Received: from rcojocaru.npunix.bitdefender.biz (unknown [10.17.12.174])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 32F873084EF2;
 Mon, 19 Nov 2018 19:26:57 +0200 (EET)
From: Razvan Cojocaru <rcojocaru@bitdefender.com>
To: xen-devel@lists.xenproject.org
Date: Mon, 19 Nov 2018 19:26:50 +0200
Message-Id: <1542648412-2711-4-git-send-email-rcojocaru@bitdefender.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1542648412-2711-1-git-send-email-rcojocaru@bitdefender.com>
References: <1542648412-2711-1-git-send-email-rcojocaru@bitdefender.com>
Subject: [Xen-devel] [PATCH V7 3/5] x86/altp2m: fix display frozen when
 switching to a new view early
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>, Wei Liu <wei.liu2@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>,
 Razvan Cojocaru <rcojocaru@bitdefender.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Jan Beulich <jbeulich@suse.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwAX_knj8vJbQoRZAA--.3726S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3tF18uF1Dur1fCFy3JrWkJFb_yoWDCw45pF
	yYyrn0gF45tFW2ga1fGws8ZrWYk3yxWF95GFZay345t342qF17Gr4I9w1UCr18GF93ZF1F
	ya4fKF1UCayjyaDanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlIb7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_tr0E3s1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Gr1j6F4UJwA2z4x0Y4vE
	x4A2jsIE14v26rxl6s0DM28EF7xvwVC2z280aVCY1x0267AKxVW0oVCq3wAa7VCE64xvF2
	IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x082IY
	62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUJVWUGwAv7V
	C2z280aVAFwI0_Gr0_Cr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VW8MxkI7II2jI8vz4vEwIxGrwCYIxAIcVC0I7IYx2IY
	67AKxVWDJVCq3wCYIxAIcVC0I7IYx2IY6xkF7I0E14v26F4j6r4UJwCYIxAIcVC2z280aV
	AFwI0_Cr1j6rxdMxvI42IY6I8E87Iv6xkF7I0E14v26F4UJVW0owCF04k20xvY0x0EwIxG
	rwCF04k20xvEw4C26cxK6c8Ij28IcwCF72vE77IF4wCFx2IqxVCFs4IE7xkEbVWUJVW8Jw
	C20s026c02F40E14v26r1j6r18MI8I3I0E7480Y4vE14v26r106r1rMI8E67AF67kF1VAF
	wI0_Jw0_GFylIxkGc2Ij64vIr41lIxAIcVCF04k26cxKx2IYs7xG6r1I6r4UMVCEFcxC0V
	AYjxAxZFUvcSsGvfC2KfnxnUUI43ZEXa7IUYio25UUUUU==

V2hlbiBhbiBuZXcgYWx0cDJtIHZpZXcgaXMgY3JlYXRlZCB2ZXJ5IGVhcmx5IG9uIGd1ZXN0IGJv
b3QsIHRoZQpkaXNwbGF5IHdpbGwgZnJlZXplIChhbHRob3VnaCB0aGUgZ3Vlc3Qgd2lsbCBydW4g
bm9ybWFsbHkpLiBUaGlzCm1heSBhbHNvIGhhcHBlbiBvbiByZXNpemluZyB0aGUgZGlzcGxheS4g
VGhlIHJlYXNvbiBpcyB0aGUgd2F5ClhlbiBjdXJyZW50bHkgKG1pcyloYW5kbGVzIGxvZ2RpcnR5
IFZHQTogaXQgaW50ZW50aW9uYWxseQptaXNjb25maWd1cmVzIFZHQSBwYWdlcyBzbyB0aGF0IHRo
ZXkgd2lsbCBmYXVsdC4KClRoZSBwcm9ibGVtIGlzIHRoYXQgaXQgb25seSBkb2VzIHRoaXMgaW4g
dGhlIGhvc3QgcDJtLiBPbmNlIHdlCnN3aXRjaCB0byBhIG5ldyBhbHRwMm0sIHRoZSBtaXNjb25m
aWd1cmVkIGVudHJpZXMgd2lsbCBubyBsb25nZXIKZmF1bHQsIHNvIHRoZSBkaXNwbGF5IHdpbGwg
bm90IGJlIHVwZGF0ZWQuCgpUaGlzIHBhdGNoOgoqIHVwZGF0ZXMgZXB0X2hhbmRsZV9taXNjb25m
aWcoKSB0byB1c2UgdGhlIGFjdGl2ZSBhbHRwMm0gaW5zdGVhZAogIG9mIHRoZSBob3N0cDJtOwoq
IG1vZGlmaWVzIHAybV9jaGFuZ2VfZW50cnlfdHlwZV9nbG9iYWwoKSwKICBwMm1fbWVtb3J5X3R5
cGVfY2hhbmdlZCgpLCBwMm1fY2hhbmdlX3R5cGVfcmFuZ2UoKSBhbmQKICBwMm1fZmluaXNoX3R5
cGVfY2hhbmdlKCkgdG8gcHJvcGFnYXRlIHRoZWlyIGNoYW5nZXMgdG8gYWxsCiAgdmFsaWQgYWx0
cDJtcy4KCldpdGggdGhlIGludHJvZHVjdGlvbiBvZiBhbHRwMm0gZmllbGRzIGluIHAybV9tZW1v
cnlfdHlwZV9jaGFuZ2VkKCkKdGhlIHdob2xlIGZ1bmN0aW9uIGhhcyBiZWVuIHB1dCB1bmRlciBD
T05GSUdfSFZNLgoKU2lnbmVkLW9mZi1ieTogUmF6dmFuIENvam9jYXJ1IDxyY29qb2NhcnVAYml0
ZGVmZW5kZXIuY29tPgpTdWdnZXN0ZWQtYnk6IEdlb3JnZSBEdW5sYXAgPGdlb3JnZS5kdW5sYXBA
Y2l0cml4LmNvbT4KCi0tLQpDQzogSnVuIE5ha2FqaW1hIDxqdW4ubmFrYWppbWFAaW50ZWwuY29t
PgpDQzogS2V2aW4gVGlhbiA8a2V2aW4udGlhbkBpbnRlbC5jb20+CkNDOiBHZW9yZ2UgRHVubGFw
IDxnZW9yZ2UuZHVubGFwQGV1LmNpdHJpeC5jb20+CkNDOiBKYW4gQmV1bGljaCA8amJldWxpY2hA
c3VzZS5jb20+CkNDOiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgpD
QzogV2VpIExpdSA8d2VpLmxpdTJAY2l0cml4LmNvbT4KCi0tLQpDaGFuZ2VzIHNpbmNlIFY2Ogog
LSBSZW1vdmVkIEtldmluJ3MgUmV2aWV3ZWQtYnkgc2luY2UgSSd2ZSBkb25lIG5vbi10cml2aWFs
IGNoYW5nZXMKICAgKG5vdCBzdXJlIGlmIHRoYXQgd2FzIHdyb25nKS4KIC0gTm93IHNldHRpbmcg
cDJtLT5tYXhfbWFwcGVkX3BmbiB0byAwLgogLSBBZGRlZCBmaW5pc2hfdHlwZV9jaGFuZ2UoKS4K
LS0tCiB4ZW4vYXJjaC94ODYvbW0vcDJtLWVwdC5jIHwgICA5ICsrLQogeGVuL2FyY2gveDg2L21t
L3AybS1wdC5jICB8ICAgOCArKysKIHhlbi9hcmNoL3g4Ni9tbS9wMm0uYyAgICAgfCAxNjUgKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLQogeGVuL2luY2x1ZGUv
YXNtLXg4Ni9wMm0uaCB8ICAgNiArLQogNCBmaWxlcyBjaGFuZ2VkLCAxNTcgaW5zZXJ0aW9ucygr
KSwgMzEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL3AybS1lcHQu
YyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0tZXB0LmMKaW5kZXggZmFiY2QwNi4uMzZlNjQ4YyAxMDA2
NDQKLS0tIGEveGVuL2FyY2gveDg2L21tL3AybS1lcHQuYworKysgYi94ZW4vYXJjaC94ODYvbW0v
cDJtLWVwdC5jCkBAIC02NTcsNiArNjU3LDkgQEAgYm9vbF90IGVwdF9oYW5kbGVfbWlzY29uZmln
KHVpbnQ2NF90IGdwYSkKICAgICBib29sX3Qgc3B1cmlvdXM7CiAgICAgaW50IHJjOwogCisgICAg
aWYgKCBhbHRwMm1fYWN0aXZlKGN1cnItPmRvbWFpbikgKQorICAgICAgICBwMm0gPSBwMm1fZ2V0
X2FsdHAybShjdXJyKTsKKwogICAgIHAybV9sb2NrKHAybSk7CiAKICAgICBzcHVyaW91cyA9IGN1
cnItPmFyY2guaHZtLnZteC5lcHRfc3B1cmlvdXNfbWlzY29uZmlnOwpAQCAtMTQ0MCw5ICsxNDQz
LDEzIEBAIHZvaWQgcDJtX2luaXRfYWx0cDJtX2VwdChzdHJ1Y3QgZG9tYWluICpkLCB1bnNpZ25l
ZCBpbnQgaSkKICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqaG9zdHAybSA9IHAybV9nZXRfaG9zdHAy
bShkKTsKICAgICBzdHJ1Y3QgZXB0X2RhdGEgKmVwdDsKIAorICAgIHAybS0+ZGVmYXVsdF9hY2Nl
c3MgPSBob3N0cDJtLT5kZWZhdWx0X2FjY2VzczsKKyAgICBwMm0tPmRvbWFpbiA9IGhvc3RwMm0t
PmRvbWFpbjsKKworICAgIHAybS0+Z2xvYmFsX2xvZ2RpcnR5ID0gaG9zdHAybS0+Z2xvYmFsX2xv
Z2RpcnR5OwogICAgIHAybS0+ZXB0LmFkID0gaG9zdHAybS0+ZXB0LmFkOwogICAgIHAybS0+bWlu
X3JlbWFwcGVkX2dmbiA9IGdmbl94KElOVkFMSURfR0ZOKTsKLSAgICBwMm0tPm1heF9yZW1hcHBl
ZF9nZm4gPSAwOworICAgIHAybS0+bWF4X21hcHBlZF9wZm4gPSBwMm0tPm1heF9yZW1hcHBlZF9n
Zm4gPSAwOwogICAgIGVwdCA9ICZwMm0tPmVwdDsKICAgICBlcHQtPm1mbiA9IHBhZ2V0YWJsZV9n
ZXRfcGZuKHAybV9nZXRfcGFnZXRhYmxlKHAybSkpOwogICAgIGQtPmFyY2guYWx0cDJtX2VwdHBb
aV0gPSBlcHQtPmVwdHA7CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLXB0LmMgYi94
ZW4vYXJjaC94ODYvbW0vcDJtLXB0LmMKaW5kZXggNTVkZjE4NS4uMzgyODA4OCAxMDA2NDQKLS0t
IGEveGVuL2FyY2gveDg2L21tL3AybS1wdC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0tcHQu
YwpAQCAtMjksNiArMjksNyBAQAogI2luY2x1ZGUgPHhlbi9ldmVudC5oPgogI2luY2x1ZGUgPHhl
bi90cmFjZS5oPgogI2luY2x1ZGUgPHB1YmxpYy92bV9ldmVudC5oPgorI2luY2x1ZGUgPGFzbS9h
bHRwMm0uaD4KICNpbmNsdWRlIDxhc20vZG9tYWluLmg+CiAjaW5jbHVkZSA8YXNtL3BhZ2UuaD4K
ICNpbmNsdWRlIDxhc20vcGFnaW5nLmg+CkBAIC00NjQsNiArNDY1LDEzIEBAIGludCBwMm1fcHRf
aGFuZGxlX2RlZmVycmVkX2NoYW5nZXModWludDY0X3QgZ3BhKQogICAgIHN0cnVjdCBwMm1fZG9t
YWluICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oY3VycmVudC0+ZG9tYWluKTsKICAgICBpbnQgcmM7
CiAKKyAgICAvKgorICAgICAqIFNob3VsZCBhbHRwMm0gZXZlciBiZSBlbmFibGVkIGZvciBOUFQg
LyBzaGFkb3cgdXNlLCB0aGlzIGNvZGUKKyAgICAgKiBzaG91bGQgYmUgdXBkYXRlZCB0byBtYWtl
IHVzZSBvZiB0aGUgYWN0aXZlIGFsdHAybSwgbGlrZQorICAgICAqIGVwdF9oYW5kbGVfbWlzY29u
ZmlnKCkuCisgICAgICovCisgICAgQVNTRVJUKCFhbHRwMm1fYWN0aXZlKGN1cnJlbnQtPmRvbWFp
bikpOworCiAgICAgcDJtX2xvY2socDJtKTsKICAgICByYyA9IGRvX3JlY2FsYyhwMm0sIFBGTl9E
T1dOKGdwYSkpOwogICAgIHAybV91bmxvY2socDJtKTsKZGlmZiAtLWdpdCBhL3hlbi9hcmNoL3g4
Ni9tbS9wMm0uYyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0uYwppbmRleCA5NzczNDk1Li44MjNmZWI0
IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0vcDJtLmMKKysrIGIveGVuL2FyY2gveDg2L21t
L3AybS5jCkBAIC0yNzcsNyArMjc3LDYgQEAgaW50IHAybV9pbml0KHN0cnVjdCBkb21haW4gKmQp
CiBpbnQgcDJtX2lzX2xvZ2RpcnR5X3JhbmdlKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sIHVuc2ln
bmVkIGxvbmcgc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcg
ZW5kKQogewotICAgIEFTU0VSVChwMm1faXNfaG9zdHAybShwMm0pKTsKICAgICBpZiAoIHAybS0+
Z2xvYmFsX2xvZ2RpcnR5IHx8CiAgICAgICAgICByYW5nZXNldF9jb250YWluc19yYW5nZShwMm0t
PmxvZ2RpcnR5X3Jhbmdlcywgc3RhcnQsIGVuZCkgKQogICAgICAgICByZXR1cm4gMTsKQEAgLTI4
NiwzMSArMjg1LDc5IEBAIGludCBwMm1faXNfbG9nZGlydHlfcmFuZ2Uoc3RydWN0IHAybV9kb21h
aW4gKnAybSwgdW5zaWduZWQgbG9uZyBzdGFydCwKICAgICByZXR1cm4gMDsKIH0KIAorc3RhdGlj
IHZvaWQgY2hhbmdlX2VudHJ5X3R5cGVfZ2xvYmFsKHN0cnVjdCBwMm1fZG9tYWluICpwMm0sCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJtX3R5cGVfdCBvdCwgcDJtX3R5
cGVfdCBudCkKK3sKKyAgICBwMm0tPmNoYW5nZV9lbnRyeV90eXBlX2dsb2JhbChwMm0sIG90LCBu
dCk7CisgICAgcDJtLT5nbG9iYWxfbG9nZGlydHkgPSAobnQgPT0gcDJtX3JhbV9sb2dkaXJ0eSk7
Cit9CisKIHZvaWQgcDJtX2NoYW5nZV9lbnRyeV90eXBlX2dsb2JhbChzdHJ1Y3QgZG9tYWluICpk
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAybV90eXBlX3Qgb3QsIHAybV90
eXBlX3QgbnQpCiB7Ci0gICAgc3RydWN0IHAybV9kb21haW4gKnAybSA9IHAybV9nZXRfaG9zdHAy
bShkKTsKKyAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqaG9zdHAybSA9IHAybV9nZXRfaG9zdHAybShk
KTsKIAogICAgIEFTU0VSVChvdCAhPSBudCk7CiAgICAgQVNTRVJUKHAybV9pc19jaGFuZ2VhYmxl
KG90KSAmJiBwMm1faXNfY2hhbmdlYWJsZShudCkpOwogCi0gICAgcDJtX2xvY2socDJtKTsKLSAg
ICBwMm0tPmNoYW5nZV9lbnRyeV90eXBlX2dsb2JhbChwMm0sIG90LCBudCk7Ci0gICAgcDJtLT5n
bG9iYWxfbG9nZGlydHkgPSAobnQgPT0gcDJtX3JhbV9sb2dkaXJ0eSk7Ci0gICAgcDJtX3VubG9j
ayhwMm0pOworICAgIHAybV9sb2NrKGhvc3RwMm0pOworCisgICAgY2hhbmdlX2VudHJ5X3R5cGVf
Z2xvYmFsKGhvc3RwMm0sIG90LCBudCk7CisKKyNpZmRlZiBDT05GSUdfSFZNCisgICAgaWYgKCB1
bmxpa2VseShhbHRwMm1fYWN0aXZlKGQpKSApCisgICAgeworICAgICAgICB1bnNpZ25lZCBpbnQg
aTsKKworICAgICAgICBmb3IgKCBpID0gMDsgaSA8IE1BWF9BTFRQMk07IGkrKyApCisgICAgICAg
ICAgICBpZiAoIGQtPmFyY2guYWx0cDJtX2VwdHBbaV0gIT0gbWZuX3goSU5WQUxJRF9NRk4pICkK
KyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqYWx0cDJt
ID0gZC0+YXJjaC5hbHRwMm1fcDJtW2ldOworCisgICAgICAgICAgICAgICAgcDJtX2xvY2soYWx0
cDJtKTsKKyAgICAgICAgICAgICAgICBjaGFuZ2VfZW50cnlfdHlwZV9nbG9iYWwoYWx0cDJtLCBv
dCwgbnQpOworICAgICAgICAgICAgICAgIHAybV91bmxvY2soYWx0cDJtKTsKKyAgICAgICAgICAg
IH0KKyAgICB9CisjZW5kaWYKKworICAgIHAybV91bmxvY2soaG9zdHAybSk7Cit9CisKKyNpZmRl
ZiBDT05GSUdfSFZNCisvKiBUaGVyZSdzIGFscmVhZHkgYSBtZW1vcnlfdHlwZV9jaGFuZ2VkKCkg
aW4gYXNtL210cnIuaC4gKi8KK3N0YXRpYyB2b2lkIF9tZW1vcnlfdHlwZV9jaGFuZ2VkKHN0cnVj
dCBwMm1fZG9tYWluICpwMm0pCit7CisgICAgaWYgKCBwMm0tPm1lbW9yeV90eXBlX2NoYW5nZWQg
KQorICAgICAgICBwMm0tPm1lbW9yeV90eXBlX2NoYW5nZWQocDJtKTsKIH0KIAogdm9pZCBwMm1f
bWVtb3J5X3R5cGVfY2hhbmdlZChzdHJ1Y3QgZG9tYWluICpkKQogewotICAgIHN0cnVjdCBwMm1f
ZG9tYWluICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CisgICAgc3RydWN0IHAybV9kb21haW4g
Kmhvc3RwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CiAKLSAgICBpZiAoIHAybS0+bWVtb3J5X3R5
cGVfY2hhbmdlZCApCisgICAgcDJtX2xvY2soaG9zdHAybSk7CisKKyAgICBfbWVtb3J5X3R5cGVf
Y2hhbmdlZChob3N0cDJtKTsKKworICAgIGlmICggdW5saWtlbHkoYWx0cDJtX2FjdGl2ZShkKSkg
KQogICAgIHsKLSAgICAgICAgcDJtX2xvY2socDJtKTsKLSAgICAgICAgcDJtLT5tZW1vcnlfdHlw
ZV9jaGFuZ2VkKHAybSk7Ci0gICAgICAgIHAybV91bmxvY2socDJtKTsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IGk7CisKKyAgICAgICAgZm9yICggaSA9IDA7IGkgPCBNQVhfQUxUUDJNOyBpKysgKQor
ICAgICAgICAgICAgaWYgKCBkLT5hcmNoLmFsdHAybV9lcHRwW2ldICE9IG1mbl94KElOVkFMSURf
TUZOKSApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgc3RydWN0IHAybV9kb21haW4g
KmFsdHAybSA9IGQtPmFyY2guYWx0cDJtX3AybVtpXTsKKworICAgICAgICAgICAgICAgIHAybV9s
b2NrKGFsdHAybSk7CisgICAgICAgICAgICAgICAgX21lbW9yeV90eXBlX2NoYW5nZWQoYWx0cDJt
KTsKKyAgICAgICAgICAgICAgICBwMm1fdW5sb2NrKGFsdHAybSk7CisgICAgICAgICAgICB9CiAg
ICAgfQorCisgICAgcDJtX3VubG9jayhob3N0cDJtKTsKIH0KKyNlbmRpZgogCiBpbnQgcDJtX3Nl
dF9pb3JlcV9zZXJ2ZXIoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAgICAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBpbnQgZmxhZ3MsCkBAIC05OTEsMTggKzEwMzgsMTQgQEAgaW50IHAybV9jaGFu
Z2VfdHlwZV9vbmUoc3RydWN0IGRvbWFpbiAqZCwgdW5zaWduZWQgbG9uZyBnZm5fbCwKIH0KIAog
LyogTW9kaWZ5IHRoZSBwMm0gdHlwZSBvZiBhIHJhbmdlIG9mIGdmbnMgZnJvbSBvdCB0byBudC4g
Ki8KLXZvaWQgcDJtX2NoYW5nZV90eXBlX3JhbmdlKHN0cnVjdCBkb21haW4gKmQsIAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBzdGFydCwgdW5zaWduZWQgbG9uZyBl
bmQsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICBwMm1fdHlwZV90IG90LCBwMm1fdHlwZV90
IG50KQorc3RhdGljIHZvaWQgY2hhbmdlX3R5cGVfcmFuZ2Uoc3RydWN0IHAybV9kb21haW4gKnAy
bSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgc3RhcnQsIHVu
c2lnbmVkIGxvbmcgZW5kLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJtX3R5cGVf
dCBvdCwgcDJtX3R5cGVfdCBudCkKIHsKICAgICB1bnNpZ25lZCBsb25nIGdmbiA9IHN0YXJ0Owot
ICAgIHN0cnVjdCBwMm1fZG9tYWluICpwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CisgICAgc3Ry
dWN0IGRvbWFpbiAqZCA9IHAybS0+ZG9tYWluOwogICAgIGludCByYyA9IDA7CiAKLSAgICBBU1NF
UlQob3QgIT0gbnQpOwotICAgIEFTU0VSVChwMm1faXNfY2hhbmdlYWJsZShvdCkgJiYgcDJtX2lz
X2NoYW5nZWFibGUobnQpKTsKLQotICAgIHAybV9sb2NrKHAybSk7CiAgICAgcDJtLT5kZWZlcl9u
ZXN0ZWRfZmx1c2ggPSAxOwogCiAgICAgaWYgKCB1bmxpa2VseShlbmQgPiBwMm0tPm1heF9tYXBw
ZWRfcGZuKSApCkBAIC0xMDQ2LDIzICsxMDg5LDU0IEBAIHZvaWQgcDJtX2NoYW5nZV90eXBlX3Jh
bmdlKHN0cnVjdCBkb21haW4gKmQsCiAgICAgcDJtLT5kZWZlcl9uZXN0ZWRfZmx1c2ggPSAwOwog
ICAgIGlmICggbmVzdGVkaHZtX2VuYWJsZWQoZCkgKQogICAgICAgICBwMm1fZmx1c2hfbmVzdGVk
cDJtKGQpOwotICAgIHAybV91bmxvY2socDJtKTsKK30KKwordm9pZCBwMm1fY2hhbmdlX3R5cGVf
cmFuZ2Uoc3RydWN0IGRvbWFpbiAqZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2ln
bmVkIGxvbmcgc3RhcnQsIHVuc2lnbmVkIGxvbmcgZW5kLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcDJtX3R5cGVfdCBvdCwgcDJtX3R5cGVfdCBudCkKK3sKKyAgICBzdHJ1Y3QgcDJtX2Rv
bWFpbiAqaG9zdHAybSA9IHAybV9nZXRfaG9zdHAybShkKTsKKworICAgIEFTU0VSVChvdCAhPSBu
dCk7CisgICAgQVNTRVJUKHAybV9pc19jaGFuZ2VhYmxlKG90KSAmJiBwMm1faXNfY2hhbmdlYWJs
ZShudCkpOworCisgICAgcDJtX2xvY2soaG9zdHAybSk7CisKKyAgICBjaGFuZ2VfdHlwZV9yYW5n
ZShob3N0cDJtLCBzdGFydCwgZW5kLCBvdCwgbnQpOworCisjaWZkZWYgQ09ORklHX0hWTQorICAg
IGlmICggdW5saWtlbHkoYWx0cDJtX2FjdGl2ZShkKSkgKQorICAgIHsKKyAgICAgICAgdW5zaWdu
ZWQgaW50IGk7CisKKyAgICAgICAgZm9yICggaSA9IDA7IGkgPCBNQVhfQUxUUDJNOyBpKysgKQor
ICAgICAgICAgICAgaWYgKCBkLT5hcmNoLmFsdHAybV9lcHRwW2ldICE9IG1mbl94KElOVkFMSURf
TUZOKSApCisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgc3RydWN0IHAybV9kb21haW4g
KmFsdHAybSA9IGQtPmFyY2guYWx0cDJtX3AybVtpXTsKKworICAgICAgICAgICAgICAgIHAybV9s
b2NrKGFsdHAybSk7CisgICAgICAgICAgICAgICAgY2hhbmdlX3R5cGVfcmFuZ2UoYWx0cDJtLCBz
dGFydCwgZW5kLCBvdCwgbnQpOworICAgICAgICAgICAgICAgIHAybV91bmxvY2soYWx0cDJtKTsK
KyAgICAgICAgICAgIH0KKyAgICB9CisjZW5kaWYKKworICAgIHAybV91bmxvY2soaG9zdHAybSk7
CiB9CiAKIC8qCiAgKiBGaW5pc2ggcDJtIHR5cGUgY2hhbmdlIGZvciBnZm5zIHdoaWNoIGFyZSBt
YXJrZWQgYXMgbmVlZF9yZWNhbGMgaW4gYSByYW5nZS4KKyAqIFVzZXMgdGhlIGN1cnJlbnQgcDJt
J3MgbWF4X21hcHBlZF9wZm4gdG8gZnVydGhlciBjbGlwIHRoZSBpbnZhbGlkYXRpb24KKyAqIHJh
bmdlIGZvciBhbHRlcm5hdGUgcDJtcy4KICAqIFJldHVybnM6IDAvMSBmb3Igc3VjY2VzcywgbmVn
YXRpdmUgZm9yIGZhaWx1cmUKICAqLwotaW50IHAybV9maW5pc2hfdHlwZV9jaGFuZ2Uoc3RydWN0
IGRvbWFpbiAqZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgIGdmbl90IGZpcnN0X2dmbiwg
dW5zaWduZWQgbG9uZyBtYXhfbnIpCitzdGF0aWMgaW50IGZpbmlzaF90eXBlX2NoYW5nZShzdHJ1
Y3QgcDJtX2RvbWFpbiAqcDJtLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZuX3Qg
Zmlyc3RfZ2ZuLCB1bnNpZ25lZCBsb25nIG1heF9ucikKIHsKLSAgICBzdHJ1Y3QgcDJtX2RvbWFp
biAqcDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOwogICAgIHVuc2lnbmVkIGxvbmcgZ2ZuID0gZ2Zu
X3goZmlyc3RfZ2ZuKTsKICAgICB1bnNpZ25lZCBsb25nIGxhc3RfZ2ZuID0gZ2ZuICsgbWF4X25y
IC0gMTsKICAgICBpbnQgcmMgPSAwOwogCi0gICAgcDJtX2xvY2socDJtKTsKLQogICAgIGxhc3Rf
Z2ZuID0gbWluKGxhc3RfZ2ZuLCBwMm0tPm1heF9tYXBwZWRfcGZuKTsKICAgICB3aGlsZSAoIGdm
biA8PSBsYXN0X2dmbiApCiAgICAgewpAQCAtMTA3NywxNCArMTE1MSw1MSBAQCBpbnQgcDJtX2Zp
bmlzaF90eXBlX2NoYW5nZShzdHJ1Y3QgZG9tYWluICpkLAogICAgICAgICBlbHNlIGlmICggcmMg
PCAwICkKICAgICAgICAgewogICAgICAgICAgICAgZ2RwcmludGsoWEVOTE9HX0VSUiwgInAybS0+
cmVjYWxjIGZhaWxlZCEgRG9tJWQgZ2ZuPSVseFxuIiwKLSAgICAgICAgICAgICAgICAgICAgIGQt
PmRvbWFpbl9pZCwgZ2ZuKTsKKyAgICAgICAgICAgICAgICAgICAgIHAybS0+ZG9tYWluLT5kb21h
aW5faWQsIGdmbik7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogCiAgICAgICAgIGdm
bisrOwogICAgIH0KIAotICAgIHAybV91bmxvY2socDJtKTsKKyAgICByZXR1cm4gcmM7Cit9CisK
K2ludCBwMm1fZmluaXNoX3R5cGVfY2hhbmdlKHN0cnVjdCBkb21haW4gKmQsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICBnZm5fdCBmaXJzdF9nZm4sIHVuc2lnbmVkIGxvbmcgbWF4X25yKQor
eworICAgIHN0cnVjdCBwMm1fZG9tYWluICpob3N0cDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOwor
ICAgIGludCByYzsKKworICAgIHAybV9sb2NrKGhvc3RwMm0pOworCisgICAgcmMgPSBmaW5pc2hf
dHlwZV9jaGFuZ2UoaG9zdHAybSwgZmlyc3RfZ2ZuLCBtYXhfbnIpOworCisgICAgaWYgKCAhcmMg
KQorICAgICAgICBnb3RvIG91dDsKKworI2lmZGVmIENPTkZJR19IVk0KKyAgICBpZiAoIHVubGlr
ZWx5KGFsdHAybV9hY3RpdmUoZCkpICkKKyAgICB7CisgICAgICAgIHVuc2lnbmVkIGludCBpOwor
CisgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgTUFYX0FMVFAyTTsgaSsrICkKKyAgICAgICAgICAg
IGlmICggZC0+YXJjaC5hbHRwMm1fZXB0cFtpXSAhPSBtZm5feChJTlZBTElEX01GTikgKQorICAg
ICAgICAgICAgeworICAgICAgICAgICAgICAgIHN0cnVjdCBwMm1fZG9tYWluICphbHRwMm0gPSBk
LT5hcmNoLmFsdHAybV9wMm1baV07CisKKyAgICAgICAgICAgICAgICBwMm1fbG9jayhhbHRwMm0p
OworICAgICAgICAgICAgICAgIHJjID0gZmluaXNoX3R5cGVfY2hhbmdlKGFsdHAybSwgZmlyc3Rf
Z2ZuLCBtYXhfbnIpOworICAgICAgICAgICAgICAgIHAybV91bmxvY2soYWx0cDJtKTsKKworICAg
ICAgICAgICAgICAgIGlmICggIXJjICkKKyAgICAgICAgICAgICAgICAgICAgZ290byBvdXQ7Cisg
ICAgICAgICAgICB9CisgICAgfQorI2VuZGlmCisKK291dDoKKyAgICBwMm1fdW5sb2NrKGhvc3Rw
Mm0pOwogCiAgICAgcmV0dXJuIHJjOwogfQpkaWZmIC0tZ2l0IGEveGVuL2luY2x1ZGUvYXNtLXg4
Ni9wMm0uaCBiL3hlbi9pbmNsdWRlL2FzbS14ODYvcDJtLmgKaW5kZXggYzdmNTcxMC4uYmU1Yjdh
MiAxMDA2NDQKLS0tIGEveGVuL2luY2x1ZGUvYXNtLXg4Ni9wMm0uaAorKysgYi94ZW4vaW5jbHVk
ZS9hc20teDg2L3AybS5oCkBAIC02MzAsOSArNjMwLDYgQEAgaW50IHAybV9maW5pc2hfdHlwZV9j
aGFuZ2Uoc3RydWN0IGRvbWFpbiAqZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdmbl90
IGZpcnN0X2dmbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgbWF4
X25yKTsKIAotLyogUmVwb3J0IGEgY2hhbmdlIGFmZmVjdGluZyBtZW1vcnkgdHlwZXMuICovCi12
b2lkIHAybV9tZW1vcnlfdHlwZV9jaGFuZ2VkKHN0cnVjdCBkb21haW4gKmQpOwotCiBpbnQgcDJt
X2lzX2xvZ2RpcnR5X3JhbmdlKHN0cnVjdCBwMm1fZG9tYWluICosIHVuc2lnbmVkIGxvbmcgc3Rh
cnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgZW5kKTsKIApAQCAt
NjYzLDYgKzY2MCw5IEBAIHZvaWQgcDJtX3BvZF9kdW1wX2RhdGEoc3RydWN0IGRvbWFpbiAqZCk7
CiAKICNpZmRlZiBDT05GSUdfSFZNCiAKKy8qIFJlcG9ydCBhIGNoYW5nZSBhZmZlY3RpbmcgbWVt
b3J5IHR5cGVzLiAqLwordm9pZCBwMm1fbWVtb3J5X3R5cGVfY2hhbmdlZChzdHJ1Y3QgZG9tYWlu
ICpkKTsKKwogLyogQ2FsbGVkIGJ5IHAybSBjb2RlIHdoZW4gZGVtYW5kLXBvcHVsYXRpbmcgYSBQ
b0QgcGFnZSAqLwogYm9vbAogcDJtX3BvZF9kZW1hbmRfcG9wdWxhdGUoc3RydWN0IHAybV9kb21h
aW4gKnAybSwgZ2ZuX3QgZ2ZuLCB1bnNpZ25lZCBpbnQgb3JkZXIpOwotLSAKMi43LjQKCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwgbWFp
bGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3RzLnhl
bnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs
