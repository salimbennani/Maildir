Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 22 Nov 2018 22:26:54 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga006.jf.intel.com (orsmga006.jf.intel.com [10.7.209.51])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id F354C58037D;
	Thu, 22 Nov 2018 05:44:34 -0800 (PST)
Received: from fmsmga101.fm.intel.com ([10.1.193.65])
  by orsmga006-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 05:44:34 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3A742RRRQyxw59OfqfRMRCwplN6tpsv+yvbD5Q0YIu?=
 =?us-ascii?q?jvd0So/mwa64YhOOt8tkgFKBZ4jH8fUM07OQ7/iwHzRYqb+681k6OKRWUBEEjc?=
 =?us-ascii?q?hE1ycBO+WiTXPBEfjxciYhF95DXlI2t1uyMExSBdqsLwaK+i764jEdAAjwOhRo?=
 =?us-ascii?q?LerpBIHSk9631+ev8JHPfglEnjWwba9xIRmssQndqtQdjJd/JKo21hbHuGZDdf?=
 =?us-ascii?q?5MxWNvK1KTnhL86dm18ZV+7SleuO8v+tBZX6nicKs2UbJXDDI9M2Ao/8LrrgXM?=
 =?us-ascii?q?TRGO5nQHTGoblAdDDhXf4xH7WpfxtTb6tvZ41SKHM8D6Uaw4VDK/5KpwVhTmlD?=
 =?us-ascii?q?kIOCI48GHPi8x/kqRboA66pxdix4LYeZyZOOZicq/Ye94VQndPXttKVyxZHIyz?=
 =?us-ascii?q?c5cPAeQGPeZdtYb9pl0Opga6CQSjAO7jzzlFiXj406A1z+gsERjK0BAiEt4Xrn?=
 =?us-ascii?q?rbss/1P7oWXe270KXE0TDPYvVU1zjn7YjGcA4uruuRUr1ua8rfyUgvGB3BjlqN?=
 =?us-ascii?q?tIfrPS2a2f4QvGeF9eprSP+hhHIgqwFrozivwMgsgZTNio4M11zI6SB1zYAoLt?=
 =?us-ascii?q?O6VUF7e8apH5Rety6YN4V4TMAsTXx2tikm0b0GoZy2cTMWyJg73RPTd+CLf5SK?=
 =?us-ascii?q?7x/lSe2fIS14hHVgeL+nhhmy8E6gwfD6WMmz1lZKoTdOn97ItnAQyxPT69aISv?=
 =?us-ascii?q?1n8kau2DaP0Rve6u5BIU8ulKrbL4QtzaI3lpoWqEnOGDL9lkvxjK+TbEok++6o?=
 =?us-ascii?q?5vz8bbr8vZ+TKZV4ihr9Mqg2lcy/BuM4PhIBX2if4eizzqXj/VXiQLVSif02jr?=
 =?us-ascii?q?PVv4zdJcQeoKOyHgxb0p475hqhEzur1M4UkWQJIV5bYh6LkovkN03ULP35D/qz?=
 =?us-ascii?q?m0qgnCtvyvzcPbDsAo/BImXCnbrgZ7px9kpRxQo1wNtC/ZxbEKsBL+j2WkLptN?=
 =?us-ascii?q?zXEBs5Mwuszub5B9VyyJkeVXiMAqCHKqPSt0GH5uY1L+mLfo8Vty7xK/kj5/Hw?=
 =?us-ascii?q?kX80gUERcbWt0JcNdXy1EOpqL1+EbXfvntsNC2YHswgmQOzvklKCUDpTZ3ioX6?=
 =?us-ascii?q?I74zE2EIamDYbFRoCwj72NxSS7EYNMZmBAFF+MFW7kd4KKWvcKdi2SONRskiIL?=
 =?us-ascii?q?Vbe/UY8tzxKuuxHgy7phMOXU/jcUtZX51Nh6/+HTjw099SRoD8SB1GGAV2V0nm?=
 =?us-ascii?q?ILRzAoxqx+rlF9x0yH0ah5hfxYCNNS6+lIUgc8KZ7T0eh6B8ruVQLGe9eDUEym?=
 =?us-ascii?q?Tcm+ATEtUtIxxMcDY0ZnFNWjkhDMxS2qD6UVl7yWHpM09K3c0mP1J8Z8zXbGya?=
 =?us-ascii?q?Ygg0MnQstJKW2pmKp/+xLPCI7OlkWTj7yqergE3C7R6GeDynKDvENfUAFuS6nF?=
 =?us-ascii?q?XncfZk3QrdT+/U7CS76uCbI6MgpO08KCK61KasH3glVCXvvsJNPeY2epkWeqGR?=
 =?us-ascii?q?mI3q+MbJbte2gFxirdE0gEkwcQ/XqcLwgxHCWhrnnaDDxvE1Lvfkzt/fN/qHO9?=
 =?us-ascii?q?Uk870QWKY1d92Lqy/x4fneacRO8L3rIYpCchrC15HFWn0NLQEdaAowthc79aYd?=
 =?us-ascii?q?My+1pH0WPZtwpgPp2vNaxih1gecxhpsEPqzRl4FoJAkc0ypnMw0AVyMb6Y0E9G?=
 =?us-ascii?q?dz6AwJ//IKPXJXfo8BCvcaHW3Ere38iQ+qsI7PQ4qFDjvAWyG0om8nVn1cRV0n?=
 =?us-ascii?q?SG6pXLCgoSTYz+UkIt+xdmoLHaZzE355nI2n10Lam0rjjC1so0C+Q/1BavYc1T?=
 =?us-ascii?q?MKOeGw/0CM0VGc6uJfcum1ioaBIEIe9T+LQ1P8Oga/uJxqqrMPx8kzKhiGRN+J?=
 =?us-ascii?q?p93V6U9ypgVu7I2I4Iw+2Z3guCUDf8kFehs8DtlYBYfz0SGXC/ySzlBI5Xaa1/?=
 =?us-ascii?q?ZoILCWaoI82qydRynZ/tW3hE9FG9A1MKwtOmeR2Xb1blxw1fyVwXoWC7mSu/1z?=
 =?us-ascii?q?F7iTUpobSQ3SPQw+XubgEIOnNWS2Z4i1fsIo+0j84BUUisbggpkgal5Engy6ha?=
 =?us-ascii?q?oqR/M3fcQUNScyfqKGFiV7O6tqCebM5X9JMorSJXXfy8YFCHULLyvwEW0iLjH2?=
 =?us-ascii?q?REwjA7eCqnupH4nxx8lWKcI2x/rHvfecFs2xjf4MbQSuJW3joDXCN4kyXYBkCg?=
 =?us-ascii?q?P9m1+tWZj43DsuGiWG27TJ1cbC7rwZmGtCSl/21qAASzkOypld3jDAc1zzX719?=
 =?us-ascii?q?5sVSjTqBb8Y4/r17m1MO59f0loAkP85NR+Go1kjoQwg5QQ02AAhpqJ5XoHjXvz?=
 =?us-ascii?q?MdJD1KP+bXoBXz4Kz8TO4Aj43k1uNXaJx4P/VnWAzcptfdi6YmUK2i0j68BGEr?=
 =?us-ascii?q?ub7LtBnSFtuFq3sRrRYeRhnjca0fYu6mQVg/sKuAouySWRGKsSElNbPSzvlhSI?=
 =?us-ascii?q?6c6xrKNMaWarcLiw0ld+nN+7ALGDpAFcRGj2epM4ESBs6cV/NUrG0Gfv5YH8ZN?=
 =?us-ascii?q?nQcdUTuwWUkhjaiOhZMpAxlvsMhSd8PWL9vHsly/M0jBB03JG6upSHJHtp/K6j?=
 =?us-ascii?q?HhFYMTj1bdsJ+j7xlaZegtqW34e3E5ViADoLXYHkTfK1ED0Is/TnOB2DEDk9qn?=
 =?us-ascii?q?edBLreEhWT6EZgr3LTDZ+rM2ubK2UezdVnXBOdPlBQgBgIXDUmmZ40DgWqxM3i?=
 =?us-ascii?q?cEhj/DwQ6ED3qgBQyu12LRnwSXnQpB2najovTJifLRxW7hxN5kvPMMye6P5zED?=
 =?us-ascii?q?9c/pG7sAONLWmbbRxSDW4VQkyEG0zjPr626Nnc9OiYA/CyLvrUbrWItOxeTOyI?=
 =?us-ascii?q?xZO034ti/jaMMNiPP3Z4A/063EpDQW52G8DDlzoTTCwXkjrHb9SHqxek5i13ss?=
 =?us-ascii?q?e//ezwVw314ouPD6ZSPc9r+xCrmqqDM++QhCBkKTdXzJ8MxHnIyKQB014WkS1h?=
 =?us-ascii?q?az6tEbEYvy7XUK3QgrNXDwIcay5rNstH9ac80RdWOcLBltP5zL14juM2C1dYU1?=
 =?us-ascii?q?zugNqpaNcOI2G8MlPHGUmKOK6HJT3N38H4f6e8RadMg+VTsh26oSybHFP7PjSf?=
 =?us-ascii?q?iznpUAiiMOFLjCGGJRxepZuychB3BWj4S9LmbBK7PcRzjT03x700m3zLOXQdMT?=
 =?us-ascii?q?h6b0NCsLmQ4TlEjfV4HmxL9mBlIvWcmyaF8+nYLY4bsft1DSR1lOJa43U6x6FW?=
 =?us-ascii?q?7CFeQ/x1lzXdrsRzo1G9ieSPzjtnUBxTqjdEno6LvENiObnH+ZlEQ3rL4BUN7W?=
 =?us-ascii?q?CIARQQu9RlEsHvu7xXytXXjq3zNSxN88jK8socHcTULMOHPWElMRroHj7UEQQE?=
 =?us-ascii?q?QSSqNWHZm0xSjvWS+meJoZg9r5jmgIAORaNDVFwpCvMaDVxoHMADIJdyRD8rja?=
 =?us-ascii?q?SXg9II5XWgqhncX8FavpHBVvKPDvTjMjeZjb9YZxQWxbP0N5gcNor+20Z6cFl1?=
 =?us-ascii?q?gJzKG1bMXdBKuiBgbhU7oENI8Hh/SG08w0PkagO3738VGv65hRo2igp4YeQw+z?=
 =?us-ascii?q?bg+VY3JlzWpCQulEk9g8nqgTeUcG25EKDleIhMACfwsAALM5jyWQpyJSm/nFBi?=
 =?us-ascii?q?OS2ME7dYlbBtcWctjALdpZ1CA9ZTSKRFZFkbwvTBNNsy1lEJmiShjWtA4+SNXZ?=
 =?us-ascii?q?9/nwond9i8rnRo1AdqbdpzLqvVcvkahmNMj76D63b7nts6xxUTchxWoW4=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AUAABVsvZbh0O0hNFiEwEBBgEBAQEDA?=
 =?us-ascii?q?QEBBwMBAQGBUQYBAQELAYJpgQIUE4N4g3uEHYwBgg0UlyaBJANPKQsIAYhRIjQ?=
 =?us-ascii?q?JDQEDAQEBAQEBAgETAQEBCA0JCCkjDIJCAQQBAQUDAwEBBwGCXgEBAQECAQECI?=
 =?us-ascii?q?AQZARsdAQMBAQkBAQUFCw0CAiYCAgMeAQERAQUBHAYTBYMcAYFoAQMNCAUKniE?=
 =?us-ascii?q?8iw18FgUBF4J3BYQ7ChknDVqBNwIBBRJ5in6CFoERgxKCVkUCAhiES4JXAoh/g?=
 =?us-ascii?q?hKECHaPRS4HAoZ8hwiDKxiBWYULBYMehwEsjReBColUMIElbIEhTSOBAYI7H4F?=
 =?us-ascii?q?8CQMXg0qBaIh5MDMBFwEBawEBjSkBAQ?=
X-IPAS-Result: =?us-ascii?q?A0AUAABVsvZbh0O0hNFiEwEBBgEBAQEDAQEBBwMBAQGBUQY?=
 =?us-ascii?q?BAQELAYJpgQIUE4N4g3uEHYwBgg0UlyaBJANPKQsIAYhRIjQJDQEDAQEBAQEBA?=
 =?us-ascii?q?gETAQEBCA0JCCkjDIJCAQQBAQUDAwEBBwGCXgEBAQECAQECIAQZARsdAQMBAQk?=
 =?us-ascii?q?BAQUFCw0CAiYCAgMeAQERAQUBHAYTBYMcAYFoAQMNCAUKniE8iw18FgUBF4J3B?=
 =?us-ascii?q?YQ7ChknDVqBNwIBBRJ5in6CFoERgxKCVkUCAhiES4JXAoh/ghKECHaPRS4HAoZ?=
 =?us-ascii?q?8hwiDKxiBWYULBYMehwEsjReBColUMIElbIEhTSOBAYI7H4F8CQMXg0qBaIh5M?=
 =?us-ascii?q?DMBFwEBawEBjSkBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,265,1539673200"; 
   d="scan'208";a="63577865"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mga01b.intel.com with ESMTP; 22 Nov 2018 05:44:32 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2437033AbeKWAXy (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Thu, 22 Nov 2018 19:23:54 -0500
Received: from mail-it1-f195.google.com ([209.85.166.195]:52633 "EHLO
        mail-it1-f195.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2437016AbeKWAXx (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 22 Nov 2018 19:23:53 -0500
Received: by mail-it1-f195.google.com with SMTP id i7so14196623iti.2;
        Thu, 22 Nov 2018 05:44:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc;
        bh=eQMLWI461iiGg49q4X7SbHaKdGX2QWoK9o2VFGvy2ZE=;
        b=k/8/jBUgpPhJCRoXiYSjeS9cIu/y8qFdlUIMo/F9PvTqeeB6NRKtmQFUcOa84U43qb
         HwF2DDgXb8hVjLZm2ZlT74Qsp0dXtLhIt1daa/mtsIImLYRCRpptW1S2v1M3Zy2AduV6
         k/klSVf5T44mkIc2Hu7/+6G+iegbkC7EzCWU2hFVbf6SrtVSeJJ72X3XBy8KPxlvfVO8
         ZuslzdR+rBbwu08FNMVmvnPpGIXYWgJaEfkBdGcSS120SJmgExpQkbn5Pz7y70TAKaEe
         CLPDEKVleFtOVVFmvL59smWt6L0oyNIR/ZXi9Z0AGQh0LX2MV7Aqv3jxdQ+vxyfILu2x
         HZTw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=eQMLWI461iiGg49q4X7SbHaKdGX2QWoK9o2VFGvy2ZE=;
        b=QyWtdMSqOW6zQYrEtOQbF+hUe3XLi8sKvJTCtsGRJkL41WkOIAWZTMBK9I6lcb0GmU
         4gvNgqAMfcm3zY6a4pQySKSaeK0aJtgj18Jx4hGacvf0jSNaqum415eKJndY7yuuGn4x
         ohHaWqRR9317OBlbakvRMjTlYvhTuQ1rOhmWXUEGbN8+uA7dF0D+Uc7kNLguf3/Q76Z8
         L0LyCIr/v528CwEjFtcuaT4g4hMyKaxo4+3Zy26FjFuvRN/RQiDisl62cugS9Ku0pXUr
         vR88l/xAfZmxVlaP3BTM6wCe44qHVLJtLt7QsmT+3goFItA91gDs79BnzUSfRziAolAG
         tW+Q==
X-Gm-Message-State: AGRZ1gL4KUGp4/8DK7ZGmZcHok9se91V764GUiVraCxpDSvfEuiwjKBz
        al/qBxXu0t0sL/u2dKDKW0auOGb6k46v/N5yWiQ=
X-Google-Smtp-Source: AJdET5fED3+1MpxoJkUU/1PxTTxLurjiNQrJG62SppiDlcEdUvQU5O++sIHMGlaEUjfsAsrd8v32Y09ljgoRa+FeZ8Y=
X-Received: by 2002:a02:788:: with SMTP id f130-v6mr9801292jaf.58.1542894267744;
 Thu, 22 Nov 2018 05:44:27 -0800 (PST)
MIME-Version: 1.0
References: <000000000000b98a67057ad7158a@google.com> <CADvbK_f3CpK=qJFngBGmO3VXFLsJm9=qqZVtxYOeBS8rwE=9Ew@mail.gmail.com>
 <20181122131344.GD31918@localhost.localdomain>
In-Reply-To: <20181122131344.GD31918@localhost.localdomain>
From: Xin Long <lucien.xin@gmail.com>
Date: Thu, 22 Nov 2018 22:44:16 +0900
Message-ID: <CADvbK_f0n64K==prdcM0KzU0S3pbo1oMW3HhE8zMngCUZp3-iQ@mail.gmail.com>
Subject: Re: KASAN: use-after-free Read in __lock_sock
To: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
Cc: syzbot+9276d76e83e3bcde6c99@syzkaller.appspotmail.com,
        davem <davem@davemloft.net>, LKML <linux-kernel@vger.kernel.org>,
        linux-sctp@vger.kernel.org, network dev <netdev@vger.kernel.org>,
        Neil Horman <nhorman@tuxdriver.com>,
        syzkaller-bugs@googlegroups.com,
        Vlad Yasevich <vyasevich@gmail.com>
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, Nov 22, 2018 at 10:13 PM Marcelo Ricardo Leitner
<marcelo.leitner@gmail.com> wrote:
>
> On Mon, Nov 19, 2018 at 05:57:33PM +0900, Xin Long wrote:
> > On Sat, Nov 17, 2018 at 4:18 PM syzbot
> > <syzbot+9276d76e83e3bcde6c99@syzkaller.appspotmail.com> wrote:
> > >
> > > Hello,
> > >
> > > syzbot found the following crash on:
> > >
> > > HEAD commit:    ccda4af0f4b9 Linux 4.20-rc2
> > > git tree:       upstream
> > > console output: https://syzkaller.appspot.com/x/log.txt?x=156cd533400000
> > > kernel config:  https://syzkaller.appspot.com/x/.config?x=4a0a89f12ca9b0f5
> > > dashboard link: https://syzkaller.appspot.com/bug?extid=9276d76e83e3bcde6c99
> > > compiler:       gcc (GCC) 8.0.1 20180413 (experimental)
> > >
> > > Unfortunately, I don't have any reproducer for this crash yet.
> > >
> > > IMPORTANT: if you fix the bug, please add the following tag to the commit:
> > > Reported-by: syzbot+9276d76e83e3bcde6c99@syzkaller.appspotmail.com
> > >
> > > netlink: 5 bytes leftover after parsing attributes in process
> > > `syz-executor5'.
> > > ==================================================================
> > > BUG: KASAN: use-after-free in __lock_acquire+0x36d9/0x4c20
> > > kernel/locking/lockdep.c:3218
> > > Read of size 8 at addr ffff8881d26d60e0 by task syz-executor1/13725
> > >
> > > CPU: 0 PID: 13725 Comm: syz-executor1 Not tainted 4.20.0-rc2+ #333
> > > Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS
> > > Google 01/01/2011
> > > Call Trace:
> > >   __dump_stack lib/dump_stack.c:77 [inline]
> > >   dump_stack+0x244/0x39d lib/dump_stack.c:113
> > >   print_address_description.cold.7+0x9/0x1ff mm/kasan/report.c:256
> > >   kasan_report_error mm/kasan/report.c:354 [inline]
> > >   kasan_report.cold.8+0x242/0x309 mm/kasan/report.c:412
> > >   __asan_report_load8_noabort+0x14/0x20 mm/kasan/report.c:433
> > >   __lock_acquire+0x36d9/0x4c20 kernel/locking/lockdep.c:3218
> > >   lock_acquire+0x1ed/0x520 kernel/locking/lockdep.c:3844
> > >   __raw_spin_lock_bh include/linux/spinlock_api_smp.h:135 [inline]
> > >   _raw_spin_lock_bh+0x31/0x40 kernel/locking/spinlock.c:168
> > >   spin_lock_bh include/linux/spinlock.h:334 [inline]
> > >   __lock_sock+0x203/0x350 net/core/sock.c:2253
> > >   lock_sock_nested+0xfe/0x120 net/core/sock.c:2774
> > >   lock_sock include/net/sock.h:1492 [inline]
> > >   sctp_sock_dump+0x122/0xb20 net/sctp/diag.c:324
> >
> > static int sctp_sock_dump(struct sctp_transport *tsp, void *p)
> > {
> >         struct sctp_endpoint *ep = tsp->asoc->ep;
> >         struct sctp_comm_param *commp = p;
> >         struct sock *sk = ep->base.sk; <--- [1]
> > ...
> >         int err = 0;
> >
> >         lock_sock(sk);  <--- [2]
> >
> > Between [1] and [2], an asoc peeloff may happen, still thinking
> > how to avoid this.
>
> This race cannot happen more than once for an asoc, so something
> like this may be doable:
>
>         struct sctp_comm_param *commp = p;
>         struct sctp_endpoint *ep;
>         struct sock *sk;
> ...
>         int err = 0;
>
> again:
>         ep = tsp->asoc->ep;
>         sk = ep->base.sk; <---[3]
>         lock_sock(sk);  <--- [2]
if peel-off happens between [3] and [2], and sk is freed
somewhere, it will panic on [2] when trying to get the
sk->lock, no?

>         if (sk != tsp->asoc->ep->base.sk) {
>                 /* Asoc was peeloff'd */
>                 unlock_sock(sk);
>                 goto again;
>         }
>
> Similarly to what we did on cea0cc80a677 ("sctp: use the right sk
> after waking up from wait_buf sleep").
>
> >
> >
> >
> > >   sctp_for_each_transport+0x2b5/0x370 net/sctp/socket.c:5091
> > >   sctp_diag_dump+0x3ac/0x660 net/sctp/diag.c:527
> > >   __inet_diag_dump+0xa8/0x140 net/ipv4/inet_diag.c:1049
> > >   inet_diag_dump+0x9b/0x110 net/ipv4/inet_diag.c:1065
> > >   netlink_dump+0x606/0x1080 net/netlink/af_netlink.c:2244
> > >   __netlink_dump_start+0x59a/0x7c0 net/netlink/af_netlink.c:2352
> > >   netlink_dump_start include/linux/netlink.h:216 [inline]
> > >   inet_diag_handler_cmd+0x2ce/0x3f0 net/ipv4/inet_diag.c:1170
> > >   __sock_diag_cmd net/core/sock_diag.c:232 [inline]
> > >   sock_diag_rcv_msg+0x31d/0x410 net/core/sock_diag.c:263
> > >   netlink_rcv_skb+0x172/0x440 net/netlink/af_netlink.c:2477
> > >   sock_diag_rcv+0x2a/0x40 net/core/sock_diag.c:274
> > >   netlink_unicast_kernel net/netlink/af_netlink.c:1310 [inline]
> > >   netlink_unicast+0x5a5/0x760 net/netlink/af_netlink.c:1336
> > >   netlink_sendmsg+0xa18/0xfc0 net/netlink/af_netlink.c:1917
> > >   sock_sendmsg_nosec net/socket.c:621 [inline]
> > >   sock_sendmsg+0xd5/0x120 net/socket.c:631
> > >   sock_write_iter+0x35e/0x5c0 net/socket.c:900
> > >   call_write_iter include/linux/fs.h:1857 [inline]
> > >   do_iter_readv_writev+0x8b0/0xa80 fs/read_write.c:680
> > >   do_iter_write+0x185/0x5f0 fs/read_write.c:959
> > >   vfs_writev+0x1f1/0x360 fs/read_write.c:1004
> > >   do_writev+0x11a/0x310 fs/read_write.c:1039
> > >   __do_sys_writev fs/read_write.c:1112 [inline]
> > >   __se_sys_writev fs/read_write.c:1109 [inline]
> > >   __x64_sys_writev+0x75/0xb0 fs/read_write.c:1109
> > >   do_syscall_64+0x1b9/0x820 arch/x86/entry/common.c:290
> > >   entry_SYSCALL_64_after_hwframe+0x49/0xbe
> > > RIP: 0033:0x457569
> > > Code: fd b3 fb ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 90 48 89 f8 48 89 f7
> > > 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff
> > > ff 0f 83 cb b3 fb ff c3 66 2e 0f 1f 84 00 00 00 00
> > > RSP: 002b:00007f2cdabbac78 EFLAGS: 00000246 ORIG_RAX: 0000000000000014
> > > RAX: ffffffffffffffda RBX: 0000000000000003 RCX: 0000000000457569
> > > RDX: 0000000000000001 RSI: 000000002051c000 RDI: 000000000000000e
> > > RBP: 000000000072c0e0 R08: 0000000000000000 R09: 0000000000000000
> > > R10: 0000000000000000 R11: 0000000000000246 R12: 00007f2cdabbb6d4
> > > R13: 00000000004c33b1 R14: 00000000004d97c8 R15: 00000000ffffffff
> > >
> > > Allocated by task 13672:
> > >   save_stack+0x43/0xd0 mm/kasan/kasan.c:448
> > >   set_track mm/kasan/kasan.c:460 [inline]
> > >   kasan_kmalloc+0xc7/0xe0 mm/kasan/kasan.c:553
> > >   kasan_slab_alloc+0x12/0x20 mm/kasan/kasan.c:490
> > >   kmem_cache_alloc+0x12e/0x730 mm/slab.c:3554
> > >   sk_prot_alloc+0x69/0x2e0 net/core/sock.c:1463
> > >   sk_alloc+0x10d/0x1690 net/core/sock.c:1523
> > >   inet_create+0x509/0x1070 net/ipv4/af_inet.c:321
> > >   __sock_create+0x536/0x930 net/socket.c:1277
> > >   sock_create net/socket.c:1317 [inline]
> > >   __sys_socket+0x106/0x260 net/socket.c:1347
> > >   __do_sys_socket net/socket.c:1356 [inline]
> > >   __se_sys_socket net/socket.c:1354 [inline]
> > >   __x64_sys_socket+0x73/0xb0 net/socket.c:1354
> > >   do_syscall_64+0x1b9/0x820 arch/x86/entry/common.c:290
> > >   entry_SYSCALL_64_after_hwframe+0x49/0xbe
> > >
> > > Freed by task 13680:
> > >   save_stack+0x43/0xd0 mm/kasan/kasan.c:448
> > >   set_track mm/kasan/kasan.c:460 [inline]
> > >   __kasan_slab_free+0x102/0x150 mm/kasan/kasan.c:521
> > >   kasan_slab_free+0xe/0x10 mm/kasan/kasan.c:528
> > >   __cache_free mm/slab.c:3498 [inline]
> > >   kmem_cache_free+0x83/0x290 mm/slab.c:3760
> > >   sk_prot_free net/core/sock.c:1504 [inline]
> > >   __sk_destruct+0x728/0xa80 net/core/sock.c:1588
> > >   sk_destruct+0x78/0x90 net/core/sock.c:1596
> > >   __sk_free+0xcf/0x300 net/core/sock.c:1607
> > >   sk_free+0x42/0x50 net/core/sock.c:1618
> > >   sock_put include/net/sock.h:1693 [inline]
> > >   sctp_close+0x8d4/0xad0 net/sctp/socket.c:1569
> > >   inet_release+0x104/0x1f0 net/ipv4/af_inet.c:428
> > >   __sock_release+0xd7/0x250 net/socket.c:579
> > >   sock_close+0x19/0x20 net/socket.c:1141
> > >   __fput+0x385/0xa30 fs/file_table.c:278
> > >   ____fput+0x15/0x20 fs/file_table.c:309
> > >   task_work_run+0x1e8/0x2a0 kernel/task_work.c:113
> > >   get_signal+0x1558/0x1980 kernel/signal.c:2347
> > >   do_signal+0x9c/0x21c0 arch/x86/kernel/signal.c:816
> > >   exit_to_usermode_loop+0x2e5/0x380 arch/x86/entry/common.c:162
> > >   prepare_exit_to_usermode arch/x86/entry/common.c:197 [inline]
> > >   syscall_return_slowpath arch/x86/entry/common.c:268 [inline]
> > >   do_syscall_64+0x6be/0x820 arch/x86/entry/common.c:293
> > >   entry_SYSCALL_64_after_hwframe+0x49/0xbe
> > >
> > > The buggy address belongs to the object at ffff8881d26d6040
> > >   which belongs to the cache SCTP(33:syz1) of size 1776
> > > The buggy address is located 160 bytes inside of
> > >   1776-byte region [ffff8881d26d6040, ffff8881d26d6730)
> > > The buggy address belongs to the page:
> > > page:ffffea000749b580 count:1 mapcount:0 mapping:ffff8881b517f200 index:0x0
> > > flags: 0x2fffc0000000200(slab)
> > > raw: 02fffc0000000200 ffff8881c6685748 ffffea0007538388 ffff8881b517f200
> > > raw: 0000000000000000 ffff8881d26d6040 0000000100000002 ffff8881b6b4e7c0
> > > page dumped because: kasan: bad access detected
> > > page->mem_cgroup:ffff8881b6b4e7c0
> > >
> > > Memory state around the buggy address:
> > >   ffff8881d26d5f80: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
> > >   ffff8881d26d6000: fc fc fc fc fc fc fc fc fb fb fb fb fb fb fb fb
> > > > ffff8881d26d6080: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
> > >                                                         ^
> > >   ffff8881d26d6100: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
> > >   ffff8881d26d6180: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
> > > ==================================================================
> > >
> > >
> > > ---
> > > This bug is generated by a bot. It may contain errors.
> > > See https://goo.gl/tpsmEJ for more information about syzbot.
> > > syzbot engineers can be reached at syzkaller@googlegroups.com.
> > >
> > > syzbot will keep track of this bug report. See:
> > > https://goo.gl/tpsmEJ#bug-status-tracking for how to communicate with
> > > syzbot.
