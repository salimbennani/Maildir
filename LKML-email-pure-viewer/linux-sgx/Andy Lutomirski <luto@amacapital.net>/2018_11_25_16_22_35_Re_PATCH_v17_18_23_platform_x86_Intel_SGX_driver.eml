Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 26 Nov 2018 08:51:06 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga007.fm.intel.com (fmsmga007.fm.intel.com [10.253.24.52])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 5B0795802E4;
	Sun, 25 Nov 2018 08:28:42 -0800 (PST)
Received: from fmsmga105.fm.intel.com ([10.1.193.10])
  by fmsmga007-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 25 Nov 2018 08:28:41 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AtkEU8xxfT7swfxDXCy+O+j09IxM/srCxBDY+r6Qd?=
 =?us-ascii?q?0e8UIvad9pjvdHbS+e9qxAeQG9mDu7Qc06L/iOPJYSQ4+5GPsXQPItRndiQuro?=
 =?us-ascii?q?EopTEmG9OPEkbhLfTnPGQQFcVGU0J5rTngaRAGUMnxaEfPrXKs8DUcBgvwNRZv?=
 =?us-ascii?q?JuTyB4Xek9m72/q99pHPYAhEniaxba9vJxiqsAvdsdUbj5F/Iagr0BvJpXVIe+?=
 =?us-ascii?q?VSxWx2IF+Yggjx6MSt8pN96ipco/0u+dJOXqX8ZKQ4UKdXDC86PGAv5c3krgfM?=
 =?us-ascii?q?QA2S7XYBSGoWkx5IAw/Y7BHmW5r6ryX3uvZh1CScIMb7Vq4/Vyi84Kh3SR/okC?=
 =?us-ascii?q?YHOCA/8GHLkcx7kaZXrAu8qxBj34LYZYeYP+d8cKzAZ9MXXXZOUclMWSJBBY2z?=
 =?us-ascii?q?bYUBAeUCM+ZWsYf9vEMOoBmlCAmwHePvzyNEhn/q0aA41ekqDAHI3BYnH9ILqH?=
 =?us-ascii?q?nZsNP1O7oSUOuoyqfI0CnDb/RT2Tf88ojIaRMhofCRVr93dcrR1FUvFwTeg1qK?=
 =?us-ascii?q?rIzqJS+a2f4Vs2ia8+pvT+avh3Qhqw5vvjii38EhgZTKiIIN0l3I6zl1zYIvKd?=
 =?us-ascii?q?GlRkN3f8SoHIZTui2GLYd7Q8EvT3l2tCs71rEKpJu2cSkFxZkmwhPQd+KLf5SU?=
 =?us-ascii?q?7h/mVuucLil0iXZgdb+8mxm961Wsx+j8W8S70VtHoS9In9bQuXAD1RHe79SIRe?=
 =?us-ascii?q?Vz80ql3zuEyhrd5fteIU8ukKrWM54hzaA0lpoUqUnDACD2l1vsjKOMdUUr5PKo?=
 =?us-ascii?q?6+L5bbXivJOcMJV0ig7mPqQvnMywH/g4PxAQU2SH/emwzqDv8EPnTLlQk/E7kb?=
 =?us-ascii?q?XVvIrbKMkZvqK5BhVa0ocn6xaxFTem19EYkGEDLFJEfhKHkofoN0jNIP/mF/e/?=
 =?us-ascii?q?hUqjkDNyy/DBMLzhBIvCLmLYnbf/crZy9VRcxBAwzd9B/ZJUDK8OIPbpVk/2rt?=
 =?us-ascii?q?zYAQc1MxaozOb/FNV9yoQeVHqLAq+YM6Pdr0WE5+0yI+SXYI8VuTD9K+Uq5vL0?=
 =?us-ascii?q?jH85n0Mdcret3ZcNdH+4GfFmKV2DYXXwmtcBDXsKvg0mQezqklKCUCJTaGy1X6?=
 =?us-ascii?q?4m5jE7FZipDYHMRo22hLyB3SG7HoBZZ2xcC1CMF2voeJuAW/sWdC2SJcphmCQe?=
 =?us-ascii?q?Vbe9U48hyQ2utAjixrplKerb5DcUtZHk1Nhz4e3Tkgo/9Th1D8SbzmGMQHt4nm?=
 =?us-ascii?q?IORz8qwq9/pVZxxUuE0ah9m/ZYD8Bc5+tVUgcmMp7R1/Z1C8vyWgLGfdeFUkym?=
 =?us-ascii?q?Tc+kATwqStIxwtkOY1tyGtm4jxDD2TaqDKERl7CRGJM09afc1WDrJ8lh03bGyL?=
 =?us-ascii?q?Uhj14+T8tML2KmgLRz9wzSB4HTlUWZmL2ndaAd3C7L6WeCwnCCvEBeUA5sT6rF?=
 =?us-ascii?q?WWoTaVfRrdT8/knCVaOhCaw7Mgtdzs6PMrZFZcf3jVpYXvvjOM7RY2Sqm2iuAx?=
 =?us-ascii?q?aEwbeMbInve2UZxyjdDEkEkwYO/XeJLwQ+ByGho37AAzxqD17gf0Ts8exmonOh?=
 =?us-ascii?q?UkA01x2Kb1Fm17et5xEan+KcRO0J0rIEoighrS50E0i739/ND9qApgxhfLhTYN?=
 =?us-ascii?q?8n4VdH037ZuBJ5PpC6M69igVseeRxtv0zyzxV3FplAkc8yoXM2zQpyLKWY0E9B?=
 =?us-ascii?q?dzKYx5zwJqfbKm7o/BCraq7W3F7e3c2S+qcO7vQ4tlrisBuoFkok73Vozd1V32?=
 =?us-ascii?q?GA6ZXNCQoYSYjxXVov9xhmu7HaZTEw6JnQ1XJyPqi7rD/D18gyC+s41xmvZdFf?=
 =?us-ascii?q?MKCDFA/sCMAaA8muKOo3m1mmdB4EPeZS9LIqMMOibfeJxKmrPON4ljK8kWtH+J?=
 =?us-ascii?q?x90l6L9ydkSu/IwowJzO2C0gqGVzfzllGhss/slIBAZDESGHe/yCf+CI5QYK1y?=
 =?us-ascii?q?YZgECWO0L8KrwdV+gobnW2RE+167G1MGxMipdAKIb1z8wQJfz14XrmGgmSeiyT?=
 =?us-ascii?q?x7jSsprquG0CPS2evicAcINXBRRGlli1fhOoy0j9EcXEi1YAkljhql5UDmx6dF?=
 =?us-ascii?q?oKRzNXXcQUBNfyLuNWFtTrOwtqaeY85I8J4psSRXXP68YFyAUb79vh0a3jjnH2?=
 =?us-ascii?q?tfwjA7aj6rto/4nxx8lGKSMnJzoGDFdsF3wBfV/MbcSuJJ3joaWCl4jiHaBlqm?=
 =?us-ascii?q?MNmz/tWUlJDDvvqlV227VZ1TcijrzYWeuyu9/mBqBRy/n/aumtzoCwQ60Cn718?=
 =?us-ascii?q?V0WiXMthrzfo7r16GiO+J9YkZoHEP869Z9Goxmkoo/npYQ1WIYhpWU+3oKimPz?=
 =?us-ascii?q?MdRd2aLjY3sBXz8Lw9jJ4Af73E1vNG6Gx4X8Vn+F2Mtue8G6Yn8K2iI6981KC7?=
 =?us-ascii?q?2b7L1ekSt1v1q3twTRYfdmkzcZyPsu7mMagu4TtAosyCWdHq4dHU1CMSPwkBSI?=
 =?us-ascii?q?6si0rL9La2a3bbiwyE1+kMikDLGDoQFTQmz1e5k8Ei9r8sVwLkjM32bt5YH+d9?=
 =?us-ascii?q?nddtYTthySkxfdgOlZMpMxlvwWhSV5PWLxp2Eqy+k+jRZ2x5G1oJCHK3lx/KK+?=
 =?us-ascii?q?GhNYKjr1Z8YJ9jDsl6lemNuW35u0HpVgATgLWJroTfS1EDMdr/jnNgCOECEipX?=
 =?us-ascii?q?efA7bQAQif6EJ+pXLVD5+rL22XJGUezdh6XxaSPktfgAQJXDkgmp45CxunxMjg?=
 =?us-ascii?q?cEd/+zAQ6UT0qhpKyuJ0KRb/Vn3TqxuvajcxUJKfNgZZ7hle50fJNsyT9uBzED?=
 =?us-ascii?q?td/pK/twyBMHCbax5LDWEUWUyEGlbjMaO15dTb9+iYB+y+L+bBYLmUqOxeUeuI?=
 =?us-ascii?q?yoyr0od84zmMMcCPNGF4D/InwkpDQWx5G8PBljQPTCwXijvNb9OBqxe64CF3tc?=
 =?us-ascii?q?e/8PLkWA/04YuPCr1SMchg+hysgKeDMfKQizh9KTpCypwMwnrIwqAF3FEOkyFu?=
 =?us-ascii?q?ayWtEbMYuC7NUq3Qm6xXDx0aay9pN8tI9aU83gZTNs7Bl9P1zaV1jvo0C1dDSF?=
 =?us-ascii?q?zgldulZc0MI2GhKlzHAFyHO6iBJT3O28v3e7+zSaVMjOVIsB29oSyUE1L4MTSZ?=
 =?us-ascii?q?iTboVwqjMeVNjCyAOBxeuYe9cgtiCGT5TdLmbAG7P8FzjTEs3bI0gXbKP3YGMT?=
 =?us-ascii?q?dga0NNsqGQ7SRAj/VjGmxB62BpIvWelymF7+nXNJAWvOBvAiR1keJa/Xs7x6FU?=
 =?us-ascii?q?7CFCWPx6hi/SosRyrFGhl+mF0iBnXwZWqjZXmIKLul1vOKXD+ZlGXHbE/RQN4n?=
 =?us-ascii?q?2RChQKvdRlDNLvtrtUytjOkqLzNThD/8jV/csaG8jbNsaHPGA9PhruHT6HRDcC?=
 =?us-ascii?q?GByiL2LcgARmmfKR93uYqNBuqJH2m5kJDKRSV180EP4cIkBkGsESZpZxQj4g17?=
 =?us-ascii?q?WciZhby2C5qUz4QslL9rTaSvWXAO/0KzfR2b1ZexwgyLbxJo0LN5Hy3wpkZ0Us?=
 =?us-ascii?q?z9eCIFbZQd0Y+n4pVQQzukgYtSEmFmA=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0CeAQBrzfpbh0O0hNFYChwBAQEEAQEHB?=
 =?us-ascii?q?AEBgWUCgS+COyeDeZQXUAEBBoE1FIkGjjaBEANKFAEBGBMBgUuCdYQaIjgSAQM?=
 =?us-ascii?q?BAQEBAQECARMBAQEIDQkIKSMMQgEOAYFkJAGCYQEBAQECAQECIB0BATcBBQkBA?=
 =?us-ascii?q?QoYAgImAgIDMQEFARwGEwWDHIF1BQgBBJo1PIodcIEvgnYBAQWHEwgSeYksgVI?=
 =?us-ascii?q?XeIEHgTgfgkyESwgrgwQxgiaLE4R/jx1VCZFHiVGHN5UuglsCBAIEBQIFDyGBP?=
 =?us-ascii?q?IEFcXsKZQGCQT6BXYNtinMfMgGBBAEBIYIZig8BAQ?=
X-IPAS-Result: =?us-ascii?q?A0CeAQBrzfpbh0O0hNFYChwBAQEEAQEHBAEBgWUCgS+COye?=
 =?us-ascii?q?DeZQXUAEBBoE1FIkGjjaBEANKFAEBGBMBgUuCdYQaIjgSAQMBAQEBAQECARMBA?=
 =?us-ascii?q?QEIDQkIKSMMQgEOAYFkJAGCYQEBAQECAQECIB0BATcBBQkBAQoYAgImAgIDMQE?=
 =?us-ascii?q?FARwGEwWDHIF1BQgBBJo1PIodcIEvgnYBAQWHEwgSeYksgVIXeIEHgTgfgkyES?=
 =?us-ascii?q?wgrgwQxgiaLE4R/jx1VCZFHiVGHN5UuglsCBAIEBQIFDyGBPIEFcXsKZQGCQT6?=
 =?us-ascii?q?BXYNtinMfMgGBBAEBIYIZig8BAQ?=
X-IronPort-AV: E=Sophos;i="5.56,278,1539673200"; 
   d="scan'208";a="139463558"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 25 Nov 2018 08:28:40 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726644AbeKZDOC (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sun, 25 Nov 2018 22:14:02 -0500
Received: from mail-pf1-f193.google.com ([209.85.210.193]:36972 "EHLO
        mail-pf1-f193.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726395AbeKZDOC (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 25 Nov 2018 22:14:02 -0500
Received: by mail-pf1-f193.google.com with SMTP id u3-v6so5377898pfm.4
        for <linux-kernel@vger.kernel.org>; Sun, 25 Nov 2018 08:22:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=amacapital-net.20150623.gappssmtp.com; s=20150623;
        h=mime-version:subject:from:in-reply-to:date:cc
         :content-transfer-encoding:message-id:references:to;
        bh=m0PVqkjcw+12u0+KUpFGsrTYmf3DdzTqCQWVqScVdZ8=;
        b=DxNiQADuf2HNQWqalXSE0mcE9H0HM+fIkUChnNmyIDBS9oV75M2b5hsJ4yjhZvKxuV
         ihRRte0gMRWjvYtsTn3u86K1CM6ivHJhTdhMxR8lL0nt2HEnDT+e/3RSrqT0yygv9LlM
         s8CfmwRBj4m48/pWBWZ+7/madFdLU0GfajBmExXRL6C6dnd7v13bc59jsd4T7+MZOA5R
         HBHbMF/k0QewuoNy03Svo+MnAcPfi0YDnoCwiImsYYEOOYrzUkOy7/Xpcqt15m47jJWq
         +SAaZ2wfPXwoGDREm9LTWROEMmwAQp93Y2/IuWUhBIqx7nKd4wx8kHhb7w+lIy1wAjD6
         l+qQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:subject:from:in-reply-to:date:cc
         :content-transfer-encoding:message-id:references:to;
        bh=m0PVqkjcw+12u0+KUpFGsrTYmf3DdzTqCQWVqScVdZ8=;
        b=X4W1q0BBvOt8FeqMIGELG8Jv+lqu2fqmukD8c0ptFNidR9cTfK8/3gJY8rMFXJkPbp
         6L7xa3n+FzYE+MnvMNVFKjy+dXp59k9D0Or84Hf2JxKWJ3JDn7X8qvGapsXYMSAwXqRT
         8g5ORHs79DLbd5pYVlK1UkrsRg94TKC49DGpd+CWu1OfV/TuijRlyO4nQy4cJJKhmjF1
         Ke2sphP3rs5v/7AmLOHJ4EcWvpIXCw/lFP8jFhnv6f23BqGHTbsSUgO9e6Ey4FhOyXh4
         AESAYPFzJk3ZRzo2lYH59jy0xdGvsouRDheAL6JWyYMs3IqX7qdFtXTWlvyTx1N2ZXCA
         lLCA==
X-Gm-Message-State: AA+aEWa1KTk487ucgV2asnM/ZZObbRuaoFpzP0wTpMw3HwTAzJkRz3tr
        n97tGhUlkmQFYmPzf/dgcJGdGg==
X-Google-Smtp-Source: AFSGD/WCYkcZcixKUId1uJd0uSrDIXxkJ+WE+KP2ENCvsIj9te9dAhpkGOjjzHVQL21y/OR+9SPlSg==
X-Received: by 2002:a65:610d:: with SMTP id z13mr21763674pgu.427.1543162957002;
        Sun, 25 Nov 2018 08:22:37 -0800 (PST)
Received: from ?IPv6:2601:646:c200:7429:8ca1:5464:4cf7:ce39? ([2601:646:c200:7429:8ca1:5464:4cf7:ce39])
        by smtp.gmail.com with ESMTPSA id w80-v6sm93123672pfk.11.2018.11.25.08.22.35
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Sun, 25 Nov 2018 08:22:36 -0800 (PST)
Content-Type: text/plain;
        charset=utf-8
Mime-Version: 1.0 (1.0)
Subject: Re: [PATCH v17 18/23] platform/x86: Intel SGX driver
From: Andy Lutomirski <luto@amacapital.net>
X-Mailer: iPhone Mail (16A404)
In-Reply-To: <20181125145329.GA5777@linux.intel.com>
Date: Sun, 25 Nov 2018 08:22:35 -0800
Cc: Andy Lutomirski <luto@kernel.org>,
        "Dr. Greg Wettstein" <greg@enjellic.com>, X86 ML <x86@kernel.org>,
        Platform Driver <platform-driver-x86@vger.kernel.org>,
        linux-sgx@vger.kernel.org, Dave Hansen <dave.hansen@intel.com>,
        "Christopherson, Sean J" <sean.j.christopherson@intel.com>,
        nhorman@redhat.com, npmccallum@redhat.com,
        "Ayoun, Serge" <serge.ayoun@intel.com>, shay.katz-zamir@intel.com,
        haitao.huang@linux.intel.com,
        Andy Shevchenko <andriy.shevchenko@linux.intel.com>,
        Thomas Gleixner <tglx@linutronix.de>,
        "Svahn, Kai" <kai.svahn@intel.com>, mark.shanahan@intel.com,
        Suresh Siddha <suresh.b.siddha@intel.com>,
        Ingo Molnar <mingo@redhat.com>, Borislav Petkov <bp@alien8.de>,
        "H. Peter Anvin" <hpa@zytor.com>,
        Darren Hart <dvhart@infradead.org>,
        Andy Shevchenko <andy@infradead.org>,
        LKML <linux-kernel@vger.kernel.org>
Content-Transfer-Encoding: quoted-printable
Message-Id: <0669C300-02CB-4EA6-BF88-5C4B4DDAD4C7@amacapital.net>
References: <20181116010412.23967-1-jarkko.sakkinen@linux.intel.com> <20181116010412.23967-19-jarkko.sakkinen@linux.intel.com> <CALCETrXctxfED1Dr-MuZxFnh5gzTyRL06hRJ_fQnNA8p2S4xEQ@mail.gmail.com> <20181119161917.GF13298@linux.intel.com> <CALCETrX+A4XaEMq3fJqmHUeeDHr_BdWh-Wk3ikXfY=L77BbaGA@mail.gmail.com> <20181120120442.GA22172@linux.intel.com> <20181122111253.GA31150@wind.enjellic.com> <CALCETrWJr-C6yK8NBCp=NbapwHOaBFphiDU9VKEtQ0NMRrdC2g@mail.gmail.com> <20181124172114.GB32210@linux.intel.com> <20181125145329.GA5777@linux.intel.com>
To: Jarkko Sakkinen <jarkko.sakkinen@linux.intel.com>
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org


>> On Nov 25, 2018, at 6:53 AM, Jarkko Sakkinen <jarkko.sakkinen@linux.intel=
.com> wrote:
>>=20
>> On Sat, Nov 24, 2018 at 09:21:14AM -0800, Jarkko Sakkinen wrote:
>> On Thu, Nov 22, 2018 at 07:21:08AM -0800, Andy Lutomirski wrote:
>>>> At a high level, addressing these issues is straight forward.  First,
>>>> the driver needs to support authorization equivalent to that which is
>>>> implemented in the current Intel Launch Enclave, ie. control over the
>>>> SGX_FLAGS_PROVISION_KEY attribute.
>>>=20
>>> I agree, hence my email :)
>>=20
>> Started to scratch my head that is it really an issue that any enclave
>> can provision in the end?
>>=20
>> Direct quote from your first response:
>>=20
>> "In particular, the ability to run enclaves with the provisioning bit set=

>> is somewhat sensitive, since it effectively allows access to a stable
>> fingerprint of the system."
>>=20
>> As can be seen from the key derivation table this does not exactly hold
>> so you should refine your original argument before we can consider any
>> type of change.
>>=20
>> I just don't see what it is so wrong for any enclave to be able to tell
>> that it really is an enclave.
>=20
> I mean I can understand why Greg wants LE although I don't understand
> what benefit does it bring to anyone to lock in for enclave to allow
> to identify itself.
>=20
> What you are proposing does not really bring any additional security if
> we consider a threat model where the kernel is an adversary but it makes
> the software stack more clanky to use.

Agreed. What I=E2=80=99m proposing adds additional security if the kernel is=
 *not* compromised.

There are other ways to accomplish it that might be better in some respects.=
  For example, there could be /dev/sgx and /dev/sgx_rights/provision.  The f=
ormer exposes the whole sgx API, except that it doesn=E2=80=99t allow provis=
ioning by default. The latter does nothing by itself. To run a provisioning e=
nclave, you open both nodes, then do something like:

ioctl(sgx, SGX_IOC_ADD_RIGHT, sgx_provisioning);

This requires extra syscalls, but it doesn=E2=80=99t have the combinatorial e=
xplosion problem.=
