Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:32:18 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga001.fm.intel.com (fmsmga001.fm.intel.com [10.253.24.23])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 2B892580460;
	Thu, 22 Nov 2018 13:29:32 -0800 (PST)
Received: from fmsmga101.fm.intel.com ([10.1.193.65])
  by fmsmga001-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 13:29:31 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3ATF4NxxeOSpjlUqrZiRLt7gc+lGMj4u6mDksu8pMi?=
 =?us-ascii?q?zoh2WeGdxc6/YhyN2/xhgRfzUJnB7Loc0qyK6/CmATRIyK3CmUhKSIZLWR4BhJ?=
 =?us-ascii?q?detC0bK+nBN3fGKuX3ZTcxBsVIWQwt1Xi6NU9IBJS2PAWK8TW94jEIBxrwKxd+?=
 =?us-ascii?q?KPjrFY7OlcS30P2594HObwlSizexfbB/IA+qoQnNq8IbnZZsJqEtxxXTv3BGYf?=
 =?us-ascii?q?5WxWRmJVKSmxbz+MK994N9/ipTpvws6ddOXb31cKokQ7NYCi8mM30u683wqRbD?=
 =?us-ascii?q?VwqP6WACXWgQjxFFHhLK7BD+Xpf2ryv6qu9w0zSUMMHqUbw5Xymp4rx1QxH0li?=
 =?us-ascii?q?gIKz858HnWisNuiqJbvAmhrAF7z4LNfY2ZKOZycqbbcNgHR2ROQ9xRWjRODYOy?=
 =?us-ascii?q?bYQBD+QPM+VFoYfju1QOtgO+CAu3CePz1jNFnGP60bEm3+kjFwzNwQwuH8gJsH?=
 =?us-ascii?q?TRtNj7M70dUfqpzKnJyzXIcu5b2TPg6IjNbB8hp+qMXa5xccrXxkkvEx7Og1KV?=
 =?us-ascii?q?qYP/JTOVyuUNs26B4+V7UeKvlmsnpB93oji02scsi4/Jho0Ryl3f+iV5x4E1Jd?=
 =?us-ascii?q?K8SEFlZN6rCppQtyWAO4RqRcMiRnhltSAnwbMIvp67eTIFyJUhxxPHbPyIbpKI?=
 =?us-ascii?q?4hXiVOmMOzt3mHVleLenixaz90igxPf8WdOp31lUtCVKj8PAtncX1xzc7MWMV/?=
 =?us-ascii?q?hz/l+51DqRywze7vtILV06mKbFMZIt3709moYJvUnCHCL6gFv6gLOSe0k++eWl?=
 =?us-ascii?q?6/7rbqv7qpOALYN5iwDzP6IzkcKlG+s4KBIBX22D9OS8yrLj+Ur5Ta1Ujv05jK?=
 =?us-ascii?q?bZqorWJccFqa6jBQ9azIIj5wy4Dze839QUhXgHLFRbdxKbl4XlJU3CLfTiAfui?=
 =?us-ascii?q?jVmgji1ny+3FM7H9GJnAL3rOnK/kfbln6k5czAQzzcpY55JRErwBJPPzWknstN?=
 =?us-ascii?q?3XFxM5MBK7w/zhCNpj0oMSQGWPA6GfMKzMq1+F/fwvI+aSa48Pojr9KOYq5+To?=
 =?us-ascii?q?jXAnnV8RZ66p3YEYaHygBPRpP12ZYWbwgtcGCWoKugs+TO/0h1GYXj9Tem2/X6?=
 =?us-ascii?q?Y95jE9FYKnAp3PRoGrgLydwii7GodaaXxBClCJCX3obZmLW+8QaCKOJc9sijwE?=
 =?us-ascii?q?WqKgS489zx6usxX2y7p6LuXO/C0Yuonu1Nx05+3ViBEz+iZ4D8Wb02GRUW50mn?=
 =?us-ascii?q?kESCMx3KB6uUZ90EuM0bBkg/xEEtxe//FJUgAkOpLGzOx6DNbyWgTGftqSTFam?=
 =?us-ascii?q?Q9OmASw+T94rwt8OZVp9FMumjhzZwyWqBLoVnaSRBJMo6qLcw2TxJ8Flxnncz6?=
 =?us-ascii?q?khj14mQshVOW28nKF/9RPeB4rIk0Wfiqarer4Q3C/L9Gef02WOuFtUXxJ3UaXA?=
 =?us-ascii?q?RXoffFfZrczl5kPeSL+jEbcnPRFHycKYLqtKa8fmjVNJRPr4PNTeYmSxm3q/BB?=
 =?us-ascii?q?qSx7OMapbqdHsZ3CnHFEcElAUT926cNQciHiehv37eDDt2GF3yeUzs7/dxpGm7?=
 =?us-ascii?q?TkAuyQGKdFNu17yy9h4RhvycTvcT06kAuCcgrTV0AVm808jXC9qGuwpuYqFcbc?=
 =?us-ascii?q?kh71dA0GLTrxZ9MYC4L6B+ml4edBx6sF702BVpFIpMi8gqo2kszAppN62Y1khM?=
 =?us-ascii?q?dzeZ3ZD2J73WJXP+/BGpa67KxF7e1Mya9bsI6PQ9s1/jph2mFlI+83V71NlYy2?=
 =?us-ascii?q?ec5pTPDAoVTZLxUkY2+wJmp73AZSk9/YfU1XxqMam7qTLC39MpBO04yhevZdtf?=
 =?us-ascii?q?MaWEFBPsHM0eHcShNOsqm12xZBIeIO9S7LI0P9+hd/aewqGrOPhvnT24gmVH+o?=
 =?us-ascii?q?xyyV+M+DdmRe7O3JYFxO+Y0xCDVzf9ilehr8/2lZpFZTEUAmqw1yzkCJRNaa11?=
 =?us-ascii?q?eIYBEX2uLNGvxtVim57tXGZV9V6+B18cxMClYxuTb1zn0g1W2kQauninmSq+zz?=
 =?us-ascii?q?xpnDAltKuf3CrSw+v8cBoLIHJERG5njV30O4i7k8gaXFS0bwgujBal/0f6yLRB?=
 =?us-ascii?q?q6RlMmbTRl1Efy7oIGF4U6u8r6aNbNRL6Jw1rypXSuO8YVaBR775ohsa1T7jHm?=
 =?us-ascii?q?REyDA6cTGqpov2nxhghG2BK3ZzqWLTedtsyhfH+NzcWflR0yIGRSl5kzXWBkKw?=
 =?us-ascii?q?P8K0/dWSjJrDtuG+V2S8VpxcayXrzIWAtDel6m1uGxGwg/ezmtj/GwggzSD7z8?=
 =?us-ascii?q?VqVTnPrBvkYInkzb66MeFkfklvHlP88NB1GoJ9kosxgpEfx34ai46R/XoGl2fz?=
 =?us-ascii?q?LNpa1bj/bHoLWT4E3drV7BL5101kK3KD35j5WWmFwst9e9m6ZXsb2yIn4MBNEq?=
 =?us-ascii?q?uU7r1EnS1ur1q8rALRZ+V9nzgHxfsv7n4an/8GuA43wiqBBbASGFFSPTbwmBSQ?=
 =?us-ascii?q?89C+sKJXaX6scbeq1Upyh9ChDKyYrQFaV3b0YZMiHS527sViP1PAynzz6of4eN?=
 =?us-ascii?q?bOadIfrAGbkxDFj+JNMpI+iuIKhTZ7OWL6pXAlzu87jR900p2gsomINX5t/L6n?=
 =?us-ascii?q?DR5CLTL6edkT+j72gKZan8aW2Z2vH5p7FjUKWpvoUeynEDYIufv7MAaOFSU2qm?=
 =?us-ascii?q?2HFrrHAQ+f9EBmomrTE5CsMnGbPngYws9kRBmAP0xfmwEUUS4+np44EACq2cPg?=
 =?us-ascii?q?fF145jAX+l73tB9Mxvh0OBn4V2fVvB2oZSssSJiDMBpW6RlP6FzPPsyZ6uJzAj?=
 =?us-ascii?q?tU/pm8rAGWLmybZgJIDXwGW0CeBlDjOKWu6sfE8+SCGuW+KP7Oa62UqeNCT/eI?=
 =?us-ascii?q?2Y6v0ox+8jaOLMqPO2dtD+Yh1kpfR3x5GNnZmzYSSywRjS3NdNWWpBO9+i1xs8?=
 =?us-ascii?q?C+/+7nWAPp5YuTFbRSNc9j9AyxgaeGL+SQnjp2KS5E1pMQwn/F0Lge3FkPiyF3?=
 =?us-ascii?q?ajmiC7IAuTTWTKLXnK9XAAUWaydyNMtO8qI90RNBOc/ditPpyLF4iuQ5BEtCVV?=
 =?us-ascii?q?zkgsupf9AFI3mhNFPbA0aGLLSGKiPKw8H0YqO8SKdcjOZOtx23tjaUDVXjPimY?=
 =?us-ascii?q?lzTyUxCvMOdMjDyUPRBEuYG9dAptBnbnTN78dhK7N9p3hyUswbIonnPKKXIcMT?=
 =?us-ascii?q?9kfkxXs72f9jlYjet/GmBb6nplLPKJmyKY7+neN5YXvuFnAiVyl+JG/ns6z6FZ?=
 =?us-ascii?q?4z1DRPxwgCHStMJho0m6kumTzTpqSAZOqjdOhI6RoUpuI7nW9pleVnbC5x8N6W?=
 =?us-ascii?q?SQCxIXp9pqENHvuqZQysTRm6L3MjtN79XU/c4EDcjONM2HKGYhMQbuGDPMDAoK?=
 =?us-ascii?q?VzirNWTeh0xbiP6T932VoYI8qpjjg5cOTr5bVFooFvIVEEhlHdoCIItpUTMgi7?=
 =?us-ascii?q?KUkMkI5X/t5CXWEcdQpI3BW+66C/z+LDeTl7QCbBwNkp3iKoFGE4Thx01kInN+?=
 =?us-ascii?q?gYHHHVHMXNZCpmU1awYuvERLtnJ6U2g+3Vn5awWi5FccEvm7mhMzgwp6J+8q8W?=
 =?us-ascii?q?G/sB8MOlPWqX5owwEKktL/jGXUKWapIQ=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AqAABaHvdbh0O0hNFiHgEGBwaBUggLA?=
 =?us-ascii?q?YJpgQIng3mDe5Adgg0UlyYUgV0uDQYBiFIiNQgNAQMBAQEBAQECARMBAQEIDQk?=
 =?us-ascii?q?IKSMMgjYkAYJiAQIBAgECIB0BOAEDAgkBAQUFCw0CAiYCAgMfBgwBBQEcGQWDH?=
 =?us-ascii?q?AGBaAEDFQUKnGo8iw2BL4J3BYExAYJ+CkANghECBhJ5in6BVz+EI4MbAwEBgUZ?=
 =?us-ascii?q?lgjeCVwKgAgcCghwEhFyGGIQbGIFZTYdhhwGNQ4peMIEnAoIJNDxdDBiCOwkKg?=
 =?us-ascii?q?giDbYUUhT8+MwEBgQMBAYxVAQE?=
X-IPAS-Result: =?us-ascii?q?A0AqAABaHvdbh0O0hNFiHgEGBwaBUggLAYJpgQIng3mDe5A?=
 =?us-ascii?q?dgg0UlyYUgV0uDQYBiFIiNQgNAQMBAQEBAQECARMBAQEIDQkIKSMMgjYkAYJiA?=
 =?us-ascii?q?QIBAgECIB0BOAEDAgkBAQUFCw0CAiYCAgMfBgwBBQEcGQWDHAGBaAEDFQUKnGo?=
 =?us-ascii?q?8iw2BL4J3BYExAYJ+CkANghECBhJ5in6BVz+EI4MbAwEBgUZlgjeCVwKgAgcCg?=
 =?us-ascii?q?hwEhFyGGIQbGIFZTYdhhwGNQ4peMIEnAoIJNDxdDBiCOwkKggiDbYUUhT8+MwE?=
 =?us-ascii?q?BgQMBAYxVAQE?=
X-IronPort-AV: E=Sophos;i="5.56,267,1539673200"; 
   d="scan'208";a="63617990"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mga01b.intel.com with ESMTP; 22 Nov 2018 13:29:30 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2407484AbeKWIKj (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 03:10:39 -0500
Received: from mail-ot1-f66.google.com ([209.85.210.66]:44289 "EHLO
        mail-ot1-f66.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1732619AbeKWIKj (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 03:10:39 -0500
Received: by mail-ot1-f66.google.com with SMTP id f18so7493005otl.11;
        Thu, 22 Nov 2018 13:29:26 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc;
        bh=Ha7qZov1GAIxKR5+NArEJ5S+4Vwlc5PDn3a+s53NtfM=;
        b=GtzWVemh8gnOdY0YsZXrMeBIsSSTa9fzcAsG+zbJXqMMdh7oYQRn6JSW6q+WMgXIog
         VbasCy2bq12nsanF3bm2lXeOiem/ss0edM2UmW7OqiU47zvV6rIpyWct1v8b2hISeqzG
         9/xOSBXAMJhHJyeiqhPGUTZ/bO8t+ijgHI0J+J8w5cggamEl/LtAdDcxdkNInu4LNcCn
         GtmZaCkRSA4CUDj1vXstevm6pP1/iqezqVCyqvDOYXHM2ImeOal7Q8Ut602v5uDGodfV
         oUQKSBvbicBghW/JSFoMpaUDo66+fDS2QTZ17vq6qglJt3dvncRnlL4KcXjq585dT7P7
         ratg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=Ha7qZov1GAIxKR5+NArEJ5S+4Vwlc5PDn3a+s53NtfM=;
        b=kBXx2g+0MJqOnCI7YWMRT0lGrGDRaXWTOg2qGFDEsvJ5b13rkHCioKqlgDzBD4lZuZ
         sYIdfPOak4ED17s8fYtBuvHqMPtMiViSXlFwvoHMyA3GXv0XRzac/VG/GLarT1DdDrhq
         vrlGlK78Gqq+bQnOz7DprDjldUefomjWXq3ymFjzVYg9n8C68JG0OwC2OwKrai4Z81Jx
         lJwpz8mcQuDkofAbrrpEiioHgHUwkZBdfuOMmTgLIvh90+DrVmisJBlhM3AUs0VrwBwz
         vOnWsbWypVAXqbu9iVHEZGlsK9zohqpgK1Ls5QE592l4Ss5Nqe/4IiudptbNVn/6G+h6
         77Fw==
X-Gm-Message-State: AA+aEWa8/Q5x0IyFn6w01GM/GNaLavMI8sXB70S97Qv6HKyZi96yRUgD
        /Uvxwo2cMtK6f4EEHIQcdRsDLtLiA59PuLRhQVo=
X-Google-Smtp-Source: AFSGD/VODV73mmeyKQi8Vh2ui0ye4ne2KgYevQjkSKXTEIsuDse+uQ3PX1EN7qPH53AHLijip8akTpFcp6Bqx1kGGZ8=
X-Received: by 2002:a9d:6a8e:: with SMTP id l14mr6976911otq.348.1542922166228;
 Thu, 22 Nov 2018 13:29:26 -0800 (PST)
MIME-Version: 1.0
References: <20181116205303.6354-1-martin.blumenstingl@googlemail.com> <59801d61ba4e5d5fc8f0df1adffad1f9c7afb45c.camel@baylibre.com>
In-Reply-To: <59801d61ba4e5d5fc8f0df1adffad1f9c7afb45c.camel@baylibre.com>
From: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
Date: Thu, 22 Nov 2018 22:29:15 +0100
Message-ID: <CAFBinCAgJTRgF-YX2Yt84c57URvV6Tr_R7=s1tjFPyzeWmup-A@mail.gmail.com>
Subject: Re: [PATCH 0/3] Meson8b: add the CPU clock post-dividers
To: jbrunet@baylibre.com
Cc: linux-amlogic@lists.infradead.org,
        Neil Armstrong <narmstrong@baylibre.com>,
        mturquette@baylibre.com, sboyd@kernel.org,
        linux-clk@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
        linux-kernel@vger.kernel.org
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Jerome,

On Thu, Nov 22, 2018 at 10:05 AM Jerome Brunet <jbrunet@baylibre.com> wrote:
>
> On Fri, 2018-11-16 at 21:53 +0100, Martin Blumenstingl wrote:
> > This is the successor to my previous series "meson8b: add the CPU_DIV16
> > clock for the ARM TWD" from [0]. I decided to not send this as v2 of
> > the original series because the PERIPH clock is not the CPU_DIV16 clock.
> > It's not clear whether a CPU_DIV16 clock exists.
> >
> > With this series we get all the CPU_CLK post-dividers as listed in the
> > public S805 datasheet [1] on pages 31 and 32:
> > - ABP
> > - PERIPH (used as input for the ARM global timer and ARM TWD timer)
> > - AXI
> > - L2 DRAM
> >
> > Each of these clocks has a register called "..._CLK_DIS" which is
> > documented as a "just in case" bit:
> > "Set to 1 to manually disable the [...] clock when changing the mux
> > selection. Typically this bit is set to 0 since the clock muxes can
> > switch without glitches."
> > Since we're not supposed to touch that register we're setting
> > CLK_IS_CRITICAL for these clocks in the driver.
>
> If we are not supposed to touch the register, I'd prefer if you used RO ops
> instead of using CLK_IS_CRITICAL.
that makes sense as other "read-only" clocks are using RO ops as well.
I'll add a new patch which introduces clk_regmap_gate_ro_ops as we
don't have that yet

> >
> > The result of this is that we can use the PERIPH clock which clocks
> > the ARM TWD timer. I will send a separate series to add the TWD timer.
> >
> >
> > [0] http://lists.infradead.org/pipermail/linux-amlogic/2018-July/007890.html
> > [1]
> > https://dn.odroid.com/S805/Datasheet/S805_Datasheet%20V0.8%2020150126.pdf
> >
> > Martin Blumenstingl (3):
> >   dt-bindings: clock: meson8b: export the CPU post dividers
> >   clk: meson: meson8b: rename cpu_div2/cpu_div3 to
> >     cpu_in_div2/cpu_in_div3
> >   clk: meson: meson8b: add the CPU clock post divider clocks
> >
> >  drivers/clk/meson/meson8b.c              | 268 ++++++++++++++++++++++-
> >  drivers/clk/meson/meson8b.h              |  17 +-
> >  include/dt-bindings/clock/meson8b-clkc.h |   4 +
> >  3 files changed, 276 insertions(+), 13 deletions(-)
> >
>
> With CLK_IS_CRITICAL removed, looks good to me:
>
> Acked-by: Jerome Brunet <jbrunet@baylibre.com>
thanks for reviewing this!


Regards
Martin
