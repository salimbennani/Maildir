Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:32:38 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga006.fm.intel.com (fmsmga006.fm.intel.com [10.253.24.20])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id AFD6358037D;
	Thu, 22 Nov 2018 14:16:37 -0800 (PST)
Received: from orsmga106.jf.intel.com ([10.7.208.65])
  by fmsmga006-1.fm.intel.com with ESMTP; 22 Nov 2018 14:16:36 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AclA2gh2QCEa1xudbsmDT+DRfVm0co7zxezQtwd8Z?=
 =?us-ascii?q?segTKvjxwZ3uMQTl6Ol3ixeRBMOHs6IC07KempujcFRI2YyGvnEGfc4EfD4+ou?=
 =?us-ascii?q?JSoTYdBtWYA1bwNv/gYn9yNs1DUFh44yPzahANS47xaFLIv3K98yMZFAnhOgpp?=
 =?us-ascii?q?POT1HZPZg9iq2+yo9JDffwZFiCChbb9uMR67sRjfus4KjIV4N60/0AHJonxGe+?=
 =?us-ascii?q?RXwWNnO1eelAvi68mz4ZBu7T1et+ou+MBcX6r6eb84TaFDAzQ9L281/szrugLd?=
 =?us-ascii?q?QgaJ+3ART38ZkhtMAwjC8RH6QpL8uTb0u+ZhxCWXO9D9QLYpUjqg8qhrUgflhy?=
 =?us-ascii?q?gJNzE78G/ZhM9+gr9Frh29vBx/24zZbZqJNPZiZK7RYc8WSXZDU8tXSidPApm8?=
 =?us-ascii?q?b4wKD+cZOuhXtZP9p0cPrRu4GAKhGefvyiJNhnDo2606yPghEQDA3AwvG9IFrX?=
 =?us-ascii?q?PZrNDvO6cITeC1za/IwS/YYPNSxDf97ZbHchY6ofGQXLJwd8XRyU00GgPKiVWQ?=
 =?us-ascii?q?roPlPzeL2eQIqWeb7u5gWfizhG4grgF8uz6izdoihInOg4Ia0FHE9SNhzYY2O9?=
 =?us-ascii?q?K4Ukh7bsCgEJdKsCGaLYR2T8U/SG9roCY30qMKtYK/cSQQ1ZgqyQDTZ+aaf4WL?=
 =?us-ascii?q?/h7vTuecLDVgiH57ZL6ygwy+/Eugx+HmSMW4zUpGojBEn9TNsH0Gygbd5dKdSv?=
 =?us-ascii?q?Rn+0eswTaP2B7X6uFDOU00i6XbJIA7wrIqlZocr17DHinol0XylqOWcV8k+uew?=
 =?us-ascii?q?5+TmZLXpuIOcOpdqhg3iNqkigNGzDOomPgQUQmSW+viw2Kfi8ED7WLlKi+c5kq?=
 =?us-ascii?q?jdsJDUP8Qboau5DhdR0oYi7Ra/Ejin3M0bnXYZNlJFfgyIj4zwN1HJLvH4C+mw?=
 =?us-ascii?q?g063nTd1yPDJIKfhDo/OLnfdirfhe6hy60pGxAo019Bf6IpYCqsdL/LrRk/xqN?=
 =?us-ascii?q?vYAwc9Mwy1wOboFs9x14wDWW+UBq+ZMaXSsUKH5+41IumMYpMVtyj5K/Q/+/Hu?=
 =?us-ascii?q?ino5k0cHfaa1xZsXdGy4HvN+LkWZe3Xsg8sBHn0NvgYkTOzqlUeNUThcZ3upW6?=
 =?us-ascii?q?I85zc7CJ+pDIvZR4CthqCB0zm/HpFMem9GDVWMG2/yd4qYQ/cMdD6SIsh5nzwG?=
 =?us-ascii?q?UriuVZUt1RKptA/8zbpnKfHZ+ikZtZLlydh06PfflRA09TxoEcud13uBQH1znm?=
 =?us-ascii?q?MNXzU2xrxwoVRhylef1qh1m+ZXFcdT5/NOUQc2L4TcwPZ4C93pXgLBf9GJSEup?=
 =?us-ascii?q?Q9m8ADExSM4xzMEKY0pnB9qiiRXD1TKwA7AJj7yLGIA08qXE0njyPcl9zWzK1K?=
 =?us-ascii?q?0gj1Y8RMtPOnarhqp+9wjVGo7InF+Vl6esdaQAwiHN8H2PwnaJvEFdSARwS7nK?=
 =?us-ascii?q?XWgDZkvKqtT0/l7NQKWwCbs5KAdBydSNKq1RatL3i1VKQ/PjONfbY2K1gGqwAR?=
 =?us-ascii?q?eIxrWRbIvlYWkd3SPdCFQanAAX53qJKQ8+BiK5qWLEEDNuDU7vY1/r8eRmtXy0?=
 =?us-ascii?q?VFE0wB+QY01hzbW1/AUViuKaS/4I2rIEuSEhqyh7HVqn3tLWDcaAqBRlfKlGfd?=
 =?us-ascii?q?w951JH33rDtwNhJpygM7xihlkGfgRrvkPu0hJ3CplAkckqtn8q0BB+KaWC0FNF?=
 =?us-ascii?q?djOY25/wN6bTKmnz+hCvdqHX1kvf0NaQ5qcA9vA4p0//swGuE0oo629n3MVN03?=
 =?us-ascii?q?uA+pXKCxIfXoj1Ukkp+Bl1ubHbbjMm6IPJyHJjK6+0sjzF29I3H+Ylzhegf9FC?=
 =?us-ascii?q?MKKLDgPyEssaB9SwJ+wugVSmchUEPOVK/q4uI8ymb+eG2LKsPOt4nDOmkH5L75?=
 =?us-ascii?q?xn3kON9ypzUOjI35kezvGc3wuHUSr8jVi7vsD2n4BEeS8dHm6lxSf4A45RY7V4?=
 =?us-ascii?q?fZwXBme2P8232tJ+iob3W35Z6FGsHUkG19KueRaIaVzywxdQ1UUOrXO7gyS4yy?=
 =?us-ascii?q?F7nC8zrqqY2izD2ODidBsBOm5WS2hul1bsIY6oj98EWEikdRQmlByg5Uzi3ahU?=
 =?us-ascii?q?uLx/L3XPQUdPZyX3L2BiXrGwt7aYeM5P9ZUovD5TUOS9Z1CaV7H8rwEb0yPlA2?=
 =?us-ascii?q?tR2jQ7eyu2tZX+mhxwkHidI2prrHrFZcFwwg/S5N7GSv5L3ToGRy54hSPMBlem?=
 =?us-ascii?q?PNmp/tSUl5HdveC4TG+hUpxTcS/2zYKPrie75GtqAQGhkPC3gNHoDQ860Srj3d?=
 =?us-ascii?q?lwSSrItAr8YpXs16miMeNoZE5oCEX+68p7HIFziY8whJAW2XgHiZSZ53sHkWHv?=
 =?us-ascii?q?MdpF3aLydmYCRTkOw9TN+gjqxFVjLm6Vx4L+TnidwdFuZ9igbmMWxyIy9cZKCK?=
 =?us-ascii?q?iP4bxAnCt1pEe4rA3Lbfh8mDcd1eUh6HoAj+4Vvwotyz2XAqoOEklAISzsixOI?=
 =?us-ascii?q?4si7rKVWZ2aga6K81URgktC6ELGNvBtcV23ndZc4Ei999cF/MFPK0H3u5YDoYt?=
 =?us-ascii?q?jQbdQPthKKlxfMlfRaKJU0lvASnypoJXr9vWE5y+48lRFuwZa6vI2dJ2Rs5q25?=
 =?us-ascii?q?BANYNibuZ8MS4TztiadensCL34GgBJlhGzMLXIf2QvKsCj4dqfPnNwOWGj0mtn?=
 =?us-ascii?q?ibAabfHROY6Ep+tH3ACZerN3WKJHUDydViWQKQJEhegAASQTU7kYQ1FgGsxMz9?=
 =?us-ascii?q?bkh54iod6UL/qhtJ0uhoLQXwUn/DpAe0bTc5UJqfIwBT7g5c/EfZK9Ce4vhwHy?=
 =?us-ascii?q?FF/Z2hsQqNJXaAZwlTCWEJW0qEB03sP7W05NnA9fSYCfS6L/fUfbqOruleXe+S?=
 =?us-ascii?q?xZ2zyotm4yqMNsKXM3hiCP07x1NDXW1jFMTfgTkPUCsXlyTCb8OAoBe8+yt3rt?=
 =?us-ascii?q?2w8fjxWQLv45ePBKVWMdl15x+2hqKDPfaKhCllMTZYyo8MxXjQxbgfwlESiiJu?=
 =?us-ascii?q?dzqsEbgati7NVqXQmqBJAB4BdiNzL9BF76Y93glLJM7ahcn51r9+jv4pFVhFUU?=
 =?us-ascii?q?btld2uZcwPO2u9Lk/IBF6XNLSaIj3G29v4Yb6nRr1KkupVtwe8uTKaE0L4OjSD?=
 =?us-ascii?q?lj/pVw2gMO1WjSGbOgBet5+5chp3FWfjS9fmYAWhMNBrlT023aE0hnTSOG4AMD?=
 =?us-ascii?q?h8dllBoaGK4SxEgvVwBWpB42FhLemFnSaZ8ubZJowXsfttHiR7ieZa7G4mxLtS?=
 =?us-ascii?q?6SFOXOZ1lzfKrt5yv1GmlfGCyzp9XxpIrzZLhYSLsl1jOKXZ7JZAX3nE8QkJ7W?=
 =?us-ascii?q?WRDRQKutRkBsfuu6BW1tjAiqbzJC1e/NLT+MtPT/TTfc6ONnssNVztFSzfBQ0C?=
 =?us-ascii?q?ZTqqM2jFgApaiv7B2GeSq80fo4LwmZxGYLtGUVEzDe8bDEthVIgHKY1rXzVim7?=
 =?us-ascii?q?qGicMO/ma/qhbVbMpduZ/DW/ebAPGpIzGc2+oXLyAUyK/1eNxAfrbw3FZvPwF3?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0BDCwD0Kfdbh0O0hNFigheCaoECJ4N5g?=
 =?us-ascii?q?3uQHYINFJkXLgsIAYhSIjcGDQEDAQEBAQEBAgETAQEBCA0JCCkhAgyCNiKCZQE?=
 =?us-ascii?q?CAwECIB0BOAEDAgkBAQUFCw0CAiYCAgMfEgEFARwZBYMcAYFoAQMVBQqcUDyLD?=
 =?us-ascii?q?YEvgncFgTEBgn4KQA2CEQIBBRJ5in6BVz+BEYMShUuCN4JXAokjll8HAoIcBIR?=
 =?us-ascii?q?cijMYgVmFC4okLI0Xil4wgTuBdzQ8gQGCO4InF4NKhRSFPz4zgQUBAYxVAQE?=
X-IPAS-Result: =?us-ascii?q?A0BDCwD0Kfdbh0O0hNFigheCaoECJ4N5g3uQHYINFJkXLgs?=
 =?us-ascii?q?IAYhSIjcGDQEDAQEBAQEBAgETAQEBCA0JCCkhAgyCNiKCZQECAwECIB0BOAEDA?=
 =?us-ascii?q?gkBAQUFCw0CAiYCAgMfEgEFARwZBYMcAYFoAQMVBQqcUDyLDYEvgncFgTEBgn4?=
 =?us-ascii?q?KQA2CEQIBBRJ5in6BVz+BEYMShUuCN4JXAokjll8HAoIcBIRcijMYgVmFC4okL?=
 =?us-ascii?q?I0Xil4wgTuBdzQ8gQGCO4InF4NKhRSFPz4zgQUBAYxVAQE?=
X-IronPort-AV: E=Sophos;i="5.56,267,1539673200"; 
   d="scan'208";a="41235981"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 22 Nov 2018 14:15:35 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2407807AbeKWIxx (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 03:53:53 -0500
Received: from mail-ot1-f66.google.com ([209.85.210.66]:34647 "EHLO
        mail-ot1-f66.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2392442AbeKWIxx (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 03:53:53 -0500
Received: by mail-ot1-f66.google.com with SMTP id t5so9182810otk.1
        for <linux-kernel@vger.kernel.org>; Thu, 22 Nov 2018 14:12:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc;
        bh=FNVnkyBUgZpbeX/f5pQRJIGAzpoNCBSjXqfSggAVv+M=;
        b=omir/kKqp8lVsm1YFAAUz21lrBURJ+0TKhphM8TkmZn2lLLU6lY/00mMO6sJJlXHHv
         iHtRKitba3yf6vebDMwRLghhkMgwQetUccYvXnviYnJSNuTOZVrSEW1/M475lO7ulrxH
         Ss1DeKUi/i6d7QrkyT0Xunvl8/iJw02Z46BtA4A37Y1i3xxTvIX6GRm9OFf3Y3FvZ5/d
         0YbZ6XK14m0YuLe012YAXWbNZL+9+1YTttTWpswFfExysN7bEWnl07WdGpfVey25ZW+3
         BVy+ZYm18loEK6B90LLiy3v/F//FyF9s5zvSPqxx0HGCcv7/qp3cTpoHwn7R5I6zISjx
         BpFg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=FNVnkyBUgZpbeX/f5pQRJIGAzpoNCBSjXqfSggAVv+M=;
        b=qnKpRd2D2fLXg6cnCTYcMNci1Sv+rebMMjbiz9+eUW5vkBOu5qZVJ6nBWscjJrbqMN
         WpmhDkms/+f9XUwQp7t3XfDNNtWr1fE/OVkK7piFTiAujHEK7ayXeyCyDEfUD/YLorLZ
         cQECdZED3DRBIGhbRIZgNIM1RhEMUyTq/ycTGH+rtKnRL4YHyyTXC3InUErggK38bMJB
         MVA0meXxhwuCtMF1GYVocVVOSzc8p5bBRjwMdvnG2fQKhusHVfVeWXI0u/iFHprf7zHc
         8Xz3e39c/oBgjLxuMd9iqPMmoq4tf93HWysaKyt6HfLJglTFgcfcuIegvg3cHZXEA02W
         qoXg==
X-Gm-Message-State: AA+aEWYUzqxeuJ+j/SGiLCj5A02P+cwC9MrnXXh6yezwaqN5lSRyKCJX
        jatsZv0SRu6N/Ak4Wvc3tN4qlMaR9FhE97y25EkGVB+x
X-Google-Smtp-Source: AFSGD/XcHuxtDnZt8HJRKzh8OEN+lPAiGk42do+OXMkXyLjWTMsL1OplP4MRmWC0cS65qYNSNwQ9x2kNI2kcxfl4ZFA=
X-Received: by 2002:a9d:715d:: with SMTP id y29mr7573525otj.148.1542924750797;
 Thu, 22 Nov 2018 14:12:30 -0800 (PST)
MIME-Version: 1.0
References: <20181115224657.14736-1-martin.blumenstingl@googlemail.com> <5ff1a888-cce2-8fd8-a98e-14c3d7c33acf@linaro.org>
In-Reply-To: <5ff1a888-cce2-8fd8-a98e-14c3d7c33acf@linaro.org>
From: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
Date: Thu, 22 Nov 2018 23:12:08 +0100
Message-ID: <CAFBinCDSLEAzJVVgFxKhN3LCUwgC3Rrr=4ZhtHCdvqEPBLWbJA@mail.gmail.com>
Subject: Re: [PATCH v2 0/2] clocksource/meson6_timer: implement ARM delay timer
To: daniel.lezcano@linaro.org
Cc: linux-amlogic@lists.infradead.org, linux-kernel@vger.kernel.org,
        tglx@linutronix.de, linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Daniel,

On Sun, Nov 18, 2018 at 2:27 AM Daniel Lezcano
<daniel.lezcano@linaro.org> wrote:
>
> On 15/11/2018 23:46, Martin Blumenstingl wrote:
> > While trying to add support for the ARM TWD Timer and the ARM Global
> > Timer on Meson8, Meson8b and Meson8m2 (ARM Cortex-A5 and Cortex-A9 SoCs)
> > I did a review of the existing driver.
> > Unfortunately I found it hard to review because the pre-processor
> > #defines did not match the names from the public S805 datasheet. Thus
> > patch #1 adjusts these. No functional changes here, this is just
> > preparation work for patch #2.
> >
> > Using the ARM Global Timer (drivers/clocksource/arm_global_timer.c)
> > would have given us a timer-based delay implementation (so udelay() and
> > friends would use the timer instead of using a loop-based delay
> > implementation). Unfortunately we can't use the ARM Global Timer yet
> > because it's input clock is derived from the CPU clock (which can change
> > once we enable CPU frequency scaling on these SoCs, for which I will be
> > sending patches in the near future).
> > Amlogic's 3.10 kernel uses Timer E as delay timer which (with the
> > current configuration) has a resolution of 1us. So patch #2 uses
> > register_current_timer_delay() to register Timer E as ARM delay timer
> > (which will be especially useful as we have to use udelay() when
> > changing the CPU clocks during DVFS).
> >
> >
> > Changes since v1 at [0]:
> > - convert the enums for the input clock (meson6_timera_input_clock and
> >   meson6_timere_input_clock) to simple #defines as these are register
> >   values and not something driver-internal. All other register values
> >   are #defines so it makes sense that these are #defines as well.
> >
> >
> > [0] https://patchwork.kernel.org/cover/10658591/
> >
> >
> > Martin Blumenstingl (2):
> >   clocksource: meson6_timer: use register names from the datasheet
> >   clocksource: meson6_timer: implement ARM delay timer
> >
> >  drivers/clocksource/meson6_timer.c | 128 +++++++++++++++++++----------
> >  1 file changed, 85 insertions(+), 43 deletions(-)
>
> Both applied, thanks!
thank you for taking my patches

I have one question more: can you please push these patches to a
repository/branch which is included in -next?
I'm asking because I'd like to send patches that enable CPU frequency
scaling on Meson8, Meson8b and Meson8m2. The code to change the CPU
clock calls udelay(), which (in this special case) needs a delay timer
to work properly (we can't use jiffies as we're using udelay() *while*
changing the CPU clock).


Regards
Martin
