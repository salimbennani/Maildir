Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 24 Nov 2018 12:37:13 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga007.jf.intel.com (orsmga007.jf.intel.com [10.7.209.58])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 0CDF758037D;
	Fri, 23 Nov 2018 11:53:32 -0800 (PST)
Received: from fmsmga105.fm.intel.com ([10.1.193.10])
  by orsmga007-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 11:53:31 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3ARE2pdxQwcaaWngfkyRf2eokGQtpsv+yvbD5Q0YIu?=
 =?us-ascii?q?jvd0So/mwa64YhaBt8tkgFKBZ4jH8fUM07OQ7/iwHzRYqb+681k6OKRWUBEEjc?=
 =?us-ascii?q?hE1ycBO+WiTXPBEfjxciYhF95DXlI2t1uyMExSBdqsLwaK+i764jEdAAjwOhRo?=
 =?us-ascii?q?LerpBIHSk9631+ev8JHPfglEnjWwba9xIRmssQndqtQdjJd/JKo21hbHuGZDdf?=
 =?us-ascii?q?5MxWNvK1KTnhL86dm18ZV+7SleuO8v+tBZX6nicKs2UbJXDDI9M2Ao/8LrrgXM?=
 =?us-ascii?q?TRGO5nQHTGoblAdDDhXf4xH7WpfxtTb6tvZ41SKHM8D6Uaw4VDK/5KptVRTmij?=
 =?us-ascii?q?oINyQh/W/XlMJ+kaxVrhGmqRNwzIDUe5mVOfhlc6/Bft4XX3ZNU9xNWyBdBI63?=
 =?us-ascii?q?cosBD/AGPeZdt4TzoEEBrQGiBQmtAuPk1yJFhnvr3a0/zeshFxrG3BAhH9IIv3?=
 =?us-ascii?q?TUqMj+OaAXUe+v1qnI0TTDb/VM1Tjm7IjIbxUhru+KXbJrbcrRyE8vFwzBjliL?=
 =?us-ascii?q?pozlODSV1usJs2eF6upvT+Ovi2o9pw5tpTivw94hh4/UjYwbzVDE8D92wIczJd?=
 =?us-ascii?q?CgS050f8SkEJ1OuCGeLYd2RdkiQ25wtCY7zL0Gt4S7czIXx5s53RHQduaLc4+S?=
 =?us-ascii?q?4hLsUuuaPDR2hGp9db6hmxq/9VKsxvDyW8WqylpGsylInsXWun0M1RHf8taLRu?=
 =?us-ascii?q?dh8kqv3DuAyhzc5+RZLk02m6fXNZsswrAwm5YPrUjOGy/7lUH0gaCLc0go5+ml?=
 =?us-ascii?q?5P7mb7jjqJKQKo95hwP7P6kghMCzH/k0Pw4TVGaB4+u8zqfs/UjhTbVKkPI2lq?=
 =?us-ascii?q?7ZvYjEJcQUuKG5GRVZ0oU95BalCTepztAYkWMALFJfdxKLl4npO1fQL/DkFfqz?=
 =?us-ascii?q?nUignTNxy/zbMLDtHI/BImXAnbv9Z7pw6kxRxBI2zd9F5pJUDr8BIOj0Wk/0rN?=
 =?us-ascii?q?HYCh45Mwqpw+foEdl91Z0RWXiJAqCHNKPeqFiI5+wpI+aSfo8Yoyj9K/c76P70?=
 =?us-ascii?q?l3M5mkESfbOv3ZQJbHC0BPNmI1+WYXb0mNcODX8KvhYiTOztkFCCVT9TZ3WsUK?=
 =?us-ascii?q?4m6TA7FZmrDYPCRoCrnbyA0z23HpxQZmBaFF+MFW3keJmDW/cJcCiSONNukiQY?=
 =?us-ascii?q?Vbi9TI8szRGuuxX7y7p7NOXU/TcUtZL+1Ndv4e3Tmgo/9Th1D8SbzmGMQHt4nm?=
 =?us-ascii?q?IORz8qwq9/pVZxxUuE0ah9m/ZYD8Bc5+tVUgcmMp7R1+56C9fsVQ7bfdeJT1Cm?=
 =?us-ascii?q?QtOhATwqStIxwtkOY1tyGtm4jxDD2TaqDKERl7CRGJM09afc1WDrJ8lh03bGyL?=
 =?us-ascii?q?Uhj14+T8RVLm2mhql/9wvJC47TiUqZlb2ndaAd3C7L6WeCwnCCvEBeUA5sT6rF?=
 =?us-ascii?q?WWoTaVfRrdT8/knCVaOhCaw7Mgtdzs6PMqhKZcfvjVlcQPfjOc7RY2S+m2qrAR?=
 =?us-ascii?q?aIx7WMbJflemkH3SXdDlQEnB4X/XqcKQc+ASKhqXrEDDNyDVLvf1/s8e5mpXym?=
 =?us-ascii?q?VEA00R+FY1dh17Wv/B4VnuKTS/UU0rIAuychrjF0EU2539LXDdqAugVgcL9dYd?=
 =?us-ascii?q?M7/FdIy2bZuxZhMZynKqBonkQefBhvv0PyyxV3DZ1NntUwo3M00gV+M6KY30lH?=
 =?us-ascii?q?dzODw5/wPKbaKm3z/BCpdq7X1UvS0NeQ+qcT9vs4r0/vsx2uFkon639nycVa02?=
 =?us-ascii?q?OA5pXWCwofSY7xUkcy9xh9u7HaYik865nI1XF2Nqm0qDvC29MvBOsq0Ruge9Zf?=
 =?us-ascii?q?MKWZFA79CcEaBs6uKPA0lFitdB4LIOdS9KssNcO8a/SGwLKrPPpnnD++l2tH5J?=
 =?us-ascii?q?5y002S+Ct8UOLHxIsFzOyC0QuBVDf8i0mhv9vzmYBFYzESA2W+xTLlBI5Xeq19?=
 =?us-ascii?q?Y4ILBX2yLM2ww9V0n4TtVGJA9F6/G1MG39ekeBqPb1DnwQJcz0UWoXy9liu+wD?=
 =?us-ascii?q?x5iDUprquZ3CzTzOXubhsHOmhXRGZ8iVfgO5S7j9cfXEKwdQgmiAOl5Vrmx6hc?=
 =?us-ascii?q?vKl/NWjTTltScCjsMm5iVbG8trycbM5V6ZMkqDlYX/64YV+HVLH9uRwa0yX4Em?=
 =?us-ascii?q?taxTA7cSyqu5rjkxx7jmKdMGh8rH7Ddc5swhff4cTWReRN0ToeWCl4lT7XC0C8?=
 =?us-ascii?q?Ptmo59mVl43PsvujV2KnTZBTdSjrzYWdtCq0/2FqABu/n+ytld3jCwQ1zSj719?=
 =?us-ascii?q?xyXyXSsBn8epXr17i9Me9/fElnHkX868l5GoF5iIcwn4sf2XsZhpWU+3oIj2Hz?=
 =?us-ascii?q?PM5f2aL/anoNWDEKz8TU4AjjxE1sMHaJy5jlWXWax8trf8O6bX8O2iIh88BKD7?=
 =?us-ascii?q?+Z7bxekityuFa4rwPRYf5mkzcZyPsu7mMagu4TtAosyCWdHq4dHU1CMSPwkBSI?=
 =?us-ascii?q?6si0rL9La2a3bbiwyE1+kMiiDL6YowFQQnb5eoo4Ei924cVyK1bM0Hz16oH5d9?=
 =?us-ascii?q?jcd9MTthuIkxjei+hZMo4+lv0PhSB/I2LyoWUly/InjRxpxZy6uYmHK2Z3866j?=
 =?us-ascii?q?DB9XKCb1Z98N9TH3lqlRgNyW34+0E5VlGzULWoboTP2yHDITs/TnKxiBEDkmpn?=
 =?us-ascii?q?iHHrrfGBeV6F16oHLXD5CrK3aXKWEFzdVlQRmRPk1ejxoSXDUnhZ45DQGqydfl?=
 =?us-ascii?q?cEd44DAR+1H5pgFNyuJuKxnwTGPfqB20ZTczTZiVNABW4R1a50fJLcye6fp+ED?=
 =?us-ascii?q?pC8Z2mqAyNN3aXZwBVDWwSXkyEBlbjPqSh5NXa8uiYAPa+IOXKYbmUteNeUPKI?=
 =?us-ascii?q?z4q10oR65zaMKtmPPn56Av05wEVDWG52G9/DlzUTUSAXlD/Nb82GpBe64CJ3td?=
 =?us-ascii?q?uy8PDqWALp+IuOBKFeMdRp+xCqn6iDM/Scizp+KTZdzpkM32PHyKAD3F4OjCFj?=
 =?us-ascii?q?bzmsEbMdtS7UUaLfgKlXAwQAayN0MstI4Lkx3g1MOc7dl9P02aR0jv8zC1dZS1?=
 =?us-ascii?q?PhntulatANI2G4LFnHHlqENKyaJT3XxMH6eaO8RqNRjOVXtB2wuCyXE0z5PjSE?=
 =?us-ascii?q?mDnmSQqvMfxXjCyAOBxeuYe9cgtiCGT5TdLmbAG7P8FzjTEs3bI0gXbKP3YGMT?=
 =?us-ascii?q?dga0NNsqGQ7SRAj/plBmxO9WBlIveEmiqD6+nYK40bsf9qAiRyiuJb7242y7pT?=
 =?us-ascii?q?7CFYWvN1nDHeocJpo1GjiuOP0CZoUAJSqjZXg4KGpVliOaTc9pVaRXnI5g4C7W?=
 =?us-ascii?q?WOBBQMvNZlDtzvu6ZNytnAjq7zKTFC887K8ssYHcTbNMWHMH85OxrzBDHUFBcF?=
 =?us-ascii?q?TSKsNWzHh01SiveS9niUrpg8spftmZoORaVdVFw6Df4aDkVlHNofIJZ4RD8kkL?=
 =?us-ascii?q?ibjNIW6nq6thXeWMJavpWUHs6VVP7mMjKepbJNZhwOzPX/N4tXfo772khnY19S?=
 =?us-ascii?q?lo3bH0vaR90LqSpkKkcwoUNQ4D13S2k01EPuQges+2MIU/+ykAQ/hgZ3baIq7j?=
 =?us-ascii?q?i/zU0wIw/vrTEskU95s9H4hD2XayLwKqi0FdVTAjDotk53OJfmRgtzdhGzm0Ng?=
 =?us-ascii?q?HDjDQL1Vgr5pdGQtgwjZ78gcUcVARLFJNUdDjcqcYO8lhAxR?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AiAABgWfhbh0O0hNFkHQEBBQEHBQGBU?=
 =?us-ascii?q?QgBCwEBgS+BOYECJ4wRX4shgiGXJ4FxFAEBGA0GAYM/AYUaIjQJDQEDAQEBAQE?=
 =?us-ascii?q?BAgETAQEBCA0JCCkjDEIBEAGBYiKCaAQCLwENATgBAwIJAgVLAyUMAQUBIxeDH?=
 =?us-ascii?q?AGBaAEDFQEECpszPIw8gncFgTEBgn0KQA2CEQIGEodMgw+BHIFXP4Nug1ADAoc?=
 =?us-ascii?q?5AokflmMHAoIcBIRchhiEECOCJocrC4csjUOKRgIEAgQFAgUPIYElgg00PF0TE?=
 =?us-ascii?q?YI7CYISg22FFIU/PzIBgQQBAYFQilEBAQ?=
X-IPAS-Result: =?us-ascii?q?A0AiAABgWfhbh0O0hNFkHQEBBQEHBQGBUQgBCwEBgS+BOYE?=
 =?us-ascii?q?CJ4wRX4shgiGXJ4FxFAEBGA0GAYM/AYUaIjQJDQEDAQEBAQEBAgETAQEBCA0JC?=
 =?us-ascii?q?CkjDEIBEAGBYiKCaAQCLwENATgBAwIJAgVLAyUMAQUBIxeDHAGBaAEDFQEECps?=
 =?us-ascii?q?zPIw8gncFgTEBgn0KQA2CEQIGEodMgw+BHIFXP4Nug1ADAoc5AokflmMHAoIcB?=
 =?us-ascii?q?IRchhiEECOCJocrC4csjUOKRgIEAgQFAgUPIYElgg00PF0TEYI7CYISg22FFIU?=
 =?us-ascii?q?/PzIBgQQBAYFQilEBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,271,1539673200"; 
   d="scan'208";a="139352483"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 23 Nov 2018 11:53:30 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2441449AbeKXGjG (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sat, 24 Nov 2018 01:39:06 -0500
Received: from mail-wr1-f66.google.com ([209.85.221.66]:33931 "EHLO
        mail-wr1-f66.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1729872AbeKXGjG (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sat, 24 Nov 2018 01:39:06 -0500
Received: by mail-wr1-f66.google.com with SMTP id j2so13369738wrw.1
        for <linux-kernel@vger.kernel.org>; Fri, 23 Nov 2018 11:53:24 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=20161025;
        h=from:to:cc:subject:date:message-id:mime-version
         :content-transfer-encoding;
        bh=gODjD0eo2vQeoQYeMF+uNMs3RYPbO6A3EDKJq3DZPzM=;
        b=g9roArnjyLDZnVtDT+iM5K2jdtVfMnF0AoRQaob0IWCk9+CBYfKKBQ350OBJWqhWg/
         NhHkecY7KOP8lU3mSqEwGEuF+SEX9fUlh7J4+HaBVTazWqpGWZKl7d+moxIGw06cDFkJ
         63BEcJQwWzYH739j55CyZMp2lDRrgXJh542RfN6u8wE8sBw4bRQVfivXAp+hegT+34nM
         pFK9yAIOaUFMdTLMAwkdV9AOVKQpRE497ZmocA7/iEZew2omsaJGZeLnIFMQ7G2RLjdW
         QnzyDJmX1XJgGAfIs9YYQGaBSFeOKMWh838tqw7karlgDl7l7My/gUXrWmh9z/tb0JtQ
         W0VQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
         :content-transfer-encoding;
        bh=gODjD0eo2vQeoQYeMF+uNMs3RYPbO6A3EDKJq3DZPzM=;
        b=dhsOPYZzKM4asJO5cK/Zt7W1gkCAnQZXhT4HJQ/LkFsEZCr21py3+vFLZYk0PX2Nyj
         tPq5Jlk5AuzUr4FcLbffO8GjV27Z3mC0VNlbVqHqeGTXWsc1ggyp6l2lb2CH1LJJEH7a
         kzzyoEJUzSh35sTXmjRXmRVyuPKGfAdQBj2EY2mvhsVsW4ujgxov0RIufkmxzYmCPQYy
         GSJZXyk+0LwXqOX5SDbDj7kvKTKc9lSenBWFf6YbIz/2epR1Utzxz39z+HsE77Q+D7Po
         wMWb1swprw+0dKSkWIL/67oEULkDoqXUnWQ+yLjgEADZFcB4bagjj6M/DZwmxKx1ajsQ
         eQCQ==
X-Gm-Message-State: AA+aEWZhG5Ce8vxe/y9fZ5FPZ1oxnJaNJMJU4KZ1U6UED29ypZPqvAwU
        dV1tZsCUeTSpvd4hnWXhhD4=
X-Google-Smtp-Source: AFSGD/XVZY/Gy1e/DGbb/PS1SHQXZH+yaf5RkhGvgF5Hhgzxsi9uHfXzFj1yb7mwPsDNghXB15wfXg==
X-Received: by 2002:adf:f449:: with SMTP id f9mr15627412wrp.40.1543002803973;
        Fri, 23 Nov 2018 11:53:23 -0800 (PST)
Received: from blackbox.darklights.net (p200300DCD732F500597D16A631573221.dip0.t-ipconnect.de. [2003:dc:d732:f500:597d:16a6:3157:3221])
        by smtp.googlemail.com with ESMTPSA id g198sm11495337wmd.23.2018.11.23.11.53.22
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Fri, 23 Nov 2018 11:53:23 -0800 (PST)
From: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
To: carlo@caione.org, khilman@baylibre.com,
        linux-amlogic@lists.infradead.org
Cc: linux-arm-kernel@lists.infradead.org, linux-kernel@vger.kernel.org,
        Martin Blumenstingl <martin.blumenstingl@googlemail.com>
Subject: [PATCH 0/6] 32-bit Meson: add the ARM TWD and Global Timers
Date: Fri, 23 Nov 2018 20:53:05 +0100
Message-Id: <20181123195311.4578-1-martin.blumenstingl@googlemail.com>
X-Mailer: git-send-email 2.19.2
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

The 32-bit Meson SoCs use Cortex-A9 or Cortex-A5 cores. These come
with the ARM TWD ("Timer Watchdog") which contains a timer and a
watchdog as well as the ARM Global Timer.

This enables the corresponding configs for the 32-bit Meson target.
Additionally this adds and enables the ARM TWD timer. The Global
Timer is added but currently disabled because it's clock input is
the PERIPH clock which is derived from the CPU clock. Thus the rate
of the PERIPH clock will change when changing the CPU frequency.
Unfortunately the Global Timer driver doesn't handle clocks with
changing rates yet (unlike the TWD timer), thus we keep it disabled
for now.

The whole series is inspired by an almost 3 year old patch from
Carlo: [0]


Dependencies:
- I build this on top of my other series "ARM: dts: meson: add the
  timer interrupts and clocks" from [1]
- CLKID_PERIPH requires updated clock driver headers. Neil provided
  a tag which includes the updated headers: [2]
- There is no runtime dependency on the PERIPH clock as we don't
  have CPU frequency scaling support enabled yet. In case the TWD
  timer driver can't find the clock it falls back to auto-detecting
  the clock rate at boot time. This is safe as long as we don't have
  .dts patches in place which allow changing the CPU clock rate. Once
  we enable CPU frequency scaling support for the PERIPH clock becomes
  mandatory so the TWD timer driver knows about changes to the PERIPH
  clock (which is derived from the CPU clock).


[0] https://patchwork.kernel.org/patch/7797581/
[1] https://patchwork.kernel.org/cover/10687005/
[2] http://lists.infradead.org/pipermail/linux-amlogic/2018-November/009136.html


Martin Blumenstingl (6):
  ARM: meson: select HAVE_ARM_TWD and ARM_GLOBAL_TIMER
  ARM: dts: meson: group the Cortex-A5 / Cortex-A9 peripherals
  ARM: dts: meson8: add the ARM TWD timer
  ARM: dts: meson8: add the Cortex-A9 global timer
  ARM: dts: meson8b: add the ARM TWD timer
  ARM: dts: meson8b: add the Cortex-A5 global timer

 arch/arm/boot/dts/meson.dtsi   | 24 ++++++++++++++++--------
 arch/arm/boot/dts/meson8.dtsi  | 32 +++++++++++++++++++++++++++-----
 arch/arm/boot/dts/meson8b.dtsi | 32 +++++++++++++++++++++++++++-----
 arch/arm/mach-meson/Kconfig    |  2 ++
 4 files changed, 72 insertions(+), 18 deletions(-)

-- 
2.19.2

