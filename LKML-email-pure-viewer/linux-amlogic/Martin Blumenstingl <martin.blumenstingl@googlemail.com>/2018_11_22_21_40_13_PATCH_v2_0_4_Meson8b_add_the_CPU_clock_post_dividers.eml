Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:32:21 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga006.fm.intel.com (fmsmga006.fm.intel.com [10.253.24.20])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 8A02958037D;
	Thu, 22 Nov 2018 13:40:32 -0800 (PST)
Received: from fmsmga103.fm.intel.com ([10.1.193.90])
  by fmsmga006-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 13:40:32 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3A4xzUDxXOru5tfMyYivsX+zbNWDnV8LGtZVwlr6E/?=
 =?us-ascii?q?grcLSJyIuqrYZhKCuKdThVPEFb/W9+hDw7KP9fy4CSpYud6oizMrSNR0TRgLiM?=
 =?us-ascii?q?EbzUQLIfWuLgnFFsPsdDEwB89YVVVorDmROElRH9viNRWJ+iXhpTEdFQ/iOgVr?=
 =?us-ascii?q?O+/7BpDdj9it1+C15pbffxhEiCCybL9uLxi6txndutULioZ+N6g9zQfErGFVcO?=
 =?us-ascii?q?pM32NoIlyTnxf45siu+ZNo7jpdtfE8+cNeSKv2Z6s3Q6BWAzQgKGA1+dbktQLf?=
 =?us-ascii?q?QguV53sTSXsZnxxVCAXY9h76X5Pxsizntuph3SSRIMP7QawoVTmk8qxmTgLjhi?=
 =?us-ascii?q?UaOD4j6GzZitJ+gr9VrhyioBJwzIHaYJqNNPd8Za7RYdAXSHBdUstLSyBNHoWx?=
 =?us-ascii?q?ZJYPAeobOuZYqpHwqVwUohukGQmsBeXvwSJVi3/ywK061vouEQfd3Aw8HtIOtn?=
 =?us-ascii?q?vUrNHoP6oVVOC61rPIzSnCb/NQwzvy84zIcg0kof6SW7JwatbRyUgpFwPKilWd?=
 =?us-ascii?q?soPlPzSS1uQCt2iU8e9gWviui24jsQ1+vj+vxsI1h4TPm4kbxFfE9SBjz4Y0I9?=
 =?us-ascii?q?21UEl7bsO+EJtXtiGVKpF6Td8lQ2FtoCo6yaMJuYS9fCcUzJQr3Rnfa+aIc4SQ?=
 =?us-ascii?q?4xLjUuiRIS1ii314Zr2wnQu9/VKnyu3mWcm51ktBoCldktTUqHwByxje5tKaRv?=
 =?us-ascii?q?Zz4EutwyuD2gPP5u1eIE05l7LXJ4A9zrIsmJcetFnMETPzlUrrjqKbeFso9+2m?=
 =?us-ascii?q?6+nnfrnqupqROo1phQ7gL6gjn8+yDvkiPQQTWmWb9+ax2KPt/UD8TrVHjeA5n6?=
 =?us-ascii?q?3fvZvHP8oUvLS5DBVQ0os76xawETOm0NMAkHkZI1JKZgiHg5LqO17QOvD4C+mw?=
 =?us-ascii?q?g1C2nDds3fDGMaXtApTLLnfdjLfsZahx51JYxQYp0NxS6YxYBqscLP/wRkP9rt?=
 =?us-ascii?q?3VAx0hPwyx2ennCdF91o0EWWKIB6+UKKfSsV6O5uIyLOiAfYwVtyjnK/gj+fHu?=
 =?us-ascii?q?iWY1mVgTfKmvw5QXcmu1HuppI0qHe3rgmNQBHnkQvgo4UuPqjEeOUTlJZ3a9R6?=
 =?us-ascii?q?48/C00CJq6DYffQYCgmLiB3Ca4HpJIfGxHBU2MHGzsd4WFXfcMdS2TLtVgkjwC?=
 =?us-ascii?q?SbiuVYsh2Quyuw/9zrptNvDU9TEAtZL/yNh14PXelREo+jx1E8SSyWaNQ3t0nm?=
 =?us-ascii?q?MVXTA22q9/rFd5yleC16h4nvNZGcZS5/NPTgc1K5rcw/ZmBND1XwLLZs2JR0q+?=
 =?us-ascii?q?QtW6HTExSco8w90JY0ljAdmijRfD3yysA78SjLGLAJ008qTB33n+Pcp9ynDG1L?=
 =?us-ascii?q?U/gFkiWMdAKWqmhqtn/QjJG4HJi1mZl7qtdakExiHN72eDzW2NvE1CSg5/S6fF?=
 =?us-ascii?q?UGsbZkvXq9T5+0zDQ6WvCbQhLgtO18qCJrFWZd3uiFVMXO3jN8jGY2Kth2ewAg?=
 =?us-ascii?q?6FxrCWY4rsYWkd2CTdB1ICkwAc5nuGMQk+BiG8o2PRFjBuFFTvY1/y/ul6sn+0?=
 =?us-ascii?q?Ukg0zwSSZU17y7W14gIVheCbS/4Lw70LojkhpCtuEFa9xd3WDcGAqBRnfKlbZd?=
 =?us-ascii?q?M941JH1WbCugx5P5ygKb1ih1EEfwR2uUPuywt4CoFancc2q3MqyRJ4KbiE31NZ?=
 =?us-ascii?q?azOYwZfwN6XKJWbo4hCgdbTa2lHE39aQ4acA9vI4pk7nvAGoEEoi7npm38NU03?=
 =?us-ascii?q?ua+pXFEg4SXYjtXUYw8hhwv6vabTUl54PIyX1sNrG5siPD29IsA+sl1hagftdF?=
 =?us-ascii?q?PKOYDgPyFNcaB8yvKOwslFikdRYEPOFU9K4pMMKqbfqG2Ki3POl+mDKql3hI4I?=
 =?us-ascii?q?d40kiU7SpzVvbI34oZw/GfxgaITTP8g0mus8/pmYFIfyodHneixif+Ao5RZapy?=
 =?us-ascii?q?fZgQBGeqIs23wMh+hpH3V35Z8l6jG00J2MuzdRWOaFz92BVa1V4Lrny/hSu40z?=
 =?us-ascii?q?t0nikpr6qCxiDB3/7udRsHOmFRQmligkzhIYy1j9AcQUipYBIllBqj5Ubm2adb?=
 =?us-ascii?q?oL5zIHXUQUdNZyL2NX1tUrOstrqeZM5C8IkosSRLX+ume1CVV7n9rwEc0yz9BW?=
 =?us-ascii?q?texSk3eC2wtZX9ghN1lnidLHF1rHfCfcFwxBHf5MHTRPJL3zoGQjV4hifTBlSm?=
 =?us-ascii?q?I9ap+tCUnY/Zsu+iT2KhSoFTcS7zwIKAtSu3/21rDQekn/CunN3qCgw60S7919?=
 =?us-ascii?q?l3WiTEthf8Yo/316ukNeJrZFVnBFj568BiAIFxjpMwhI0M2XgdnpiV/2AIkX3w?=
 =?us-ascii?q?MdVY3qLydmENSiQIw97W4Qjl3lNsLnSSyoL9V3WdxNZhZtagbmMX3CI9895FCK?=
 =?us-ascii?q?OO4LNYmit1p0KyrRjNbvhlgjcd1fwu5WYagu4Tvwoh1CedArEUHURDOSzslhKI?=
 =?us-ascii?q?782xralNZWavd6Sw21R6ndy7EL6CpQRcUm7jepg+BS9w8tl/MFXU3X3w8I7kec?=
 =?us-ascii?q?PcbdIOthKOlRfAgPNYKJYwlvoMmCpmNnjxvXwjy+4nkxNu2Yu2s5SAK2Vo5Ki5?=
 =?us-ascii?q?GAJXNiXpZ8MP/THglaNenseV34+1BJlgFCsEXID0Tf22CjIdruroNxyBEDAnrn?=
 =?us-ascii?q?ebGLzfHRKQ6Ut8rnLPFYyrOG+TJHUD0dpiQxydLlRFgA8IRDU6goI5Fgeyycz9?=
 =?us-ascii?q?d0d54yod51/ipRtK1+JoLAL/UmbEqQesazc0ToWfLRVM4gFD4UfVLdKR7uZpEy?=
 =?us-ascii?q?5E+Z2hqRSHKnaHaARQEWEJRkuECkj4Mba04tnA9/WYCvC6L/vTeriOre1eV/GV?=
 =?us-ascii?q?xZOgyIdm/jCMNtmRMXlmFfE0xk1DXXVhEcTDhzoPUzAXlz7Kb8ODphez4Ch3od?=
 =?us-ascii?q?6k8PjxRALj/4iPC6ZRMdVy/RC5m7yDOvWUhCZ4LzZYy5wNyWXJyLgZwF4dlSVu?=
 =?us-ascii?q?eyOxHrQHsC7HVLjQlbNPDx4HdyNzM9NF7qI73glQIM7bl8n61rhigv4uDFdFU1?=
 =?us-ascii?q?Phl9qtZcwLJWG9KVzGCFyKNLSAOT3E3cX3bbmgRr1XieVerwewtiqDE0//IjSD?=
 =?us-ascii?q?kCHkVxCxPuFNjyGbPx1etJu+chZ3DmjjQ8zpagemMN9sljA2xbw0hnXXNW8TKz?=
 =?us-ascii?q?R8ckVNrqGO4iNcmPlwB2tB7n99J+mehymZ9/XYKooRsfZzGCt0ivlV4G4kxLpV?=
 =?us-ascii?q?9i1EQP11lTDWrt5vpVGmj+aOxiBmUBpItjZEmoaLsV9+NqXe85lKQWzE8w4V7W?=
 =?us-ascii?q?WMFxQKoMNoCsHuu6BV0NTAiLj/JytC893K+8sRHMzUKMOBMHo8PhvlAj/UDA0Z?=
 =?us-ascii?q?TTG1MWHTnVBSkPaX9neNtJg1toDsmIYSSr9cTFE0FukVCkJgHNwDJpd4RjIlkb?=
 =?us-ascii?q?6Bg84O6nqztx3RRMRcvpDaWfOeG/TvKDCFjbZaYxsE26/3LYMWNt6z50s3blh8?=
 =?us-ascii?q?gZSPEk/UWt9MqQVlbxQouwNM9nZkR2E+0k6jbRmipDcVHOSxhQIsjQ1xSe4k5T?=
 =?us-ascii?q?Pt6U06YFHNoW94kkMrhNPonRibeS/1La2qUMddDC+nmVI2N8beShxpbAv6t0h5?=
 =?us-ascii?q?MTrCXK5QibRkPTRugRXAuJ0JE/pBSKBCewMRw/6TT/ov1ltYpyCuxEsB7uzAX8?=
 =?us-ascii?q?gx3DA2eIKh+ioTkzloa8Q4cPTd?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AoAABuIfdbh0O0hNFiHgEGBwaBUQkLA?=
 =?us-ascii?q?QGBL4E5gQInjHCLIYIhlyaBcRQBARgNBgGIUiI0CQ0BAwEBAQEBAQIBEwEBAQg?=
 =?us-ascii?q?NCQgpIwxCAQwBgWYigmgBAwIvAQ0BOAEDAgkCBUsDJQwBBQEjF4McAYFoAQMVA?=
 =?us-ascii?q?QQKnGQ8jDyCdwWBMQGCfgpADYIRAgYSh0yDD4EcgVc/hz4DAQGHOQKgAgcCghw?=
 =?us-ascii?q?EhFyGGIQQI4FZTYcrCyuHAY1DikYCBAIEBQIFDyGBJYINNDxdDBiCOwkKggiDb?=
 =?us-ascii?q?YUUhT8/MgEBgQMBAYFMiwkBAQ?=
X-IPAS-Result: =?us-ascii?q?A0AoAABuIfdbh0O0hNFiHgEGBwaBUQkLAQGBL4E5gQInjHC?=
 =?us-ascii?q?LIYIhlyaBcRQBARgNBgGIUiI0CQ0BAwEBAQEBAQIBEwEBAQgNCQgpIwxCAQwBg?=
 =?us-ascii?q?WYigmgBAwIvAQ0BOAEDAgkCBUsDJQwBBQEjF4McAYFoAQMVAQQKnGQ8jDyCdwW?=
 =?us-ascii?q?BMQGCfgpADYIRAgYSh0yDD4EcgVc/hz4DAQGHOQKgAgcCghwEhFyGGIQQI4FZT?=
 =?us-ascii?q?YcrCyuHAY1DikYCBAIEBQIFDyGBJYINNDxdDBiCOwkKggiDbYUUhT8/MgEBgQM?=
 =?us-ascii?q?BAYFMiwkBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,267,1539673200"; 
   d="scan'208";a="53016195"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 22 Nov 2018 13:40:30 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2404924AbeKWIVl (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 03:21:41 -0500
Received: from mail-wm1-f67.google.com ([209.85.128.67]:40048 "EHLO
        mail-wm1-f67.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2392303AbeKWIVk (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 03:21:40 -0500
Received: by mail-wm1-f67.google.com with SMTP id q26so10283420wmf.5;
        Thu, 22 Nov 2018 13:40:25 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=20161025;
        h=from:to:cc:subject:date:message-id:mime-version
         :content-transfer-encoding;
        bh=lEf8ew0Ss4HaxFBLQGgMBaQ8orjd3JGzoZQYwrnpOho=;
        b=c+0FW+UsFQsYAXLL+CBALS5Zo99mFTdv/eaOWmTVmpZ/pybf+1wawSeZSY9tkNwe1y
         Q01BoMR9EoM/oVOlQKrdLnvRdCz/k0YiQlxY3eN/jXeKMLQZrI20FM0e0B35o+Ib0xgm
         OKh2yV0oC88h3+YPPZ8Hp4pIjPH1nKtdHrFluDOd90Txgqm1/TXY/bAlgqm3WtKS7L5x
         EJDAPeBDUSumtXKBLRLRFkAdYoT8da3RxK1ZBxIis23EL3HCQ7z2vI0FRMcJMgCoNSC/
         D5BtVV9/m1F8v7490+B2SkMytpFlySd7/5aEMGYBbs41RKdT4bEvUhDtRqRsrwCLm8Rt
         hHwQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
         :content-transfer-encoding;
        bh=lEf8ew0Ss4HaxFBLQGgMBaQ8orjd3JGzoZQYwrnpOho=;
        b=TxFPF4LQAywO/TTvuMnW3oaay5vd5yooGuHciIvYsQlQevFJt+abDDJzauNfU4xEXJ
         G974k6JIXFNrQyQGbiNEAIvpRw2yAFvGw51mNvKEZFJfGugynvOfsYetizxOYjTyoVwg
         baDJG6+xb0KdgbbtpHljTm4nFG7EDajnOHiTUD6Q/bBfacKZUwZ43xC9Fd5Ig4GOvx46
         JqN557V2/S5QLbxx5Rd3ZiPdH6WjO8HVQ1iS82UXARM9F3vsvzLn/esODtD9ONqLpDgu
         f4lCAthfA3w7CbHgvUcvVaKplakB5DxgwH/7ZJyb7EO8hhNczVOJ19wH6gRTmnoLHEF8
         +oUg==
X-Gm-Message-State: AA+aEWbpARnvbBToByJy0bonoDW6QgD9Pfelx59v4RZNvlhDCn+GIklY
        MUybiDPXSwZ2poz9ZIjDJZU=
X-Google-Smtp-Source: AFSGD/VfvVHFl0/Y2tUX0BQO4pqUG7sfex/TALv9EU7wYgCJsc7WmP5OsDuSMae1TqDcHMtUp2KgjA==
X-Received: by 2002:a1c:bb42:: with SMTP id l63mr9652709wmf.47.1542922824760;
        Thu, 22 Nov 2018 13:40:24 -0800 (PST)
Received: from blackbox.darklights.net (p200300DCD732F5007DE18DA1F72FF8D9.dip0.t-ipconnect.de. [2003:dc:d732:f500:7de1:8da1:f72f:f8d9])
        by smtp.googlemail.com with ESMTPSA id x14sm29755554wrm.65.2018.11.22.13.40.23
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Thu, 22 Nov 2018 13:40:24 -0800 (PST)
From: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
To: linux-amlogic@lists.infradead.org, narmstrong@baylibre.com,
        jbrunet@baylibre.com
Cc: mturquette@baylibre.com, sboyd@kernel.org,
        linux-clk@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
        linux-kernel@vger.kernel.org,
        Martin Blumenstingl <martin.blumenstingl@googlemail.com>
Subject: [PATCH v2 0/4] Meson8b: add the CPU clock post-dividers
Date: Thu, 22 Nov 2018 22:40:13 +0100
Message-Id: <20181122214017.25643-1-martin.blumenstingl@googlemail.com>
X-Mailer: git-send-email 2.19.1
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

This is the successor to my previous series "meson8b: add the CPU_DIV16
clock for the ARM TWD" from [0]. I decided to not send this as v2 of
the original series because the PERIPH clock is not the CPU_DIV16 clock.
It's not clear whether a CPU_DIV16 clock exists.

With this series we get all the CPU_CLK post-dividers as listed in the
public S805 datasheet [1] on pages 31 and 32:
- ABP
- PERIPH (used as input for the ARM global timer and ARM TWD timer)
- AXI
- L2 DRAM

Each of these clocks has a register called "..._CLK_DIS" which is
documented as a "just in case" bit:
"Set to 1 to manually disable the [...] clock when changing the mux
selection. Typically this bit is set to 0 since the clock muxes can
switch without glitches."
Since we're not supposed to touch that register we're using the new
read-only gate clk_ops to ensure that nothing accidentally modifies
these bits.

The result of this is that we can use the PERIPH clock which clocks
the ARM TWD timer. I will send a separate series to add the TWD timer.


changes since v1 at [2]:
- added new patch 2 "clk: meson: clk-regmap: add read-only gate ops"
- switched from CLK_IS_CRITICAL to the new clk_regmap_gate_ro_ops
  so we're consistent with all other read-only clocks
- collected Jerome's Acked-by tags (thanks!)


[0] http://lists.infradead.org/pipermail/linux-amlogic/2018-July/007890.html
[1] https://dn.odroid.com/S805/Datasheet/S805_Datasheet%20V0.8%2020150126.pdf
[2] https://patchwork.kernel.org/cover/10687023/


Martin Blumenstingl (4):
  dt-bindings: clock: meson8b: export the CPU post dividers
  clk: meson: clk-regmap: add read-only gate ops
  clk: meson: meson8b: rename cpu_div2/cpu_div3 to
    cpu_in_div2/cpu_in_div3
  clk: meson: meson8b: add the CPU clock post divider clocks

 drivers/clk/meson/clk-regmap.c           |   5 +
 drivers/clk/meson/clk-regmap.h           |   1 +
 drivers/clk/meson/meson8b.c              | 264 ++++++++++++++++++++++-
 drivers/clk/meson/meson8b.h              |  17 +-
 include/dt-bindings/clock/meson8b-clkc.h |   4 +
 5 files changed, 278 insertions(+), 13 deletions(-)

-- 
2.19.1

