Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 26 Nov 2018 08:52:36 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga001.jf.intel.com (orsmga001.jf.intel.com [10.7.209.18])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id E8B8C5803C2;
	Sun, 25 Nov 2018 14:55:42 -0800 (PST)
Received: from orsmga106.jf.intel.com ([10.7.208.65])
  by orsmga001-1.jf.intel.com with ESMTP; 25 Nov 2018 14:55:42 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3Ahe+3Qha+0SwYP/u5MlX12Jj/LSx+4OfEezUN459i?=
 =?us-ascii?q?sYplN5qZpcm+ZB7h7PlgxGXEQZ/co6odzbaO4+a4ASQp2tWoiDg6aptCVhsI24?=
 =?us-ascii?q?09vjcLJ4q7M3D9N+PgdCcgHc5PBxdP9nC/NlVJSo6lPwWB6nK94iQPFRrhKAF7?=
 =?us-ascii?q?Ovr6GpLIj8Swyuu+54Dfbx9HiTahYr5+Ngm6oRnMvcQKnIVuLbo8xAHUqXVSYe?=
 =?us-ascii?q?RWwm1oJVOXnxni48q74YBu/SdNtf8/7sBMSar1cbg2QrxeFzQmLns65Nb3uhnZ?=
 =?us-ascii?q?TAuA/WUTX2MLmRdVGQfF7RX6XpDssivms+d2xSeXMdHqQb0yRD+v9LlgRgP2hy?=
 =?us-ascii?q?gbNj456GDXhdJ2jKJHuxKquhhzz5fJbI2JKPZye6XQctQHS2pcRcZRTzJODZ+g?=
 =?us-ascii?q?b4UBCOoBOPxXr4j7p1ATqRezCg2hCObpxzRVhHH5wLc63vwvHw/GwgIuAtEAsH?=
 =?us-ascii?q?rbo9rpKagdU+66zLLQzTjBdP5W1ivx5ZLSfxw9u/yAQ7R9etfRx0k1EAPFi02d?=
 =?us-ascii?q?p5b/MDOLyOsNt3WQ4e16Wu2zi24otQJxqSWoy8c0kIbJmJwaylTf+CVk3Ik0K8?=
 =?us-ascii?q?e0R1J6YNO9FpZbqi+UN4xzQsw4QmFovj43yrkHuZ6lYicKypMnxwPFa/yBaYeI?=
 =?us-ascii?q?5gjvW/qWITd9nH5qZK+/hxCz8US61uL9V8+520tJoCpditTAqGwB2hjJ5sSaRP?=
 =?us-ascii?q?Zx4F2t1SuM2gzP8O1JIEI5mbLGJ5MlwrM8jIcfvVnNEyPshkn7jbWaelgg9+Wm?=
 =?us-ascii?q?7ensf6/oqYWGN4BujwHzKqQuldK7AeQ/KgUOQWeb9vqm1LH5/k32Xq9Kjvsona?=
 =?us-ascii?q?ndqpzaIt4bpqGhDw9U1IYs9Qq/Ai+43NgEmXQLNk9JdRyZg4TzJl3DI+z0Ae2+?=
 =?us-ascii?q?jlmuiDtrwurJPrzlApXDNHjDl7LhcK55605dzgoz0N9e64tXCr4fOvLzXFH+tN?=
 =?us-ascii?q?jBAh8+PQ20xfjoCM9m24MAVmKAHLWZPLnRsVCW/OIvJfeDZIsPtDb6Mfgl6Obi?=
 =?us-ascii?q?jWUlll8FYampwZwXZWi8HvRnIEWWf2Dgg9gcEWoRugo+TerqiECNUDJJZnayWb?=
 =?us-ascii?q?486S8/CI68EYjDQYWtiqSb3CinBp1WenxGCleUHHfobYqEWusMZziVIsN7kjwE?=
 =?us-ascii?q?SKKuS4ku1Ry1sA/6yrxnLvfb+yECtJLj0sR16PPXlR0o6TN0CMGd2XmXT25ohm?=
 =?us-ascii?q?MIWyM23KdnrEx/zVeMz7J0g/9fFdxV4fNJVRw3NZrdz+x8FtDzVRjNftaPSFa6?=
 =?us-ascii?q?XNqmBSs9Qc42w98Le0x9Acmtjgjf3yq2BL8Yj6aEBIc08qLb3Hj9Pdx9xGzE1K?=
 =?us-ascii?q?Q6i1kmQ81PNXCph6Jl9gjTAZLJnFudl6qwaasc2yvN/n+ZzWWSpEFYTBJwUaLd?=
 =?us-ascii?q?UHAcfETWq8715kfDT7C0D7QnPRBMycqDKqtMd93ogk9KRPblONTCfW2xn328Cg?=
 =?us-ascii?q?qPxrOJdIDqYXkS3D3BCEgYlAAe5WuJOhIgBii/uW7eDCZhFVT0Y0zy9+lyr3e7?=
 =?us-ascii?q?TkwxzwGOdEBh07u1+hgIhf2TUf8T37QEuDs/pDVwBlqyw9XWC9+YrQp7YKpcec?=
 =?us-ascii?q?894EtA1W/BqgNyJIKgIL54il4eaQt3uVju2AtxCohblcgqrXUqzBd9KK6C0VNB?=
 =?us-ascii?q?cS+Y0o70OrHNNmby+xWvYbbM2l7CyNaW5rsP6PMgplX/vQGpE00i82ln09hVyX?=
 =?us-ascii?q?ec+o/GDA0IUZL1U0Y38Rd6qqreYik84YPUyHJtPbO1sj/Ex9ImGu8lxgy8cNdY?=
 =?us-ascii?q?NaOODBXyHNECB8iyNOwqnECkYQgAPO9M+687IcOne+Gd1662IelvhjSmjWdA4I?=
 =?us-ascii?q?BjyU+M8yt8SujV35cK2f2Y3w2HVyvig1elqMz4hYdEZTQKFGql1SfkHJJRZrF1?=
 =?us-ascii?q?fYsTCWauPte7yclki5/sW35X7lijB1wd1c+teBqSaUH93AJK2UQWp3ynhTW3zz?=
 =?us-ascii?q?hunz41qaqf2TTEw/7+exofJm5LWG5igE/2IYi1k98VRlKoYBUulBe/40b12bJb?=
 =?us-ascii?q?pKVmI2bPW0hIezX5IH94Uqu3sLqPeMpP6JIusSVKX+Wwe1GaSrjhoxQE1yPvBX?=
 =?us-ascii?q?dRxDc+dzuyoJX2gwR6iH6BLHZ0tHfYecBwyQ3f5dDGXv5RwzwGSTJ8iTnWAFi8?=
 =?us-ascii?q?Itao8c+Vl5fFruCxSWahWodPfinsyIOKrDG76nFyAR2jg/CzncXqEQog3i/h1N?=
 =?us-ascii?q?lqViLIoAznYobx1KS6MuNnfk92C1/68Md6HoB+ko0thJAfw3Qah5OV/WYZnmf3?=
 =?us-ascii?q?K9lUxaX+bH8VTz4R39HV+BTl2FFkLn+Rx4P2THKdztFjZ9m7ZGMbwSY978FMCK?=
 =?us-ascii?q?eJ471Ihyp1olykrQ3PZfhxhCsSyfwr6HQCmeEGpBItzjmBArAVBURYPjbjlxWS?=
 =?us-ascii?q?49C+saVYfmCvcber2Up6nNChCqyCow5GVHb4fJciATF/7sFlPF3Q133z75nueM?=
 =?us-ascii?q?PMYtILqh2UjxDAgvBQKJIwlfoFnzBrOGzjsn0+1+40kwZu0oqks4idJGVg56a5?=
 =?us-ascii?q?Ah9eNj3oaMIf4DDtjaBCnsmI24CjBIluGjIOXJHwV/KnDCoStej7NwaJCDA8tn?=
 =?us-ascii?q?CbGb/FEQ6e8khmqW/PE4uwN3GWP3QZydRiRB+AJE1QmgwUXTM6noInGQCu3sDu?=
 =?us-ascii?q?bEB55jUJ7F7ithRM0v5oNwX4UmrHvwincDA0SJyCLBZM6gFC+lzYMcif7uJ1Ai?=
 =?us-ascii?q?FZ8YetrA2LKmyHeQtICXsFVVCDB1DmJrOu/8XP8/CEBuqiKPvDebeOpvZbV/iW?=
 =?us-ascii?q?3pKjyJdm8yyPNsWSPXliEvs71VBYXX1iH8TZmjMPSzEYli7Xbs6bogu89TNzrs?=
 =?us-ascii?q?yl7PvrXwfv75OVC7ROKdVv5wy2gaCbOu+QgyZ5NC9Y1o4Wyn/O0rQfx1kSiydh?=
 =?us-ascii?q?dzS2FbQAtCjNTL/fm6NNDh4bbT9zO9VM764mwgZNPsvbgMvv1rFklv41F0tFVV?=
 =?us-ascii?q?v5l8Gpe8MKImK9NFDGBEqRN7SGPzrLw87pbqOmVL1Ql/5ZtxmxuTadDk/iMS6P?=
 =?us-ascii?q?lzjvVxCzL+5MiDuXMwBZuIG4ahxtE3TsTMr6ah2nN996lSc5waAviXPQK2EdMS?=
 =?us-ascii?q?Jwc0dMrrCL6SNYg/N/G3FO73Z/LOmEnTqZ4PfcKpoMrfRrBSF0nfpA4Hsm07tV?=
 =?us-ascii?q?8D1ERPttlSvOr95upkuqnfWVxjV7UBpBtDBLiZmPvUVjP6XZ65ZBVWzF/BIL8W?=
 =?us-ascii?q?WfFRAKq8F5Bd3ovqBa0sLPm77rKDde79LU+tMRBsjOJ8KBNXohMBzpFybVDQsF?=
 =?us-ascii?q?VzGrM27fildZkPGT8H2Vs5c7poLtmJoIVr9USlg1GukGBURiGdxRaKtwCxYtja?=
 =?us-ascii?q?KbgdFA2nu6px7BDJFFv5TDR9qTB/v1ITqUhLUCYAEHl+DWN4MWY7XyxUFmInxz?=
 =?us-ascii?q?l4THGAKERdlTrylJcwQr5k5fpistBlYv0l7oP1v+qEQYEuS5y1tr0wY=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0A0AABoJ/tbh0O0hNFhFgMBAQEBAQEBA?=
 =?us-ascii?q?QEBAQEHAQEBAQEBgVQBAQEBAQELAYJpgQIniH6PEYINFI1wiUyBWQEUHQsIAYh?=
 =?us-ascii?q?aIjcGDQEDAQEBAQEBAgETAQEBCA0JCCkjDII2JIJjAQIDAQJ2BgkBAQoOCgklA?=
 =?us-ascii?q?wwFGDETBYMcAYIBBAEKplWKCA+CbYkcF4F/gyV+gxALA4EtARIBEoNCgiYCixG?=
 =?us-ascii?q?UcQmCIIRciigjClWBR45iLI0XjEmBBnEzGggwgycJghsDF4NKKIorPjMBAYEDA?=
 =?us-ascii?q?QGJfw0XgicBAQ?=
X-IPAS-Result: =?us-ascii?q?A0A0AABoJ/tbh0O0hNFhFgMBAQEBAQEBAQEBAQEHAQEBAQE?=
 =?us-ascii?q?BgVQBAQEBAQELAYJpgQIniH6PEYINFI1wiUyBWQEUHQsIAYhaIjcGDQEDAQEBA?=
 =?us-ascii?q?QEBAgETAQEBCA0JCCkjDII2JIJjAQIDAQJ2BgkBAQoOCgklAwwFGDETBYMcAYI?=
 =?us-ascii?q?BBAEKplWKCA+CbYkcF4F/gyV+gxALA4EtARIBEoNCgiYCixGUcQmCIIRciigjC?=
 =?us-ascii?q?lWBR45iLI0XjEmBBnEzGggwgycJghsDF4NKKIorPjMBAYEDAQGJfw0XgicBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,279,1539673200"; 
   d="asc'?scan'208";a="41466817"
X-Amp-Result: UNSCANNABLE
X-Amp-File-Uploaded: False
Unscannable: 2
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 25 Nov 2018 14:55:39 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726143AbeKZJrs (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Mon, 26 Nov 2018 04:47:48 -0500
Received: from atrey.karlin.mff.cuni.cz ([195.113.26.193]:51412 "EHLO
        atrey.karlin.mff.cuni.cz" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726032AbeKZJrs (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 26 Nov 2018 04:47:48 -0500
Received: by atrey.karlin.mff.cuni.cz (Postfix, from userid 512)
        id C13998081B; Sun, 25 Nov 2018 23:55:30 +0100 (CET)
Date: Sun, 25 Nov 2018 23:55:33 +0100
From: Pavel Machek <pavel@ucw.cz>
To: Matthew Wilcox <willy@infradead.org>
Cc: Daniel Colascione <dancol@google.com>,
        linux-kernel <linux-kernel@vger.kernel.org>,
        Linux API <linux-api@vger.kernel.org>,
        Tim Murray <timmurray@google.com>,
        Primiano Tucci <primiano@google.com>,
        Joel Fernandes <joelaf@google.com>,
        Jonathan Corbet <corbet@lwn.net>,
        Andrew Morton <akpm@linux-foundation.org>,
        Mike Rapoport <rppt@linux.vnet.ibm.com>,
        Roman Gushchin <guro@fb.com>, Vlastimil Babka <vbabka@suse.cz>,
        "Dennis Zhou (Facebook)" <dennisszhou@gmail.com>,
        Prashant Dhamdhere <pdhamdhe@redhat.com>,
        "Eric W. Biederman" <ebiederm@xmission.com>, rostedt@goodmis.org,
        tglx@linutronix.de, mingo@kernel.org, linux@dominikbrodowski.net,
        pasha.tatashin@oracle.com, jpoimboe@redhat.com,
        ard.biesheuvel@linaro.org, Michal Hocko <mhocko@suse.com>,
        David Howells <dhowells@redhat.com>, ktsanaktsidis@zendesk.com,
        "open list:DOCUMENTATION" <linux-doc@vger.kernel.org>
Subject: Re: [PATCH] Add /proc/pid_generation
Message-ID: <20181125225533.GB30242@amd>
References: <20181121201452.77173-1-dancol@google.com>
 <20181121203150.GK3065@bombadil.infradead.org>
 <CAKOZueuCYOsaHZzoz5nNPr8Jb-fEiHTR4MektaJx8vuUXcrKCQ@mail.gmail.com>
 <20181122020633.GN3065@bombadil.infradead.org>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
        protocol="application/pgp-signature"; boundary="TRYliJ5NKNqkz5bu"
Content-Disposition: inline
In-Reply-To: <20181122020633.GN3065@bombadil.infradead.org>
User-Agent: Mutt/1.5.23 (2014-03-12)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org


--TRYliJ5NKNqkz5bu
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Wed 2018-11-21 18:06:33, Matthew Wilcox wrote:
> On Wed, Nov 21, 2018 at 12:38:20PM -0800, Daniel Colascione wrote:
> > On Wed, Nov 21, 2018 at 12:31 PM Matthew Wilcox <willy@infradead.org> w=
rote:
> > >
> > > On Wed, Nov 21, 2018 at 12:14:44PM -0800, Daniel Colascione wrote:
> > > > This change adds a per-pid-namespace 64-bit generation number,
> > > > incremented on PID rollover, and exposes it via a new proc file
> > > > /proc/pid_generation. By examining this file before and after /proc
> > > > enumeration, user code can detect the potential reuse of a PID and
> > > > restart the task enumeration process, repeating until it gets a
> > > > coherent snapshot.
> > > >
> > > > PID rollover ought to be rare, so in practice, scan repetitions will
> > > > be rare.
> > >
> > > Then why does it need to be 64-bit?
> >=20
> > [Resending because of accidental HTML. I really need to switch to a
> > better email client.]
> >=20
> > Because 64 bits is enough for anyone. :-) A u64 is big enough that
> > we'll never observe an overflow on a running system, and PID
> > namespaces are rare enough that we won't miss the four extra bytes we
> > use by upgrading from a u32.  And after reading about some security
> > problems caused by too-clever handling of 32-bit rollover, I'd rather
> > the code be obviously correct than save a trivial amount of space.
>=20
> I don't think you understand how big 4 billion is.  If it happens once a
> second, it will take 136 years for a 2^32 count to roll over.  How often
> does a PID roll over happen?

Well, the cost of 64-bit vs. 32-bit is really small here... I'd go
with 64bits. If you have 1000 CPUs, rollovers may be faster..

Best regards,
									Pavel
--=20
(english) http://www.livejournal.com/~pavelmachek
(cesky, pictures) http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blo=
g.html

--TRYliJ5NKNqkz5bu
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iEYEARECAAYFAlv7KGUACgkQMOfwapXb+vKUpACguxRTw5+EBG5s9D4iEpat3sen
udYAnRn+k2NI+lNteoHed7ikYIohN7P4
=pK2+
-----END PGP SIGNATURE-----

--TRYliJ5NKNqkz5bu--
