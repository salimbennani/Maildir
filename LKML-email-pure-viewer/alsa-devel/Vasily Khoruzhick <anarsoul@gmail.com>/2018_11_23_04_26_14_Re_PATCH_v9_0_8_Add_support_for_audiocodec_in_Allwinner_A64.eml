Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 13:08:05 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga004.jf.intel.com (orsmga004.jf.intel.com [10.7.209.38])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 5CE4558037D;
	Thu, 22 Nov 2018 20:26:22 -0800 (PST)
Received: from orsmga101.jf.intel.com ([10.7.208.22])
  by orsmga004-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 20:26:22 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3A1c5jYBG82i87NMmqW0HeI51GYnF86YWxBRYc798d?=
 =?us-ascii?q?s5kLTJ75o8q6bnLW6fgltlLVR4KTs6sC17KG9fi4EUU7or+5+EgYd5JNUxJXwe?=
 =?us-ascii?q?43pCcHRPC/NEvgMfTxZDY7FskRHHVs/nW8LFQHUJ2mPw6arXK99yMdFQviPgRp?=
 =?us-ascii?q?OOv1BpTSj8Oq3Oyu5pHfeQpFiCa+bL9oMBm6sRjau9ULj4dlNqs/0AbCrGFSe+?=
 =?us-ascii?q?RRy2NoJFaTkAj568yt4pNt8Dletuw4+cJYXqr0Y6o3TbpDDDQ7KG81/9HktQPC?=
 =?us-ascii?q?TQSU+HQRVHgdnwdSDAjE6BH6WYrxsjf/u+Fg1iSWIdH6QLYpUjm58axlVAHnhz?=
 =?us-ascii?q?sGNz4h8WHYlMpwjL5AoBm8oxBz2pPYbJ2JOPZ7eK7WYNEUSndbXstJVyJPHJ6y?=
 =?us-ascii?q?YYUMAeUDM+ZXoIbzqEcVrRumBwShH//vxCJSi3PqwaE2z/otHAfb1wIgBdIOt3?=
 =?us-ascii?q?HUoc36O6gISuC1za3IzDXeZP1T2Tf975LIcg0goPGMXLJ/bcnRwlQoGgzfiFWf?=
 =?us-ascii?q?s5blPyiS1uQQt2iW9OVgVee1hG4mrwF9uCSgxsApioTQgI8e11PK9T1hzYorOd?=
 =?us-ascii?q?G1TFR3bcOqHZdOrS2WKoh7Tt84T2xpuis20qMKtYO6cSQQypkr2gTTZ+GDfoWG?=
 =?us-ascii?q?+B7vSemcLSt+iXl4YrywnQyy/lKlyuDkVsm7zlJKri1dn9nSuXACyQbT5tKESv?=
 =?us-ascii?q?Rj5Eeh3yiA1wTJ5uFDO0A0mrLXK58nwrEuipoeqVrPEjPylUnskaObeFso9vK1?=
 =?us-ascii?q?5+nkfrnqvJ6ROo1shgH7KKsum8i/AeoiMggJWmiW4eC81Lzl/U3kT7RGl/42nb?=
 =?us-ascii?q?fDsJDcO8sbore1Awhb04Yl9Rm/FSyr0MoXnXYZNlJJYhGHgJbzO1HIPv/4Ce2z?=
 =?us-ascii?q?g1O2kDdk3/zGJKHuAo3RLnjfl7fsZbJ9609fyAUt19xe6I9UB6oFIPLyXE/xqd?=
 =?us-ascii?q?PZAgU4Mwyy3+boFtF92pkCVmKIB6+TKLnSvkOQ5uIzP+mMY5cYuDbnJPgk+/7h?=
 =?us-ascii?q?l3g5lUUdfam0x5QXbn+4E+9iI0WYZ3rsn9gAHX0Lvgo4UOzlllmCXSRPaHa1Wq?=
 =?us-ascii?q?I2/is7B56+DYffWoCth6SM3CW8HpJIfGxGCVeMEXHud4WDQPoMbCOSIsl8kj0L?=
 =?us-ascii?q?T7ShSokh1Q2wuw/+0bZoMu3U+igAv5L5yNd1//HTlQ019TFsFcudyGGNT2Z3nm?=
 =?us-ascii?q?8SXT85xqJ/rFd5yleC16h4nvNZGcZS5/NPTgc1K5rcw/ZmBND1XwLLZs2JR0q+?=
 =?us-ascii?q?QtW6HTExSco8w9wUbEZ7AdmiihHD0DCsA78ajLGLAJ008qTB33n+Pcp9ynDG1L?=
 =?us-ascii?q?U/gFkiWMdAKWqmhqtn/QjJG4HJi1mZl7qtdakEwSHC7nmDwnSUsEFYSgFwV77F?=
 =?us-ascii?q?Um4ZZkfRqdT55UbCT7u1BLQjMwtBz9OCK6RQZt3oi1VGWOnsONDEb22tnGewAA?=
 =?us-ascii?q?6CxqmQY4ryZ2UdwCLdBVAZnA8J43aJKxIyBie7rGLYFzxhC1Tvbljo8el/rnO7?=
 =?us-ascii?q?U0A1wxuLb01ny7q65BoVieaARPMU27IOoD0hpClsHFahw9LWDMKNpxZgfKVZZt?=
 =?us-ascii?q?M9/FdH1GLDuwxhJJCgKLpihlofcwRxsEPjzBF3CoRGkcg3o3Im1gtyKaSE0Fxf?=
 =?us-ascii?q?czOUx4z/OrrSKmPq5hCgd7bW2k3C0NaR4qoA8vA4pEvsvQ63Fksu6W5o08RI3H?=
 =?us-ascii?q?SG4JXKDw0SUYzqX0Yz9hh6oazaYyYn64PV031sLbe7sjvY1901A+slzw6qf81D?=
 =?us-ascii?q?P6OcCA/yD8oaCtCuKew3gVSmcggIPeFS9KEuOcOmeOCL2KqqPOZmgTKngn5L4I?=
 =?us-ascii?q?F70kKQ6SV8TvTE0IoCw/GdxgGHTSvzjE+9ssDrnoBJfSsSHmujxif+Ho5ee6py?=
 =?us-ascii?q?cZwNCWiwOc23x8xyiIL3VH5c6VGsGUkG2MiveReJa1z93AtQ1VkYoHC9mCu4yS?=
 =?us-ascii?q?B0nC8trqaFwCPOxOHifgIdOmFXXGlikUvsIY+sgtEaXUikdQgomAG+5UbnwahW?=
 =?us-ascii?q?v6B/L2jVQUdVcCn6NWBiUq2strWcZ85D8o8nsSJSUO6ke1CVVqb9owcG0yPkB2?=
 =?us-ascii?q?Zexio0dyupupX6mBx2knmdI2xwrHraeMFwwwnQ5NrHSP5V3zoGQjR4iDbNCli9?=
 =?us-ascii?q?Odmp4cubl5PZvu+iUGKhU4VZcTP3woOYqCu7+WpqDAW/nv+pnd3rCwo60S7919?=
 =?us-ascii?q?RxUSXIrRD8YpTk1qigMOJneFVoC0H468ZgBo5+lY4wjokK2XcGnpWV4WYHkWDr?=
 =?us-ascii?q?PNVYw63+bWABRT4Ww9HP5gjl11ZuLnaIx4L/S3WczdFtZ9i8YmMKxC0969pGB7?=
 =?us-ascii?q?uT7LxBhSF1uEa3rRrNYfhhmTcQ0f4u6H8Zg+4TogYswDuSAqsOHUZGJyzjjAqH?=
 =?us-ascii?q?78qxrKhMYGavcL6w1FdxnNy7DbGCpB1cV2j9eps4ASBw6cB/OkrW0HLv8oHkZM?=
 =?us-ascii?q?XQbdULux2IlBfAivJZKZMrmfoMmCpnInn9vXw+xu4/jBxu24y6vYedJ2Vs+qK5?=
 =?us-ascii?q?HgBXNjnva8wP/THtiL5UntyK0IC3ApVhBjILUYPzQv2yFzISsennOxyKED0hsX?=
 =?us-ascii?q?qbHbvfHQmC6EZptX7PEparN22JK3kd19ltWB6dJElHigAOQDo6hoI5FhytxMH5?=
 =?us-ascii?q?ckd2/DUR6UDjqhdW1uJkLRr/UnrcpAe1bDc7UoOfIQFS7gFD4UfVLMOf4vhyHy?=
 =?us-ascii?q?Fe4p2usgiNJnaHaARPCGEDQlaECEz7Prmy+dnA9PCVB+q5L/vTeLWOtPZRV/GS?=
 =?us-ascii?q?yZK01Ytm+TmMO96LPnljCf07x0VCUWp4G8TfhzUAVSgXmzjRYM6coRe24jd3od?=
 =?us-ascii?q?yn8PT3RALv4pOCC7tMPtVu+BC2gqaDO/SThCZjLjZY2Y0DxWXVyLgEx1MSjyBu?=
 =?us-ascii?q?dz+wEbUPryLNTaTQmrNJAB4fcS98KMxI76ck1AlXJcHbks/11qJ/jvMtEVhFSE?=
 =?us-ascii?q?fumtu3as0KOW29MFLHCV2PNLSHIz3L3s72bbm9Sb1WkOVbqRmwtSyHHE/kOzSJ?=
 =?us-ascii?q?jyPpWAy3MeFQkCGbOwRTuJ28chZoE2TsUMjqZQG7MNBpiz072rk0hnLMNW4BPj?=
 =?us-ascii?q?lwaUJNrruM7SxGhvVzAXBO7n1gLeOcgSaW8/HYKooKsftsGil1l/hV4HI/y7tU?=
 =?us-ascii?q?6iFLXP10mCvIod5orFGrie2PyjthUBpTpTdHnoOLvUN+OarH8plMQ2rL/BUI7T?=
 =?us-ascii?q?bYNxNfjNtoDJjepuhs0dHO3PbsJTFZ29nP/MZaANLbfpGpKn0kZCTgAz/QHUMm?=
 =?us-ascii?q?TTmxKHPfhkde2KWb8HSPtZ8nrrDjnZMPTvlQU1ljRaBSMVhsANFXeMQ/ZTgji7?=
 =?us-ascii?q?POyZdQvXc=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AnAAAxgPdbh0O0hNFiHQEBBQEHBQGBU?=
 =?us-ascii?q?QgBCwGCXYEOJ4wRX4tyBoE1FIkFA44fgXMSAQEYEwGBS4cHIjQJDQEDAQEBAQE?=
 =?us-ascii?q?BAgETAQEBCA0JCCkjDII2JAGCYQEBAQECAQECNwYBGx0BAwEBCQEBBQUYCRUQA?=
 =?us-ascii?q?wwBEQIRAQUBHAYTBYMcgWkBAwgFCAWbcjyMHwUBF4J3BYQtChknDVqBNwIGEoV?=
 =?us-ascii?q?fVIQogRwXeIEHgRGCZC6CVogDApAQhSaKHi4JjgSDQwoCiUWHN4dUhnmJPAYCC?=
 =?us-ascii?q?QcPIYElgg1wFYMnghuDbYpzHzKBBAEBAYxVAQE?=
X-IPAS-Result: =?us-ascii?q?A0AnAAAxgPdbh0O0hNFiHQEBBQEHBQGBUQgBCwGCXYEOJ4w?=
 =?us-ascii?q?RX4tyBoE1FIkFA44fgXMSAQEYEwGBS4cHIjQJDQEDAQEBAQEBAgETAQEBCA0JC?=
 =?us-ascii?q?CkjDII2JAGCYQEBAQECAQECNwYBGx0BAwEBCQEBBQUYCRUQAwwBEQIRAQUBHAY?=
 =?us-ascii?q?TBYMcgWkBAwgFCAWbcjyMHwUBF4J3BYQtChknDVqBNwIGEoVfVIQogRwXeIEHg?=
 =?us-ascii?q?RGCZC6CVogDApAQhSaKHi4JjgSDQwoCiUWHN4dUhnmJPAYCCQcPIYElgg1wFYM?=
 =?us-ascii?q?nghuDbYpzHzKBBAEBAYxVAQE?=
X-IronPort-AV: E=Sophos;i="5.56,268,1539673200"; 
   d="scan'208";a="41946091"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 22 Nov 2018 20:26:20 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2408095AbeKWPIs (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 10:08:48 -0500
Received: from mail-pg1-f194.google.com ([209.85.215.194]:39673 "EHLO
        mail-pg1-f194.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1730785AbeKWPIs (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 10:08:48 -0500
Received: by mail-pg1-f194.google.com with SMTP id w6so2516057pgl.6;
        Thu, 22 Nov 2018 20:26:16 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=from:to:cc:subject:date:message-id:in-reply-to:references
         :mime-version:content-transfer-encoding;
        bh=VqEM8IQ5yjLEIdNNn7VUdZSj7uxrnCxQ+hAblpVMVvc=;
        b=SahMg6pMjZZOHW65QQvnJkgUPFFBzkGFDihHGs2fCNpOWBNqLntdb32265gXQVc7Er
         67MMhhyTRbpPYtVaGR0eIyFKyXsaPdK9qcymhZvJ/vMNfzFEt4+Q2b/KfrV3FqcBOGSa
         zxjGJtnPSX9DtglAMriq1GL14FRnDzTo1xRQLaeKoVXBSwMQIhUAXJcMXPN3ACSPSoGe
         /XmIvJE9jDwWEXkiTI+YvQLjMSju6QP/YsktZlqRj3wt0jmgfM5eyb3ESEdUpq+CSeNG
         WTq32VF2jCAfUZ206r1BqOU+6c0BFGQCLAW2w4fEKLKOvBF2SyPC4EQwgCSS1mAXvUxv
         yfjA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
         :references:mime-version:content-transfer-encoding;
        bh=VqEM8IQ5yjLEIdNNn7VUdZSj7uxrnCxQ+hAblpVMVvc=;
        b=AUx0PvYwksX0SSMiD0ZoERrxIRRcWGoi+ANm3e+tBaCl9o5/t3zUhSB40O2vH5Avs6
         Goxltd7olwKxsXNrjH3Kvg6az8RF3txRwD1EdJcDGSTJdKlbLu/Gq8JzdornM44OrPAf
         ioHP2zHoL1eG2El+CXdwGBf0Zux8WSPawj64SShJ4rsyxdhMYMRyqbCVN17cmoQDE94m
         YG5eN4jIMHQkmuNB/psDzcQOkCVD7QyTJM2Kwr1L80YqvxeTsENMsAntJV13NNFGPKkS
         HuSFa+40H9gQtVlr23sOWHjSjIDGW8E4RyWcAEIqNXfapotsjvQjP9b8Sp2JQ5d1GpIn
         oaCA==
X-Gm-Message-State: AGRZ1gJZ3yMuWaU6qQ10LRFEeftBpGUPXW7B9BHX8uj3PJwkWVQdA9ko
        zx6JV24KIq6vJZtICHjXTEC4TdoT
X-Google-Smtp-Source: AJdET5dl9TzD29g76rwMho7skFjkotYQuNw1z5I4xRdOMLT5ucPdp+bmcKUZwvMna+Vua5OCaWh0FA==
X-Received: by 2002:a62:ed09:: with SMTP id u9-v6mr14035955pfh.188.1542947175979;
        Thu, 22 Nov 2018 20:26:15 -0800 (PST)
Received: from anarsoul-thinkpad.localnet (216-71-193-140.dyn.novuscom.net. [216.71.193.140])
        by smtp.gmail.com with ESMTPSA id z6-v6sm64109292pfb.77.2018.11.22.20.26.14
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Thu, 22 Nov 2018 20:26:15 -0800 (PST)
From: Vasily Khoruzhick <anarsoul@gmail.com>
To: Chen-Yu Tsai <wens@csie.org>
Cc: Mark Brown <broonie@kernel.org>,
        Liam Girdwood <lgirdwood@gmail.com>,
        Rob Herring <robh+dt@kernel.org>,
        Mark Rutland <mark.rutland@arm.com>,
        Maxime Ripard <maxime.ripard@bootlin.com>,
        devicetree@vger.kernel.org, alsa-devel@alsa-project.org,
        linux-arm-kernel@lists.infradead.org, linux-kernel@vger.kernel.org,
        linux-sunxi@googlegroups.com
Subject: Re: [PATCH v9 0/8] Add support for audiocodec in Allwinner A64
Date: Thu, 22 Nov 2018 20:26:14 -0800
Message-ID: <2007258.VzpTJLJblp@anarsoul-thinkpad>
In-Reply-To: <20181122102325.29495-1-wens@csie.org>
References: <20181122102325.29495-1-wens@csie.org>
MIME-Version: 1.0
Content-Transfer-Encoding: 7Bit
Content-Type: text/plain; charset="us-ascii"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thursday, November 22, 2018 2:23:17 AM PST Chen-Yu Tsai wrote:
> Hi everyone,
> 
> This is v9 of the A64 audio codec series, originally started by Vasily.
> These are the last changes to make the A64 audio codec work correctly,
> and be accurately represented in the device tree and in software.
> 
> Notably, the new driver changes cover regulator supplies for the simple
> audio amplifier, which is used in the Pinebook for the internal
> speakers, and the audio codec's internal headphone amp. There's also an
> extra patch that enables SDM fractional clock support for the audio PLL
> on the A64, which gives us accurate audio playback.
> 
> Patch 1 & 2 add the cpvdd regulator supply to the sun50i-codec-analog
> dt bindings & driver.
> 
> Patch 3 & 4 add a regulator supply to the simple-audio-amplifier dt
> bindings & driver.
> 
> Patch 5 adds SDM fractional clock support for the audio PLL on the A64.
> 
> Patch 6 ~ 8 add the device tree bits and enables audio on several
> boards.
> 
> I have one extra patch for the Bananapi M64 that's not included here,
> as I'm waiting for an accessory to test the microphone bias. I'll send
> that one out once it's tested.
> 
> As always, we'll take the clock and dts patches after Mark has merged
> the ASoC ones.
> 
> And a big thanks to Vasily for having worked on this for so long.

Thank you for picking it up!

Just a minor note: hpvcc-supply should be a property of codec_analog in 
sun50i-a64-pinebook.dts

Otherwise looks fine, tested on Pinebook and Pine64-LTS.

Tested-by: Vasily Khoruzhick <anarsoul@gmail.com> 

> Regards
> ChenYu
> 
> v9: - Dropped simple amplifier headphone amp device tree changes
>     - Dropped "make enable-gpio optional for simple amplifier"
>     - Lowered oversampling rate from 512 to 128
>     - Add regulator supply for audio codec CPVDD (headphone amp charge pump)
> - Hook up CPVDD regulator in board device trees
>     - Add patch to enable SDM fractional clock support for audio PLL on A64
> v8: - drop merged patches
>     - add regulator property for simple amplifier, make enable-gpio
>       optional
>     - add regulator to speaker amp, introduce headphone amp
> v7: - drop 'Mic' and 'Headset Mic' from dtsi
>     - move AIF1 Slot 0 ADC to ADC route to sun8i-codec
>     - drop BIAS routes for Pine64 and SoPine
> v6: - driver patches has been merged through ASoC tree
>     - rebase onto 4.20-rc1
>     - Drop 'Speaker' from routes on sopine and pine64, they don't have
>       speaker.
> v5: - collect all the tags
> v4: - dts: don't use 'Mic' and 'Headset Mic' widgets from sun8i-codec,
>       define our board-level widgets instead.
> v3: - renamed sunxi-adda-pr-regmap to sun8i-adda-pr-regmap
>     - use ilog2() to calculate reg value for LRCK div instead of using a
>       table
> v2: - Use simple-amplifier for speaker amp on Pinebook
>     - Rename sun50i-a64-i2s to sun50i-a64-codec-i2s to preserve compatible
>       string for other 3 I2S modules in A64 in case if there's any
>       incompatibility with H3
> 
> Chen-Yu Tsai (3):
>   ASoC: dt-bindings: sun50i-codec-analog: Add headphone amp regulator
>     supply
>   ASoC: sunxi: sun50i-codec-analog: Add support for cpvdd regulator
>     supply
>   clk: sunxi-ng: sun50i: a64: Use sigma-delta modulation for audio PLL
> 
> Vasily Khoruzhick (5):
>   ASoC: dt-bindings: add regulator property to simple amplifier
>   ASoC: simple-amplifier: add VCC regulator widget
>   arm64: dts: allwinner: a64: add nodes necessary for analog sound
>     support
>   arm64: dts: allwinner: a64: enable sound on Pine64 and SoPine
>   arm64: dts: allwinner: a64: enable sound on Pinebook
> 
>  .../bindings/sound/simple-amplifier.txt       |  5 ++
>  .../bindings/sound/sun50i-codec-analog.txt    |  2 +
>  .../boot/dts/allwinner/sun50i-a64-pine64.dts  | 27 ++++++++++
>  .../dts/allwinner/sun50i-a64-pinebook.dts     | 49 +++++++++++++++++
>  .../allwinner/sun50i-a64-sopine-baseboard.dts | 26 +++++++++
>  .../boot/dts/allwinner/sun50i-a64-sopine.dtsi |  4 ++
>  arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi | 54 +++++++++++++++++++
>  drivers/clk/sunxi-ng/ccu-sun50i-a64.c         | 37 ++++++++-----
>  sound/soc/codecs/simple-amplifier.c           |  4 ++
>  sound/soc/sunxi/sun50i-codec-analog.c         |  2 +
>  10 files changed, 197 insertions(+), 13 deletions(-)




