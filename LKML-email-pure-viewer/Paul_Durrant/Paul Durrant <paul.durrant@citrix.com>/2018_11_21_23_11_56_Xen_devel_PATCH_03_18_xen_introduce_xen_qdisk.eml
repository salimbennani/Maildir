Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 22 Nov 2018 00:34:13 -0000
Received: from icoremail.net (unknown [209.85.214.175])
	by mail-app2 (Coremail) with SMTP id by_KCgCn39yKdvVbBgjJAQ--.58297S3;
	Wed, 21 Nov 2018 23:15:23 +0800 (CST)
Received: from mail-pl1-f175.google.com (unknown [209.85.214.175])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwC3nkqGdvVbpg1kAA--.3962S3;
	Wed, 21 Nov 2018 23:15:18 +0800 (CST)
Received: by mail-pl1-f175.google.com with SMTP id t13so5938759ply.13
        for <xuliker@zju.edu.cn>; Wed, 21 Nov 2018 07:15:18 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=Nf52mGwUCvJlGZf4Cmbucs8RIjCiYmrORa7/BVdy1fY=;
        b=WFB4vVDUWWL0peO7xktXeBa3iepXp1e8WFbzwr/VK60qDXOJDmOCSDAvKnIBGqC0EB
         iDb0cyUARwu8Omiffjq4Ql/Xb5LLqnr6ReSa58EchwmfJYo1dMaq1KluCrKcnO5tnekJ
         IOyH4rRd+0bqVrWOKQyQIA7CCjM1ZwxVfzU5JOziprPf2q3yTygfKM2/cM3wpR1sh5CN
         mJ7FHZZc9HXNtHZxIwJuGE3colxT7e3FLaKmrODOTFIpVz/onv4jbgGJ4BTL/pAkkTnj
         nLjYmx4QwPXRjgefv3yJjXk+7m/nSXzFgj4tyLpo/UAXschb25iSwkol5xTicpDoB9ZS
         lKbg==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AA+aEWaAvuFnvz9dFGc/oieovHyYlm2BD05MJPdbU2rWLl8oC8ppfYTb
	zARsUEjSf5PnFxVrnW/BhypdG8ZNNaORInHm9EPKnkaYTPeLsxo=
X-Received: by 2002:a17:902:8f97:: with SMTP id z23mr7309977plo.283.1542813318021;
        Wed, 21 Nov 2018 07:15:18 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp2081165pju;
        Wed, 21 Nov 2018 07:15:16 -0800 (PST)
X-Google-Smtp-Source: AFSGD/VHdqrAEdE1zLZZMzxt3nMl3nK5rXM7pjpMurMF3Kn2rK5o4Ql3Tgt8Wu0IF/pKXMx24WqL
X-Received: by 2002:a25:4fd4:: with SMTP id d203-v6mr6748646ybb.39.1542813316454;
        Wed, 21 Nov 2018 07:15:16 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542813316; cv=none;
        d=google.com; s=arc-20160816;
        b=qa5CIDeHBPH9PnHiMpm/HNkN6KJIo9qNc5zoWBay/B8izI8YghWuRT8vItftlJLTsw
         SXyrVBDkJ4GMtS8nwmfqU48wku/jXdQhLyL5oTOsqJ6kXS9wojFe+++9dX9NJsbEk9h/
         rUZJikr/5J4R0wXSvddUeWaReLs3jAJ4Xa4nv2wO+c5P860pqcrh1mTS9UQZwqAFVu+o
         mClyqEjCL3zX8zs4vCXciNu8oewE2g1p/u0jHEgqTUaEA82im18NMKyNwNnNNamrnQEC
         RnwGU3GCyt/MBoQT4HSD3bIeZMZgtq+f3BCrXy1BitOUHycxpqO0KVMrenWbO5F9vXYv
         kBjg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=Nf52mGwUCvJlGZf4Cmbucs8RIjCiYmrORa7/BVdy1fY=;
        b=EnkLev/M3ZGRq7clm04RlXrcf+zaP7jlpOtIM65uOZVb9jST0hNijBYMw72nAYoIRG
         EZOSJIlRxKXO1RgydIm6S9FwWQv+yczL1oMHiPoxo4bcq8CqYA5iQZ9opP81US9/CqUb
         Z7a5rZJQRTyi5KryENrHDCf4t6thT1u7RalSgawXbQ5n6scKV+XHB/aZ5GfRrSYZHLAf
         PdUDyQV17ZrqI3udsAGDlghIq8PZkdFbKbWJv9BbWb4+N69zqQUqhOPpaipZZBEUeK+j
         mPOdmelP4JbXSrbY/hWVnQs5vfGeDruLcPCNoobzWWY9Emxo5O/QHC5IodDLkPinYGTS
         3aAw==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id h195si8917973ywc.57.2018.11.21.07.14.57
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 21 Nov 2018 07:15:16 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gPUAw-0007Hy-R4; Wed, 21 Nov 2018 15:12:22 +0000
Received: from us1-rack-dfw2.inumbo.com ([104.130.134.6])
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <srs0=wvse=oa=citrix.com=prvs=856356900=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1gPUAv-0007Hj-PK
 for xen-devel@lists.xenproject.org; Wed, 21 Nov 2018 15:12:21 +0000
X-Inumbo-ID: d6eed5cc-ed9f-11e8-9a16-bc764e045a96
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-rack-dfw2.inumbo.com (Halon) with ESMTPS
 id d6eed5cc-ed9f-11e8-9a16-bc764e045a96;
 Wed, 21 Nov 2018 15:12:19 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,261,1539648000"; d="scan'208";a="71205794"
From: Paul Durrant <paul.durrant@citrix.com>
To: <qemu-block@nongnu.org>, <qemu-devel@nongnu.org>,
 <xen-devel@lists.xenproject.org>
Date: Wed, 21 Nov 2018 15:11:56 +0000
Message-ID: <20181121151211.15997-4-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20181121151211.15997-1-paul.durrant@citrix.com>
References: <20181121151211.15997-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 03/18] xen: introduce 'xen-qdisk'
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, Anthony Perard <anthony.perard@citrix.com>,
 Paul Durrant <paul.durrant@citrix.com>,
 Stefano Stabellini <sstabellini@kernel.org>, Max Reitz <mreitz@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwC3nkqGdvVbpg1kAA--.3962S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoWfGrWxJF47GFWxXr4xXw1UZFb_yoWDAF1fpa
	48XFs8KFW7GF4aga1fXFs3uF1rWws7Gw18Kr9xGw1F9ryfJFZ5tFnIk343WFyrJrsxCr4U
	XFZ8KrWv93WfWw7anT9S1TB71UUUUU7qnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlFb7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_tr0E3s1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Cr0_Gr1UM28EF7xvwVC2
	z280aVAFwI0_GcCE3s1l84ACjcxK6I8E87Iv6xkF7I0E14v26rxl6s0DM2vj6VCEFcxC0V
	AYjxAxZF0EFcxC0VAYjxAxZF0Ew4CEw7xC0VCjxxvEa2IrM2AIxVAIcxkEcVAq07x20xvE
	ncxIr21l5I8CrVACY4xI64kE6c02F40Ex7xfMcIj6xIIjxv20xvE14v26r1Y6r17McIj6I
	8E87Iv67AKxVWxJVW8Jr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VW5WwCY0x0Ix7I2Y4AK64vIr41lcIIF0xvE2Ix0cI8I
	cVAFwI0_Xr0_Ar1lcIIF0xvE2Ix0cI8IcVCY1x0267AKxVW8JVWxJwCYIxAIcVC2z280aV
	AFwI0_GcCE3s1lcIIF0xvEx4A2jsIEc7CjxVAFwI0_GcCE3s1l42xK82IYc2Ij64vIr41l
	42xK82IY64kExVAvwVAq07x20xyl4x8a6x804xWl4I8I3I0E4IkC6x0Yz7v_Jr0_Gr1lx2
	IqxVAqx4xG67AKxVWUJVWUGwC20s026x8GjcxK67AKxVWUGVWUWwC2zVAF1VAY17CE14v2
	6r1q6r43MIIYrxkI7VAKI48JMIIF0xvE42xK8VAvwI8IcIk0rVW8JVW3JwCE64xvF2IEb7
	IF0Fy7YxBIdaVFxhVjvjDU0xZFpf9x07bfPEfUUUUU=

VGhpcyBwYXRjaCBhZGRzIGEgbmV3IFhlbkRldmljZTogJ3hlbi1xZGlzaycgWzFdLiBUaGlzIHdp
bGwgZXZlbnR1YWxseQpyZXBsYWNlIHRoZSAneGVuX2Rpc2snIGxlZ2FjeSBQViBiYWNrZW5kIGJ1
dCBpdCBpcyBpbGx1c3RyYXRpdmUgdG8gYnVpbGQKdXAgdGhlIGltcGxlbWVudGF0aW9uIGluY3Jl
bWVudGFsbHksIGFsb25nIHdpdGggdGhlIFhlbkJ1cy9YZW5EZXZpY2UKZnJhbWV3b3JrLiBTdWJz
ZXF1ZW50IHBhdGNoZXMgd2lsbCB0aGVyZWZvcmUgYWRkIHRvIHRoaXMgZGV2aWNlJ3MKaW1wbGVt
ZW50YXRpb24gYXMgbmV3IGZlYXR1cmVzIGFyZSBhZGRlZCB0byB0aGUgZnJhbWV3b3JrLgoKQWZ0
ZXIgdGhpcyBwYXRjaCBoYXMgYmVlbiBhcHBsaWVkIGl0IGlzIHBvc3NpYmxlIHRvIGluc3RhbnRp
YXRlIGEgbmV3Cid4ZW4tcWRpc2snIGRldmljZSB3aXRoIGEgc2luZ2xlICd2ZGV2JyBwYXJhbWV0
ZXIsIHdoaWNoIGFjY2VwdHMgdmFsdWVzCmFkaGVyaW5nIHRvIHRoZSBYZW4gVkJEIG5hbWluZyBz
Y2hlbWUgWzJdLiBGb3IgZXhhbXBsZSwgYSBjb21tYW5kLWxpbmUKaW5zdGFudGlhdGlvbiBvZiBh
IHhlbi1xZGlzayBjYW4gYmUgZG9uZSB3aXRoIGFuIGFyZ3VtZW50IHNpbWlsYXIgdG8gdGhlCmZv
bGxvd2luZzoKCi1kZXZpY2UgeGVuLXFkaXNrLHZkZXY9aGRhCgpUaGUgaW1wbGVtZW50YXRpb24g
b2YgdGhlIHZkZXYgcGFyYW1ldGVyIGZvcm11bGF0ZXMgdGhlIGFwcHJvcHJpYXRlIFZCRApudW1i
ZXIgZm9yIHVzZSBpbiB0aGUgUFYgcHJvdG9jb2wuCgpbMV0gVGhlIG5hbWUgJ3FkaXNrJyBhcyBh
bHdheXMgYmVlbiB0aGUgbmFtZSBnaXZlbiB0byB0aGUgUUVNVQogICAgaW1wbGVtZW50YXRpb24g
b2YgdGhlIFhlbiBQViBibG9jayBwcm90b2NvbCBiYWNrZW5kIGltcGxlbWVudGF0aW9uClsyXSBo
dHRwOi8veGVuYml0cy54ZW4ub3JnL2dpdHdlYi8/cD14ZW4uZ2l0O2E9YmxvYjtmPWRvY3MvbWFu
L3hlbi12YmQtaW50ZXJmYWNlLm1hcmtkb3duLjcKClNpZ25lZC1vZmYtYnk6IFBhdWwgRHVycmFu
dCA8cGF1bC5kdXJyYW50QGNpdHJpeC5jb20+Ci0tLQpDYzogS2V2aW4gV29sZiA8a3dvbGZAcmVk
aGF0LmNvbT4KQ2M6IE1heCBSZWl0eiA8bXJlaXR6QHJlZGhhdC5jb20+CkNjOiBTdGVmYW5vIFN0
YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNjOiBBbnRob255IFBlcmFyZCA8YW50
aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4KLS0tCiBNQUlOVEFJTkVSUyAgICAgICAgICAgICAgICB8
ICAgMiArLQogaHcvYmxvY2svTWFrZWZpbGUub2JqcyAgICAgfCAgIDEgKwogaHcvYmxvY2svdHJh
Y2UtZXZlbnRzICAgICAgfCAgIDQgKwogaHcvYmxvY2sveGVuLXFkaXNrLmMgICAgICAgfCAyNTYg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL2h3
L3hlbi94ZW4tcWRpc2suaCB8ICAzOCArKysrKysrCiA1IGZpbGVzIGNoYW5nZWQsIDMwMCBpbnNl
cnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgaHcvYmxvY2sveGVu
LXFkaXNrLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL2h3L3hlbi94ZW4tcWRpc2suaAoK
ZGlmZiAtLWdpdCBhL01BSU5UQUlORVJTIGIvTUFJTlRBSU5FUlMKaW5kZXggMTAzMjQwNmM1Ni4u
MTBmMDQ4YTUwMyAxMDA2NDQKLS0tIGEvTUFJTlRBSU5FUlMKKysrIGIvTUFJTlRBSU5FUlMKQEAg
LTM4OSw3ICszODksNyBAQCBGOiBody85cGZzL3hlbi05cC1iYWNrZW5kLmMKIEY6IGh3L2NoYXIv
eGVuX2NvbnNvbGUuYwogRjogaHcvZGlzcGxheS94ZW5mYi5jCiBGOiBody9uZXQveGVuX25pYy5j
Ci1GOiBody9ibG9jay94ZW5fKgorRjogaHcvYmxvY2sveGVuKgogRjogaHcveGVuLwogRjogaHcv
eGVucHYvCiBGOiBody9pMzg2L3hlbi8KZGlmZiAtLWdpdCBhL2h3L2Jsb2NrL01ha2VmaWxlLm9i
anMgYi9ody9ibG9jay9NYWtlZmlsZS5vYmpzCmluZGV4IDUzY2U1NzUxYWUuLmJjZGQzNmQzMTgg
MTAwNjQ0Ci0tLSBhL2h3L2Jsb2NrL01ha2VmaWxlLm9ianMKKysrIGIvaHcvYmxvY2svTWFrZWZp
bGUub2JqcwpAQCAtNSw2ICs1LDcgQEAgY29tbW9uLW9iai0kKENPTkZJR19OQU5EKSArPSBuYW5k
Lm8KIGNvbW1vbi1vYmotJChDT05GSUdfUEZMQVNIX0NGSTAxKSArPSBwZmxhc2hfY2ZpMDEubwog
Y29tbW9uLW9iai0kKENPTkZJR19QRkxBU0hfQ0ZJMDIpICs9IHBmbGFzaF9jZmkwMi5vCiBjb21t
b24tb2JqLSQoQ09ORklHX1hFTikgKz0geGVuX2Rpc2subworY29tbW9uLW9iai0kKENPTkZJR19Y
RU4pICs9IHhlbi1xZGlzay5vCiBjb21tb24tb2JqLSQoQ09ORklHX0VDQykgKz0gZWNjLm8KIGNv
bW1vbi1vYmotJChDT05GSUdfT05FTkFORCkgKz0gb25lbmFuZC5vCiBjb21tb24tb2JqLSQoQ09O
RklHX05WTUVfUENJKSArPSBudm1lLm8KZGlmZiAtLWdpdCBhL2h3L2Jsb2NrL3RyYWNlLWV2ZW50
cyBiL2h3L2Jsb2NrL3RyYWNlLWV2ZW50cwppbmRleCAzMzVjMDkyNDUwLi5mZDNjMTI2YWMxIDEw
MDY0NAotLS0gYS9ody9ibG9jay90cmFjZS1ldmVudHMKKysrIGIvaHcvYmxvY2svdHJhY2UtZXZl
bnRzCkBAIC0xMjcsMyArMTI3LDcgQEAgeGVuX2Rpc2tfaW5pdChjaGFyICpuYW1lKSAiJXMiCiB4
ZW5fZGlza19jb25uZWN0KGNoYXIgKm5hbWUpICIlcyIKIHhlbl9kaXNrX2Rpc2Nvbm5lY3QoY2hh
ciAqbmFtZSkgIiVzIgogeGVuX2Rpc2tfZnJlZShjaGFyICpuYW1lKSAiJXMiCisKKyMgaHcvYmxv
Y2sveGVuLXFkaXNrLmMKK3hlbl9xZGlza19yZWFsaXplKHVpbnQzMl90IGRpc2ssIHVpbnQzMl90
IHBhcnRpdGlvbikgImQldXAldSIKK3hlbl9xZGlza191bnJlYWxpemUodWludDMyX3QgZGlzaywg
dWludDMyX3QgcGFydGl0aW9uKSAiZCV1cCV1IgpkaWZmIC0tZ2l0IGEvaHcvYmxvY2sveGVuLXFk
aXNrLmMgYi9ody9ibG9jay94ZW4tcWRpc2suYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwLi43MjEyMjA3M2Y3Ci0tLSAvZGV2L251bGwKKysrIGIvaHcvYmxvY2sveGVuLXFk
aXNrLmMKQEAgLTAsMCArMSwyNTYgQEAKKy8qCisgKiBDb3B5cmlnaHQgKGMpIENpdHJpeCBTeXN0
ZW1zIEluYy4KKyAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCisgKi8KKworI2luY2x1ZGUgInFlbXUv
b3NkZXAuaCIKKyNpbmNsdWRlICJxZW11L2N1dGlscy5oIgorI2luY2x1ZGUgInFhcGkvZXJyb3Iu
aCIKKyNpbmNsdWRlICJxYXBpL3Zpc2l0b3IuaCIKKyNpbmNsdWRlICJody9ody5oIgorI2luY2x1
ZGUgImh3L3hlbi94ZW4tcWRpc2suaCIKKyNpbmNsdWRlICJ0cmFjZS5oIgorCitzdGF0aWMgdm9p
ZCB4ZW5fcWRpc2tfcmVhbGl6ZShYZW5EZXZpY2UgKnhlbmRldiwgRXJyb3IgKiplcnJwKQorewor
ICAgIFhlblFkaXNrRGV2aWNlICpxZGlza2RldiA9IFhFTl9RRElTS19ERVZJQ0UoeGVuZGV2KTsK
KyAgICBYZW5RZGlza1ZkZXYgKnZkZXYgPSAmcWRpc2tkZXYtPnZkZXY7CisKKyAgICBpZiAoIXZk
ZXYtPnZhbGlkKSB7CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgInZkZXYgcHJvcGVydHkgbm90
IHNldCIpOworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgdHJhY2VfeGVuX3FkaXNrX3Jl
YWxpemUodmRldi0+ZGlzaywgdmRldi0+cGFydGl0aW9uKTsKK30KKworc3RhdGljIHZvaWQgeGVu
X3FkaXNrX3VucmVhbGl6ZShYZW5EZXZpY2UgKnhlbmRldiwgRXJyb3IgKiplcnJwKQoreworICAg
IFhlblFkaXNrRGV2aWNlICpxZGlza2RldiA9IFhFTl9RRElTS19ERVZJQ0UoeGVuZGV2KTsKKyAg
ICBYZW5RZGlza1ZkZXYgKnZkZXYgPSAmcWRpc2tkZXYtPnZkZXY7CisKKyAgICB0cmFjZV94ZW5f
cWRpc2tfdW5yZWFsaXplKHZkZXYtPmRpc2ssIHZkZXYtPnBhcnRpdGlvbik7Cit9CisKK3N0YXRp
YyBjaGFyICpkaXNrX3RvX3ZiZF9uYW1lKHVuc2lnbmVkIGludCBkaXNrKQoreworICAgIHVuc2ln
bmVkIGludCBsZW4gPSBESVZfUk9VTkRfVVAoZGlzaywgMjYpOworICAgIGNoYXIgKm5hbWUgPSBn
X21hbGxvYzAobGVuICsgMSk7CisKKyAgICBkbyB7CisgICAgICAgIG5hbWVbbGVuLS1dID0gJ2En
ICsgKGRpc2sgJSAyNik7CisgICAgICAgIGRpc2sgLz0gMjY7CisgICAgfSB3aGlsZSAoZGlzayAh
PSAwKTsKKyAgICBhc3NlcnQobGVuID09IDApOworCisgICAgcmV0dXJuIG5hbWU7Cit9CisKK3N0
YXRpYyB2b2lkIHhlbl9xZGlza19nZXRfdmRldihPYmplY3QgKm9iaiwgVmlzaXRvciAqdiwgY29u
c3QgY2hhciAqbmFtZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpvcGFx
dWUsIEVycm9yICoqZXJycCkKK3sKKyAgICBEZXZpY2VTdGF0ZSAqZGV2ID0gREVWSUNFKG9iaik7
CisgICAgUHJvcGVydHkgKnByb3AgPSBvcGFxdWU7CisgICAgWGVuUWRpc2tWZGV2ICp2ZGV2ID0g
cWRldl9nZXRfcHJvcF9wdHIoZGV2LCBwcm9wKTsKKyAgICBjaGFyICpzdHI7CisKKyAgICBzd2l0
Y2ggKHZkZXYtPnR5cGUpIHsKKyAgICBjYXNlIFhFTl9RRElTS19WREVWX1RZUEVfRFA6CisgICAg
ICAgIHN0ciA9IGdfc3RyZHVwX3ByaW50ZigiZCVsdXAlbHUiLCB2ZGV2LT5kaXNrLCB2ZGV2LT5w
YXJ0aXRpb24pOworICAgICAgICBicmVhazsKKworICAgIGNhc2UgWEVOX1FESVNLX1ZERVZfVFlQ
RV9YVkQ6CisgICAgY2FzZSBYRU5fUURJU0tfVkRFVl9UWVBFX0hEOgorICAgIGNhc2UgWEVOX1FE
SVNLX1ZERVZfVFlQRV9TRDogeworICAgICAgICBjaGFyICpuYW1lID0gZGlza190b192YmRfbmFt
ZSh2ZGV2LT5kaXNrKTsKKworICAgICAgICBzdHIgPSBnX3N0cmR1cF9wcmludGYoIiVzJXMlbHUi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHZkZXYtPnR5cGUgPT0gWEVOX1FESVNL
X1ZERVZfVFlQRV9YVkQpID8KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ4dmQiIDoK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh2ZGV2LT50eXBlID09IFhFTl9RRElTS19W
REVWX1RZUEVfSEQpID8KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJoZCIgOgorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgInNkIiwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIG5hbWUsIHZkZXYtPnBhcnRpdGlvbik7CisgICAgICAgIGdfZnJlZShuYW1lKTsKKyAg
ICAgICAgYnJlYWs7CisgICAgfQorICAgIGRlZmF1bHQ6CisgICAgICAgIGVycm9yX3NldGcoZXJy
cCwgImludmFsaWQgdmRldiB0eXBlIik7CisgICAgICAgIHJldHVybjsKKyAgICB9CisKKyAgICB2
aXNpdF90eXBlX3N0cih2LCBuYW1lLCAmc3RyLCBlcnJwKTsKKyAgICBnX2ZyZWUoc3RyKTsKK30K
Kworc3RhdGljIHVuc2lnbmVkIGludCB2YmRfbmFtZV90b19kaXNrKGNvbnN0IGNoYXIgKm5hbWUs
IGNvbnN0IGNoYXIgKiplbmRwKQoreworICAgIHVuc2lnbmVkIGludCBkaXNrID0gMDsKKworICAg
IHdoaWxlICgqbmFtZSAhPSAnXDAnKSB7CisgICAgICAgIGlmICghZ19hc2NpaV9pc2FscGhhKCpu
YW1lKSB8fCAhZ19hc2NpaV9pc2xvd2VyKCpuYW1lKSkgeworICAgICAgICAgICAgYnJlYWs7Cisg
ICAgICAgIH0KKworICAgICAgICBkaXNrICo9IDI2OworICAgICAgICBkaXNrICs9ICpuYW1lKysg
LSAnYSc7CisgICAgfQorICAgICplbmRwID0gbmFtZTsKKworICAgIHJldHVybiBkaXNrOworfQor
CitzdGF0aWMgdm9pZCB4ZW5fcWRpc2tfc2V0X3ZkZXYoT2JqZWN0ICpvYmosIFZpc2l0b3IgKnYs
IGNvbnN0IGNoYXIgKm5hbWUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAq
b3BhcXVlLCBFcnJvciAqKmVycnApCit7CisgICAgRGV2aWNlU3RhdGUgKmRldiA9IERFVklDRShv
YmopOworICAgIFByb3BlcnR5ICpwcm9wID0gb3BhcXVlOworICAgIFhlblFkaXNrVmRldiAqdmRl
diA9IHFkZXZfZ2V0X3Byb3BfcHRyKGRldiwgcHJvcCk7CisgICAgRXJyb3IgKmxvY2FsX2VyciA9
IE5VTEw7CisgICAgY2hhciAqc3RyLCAqcDsKKyAgICBjb25zdCBjaGFyICplbmQ7CisKKyAgICBp
ZiAoZGV2LT5yZWFsaXplZCkgeworICAgICAgICBxZGV2X3Byb3Bfc2V0X2FmdGVyX3JlYWxpemUo
ZGV2LCBuYW1lLCBlcnJwKTsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKworICAgIHZpc2l0X3R5
cGVfc3RyKHYsIG5hbWUsICZzdHIsICZsb2NhbF9lcnIpOworICAgIGlmIChsb2NhbF9lcnIpIHsK
KyAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2FsX2Vycik7CisgICAgICAgIHJldHVy
bjsKKyAgICB9CisKKyAgICBwID0gc3RyY2hyKHN0ciwgJ2QnKTsKKyAgICBpZiAoIXApIHsKKyAg
ICAgICAgZ290byBpbnZhbGlkOworICAgIH0KKworICAgICpwKysgPSAnXDAnOworICAgIGlmICgq
c3RyID09ICdcMCcpIHsKKyAgICAgICAgdmRldi0+dHlwZSA9IFhFTl9RRElTS19WREVWX1RZUEVf
RFA7CisgICAgfSBlbHNlIGlmIChzdHJjbXAoc3RyLCAieHYiKSA9PSAwKSB7CisgICAgICAgIHZk
ZXYtPnR5cGUgPSBYRU5fUURJU0tfVkRFVl9UWVBFX1hWRDsKKyAgICB9IGVsc2UgaWYgKHN0cmNt
cChzdHIsICJoIikgPT0gMCkgeworICAgICAgICB2ZGV2LT50eXBlID0gWEVOX1FESVNLX1ZERVZf
VFlQRV9IRDsKKyAgICB9IGVsc2UgaWYgKHN0cmNtcChzdHIsICJzIikgPT0gMCkgeworICAgICAg
ICB2ZGV2LT50eXBlID0gWEVOX1FESVNLX1ZERVZfVFlQRV9TRDsKKyAgICB9IGVsc2UgeworICAg
ICAgICBnb3RvIGludmFsaWQ7CisgICAgfQorCisgICAgaWYgKHZkZXYtPnR5cGUgPT0gWEVOX1FE
SVNLX1ZERVZfVFlQRV9EUCkgeworICAgICAgICBpZiAocWVtdV9zdHJ0b3VsKHAsICZlbmQsIDEw
LCAmdmRldi0+ZGlzaykpIHsKKyAgICAgICAgICAgIGdvdG8gaW52YWxpZDsKKyAgICAgICAgfQor
CisgICAgICAgIGlmICgqZW5kID09ICdwJykgeworICAgICAgICAgICAgcCA9IChjaGFyICopICsr
ZW5kOworICAgICAgICAgICAgaWYgKCplbmQgPT0gJ1wwJykgeworICAgICAgICAgICAgICAgIGdv
dG8gaW52YWxpZDsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgIH0gZWxzZSB7CisgICAg
ICAgIHZkZXYtPmRpc2sgPSB2YmRfbmFtZV90b19kaXNrKHAsICZlbmQpOworICAgIH0KKworICAg
IGlmICgqZW5kICE9ICdcMCcpIHsKKyAgICAgICAgcCA9IChjaGFyICopZW5kOworCisgICAgICAg
IGlmIChxZW11X3N0cnRvdWwocCwgJmVuZCwgMTAsICZ2ZGV2LT5wYXJ0aXRpb24pKSB7CisgICAg
ICAgICAgICBnb3RvIGludmFsaWQ7CisgICAgICAgIH0KKworICAgICAgICBpZiAoKmVuZCAhPSAn
XDAnKSB7CisgICAgICAgICAgICBnb3RvIGludmFsaWQ7CisgICAgICAgIH0KKyAgICB9IGVsc2Ug
eworICAgICAgICB2ZGV2LT5wYXJ0aXRpb24gPSAwOworICAgIH0KKworICAgIHN3aXRjaCAodmRl
di0+dHlwZSkgeworICAgIGNhc2UgWEVOX1FESVNLX1ZERVZfVFlQRV9EUDoKKyAgICBjYXNlIFhF
Tl9RRElTS19WREVWX1RZUEVfWFZEOgorICAgICAgICBpZiAodmRldi0+ZGlzayA8ICgxIDw8IDQp
ICYmIHZkZXYtPnBhcnRpdGlvbiA8ICgxIDw8IDQpKSB7CisgICAgICAgICAgICB2ZGV2LT5udW1i
ZXIgPSAoMjAyIDw8IDgpIHwgKHZkZXYtPmRpc2sgPDwgNCkgfAorICAgICAgICAgICAgICAgIHZk
ZXYtPnBhcnRpdGlvbjsKKyAgICAgICAgfSBlbHNlIGlmICh2ZGV2LT5kaXNrIDwgKDEgPDwgMjAp
ICYmIHZkZXYtPnBhcnRpdGlvbiA8ICgxIDw8IDgpKSB7CisgICAgICAgICAgICB2ZGV2LT5udW1i
ZXIgPSAoMSA8PCAyOCkgfCAodmRldi0+ZGlzayA8PCA4KSB8CisgICAgICAgICAgICAgICAgdmRl
di0+cGFydGl0aW9uOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgZ290byBpbnZhbGlk
OworICAgICAgICB9CisgICAgICAgIGJyZWFrOworCisgICAgY2FzZSBYRU5fUURJU0tfVkRFVl9U
WVBFX0hEOgorICAgICAgICBpZiAoKHZkZXYtPmRpc2sgPT0gMCB8fCB2ZGV2LT5kaXNrID09IDEp
ICYmCisgICAgICAgICAgICB2ZGV2LT5wYXJ0aXRpb24gPCAoMSA8PCA0KSkgeworICAgICAgICAg
ICAgdmRldi0+bnVtYmVyID0gKDMgPDwgOCkgfCAodmRldi0+ZGlzayA8PCA2KSB8IHZkZXYtPnBh
cnRpdGlvbjsKKyAgICAgICAgfSBlbHNlIGlmICgodmRldi0+ZGlzayA9PSAyIHx8IHZkZXYtPmRp
c2sgPT0gMykgJiYKKyAgICAgICAgICAgICAgICAgICB2ZGV2LT5wYXJ0aXRpb24gPCAoMSA8PCA0
KSkgeworICAgICAgICAgICAgdmRldi0+bnVtYmVyID0gKDIyIDw8IDgpIHwgKCh2ZGV2LT5kaXNr
IC0gMikgPDwgNikgfAorICAgICAgICAgICAgICAgIHZkZXYtPnBhcnRpdGlvbjsKKyAgICAgICAg
fSBlbHNlIHsKKyAgICAgICAgICAgIGdvdG8gaW52YWxpZDsKKyAgICAgICAgfQorICAgICAgICBi
cmVhazsKKworICAgIGNhc2UgWEVOX1FESVNLX1ZERVZfVFlQRV9TRDoKKyAgICAgICAgaWYgKHZk
ZXYtPmRpc2sgPCAoMSA8PCA0KSAmJiB2ZGV2LT5wYXJ0aXRpb24gPCAoMSA8PCA0KSkgeworICAg
ICAgICAgICAgdmRldi0+bnVtYmVyID0gKDggPDwgOCkgfCAodmRldi0+ZGlzayA8PCA0KSB8IHZk
ZXYtPnBhcnRpdGlvbjsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGdvdG8gaW52YWxp
ZDsKKyAgICAgICAgfQorICAgICAgICBicmVhazsKKworICAgIGRlZmF1bHQ6CisgICAgICAgIGdv
dG8gaW52YWxpZDsKKyAgICB9CisKKyAgICBnX2ZyZWUoc3RyKTsKKyAgICB2ZGV2LT52YWxpZCA9
IHRydWU7CisgICAgcmV0dXJuOworCitpbnZhbGlkOgorICAgIGVycm9yX3NldGcoZXJycCwgImlu
dmFsaWQgdmlydHVhbCBkaXNrIHNwZWNpZmllciIpOworICAgIGdfZnJlZShzdHIpOworfQorCitj
b25zdCBQcm9wZXJ0eUluZm8geGVuX3FkaXNrX3Byb3BfdmRldiA9IHsKKyAgICAubmFtZSAgPSAi
c3RyIiwKKyAgICAuZGVzY3JpcHRpb24gPSAiVmlydHVhbCBEaXNrIHNwZWNpZmllcjogZCpwKi94
dmQqL2hkKi9zZCoiLAorICAgIC5nZXQgPSB4ZW5fcWRpc2tfZ2V0X3ZkZXYsCisgICAgLnNldCA9
IHhlbl9xZGlza19zZXRfdmRldiwKK307CisKK3N0YXRpYyBQcm9wZXJ0eSB4ZW5fcWRpc2tfcHJv
cHNbXSA9IHsKKyAgICBERUZJTkVfUFJPUCgidmRldiIsIFhlblFkaXNrRGV2aWNlLCB2ZGV2LAor
ICAgICAgICAgICAgICAgIHhlbl9xZGlza19wcm9wX3ZkZXYsIFhlblFkaXNrVmRldiksCisgICAg
REVGSU5FX1BST1BfRU5EX09GX0xJU1QoKQorfTsKKworc3RhdGljIHZvaWQgeGVuX3FkaXNrX2Ns
YXNzX2luaXQoT2JqZWN0Q2xhc3MgKmNsYXNzLCB2b2lkICpkYXRhKQoreworICAgIERldmljZUNs
YXNzICpkZXZfY2xhc3MgPSBERVZJQ0VfQ0xBU1MoY2xhc3MpOworICAgIFhlbkRldmljZUNsYXNz
ICp4ZW5kZXZfY2xhc3MgPSBYRU5fREVWSUNFX0NMQVNTKGNsYXNzKTsKKworICAgIHhlbmRldl9j
bGFzcy0+cmVhbGl6ZSA9IHhlbl9xZGlza19yZWFsaXplOworICAgIHhlbmRldl9jbGFzcy0+dW5y
ZWFsaXplID0geGVuX3FkaXNrX3VucmVhbGl6ZTsKKworICAgIGRldl9jbGFzcy0+ZGVzYyA9ICJY
ZW4gUWRpc2sgRGV2aWNlIjsKKyAgICBkZXZfY2xhc3MtPnByb3BzID0geGVuX3FkaXNrX3Byb3Bz
OworfQorCitzdGF0aWMgY29uc3QgVHlwZUluZm8geGVuX3FkaXNrX3R5cGVfaW5mbyA9IHsKKyAg
ICAubmFtZSA9IFRZUEVfWEVOX1FESVNLX0RFVklDRSwKKyAgICAucGFyZW50ID0gVFlQRV9YRU5f
REVWSUNFLAorICAgIC5pbnN0YW5jZV9zaXplID0gc2l6ZW9mKFhlblFkaXNrRGV2aWNlKSwKKyAg
ICAuY2xhc3NfaW5pdCA9IHhlbl9xZGlza19jbGFzc19pbml0LAorfTsKKworc3RhdGljIHZvaWQg
eGVuX3FkaXNrX3JlZ2lzdGVyX3R5cGVzKHZvaWQpCit7CisgICAgdHlwZV9yZWdpc3Rlcl9zdGF0
aWMoJnhlbl9xZGlza190eXBlX2luZm8pOworfQorCit0eXBlX2luaXQoeGVuX3FkaXNrX3JlZ2lz
dGVyX3R5cGVzKQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9ody94ZW4veGVuLXFkaXNrLmggYi9pbmNs
dWRlL2h3L3hlbi94ZW4tcWRpc2suaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MDAwLi5hZGUwODY2MDM3Ci0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS9ody94ZW4veGVuLXFk
aXNrLmgKQEAgLTAsMCArMSwzOCBAQAorLyoKKyAqIENvcHlyaWdodCAoYykgQ2l0cml4IFN5c3Rl
bXMgSW5jLgorICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KKyAqLworCisjaWZuZGVmIEhXX1hFTl9R
RElTS19ICisjZGVmaW5lIEhXX1hFTl9RRElTS19ICisKKyNpbmNsdWRlICJody94ZW4veGVuLWJ1
cy5oIgorCit0eXBlZGVmIGVudW0gWGVuUWRpc2tWZGV2VHlwZSB7CisgICAgWEVOX1FESVNLX1ZE
RVZfVFlQRV9EUCwKKyAgICBYRU5fUURJU0tfVkRFVl9UWVBFX1hWRCwKKyAgICBYRU5fUURJU0tf
VkRFVl9UWVBFX0hELAorICAgIFhFTl9RRElTS19WREVWX1RZUEVfU0QsCisgICAgWEVOX1FESVNL
X1ZERVZfVFlQRV9fTUFYCit9IFhlblFkaXNrVmRldlR5cGU7CisKK3R5cGVkZWYgc3RydWN0IFhl
blFkaXNrVmRldiB7CisgICAgWGVuUWRpc2tWZGV2VHlwZSB0eXBlOworICAgIHVuc2lnbmVkIGxv
bmcgZGlzazsKKyAgICB1bnNpZ25lZCBsb25nIHBhcnRpdGlvbjsKKyAgICB1bnNpZ25lZCBsb25n
IG51bWJlcjsKKyAgICBib29sIHZhbGlkOworfSBYZW5RZGlza1ZkZXY7CisKKyNkZWZpbmUgVFlQ
RV9YRU5fUURJU0tfREVWSUNFICAieGVuLXFkaXNrIgorI2RlZmluZSBYRU5fUURJU0tfREVWSUNF
KG9iaikgXAorICAgICBPQkpFQ1RfQ0hFQ0soWGVuUWRpc2tEZXZpY2UsIChvYmopLCBUWVBFX1hF
Tl9RRElTS19ERVZJQ0UpCisKK3R5cGVkZWYgc3RydWN0IFhlblFkaXNrRGV2aWNlIFhlblFkaXNr
RGV2aWNlOworCitzdHJ1Y3QgWGVuUWRpc2tEZXZpY2UgeworICAgIFhlbkRldmljZSB4ZW5kZXY7
CisgICAgWGVuUWRpc2tWZGV2IHZkZXY7Cit9OworCisjZW5kaWYgLyogSFdfWEVOX1FESVNLX0gg
Ki8KLS0gCjIuMTEuMAoKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVsQGxpc3RzLnhlbnByb2plY3Qu
b3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1hbi9saXN0aW5mby94ZW4tZGV2
ZWw=
