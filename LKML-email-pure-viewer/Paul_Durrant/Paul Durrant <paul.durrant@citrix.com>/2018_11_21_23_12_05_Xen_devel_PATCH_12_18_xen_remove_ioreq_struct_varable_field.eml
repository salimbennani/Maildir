Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (124.160.105.205:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 22 Nov 2018 00:34:18 -0000
Received: from icoremail.net (unknown [209.85.214.169])
	by mail-app2 (Coremail) with SMTP id by_KCgDHH_pUevVbJyfJAQ--.58913S3;
	Wed, 21 Nov 2018 23:31:33 +0800 (CST)
Received: from mail-pl1-f169.google.com (unknown [209.85.214.169])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwDny0dQevVb7xpkAA--.2235S3;
	Wed, 21 Nov 2018 23:31:28 +0800 (CST)
Received: by mail-pl1-f169.google.com with SMTP id t13so5998443ply.13
        for <xuliker@zju.edu.cn>; Wed, 21 Nov 2018 07:31:28 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=/rwN+4K5vhodahA6FkSJ7x8bZYwrx+OcVYVzU26sRow=;
        b=U220z5sJSR4UmT6KWwi2bkhYd9tQFMlNI0ZSI2cf87/MTOKNy09q1DJq3EoToXSLbb
         05UkpjAgvNYdsVqJi0wlLv4mijZqbJpoH4MYDfY9a0BtvoIn5M8NdaxAPU8BjjX+jqfw
         0+Ok9Gc4GlNAblZrPWe/pLrUgN6wecewSap782r2rVGKX14/bC5BFIIecTA0ZsdWbC1z
         0+sxZVdPAxeikciR8sa2Bj6O/uYjW/EtHT9MqkYpI+c8OQy40qRCF+IPT9c22kVCQ/R0
         u3BJDY4IdlF8jRkhaqN2LzTsZAiprWTsFH5+LAvbf9EKdO/pPl8kyBeb27QEmNJNXV5c
         0+/w==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AA+aEWad7dlrPcvDR9jU95v3eH2xm1cYTsAvN0UWNWzsGkqhieCo/bio
	miS8drT0S5Uc3JNMshdtpXai16gbuu9NYnWSJC8Awy/g5W/45rw=
X-Received: by 2002:a17:902:560f:: with SMTP id h15-v6mr7467622pli.160.1542814288496;
        Wed, 21 Nov 2018 07:31:28 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp2100893pju;
        Wed, 21 Nov 2018 07:31:26 -0800 (PST)
X-Google-Smtp-Source: AJdET5emxk3l+3hfVtPL085n39jDa6YPHc4aiK/VzOmsYsu7qY55S50pnShVXRCJ8dA85iWReSac
X-Received: by 2002:a81:2e42:: with SMTP id u63mr6972862ywu.491.1542814286854;
        Wed, 21 Nov 2018 07:31:26 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542814286; cv=none;
        d=google.com; s=arc-20160816;
        b=lB/amWAgICGr0+BK9ZQKgAPs6QdofAe5kh0igtPIDcSUksQtaJYDLQQ28zdKVhA0Hi
         0gYZvRj45yZdFX/v/M6JwmEAnUDhcr8iX/vNO06xySLzjmgnSnDwdZvmZkkObK2A9cHo
         iZBGJR5DH76k5rJLssMKQfq3h1fuFrxSU+R2wEXDTagbccqRwx/wa8suldwBir95TR9L
         h1lBpni7FDJPfQSz0c3Mewn576VJgdLmTVXW8Ds4HumuALulGIDdah3VsoYSiRudxzJh
         tXISv316U7UbGX4EuefZgSw9zXv7IbzwAVgJ/oGkt/434xvjF7SAwXiXy1o1Gn9KDEFR
         mAIA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=/rwN+4K5vhodahA6FkSJ7x8bZYwrx+OcVYVzU26sRow=;
        b=mh1mkCSucxl/J+09cg9hBncxqEqPDKoh82Z2BRZO71ZS/HCUkDw/zMtuN4OZD1PbWK
         xPUA0TjC45t+inXsphTm0rewUN64tkPUFUg7yO13VzE+ysF5CMBDakYiOHkKZFhD3Fg7
         zCBsE8WaE8aYhzOMUWrE6Qqe1JsUMb3QzFvHyB05cS4N4A6xVmajhG6FvId2DlzcuZpN
         H6E7KZLFi4vB6EwjUruHzB7meoSFi+/0+uizLyJMpIp8mlVFa2uVVh3ul+wlSNP+6Oyc
         fVd3d9JLcaiE6NL0F1Y+Q3sRxtCtMjFgk9qa8KVY4AkmagouX2Ujl7PuqzXjM1h6+nlD
         uZvg==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id d11si10538492ywc.418.2018.11.21.07.31.23
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 21 Nov 2018 07:31:26 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gPURB-0000vj-EQ; Wed, 21 Nov 2018 15:29:09 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=wVSe=OA=citrix.com=prvs=856356900=paul.durrant@srs-us1.protection.inumbo.net>)
 id 1gPUR9-0000sx-4c
 for xen-devel@lists.xenproject.org; Wed, 21 Nov 2018 15:29:07 +0000
X-Inumbo-ID: 2e9da712-eda2-11e8-9535-12d6303a7972
Received: from SMTP03.CITRIX.COM (unknown [162.221.156.55])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 2e9da712-eda2-11e8-9535-12d6303a7972;
 Wed, 21 Nov 2018 15:29:05 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.56,261,1539648000"; d="scan'208";a="71207581"
From: Paul Durrant <paul.durrant@citrix.com>
To: <qemu-block@nongnu.org>, <qemu-devel@nongnu.org>,
 <xen-devel@lists.xenproject.org>
Date: Wed, 21 Nov 2018 15:12:05 +0000
Message-ID: <20181121151211.15997-13-paul.durrant@citrix.com>
X-Mailer: git-send-email 2.11.0
In-Reply-To: <20181121151211.15997-1-paul.durrant@citrix.com>
References: <20181121151211.15997-1-paul.durrant@citrix.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH 12/18] xen: remove 'ioreq' struct/varable/field
 names from dataplane/xen-qdisk.c
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, Stefano Stabellini <sstabellini@kernel.org>,
 Max Reitz <mreitz@redhat.com>, Paul Durrant <paul.durrant@citrix.com>,
 Stefan Hajnoczi <stefanha@redhat.com>,
 Anthony Perard <anthony.perard@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwDny0dQevVb7xpkAA--.2235S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvAXoWfCw43tr4xAFWrXr4fWr1xZrb_yoW8uF1kZo
	WSgrySqay8ZrW8Grn5Kw15tF9rCas5Ca1fAa1UA3yDZ3WUtr10gF17GrsxCry5A3WYgrWk
	Wr4xtr4jyr9xA34fn29KB7ZKAUJUUUUU529EdanIXcx71UUUUj7v73VFW2AGmfu7jjvjm3
	AaLaJ3UjIYCTnIWjp_UUUo47k0a2IF6w4kM7kC6x804xWl14x267AKxVWUJVW8JwAFIxvE
	14AKwVWUJVWUGwA2ocxC64kIII0Yj41l84x0c7CEw4AK67xGY2AK021l84ACjcxK6xIIjx
	v20xvE14v26F1j6w1UM28EF7xvwVC0I7IYx2IY6xkF7I0E14v26F4j6r4UJwA2z4x0Y4vE
	x4A2jsIE14v26rxl6s0DM28EF7xvwVC2z280aVCY1x0267AKxVW0oVCq3wAa7VCE64xvF2
	IEb7IF0Fy264xvF2IEb7IF0Fy264kE64k0F2IE7I0Y6sxI4wAS0I0E0xvYzxvE52x082IY
	62kv0487Mc02F40EFcxC0VAKzVAqx4xG6I80ewAv7VC0I7IYx2IY67AKxVWUGVWUXwAv7V
	C2z280aVAFwI0_Cr0_Gr1UMcvjeVCFs4IE7xkEbVWUJVW8JwACjcxG0xvY0x0EwIxGrwAC
	Y4xI67k04243AVAKzVAKj4xxMx02cVCv0xWlc7CjxVAKzI0EY4vE52x082I5MxkFs20EY4
	vE44CYbxCE4x80FwCY02Avz4vEIxC_XrWlc2IjII80xcxEwVAKI48JMxvI42IY6xIIjxv2
	0xvE14v26r4j6ryUMxvI42IY6xIIjxv20xvEc7CjxVAFwI0_Gr0_Cr1lcIIF0xvEx4A2js
	IE14v26rxl6s0DMxvI42IY6I8E87Iv6xkF7I0E14v26rxl6s0DMxAIw28IcxkI7VAKI48J
	MxAIw28IcVAKzI0EY4vE52x082I5MxCjnVCjjxCrMxC20s026xCaFVCjc4AY6r1j6r4UMI
	8I3I0E5I8CrVAFwI0_Jr0_Jr4lx2IqxVCjr7xvwVAFwI0_JrI_JrWlx4CE17CEb7AF67AK
	xVWUtVW8ZwCIc40Y0x0EwIxGrwCI42IY6xAIw20EY4v20xvaj40_Gr0_Zr1l6VACY4xI67
	k04243AbIYCTnIWIevJa73UjIFyTuYvjxU9LvKUUUUU

VGhpcyBpcyBhIHB1cmVseSBjb3NtZXRpYyBwYXRjaCB0aGF0IHB1cmdlcyB0aGUgbmFtZSAnaW9y
ZXEnIGZyb20gc3RydWN0LAp2YXJpYWJsZSBhbmQgZmllbGQgbmFtZXMuIChUaGlzIG5hbWUgaGFz
IGJlZW4gcHJvYmxlbWF0aWMgZm9yIGEgbG9uZyB0aW1lCmFzICdpb3JlcScgaXMgdGhlIG5hbWUg
dXNlZCBmb3IgZ2VuZXJpYyBJL08gcmVxdWVzdHMgY29taW5nIGZyb20gWGVuKS4KVGhlIHBhdGNo
IHJlcGxhY2VzICdzdHJ1Y3QgaW9yZXEnIHdpdGggYSBuZXcgJ1hlblFkaXNrUmVxdWVzdCcgdHlw
ZSBhbmQKJ2lvcmVxJyBmaWVsZC92YXJpYWJsZSBuYW1lcyB3aXRoICdyZXF1ZXN0JywgYW5kIHRo
ZW4gZG9lcyBuZWNlc3NhcnkKZml4LXVwIHRvIGFkaGVyZSB0byBjb2Rpbmcgc3R5bGUuCgpGdW5j
dGlvbiBuYW1lcyBhcmUgbm90IG1vZGlmaWVkIGJ5IHRoaXMgcGF0Y2guIFloZXkgd2lsbCBiZSBk
ZWFsdCB3aXRoIGluCmEgc3Vic2VxdWVudCBwYXRjaC4KCk5vIGZ1bmN0aW9uYWwgY2hhbmdlLgoK
U2lnbmVkLW9mZi1ieTogUGF1bCBEdXJyYW50IDxwYXVsLmR1cnJhbnRAY2l0cml4LmNvbT4KLS0t
CkNjOiBTdGVmYW4gSGFqbm9jemkgPHN0ZWZhbmhhQHJlZGhhdC5jb20+CkNjOiBTdGVmYW5vIFN0
YWJlbGxpbmkgPHNzdGFiZWxsaW5pQGtlcm5lbC5vcmc+CkNjOiBBbnRob255IFBlcmFyZCA8YW50
aG9ueS5wZXJhcmRAY2l0cml4LmNvbT4KQ2M6IEtldmluIFdvbGYgPGt3b2xmQHJlZGhhdC5jb20+
CkNjOiBNYXggUmVpdHogPG1yZWl0ekByZWRoYXQuY29tPgotLS0KIGh3L2Jsb2NrL2RhdGFwbGFu
ZS94ZW4tcWRpc2suYyB8IDMxMCArKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0t
LS0tLQogMSBmaWxlIGNoYW5nZWQsIDE1NiBpbnNlcnRpb25zKCspLCAxNTQgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvaHcvYmxvY2svZGF0YXBsYW5lL3hlbi1xZGlzay5jIGIvaHcvYmxvY2sv
ZGF0YXBsYW5lL3hlbi1xZGlzay5jCmluZGV4IDIyMTQ0NTVmZjkuLjUwYTQ4YjZmNWYgMTAwNjQ0
Ci0tLSBhL2h3L2Jsb2NrL2RhdGFwbGFuZS94ZW4tcWRpc2suYworKysgYi9ody9ibG9jay9kYXRh
cGxhbmUveGVuLXFkaXNrLmMKQEAgLTE4LDcgKzE4LDcgQEAKICNpbmNsdWRlICJzeXNlbXUvaW90
aHJlYWQuaCIKICNpbmNsdWRlICJ4ZW4tcWRpc2suaCIKIAotc3RydWN0IGlvcmVxIHsKK3R5cGVk
ZWYgc3RydWN0IFhlblFkaXNrUmVxdWVzdCB7CiAgICAgYmxraWZfcmVxdWVzdF90IHJlcTsKICAg
ICBpbnQxNl90IHN0YXR1czsKICAgICBvZmZfdCBzdGFydDsKQEAgLTI5LDkgKzI5LDkgQEAgc3Ry
dWN0IGlvcmVxIHsKICAgICBpbnQgYWlvX2luZmxpZ2h0OwogICAgIGludCBhaW9fZXJyb3JzOwog
ICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmU7Ci0gICAgUUxJU1RfRU5UUlkoaW9yZXEp
IGxpc3Q7CisgICAgUUxJU1RfRU5UUlkoWGVuUWRpc2tSZXF1ZXN0KSBsaXN0OwogICAgIEJsb2Nr
QWNjdENvb2tpZSBhY2N0OwotfTsKK30gWGVuUWRpc2tSZXF1ZXN0OwogCiBzdHJ1Y3QgWGVuUWRp
c2tEYXRhUGxhbmUgewogICAgIFhlbkRldmljZSAqeGVuZGV2OwpAQCAtNDQsOSArNDQsOSBAQCBz
dHJ1Y3QgWGVuUWRpc2tEYXRhUGxhbmUgewogICAgIGludCBwcm90b2NvbDsKICAgICBibGtpZl9i
YWNrX3JpbmdzX3QgcmluZ3M7CiAgICAgaW50IG1vcmVfd29yazsKLSAgICBRTElTVF9IRUFEKGlu
ZmxpZ2h0X2hlYWQsIGlvcmVxKSBpbmZsaWdodDsKLSAgICBRTElTVF9IRUFEKGZpbmlzaGVkX2hl
YWQsIGlvcmVxKSBmaW5pc2hlZDsKLSAgICBRTElTVF9IRUFEKGZyZWVsaXN0X2hlYWQsIGlvcmVx
KSBmcmVlbGlzdDsKKyAgICBRTElTVF9IRUFEKGluZmxpZ2h0X2hlYWQsIFhlblFkaXNrUmVxdWVz
dCkgaW5mbGlnaHQ7CisgICAgUUxJU1RfSEVBRChmaW5pc2hlZF9oZWFkLCBYZW5RZGlza1JlcXVl
c3QpIGZpbmlzaGVkOworICAgIFFMSVNUX0hFQUQoZnJlZWxpc3RfaGVhZCwgWGVuUWRpc2tSZXF1
ZXN0KSBmcmVlbGlzdDsKICAgICBpbnQgcmVxdWVzdHNfdG90YWw7CiAgICAgaW50IHJlcXVlc3Rz
X2luZmxpZ2h0OwogICAgIGludCByZXF1ZXN0c19maW5pc2hlZDsKQEAgLTU3LDY4ICs1Nyw2OCBA
QCBzdHJ1Y3QgWGVuUWRpc2tEYXRhUGxhbmUgewogICAgIEFpb0NvbnRleHQgKmN0eDsKIH07CiAK
LXN0YXRpYyB2b2lkIGlvcmVxX3Jlc2V0KHN0cnVjdCBpb3JlcSAqaW9yZXEpCitzdGF0aWMgdm9p
ZCBpb3JlcV9yZXNldChYZW5RZGlza1JlcXVlc3QgKnJlcXVlc3QpCiB7Ci0gICAgbWVtc2V0KCZp
b3JlcS0+cmVxLCAwLCBzaXplb2YoaW9yZXEtPnJlcSkpOwotICAgIGlvcmVxLT5zdGF0dXMgPSAw
OwotICAgIGlvcmVxLT5zdGFydCA9IDA7Ci0gICAgaW9yZXEtPmJ1ZiA9IE5VTEw7Ci0gICAgaW9y
ZXEtPnNpemUgPSAwOwotICAgIGlvcmVxLT5wcmVzeW5jID0gMDsKKyAgICBtZW1zZXQoJnJlcXVl
c3QtPnJlcSwgMCwgc2l6ZW9mKHJlcXVlc3QtPnJlcSkpOworICAgIHJlcXVlc3QtPnN0YXR1cyA9
IDA7CisgICAgcmVxdWVzdC0+c3RhcnQgPSAwOworICAgIHJlcXVlc3QtPmJ1ZiA9IE5VTEw7Cisg
ICAgcmVxdWVzdC0+c2l6ZSA9IDA7CisgICAgcmVxdWVzdC0+cHJlc3luYyA9IDA7CiAKLSAgICBp
b3JlcS0+YWlvX2luZmxpZ2h0ID0gMDsKLSAgICBpb3JlcS0+YWlvX2Vycm9ycyA9IDA7CisgICAg
cmVxdWVzdC0+YWlvX2luZmxpZ2h0ID0gMDsKKyAgICByZXF1ZXN0LT5haW9fZXJyb3JzID0gMDsK
IAotICAgIGlvcmVxLT5kYXRhcGxhbmUgPSBOVUxMOwotICAgIG1lbXNldCgmaW9yZXEtPmxpc3Qs
IDAsIHNpemVvZihpb3JlcS0+bGlzdCkpOwotICAgIG1lbXNldCgmaW9yZXEtPmFjY3QsIDAsIHNp
emVvZihpb3JlcS0+YWNjdCkpOworICAgIHJlcXVlc3QtPmRhdGFwbGFuZSA9IE5VTEw7CisgICAg
bWVtc2V0KCZyZXF1ZXN0LT5saXN0LCAwLCBzaXplb2YocmVxdWVzdC0+bGlzdCkpOworICAgIG1l
bXNldCgmcmVxdWVzdC0+YWNjdCwgMCwgc2l6ZW9mKHJlcXVlc3QtPmFjY3QpKTsKIAotICAgIHFl
bXVfaW92ZWNfcmVzZXQoJmlvcmVxLT52KTsKKyAgICBxZW11X2lvdmVjX3Jlc2V0KCZyZXF1ZXN0
LT52KTsKIH0KIAotc3RhdGljIHN0cnVjdCBpb3JlcSAqaW9yZXFfc3RhcnQoWGVuUWRpc2tEYXRh
UGxhbmUgKmRhdGFwbGFuZSkKK3N0YXRpYyBYZW5RZGlza1JlcXVlc3QgKmlvcmVxX3N0YXJ0KFhl
blFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUpCiB7Ci0gICAgc3RydWN0IGlvcmVxICppb3JlcSA9
IE5VTEw7CisgICAgWGVuUWRpc2tSZXF1ZXN0ICpyZXF1ZXN0ID0gTlVMTDsKIAogICAgIGlmIChR
TElTVF9FTVBUWSgmZGF0YXBsYW5lLT5mcmVlbGlzdCkpIHsKICAgICAgICAgaWYgKGRhdGFwbGFu
ZS0+cmVxdWVzdHNfdG90YWwgPj0gZGF0YXBsYW5lLT5tYXhfcmVxdWVzdHMpIHsKICAgICAgICAg
ICAgIGdvdG8gb3V0OwogICAgICAgICB9CiAgICAgICAgIC8qIGFsbG9jYXRlIG5ldyBzdHJ1Y3Qg
Ki8KLSAgICAgICAgaW9yZXEgPSBnX21hbGxvYzAoc2l6ZW9mKCppb3JlcSkpOwotICAgICAgICBp
b3JlcS0+ZGF0YXBsYW5lID0gZGF0YXBsYW5lOworICAgICAgICByZXF1ZXN0ID0gZ19tYWxsb2Mw
KHNpemVvZigqcmVxdWVzdCkpOworICAgICAgICByZXF1ZXN0LT5kYXRhcGxhbmUgPSBkYXRhcGxh
bmU7CiAgICAgICAgIGRhdGFwbGFuZS0+cmVxdWVzdHNfdG90YWwrKzsKLSAgICAgICAgcWVtdV9p
b3ZlY19pbml0KCZpb3JlcS0+diwgMSk7CisgICAgICAgIHFlbXVfaW92ZWNfaW5pdCgmcmVxdWVz
dC0+diwgMSk7CiAgICAgfSBlbHNlIHsKICAgICAgICAgLyogZ2V0IG9uZSBmcm9tIGZyZWVsaXN0
ICovCi0gICAgICAgIGlvcmVxID0gUUxJU1RfRklSU1QoJmRhdGFwbGFuZS0+ZnJlZWxpc3QpOwot
ICAgICAgICBRTElTVF9SRU1PVkUoaW9yZXEsIGxpc3QpOworICAgICAgICByZXF1ZXN0ID0gUUxJ
U1RfRklSU1QoJmRhdGFwbGFuZS0+ZnJlZWxpc3QpOworICAgICAgICBRTElTVF9SRU1PVkUocmVx
dWVzdCwgbGlzdCk7CiAgICAgfQotICAgIFFMSVNUX0lOU0VSVF9IRUFEKCZkYXRhcGxhbmUtPmlu
ZmxpZ2h0LCBpb3JlcSwgbGlzdCk7CisgICAgUUxJU1RfSU5TRVJUX0hFQUQoJmRhdGFwbGFuZS0+
aW5mbGlnaHQsIHJlcXVlc3QsIGxpc3QpOwogICAgIGRhdGFwbGFuZS0+cmVxdWVzdHNfaW5mbGln
aHQrKzsKIAogb3V0OgotICAgIHJldHVybiBpb3JlcTsKKyAgICByZXR1cm4gcmVxdWVzdDsKIH0K
IAotc3RhdGljIHZvaWQgaW9yZXFfZmluaXNoKHN0cnVjdCBpb3JlcSAqaW9yZXEpCitzdGF0aWMg
dm9pZCBpb3JlcV9maW5pc2goWGVuUWRpc2tSZXF1ZXN0ICpyZXF1ZXN0KQogewotICAgIFhlblFk
aXNrRGF0YVBsYW5lICpkYXRhcGxhbmUgPSBpb3JlcS0+ZGF0YXBsYW5lOworICAgIFhlblFkaXNr
RGF0YVBsYW5lICpkYXRhcGxhbmUgPSByZXF1ZXN0LT5kYXRhcGxhbmU7CiAKLSAgICBRTElTVF9S
RU1PVkUoaW9yZXEsIGxpc3QpOwotICAgIFFMSVNUX0lOU0VSVF9IRUFEKCZkYXRhcGxhbmUtPmZp
bmlzaGVkLCBpb3JlcSwgbGlzdCk7CisgICAgUUxJU1RfUkVNT1ZFKHJlcXVlc3QsIGxpc3QpOwor
ICAgIFFMSVNUX0lOU0VSVF9IRUFEKCZkYXRhcGxhbmUtPmZpbmlzaGVkLCByZXF1ZXN0LCBsaXN0
KTsKICAgICBkYXRhcGxhbmUtPnJlcXVlc3RzX2luZmxpZ2h0LS07CiAgICAgZGF0YXBsYW5lLT5y
ZXF1ZXN0c19maW5pc2hlZCsrOwogfQogCi1zdGF0aWMgdm9pZCBpb3JlcV9yZWxlYXNlKHN0cnVj
dCBpb3JlcSAqaW9yZXEsIGJvb2wgZmluaXNoKQorc3RhdGljIHZvaWQgaW9yZXFfcmVsZWFzZShY
ZW5RZGlza1JlcXVlc3QgKnJlcXVlc3QsIGJvb2wgZmluaXNoKQogewotICAgIFhlblFkaXNrRGF0
YVBsYW5lICpkYXRhcGxhbmUgPSBpb3JlcS0+ZGF0YXBsYW5lOworICAgIFhlblFkaXNrRGF0YVBs
YW5lICpkYXRhcGxhbmUgPSByZXF1ZXN0LT5kYXRhcGxhbmU7CiAKLSAgICBRTElTVF9SRU1PVkUo
aW9yZXEsIGxpc3QpOwotICAgIGlvcmVxX3Jlc2V0KGlvcmVxKTsKLSAgICBpb3JlcS0+ZGF0YXBs
YW5lID0gZGF0YXBsYW5lOwotICAgIFFMSVNUX0lOU0VSVF9IRUFEKCZkYXRhcGxhbmUtPmZyZWVs
aXN0LCBpb3JlcSwgbGlzdCk7CisgICAgUUxJU1RfUkVNT1ZFKHJlcXVlc3QsIGxpc3QpOworICAg
IGlvcmVxX3Jlc2V0KHJlcXVlc3QpOworICAgIHJlcXVlc3QtPmRhdGFwbGFuZSA9IGRhdGFwbGFu
ZTsKKyAgICBRTElTVF9JTlNFUlRfSEVBRCgmZGF0YXBsYW5lLT5mcmVlbGlzdCwgcmVxdWVzdCwg
bGlzdCk7CiAgICAgaWYgKGZpbmlzaCkgewogICAgICAgICBkYXRhcGxhbmUtPnJlcXVlc3RzX2Zp
bmlzaGVkLS07CiAgICAgfSBlbHNlIHsKQEAgLTEzMCwxOCArMTMwLDE4IEBAIHN0YXRpYyB2b2lk
IGlvcmVxX3JlbGVhc2Uoc3RydWN0IGlvcmVxICppb3JlcSwgYm9vbCBmaW5pc2gpCiAgKiB0cmFu
c2xhdGUgcmVxdWVzdCBpbnRvIGlvdmVjICsgc3RhcnQgb2Zmc2V0CiAgKiBkbyBzYW5pdHkgY2hl
Y2tzIGFsb25nIHRoZSB3YXkKICAqLwotc3RhdGljIGludCBpb3JlcV9wYXJzZShzdHJ1Y3QgaW9y
ZXEgKmlvcmVxKQorc3RhdGljIGludCBpb3JlcV9wYXJzZShYZW5RZGlza1JlcXVlc3QgKnJlcXVl
c3QpCiB7Ci0gICAgWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSA9IGlvcmVxLT5kYXRhcGxh
bmU7CisgICAgWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSA9IHJlcXVlc3QtPmRhdGFwbGFu
ZTsKICAgICBzaXplX3QgbGVuOwogICAgIGludCBpOwogCi0gICAgc3dpdGNoIChpb3JlcS0+cmVx
Lm9wZXJhdGlvbikgeworICAgIHN3aXRjaCAocmVxdWVzdC0+cmVxLm9wZXJhdGlvbikgewogICAg
IGNhc2UgQkxLSUZfT1BfUkVBRDoKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBCTEtJRl9PUF9G
TFVTSF9ESVNLQ0FDSEU6Ci0gICAgICAgIGlvcmVxLT5wcmVzeW5jID0gMTsKLSAgICAgICAgaWYg
KCFpb3JlcS0+cmVxLm5yX3NlZ21lbnRzKSB7CisgICAgICAgIHJlcXVlc3QtPnByZXN5bmMgPSAx
OworICAgICAgICBpZiAoIXJlcXVlc3QtPnJlcS5ucl9zZWdtZW50cykgewogICAgICAgICAgICAg
cmV0dXJuIDA7CiAgICAgICAgIH0KICAgICAgICAgLyogZmFsbCB0aHJvdWdoICovCkBAIC0xNTAs
NzcgKzE1MCw3OCBAQCBzdGF0aWMgaW50IGlvcmVxX3BhcnNlKHN0cnVjdCBpb3JlcSAqaW9yZXEp
CiAgICAgY2FzZSBCTEtJRl9PUF9ESVNDQVJEOgogICAgICAgICByZXR1cm4gMDsKICAgICBkZWZh
dWx0OgotICAgICAgICBlcnJvcl9yZXBvcnQoImVycm9yOiB1bmtub3duIG9wZXJhdGlvbiAoJWQp
IiwgaW9yZXEtPnJlcS5vcGVyYXRpb24pOworICAgICAgICBlcnJvcl9yZXBvcnQoImVycm9yOiB1
bmtub3duIG9wZXJhdGlvbiAoJWQpIiwgcmVxdWVzdC0+cmVxLm9wZXJhdGlvbik7CiAgICAgICAg
IGdvdG8gZXJyOwogICAgIH07CiAKLSAgICBpZiAoaW9yZXEtPnJlcS5vcGVyYXRpb24gIT0gQkxL
SUZfT1BfUkVBRCAmJgorICAgIGlmIChyZXF1ZXN0LT5yZXEub3BlcmF0aW9uICE9IEJMS0lGX09Q
X1JFQUQgJiYKICAgICAgICAgYmxrX2lzX3JlYWRfb25seShkYXRhcGxhbmUtPmJsaykpIHsKICAg
ICAgICAgZXJyb3JfcmVwb3J0KCJlcnJvcjogd3JpdGUgcmVxIGZvciBybyBkZXZpY2UiKTsKICAg
ICAgICAgZ290byBlcnI7CiAgICAgfQogCi0gICAgaW9yZXEtPnN0YXJ0ID0gaW9yZXEtPnJlcS5z
ZWN0b3JfbnVtYmVyICogZGF0YXBsYW5lLT5maWxlX2JsazsKLSAgICBmb3IgKGkgPSAwOyBpIDwg
aW9yZXEtPnJlcS5ucl9zZWdtZW50czsgaSsrKSB7CisgICAgcmVxdWVzdC0+c3RhcnQgPSByZXF1
ZXN0LT5yZXEuc2VjdG9yX251bWJlciAqIGRhdGFwbGFuZS0+ZmlsZV9ibGs7CisgICAgZm9yIChp
ID0gMDsgaSA8IHJlcXVlc3QtPnJlcS5ucl9zZWdtZW50czsgaSsrKSB7CiAgICAgICAgIGlmIChp
ID09IEJMS0lGX01BWF9TRUdNRU5UU19QRVJfUkVRVUVTVCkgewogICAgICAgICAgICAgZXJyb3Jf
cmVwb3J0KCJlcnJvcjogbnJfc2VnbWVudHMgdG9vIGJpZyIpOwogICAgICAgICAgICAgZ290byBl
cnI7CiAgICAgICAgIH0KLSAgICAgICAgaWYgKGlvcmVxLT5yZXEuc2VnW2ldLmZpcnN0X3NlY3Qg
PiBpb3JlcS0+cmVxLnNlZ1tpXS5sYXN0X3NlY3QpIHsKKyAgICAgICAgaWYgKHJlcXVlc3QtPnJl
cS5zZWdbaV0uZmlyc3Rfc2VjdCA+IHJlcXVlc3QtPnJlcS5zZWdbaV0ubGFzdF9zZWN0KSB7CiAg
ICAgICAgICAgICBlcnJvcl9yZXBvcnQoImVycm9yOiBmaXJzdCA+IGxhc3Qgc2VjdG9yIik7CiAg
ICAgICAgICAgICBnb3RvIGVycjsKICAgICAgICAgfQotICAgICAgICBpZiAoaW9yZXEtPnJlcS5z
ZWdbaV0ubGFzdF9zZWN0ICogZGF0YXBsYW5lLT5maWxlX2JsayA+PSBYQ19QQUdFX1NJWkUpIHsK
KyAgICAgICAgaWYgKHJlcXVlc3QtPnJlcS5zZWdbaV0ubGFzdF9zZWN0ICogZGF0YXBsYW5lLT5m
aWxlX2JsayA+PQorICAgICAgICAgICAgWENfUEFHRV9TSVpFKSB7CiAgICAgICAgICAgICBlcnJv
cl9yZXBvcnQoImVycm9yOiBwYWdlIGNyb3NzaW5nIik7CiAgICAgICAgICAgICBnb3RvIGVycjsK
ICAgICAgICAgfQogCi0gICAgICAgIGxlbiA9IChpb3JlcS0+cmVxLnNlZ1tpXS5sYXN0X3NlY3Qg
LQotICAgICAgICAgICAgICAgaW9yZXEtPnJlcS5zZWdbaV0uZmlyc3Rfc2VjdCArIDEpICogZGF0
YXBsYW5lLT5maWxlX2JsazsKLSAgICAgICAgaW9yZXEtPnNpemUgKz0gbGVuOworICAgICAgICBs
ZW4gPSAocmVxdWVzdC0+cmVxLnNlZ1tpXS5sYXN0X3NlY3QgLQorICAgICAgICAgICAgICAgcmVx
dWVzdC0+cmVxLnNlZ1tpXS5maXJzdF9zZWN0ICsgMSkgKiBkYXRhcGxhbmUtPmZpbGVfYmxrOwor
ICAgICAgICByZXF1ZXN0LT5zaXplICs9IGxlbjsKICAgICB9Ci0gICAgaWYgKGlvcmVxLT5zdGFy
dCArIGlvcmVxLT5zaXplID4gZGF0YXBsYW5lLT5maWxlX3NpemUpIHsKKyAgICBpZiAocmVxdWVz
dC0+c3RhcnQgKyByZXF1ZXN0LT5zaXplID4gZGF0YXBsYW5lLT5maWxlX3NpemUpIHsKICAgICAg
ICAgZXJyb3JfcmVwb3J0KCJlcnJvcjogYWNjZXNzIGJleW9uZCBlbmQgb2YgZmlsZSIpOwogICAg
ICAgICBnb3RvIGVycjsKICAgICB9CiAgICAgcmV0dXJuIDA7CiAKIGVycjoKLSAgICBpb3JlcS0+
c3RhdHVzID0gQkxLSUZfUlNQX0VSUk9SOworICAgIHJlcXVlc3QtPnN0YXR1cyA9IEJMS0lGX1JT
UF9FUlJPUjsKICAgICByZXR1cm4gLTE7CiB9CiAKLXN0YXRpYyBpbnQgaW9yZXFfZ3JhbnRfY29w
eShzdHJ1Y3QgaW9yZXEgKmlvcmVxKQorc3RhdGljIGludCBpb3JlcV9ncmFudF9jb3B5KFhlblFk
aXNrUmVxdWVzdCAqcmVxdWVzdCkKIHsKLSAgICBYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5l
ID0gaW9yZXEtPmRhdGFwbGFuZTsKKyAgICBYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lID0g
cmVxdWVzdC0+ZGF0YXBsYW5lOwogICAgIFhlbkRldmljZSAqeGVuZGV2ID0gZGF0YXBsYW5lLT54
ZW5kZXY7CiAgICAgWGVuRGV2aWNlR3JhbnRDb3B5U2VnbWVudCBzZWdzW0JMS0lGX01BWF9TRUdN
RU5UU19QRVJfUkVRVUVTVF07CiAgICAgaW50IGksIGNvdW50OwogICAgIGludDY0X3QgZmlsZV9i
bGsgPSBkYXRhcGxhbmUtPmZpbGVfYmxrOwotICAgIGJvb2wgdG9fZG9tYWluID0gKGlvcmVxLT5y
ZXEub3BlcmF0aW9uID09IEJMS0lGX09QX1JFQUQpOwotICAgIHZvaWQgKnZpcnQgPSBpb3JlcS0+
YnVmOworICAgIGJvb2wgdG9fZG9tYWluID0gKHJlcXVlc3QtPnJlcS5vcGVyYXRpb24gPT0gQkxL
SUZfT1BfUkVBRCk7CisgICAgdm9pZCAqdmlydCA9IHJlcXVlc3QtPmJ1ZjsKICAgICBFcnJvciAq
bG9jYWxfZXJyID0gTlVMTDsKIAotICAgIGlmIChpb3JlcS0+cmVxLm5yX3NlZ21lbnRzID09IDAp
IHsKKyAgICBpZiAocmVxdWVzdC0+cmVxLm5yX3NlZ21lbnRzID09IDApIHsKICAgICAgICAgcmV0
dXJuIDA7CiAgICAgfQogCi0gICAgY291bnQgPSBpb3JlcS0+cmVxLm5yX3NlZ21lbnRzOworICAg
IGNvdW50ID0gcmVxdWVzdC0+cmVxLm5yX3NlZ21lbnRzOwogCiAgICAgZm9yIChpID0gMDsgaSA8
IGNvdW50OyBpKyspIHsKICAgICAgICAgaWYgKHRvX2RvbWFpbikgewotICAgICAgICAgICAgc2Vn
c1tpXS5kZXN0LmZvcmVpZ24ucmVmID0gaW9yZXEtPnJlcS5zZWdbaV0uZ3JlZjsKLSAgICAgICAg
ICAgIHNlZ3NbaV0uZGVzdC5mb3JlaWduLm9mZnNldCA9IGlvcmVxLT5yZXEuc2VnW2ldLmZpcnN0
X3NlY3QgKgorICAgICAgICAgICAgc2Vnc1tpXS5kZXN0LmZvcmVpZ24ucmVmID0gcmVxdWVzdC0+
cmVxLnNlZ1tpXS5ncmVmOworICAgICAgICAgICAgc2Vnc1tpXS5kZXN0LmZvcmVpZ24ub2Zmc2V0
ID0gcmVxdWVzdC0+cmVxLnNlZ1tpXS5maXJzdF9zZWN0ICoKICAgICAgICAgICAgICAgICBmaWxl
X2JsazsKICAgICAgICAgICAgIHNlZ3NbaV0uc291cmNlLnZpcnQgPSB2aXJ0OwogICAgICAgICB9
IGVsc2UgewotICAgICAgICAgICAgc2Vnc1tpXS5zb3VyY2UuZm9yZWlnbi5yZWYgPSBpb3JlcS0+
cmVxLnNlZ1tpXS5ncmVmOwotICAgICAgICAgICAgc2Vnc1tpXS5zb3VyY2UuZm9yZWlnbi5vZmZz
ZXQgPSBpb3JlcS0+cmVxLnNlZ1tpXS5maXJzdF9zZWN0ICoKKyAgICAgICAgICAgIHNlZ3NbaV0u
c291cmNlLmZvcmVpZ24ucmVmID0gcmVxdWVzdC0+cmVxLnNlZ1tpXS5ncmVmOworICAgICAgICAg
ICAgc2Vnc1tpXS5zb3VyY2UuZm9yZWlnbi5vZmZzZXQgPSByZXF1ZXN0LT5yZXEuc2VnW2ldLmZp
cnN0X3NlY3QgKgogICAgICAgICAgICAgICAgIGZpbGVfYmxrOwogICAgICAgICAgICAgc2Vnc1tp
XS5kZXN0LnZpcnQgPSB2aXJ0OwogICAgICAgICB9Ci0gICAgICAgIHNlZ3NbaV0ubGVuID0gKGlv
cmVxLT5yZXEuc2VnW2ldLmxhc3Rfc2VjdCAtCi0gICAgICAgICAgICAgICAgICAgICAgIGlvcmVx
LT5yZXEuc2VnW2ldLmZpcnN0X3NlY3QgKyAxKSAqIGZpbGVfYmxrOworICAgICAgICBzZWdzW2ld
LmxlbiA9IChyZXF1ZXN0LT5yZXEuc2VnW2ldLmxhc3Rfc2VjdCAtCisgICAgICAgICAgICAgICAg
ICAgICAgIHJlcXVlc3QtPnJlcS5zZWdbaV0uZmlyc3Rfc2VjdCArIDEpICogZmlsZV9ibGs7CiAg
ICAgICAgIHZpcnQgKz0gc2Vnc1tpXS5sZW47CiAgICAgfQogCkBAIC0yMzIsNzIgKzIzMyw3MiBA
QCBzdGF0aWMgaW50IGlvcmVxX2dyYW50X2NvcHkoc3RydWN0IGlvcmVxICppb3JlcSkKICAgICAg
ICAgZXJyb3JfcmVwb3J0KCJmYWlsZWQgdG8gY29weSBkYXRhOiAlcyIsIG1zZyk7CiAgICAgICAg
IGVycm9yX2ZyZWUobG9jYWxfZXJyKTsKIAotICAgICAgICBpb3JlcS0+YWlvX2Vycm9ycysrOwor
ICAgICAgICByZXF1ZXN0LT5haW9fZXJyb3JzKys7CiAgICAgICAgIHJldHVybiAtMTsKICAgICB9
CiAKICAgICByZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBpb3JlcV9ydW5pb19xZW11X2Fpbyhz
dHJ1Y3QgaW9yZXEgKmlvcmVxKTsKK3N0YXRpYyBpbnQgaW9yZXFfcnVuaW9fcWVtdV9haW8oWGVu
UWRpc2tSZXF1ZXN0ICpyZXF1ZXN0KTsKIAogc3RhdGljIHZvaWQgcWVtdV9haW9fY29tcGxldGUo
dm9pZCAqb3BhcXVlLCBpbnQgcmV0KQogewotICAgIHN0cnVjdCBpb3JlcSAqaW9yZXEgPSBvcGFx
dWU7Ci0gICAgWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSA9IGlvcmVxLT5kYXRhcGxhbmU7
CisgICAgWGVuUWRpc2tSZXF1ZXN0ICpyZXF1ZXN0ID0gb3BhcXVlOworICAgIFhlblFkaXNrRGF0
YVBsYW5lICpkYXRhcGxhbmUgPSByZXF1ZXN0LT5kYXRhcGxhbmU7CiAKICAgICBhaW9fY29udGV4
dF9hY3F1aXJlKGRhdGFwbGFuZS0+Y3R4KTsKIAogICAgIGlmIChyZXQgIT0gMCkgewogICAgICAg
ICBlcnJvcl9yZXBvcnQoIiVzIEkvTyBlcnJvciIsCi0gICAgICAgICAgICAgICAgICAgICBpb3Jl
cS0+cmVxLm9wZXJhdGlvbiA9PSBCTEtJRl9PUF9SRUFEID8KKyAgICAgICAgICAgICAgICAgICAg
IHJlcXVlc3QtPnJlcS5vcGVyYXRpb24gPT0gQkxLSUZfT1BfUkVBRCA/CiAgICAgICAgICAgICAg
ICAgICAgICAicmVhZCIgOiAid3JpdGUiKTsKLSAgICAgICAgaW9yZXEtPmFpb19lcnJvcnMrKzsK
KyAgICAgICAgcmVxdWVzdC0+YWlvX2Vycm9ycysrOwogICAgIH0KIAotICAgIGlvcmVxLT5haW9f
aW5mbGlnaHQtLTsKLSAgICBpZiAoaW9yZXEtPnByZXN5bmMpIHsKLSAgICAgICAgaW9yZXEtPnBy
ZXN5bmMgPSAwOwotICAgICAgICBpb3JlcV9ydW5pb19xZW11X2Fpbyhpb3JlcSk7CisgICAgcmVx
dWVzdC0+YWlvX2luZmxpZ2h0LS07CisgICAgaWYgKHJlcXVlc3QtPnByZXN5bmMpIHsKKyAgICAg
ICAgcmVxdWVzdC0+cHJlc3luYyA9IDA7CisgICAgICAgIGlvcmVxX3J1bmlvX3FlbXVfYWlvKHJl
cXVlc3QpOwogICAgICAgICBnb3RvIGRvbmU7CiAgICAgfQotICAgIGlmIChpb3JlcS0+YWlvX2lu
ZmxpZ2h0ID4gMCkgeworICAgIGlmIChyZXF1ZXN0LT5haW9faW5mbGlnaHQgPiAwKSB7CiAgICAg
ICAgIGdvdG8gZG9uZTsKICAgICB9CiAKLSAgICBzd2l0Y2ggKGlvcmVxLT5yZXEub3BlcmF0aW9u
KSB7CisgICAgc3dpdGNoIChyZXF1ZXN0LT5yZXEub3BlcmF0aW9uKSB7CiAgICAgY2FzZSBCTEtJ
Rl9PUF9SRUFEOgotICAgICAgICAvKiBpbiBjYXNlIG9mIGZhaWx1cmUgaW9yZXEtPmFpb19lcnJv
cnMgaXMgaW5jcmVhc2VkICovCisgICAgICAgIC8qIGluIGNhc2Ugb2YgZmFpbHVyZSByZXF1ZXN0
LT5haW9fZXJyb3JzIGlzIGluY3JlYXNlZCAqLwogICAgICAgICBpZiAocmV0ID09IDApIHsKLSAg
ICAgICAgICAgIGlvcmVxX2dyYW50X2NvcHkoaW9yZXEpOworICAgICAgICAgICAgaW9yZXFfZ3Jh
bnRfY29weShyZXF1ZXN0KTsKICAgICAgICAgfQotICAgICAgICBxZW11X3ZmcmVlKGlvcmVxLT5i
dWYpOworICAgICAgICBxZW11X3ZmcmVlKHJlcXVlc3QtPmJ1Zik7CiAgICAgICAgIGJyZWFrOwog
ICAgIGNhc2UgQkxLSUZfT1BfV1JJVEU6CiAgICAgY2FzZSBCTEtJRl9PUF9GTFVTSF9ESVNLQ0FD
SEU6Ci0gICAgICAgIGlmICghaW9yZXEtPnJlcS5ucl9zZWdtZW50cykgeworICAgICAgICBpZiAo
IXJlcXVlc3QtPnJlcS5ucl9zZWdtZW50cykgewogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
IH0KLSAgICAgICAgcWVtdV92ZnJlZShpb3JlcS0+YnVmKTsKKyAgICAgICAgcWVtdV92ZnJlZShy
ZXF1ZXN0LT5idWYpOwogICAgICAgICBicmVhazsKICAgICBkZWZhdWx0OgogICAgICAgICBicmVh
azsKICAgICB9CiAKLSAgICBpb3JlcS0+c3RhdHVzID0gaW9yZXEtPmFpb19lcnJvcnMgPyBCTEtJ
Rl9SU1BfRVJST1IgOiBCTEtJRl9SU1BfT0tBWTsKLSAgICBpb3JlcV9maW5pc2goaW9yZXEpOwor
ICAgIHJlcXVlc3QtPnN0YXR1cyA9IHJlcXVlc3QtPmFpb19lcnJvcnMgPyBCTEtJRl9SU1BfRVJS
T1IgOiBCTEtJRl9SU1BfT0tBWTsKKyAgICBpb3JlcV9maW5pc2gocmVxdWVzdCk7CiAKLSAgICBz
d2l0Y2ggKGlvcmVxLT5yZXEub3BlcmF0aW9uKSB7CisgICAgc3dpdGNoIChyZXF1ZXN0LT5yZXEu
b3BlcmF0aW9uKSB7CiAgICAgY2FzZSBCTEtJRl9PUF9XUklURToKICAgICBjYXNlIEJMS0lGX09Q
X0ZMVVNIX0RJU0tDQUNIRToKLSAgICAgICAgaWYgKCFpb3JlcS0+cmVxLm5yX3NlZ21lbnRzKSB7
CisgICAgICAgIGlmICghcmVxdWVzdC0+cmVxLm5yX3NlZ21lbnRzKSB7CiAgICAgICAgICAgICBi
cmVhazsKICAgICAgICAgfQogICAgIGNhc2UgQkxLSUZfT1BfUkVBRDoKLSAgICAgICAgaWYgKGlv
cmVxLT5zdGF0dXMgPT0gQkxLSUZfUlNQX09LQVkpIHsKLSAgICAgICAgICAgIGJsb2NrX2FjY3Rf
ZG9uZShibGtfZ2V0X3N0YXRzKGRhdGFwbGFuZS0+YmxrKSwgJmlvcmVxLT5hY2N0KTsKKyAgICAg
ICAgaWYgKHJlcXVlc3QtPnN0YXR1cyA9PSBCTEtJRl9SU1BfT0tBWSkgeworICAgICAgICAgICAg
YmxvY2tfYWNjdF9kb25lKGJsa19nZXRfc3RhdHMoZGF0YXBsYW5lLT5ibGspLCAmcmVxdWVzdC0+
YWNjdCk7CiAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICBibG9ja19hY2N0X2ZhaWxlZChi
bGtfZ2V0X3N0YXRzKGRhdGFwbGFuZS0+YmxrKSwgJmlvcmVxLT5hY2N0KTsKKyAgICAgICAgICAg
IGJsb2NrX2FjY3RfZmFpbGVkKGJsa19nZXRfc3RhdHMoZGF0YXBsYW5lLT5ibGspLCAmcmVxdWVz
dC0+YWNjdCk7CiAgICAgICAgIH0KICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBCTEtJRl9PUF9E
SVNDQVJEOgpAQCAtMzEwLDEwICszMTEsMTEgQEAgZG9uZToKICAgICBhaW9fY29udGV4dF9yZWxl
YXNlKGRhdGFwbGFuZS0+Y3R4KTsKIH0KIAotc3RhdGljIGJvb2wgYmxrX3NwbGl0X2Rpc2NhcmQo
c3RydWN0IGlvcmVxICppb3JlcSwgYmxraWZfc2VjdG9yX3Qgc2VjdG9yX251bWJlciwKK3N0YXRp
YyBib29sIGJsa19zcGxpdF9kaXNjYXJkKFhlblFkaXNrUmVxdWVzdCAqcmVxdWVzdCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGJsa2lmX3NlY3Rvcl90IHNlY3Rvcl9udW1iZXIsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBucl9zZWN0b3JzKQogewotICAg
IFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUgPSBpb3JlcS0+ZGF0YXBsYW5lOworICAgIFhl
blFkaXNrRGF0YVBsYW5lICpkYXRhcGxhbmUgPSByZXF1ZXN0LT5kYXRhcGxhbmU7CiAgICAgaW50
NjRfdCBieXRlX29mZnNldDsKICAgICBpbnQgYnl0ZV9jaHVuazsKICAgICB1aW50NjRfdCBieXRl
X3JlbWFpbmluZywgbGltaXQ7CkBAIC0zMzIsOSArMzM0LDkgQEAgc3RhdGljIGJvb2wgYmxrX3Nw
bGl0X2Rpc2NhcmQoc3RydWN0IGlvcmVxICppb3JlcSwgYmxraWZfc2VjdG9yX3Qgc2VjdG9yX251
bWJlciwKIAogICAgIGRvIHsKICAgICAgICAgYnl0ZV9jaHVuayA9IGJ5dGVfcmVtYWluaW5nID4g
bGltaXQgPyBsaW1pdCA6IGJ5dGVfcmVtYWluaW5nOwotICAgICAgICBpb3JlcS0+YWlvX2luZmxp
Z2h0Kys7CisgICAgICAgIHJlcXVlc3QtPmFpb19pbmZsaWdodCsrOwogICAgICAgICBibGtfYWlv
X3BkaXNjYXJkKGRhdGFwbGFuZS0+YmxrLCBieXRlX29mZnNldCwgYnl0ZV9jaHVuaywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICBxZW11X2Fpb19jb21wbGV0ZSwgaW9yZXEpOworICAgICAgICAg
ICAgICAgICAgICAgICAgIHFlbXVfYWlvX2NvbXBsZXRlLCByZXF1ZXN0KTsKICAgICAgICAgYnl0
ZV9yZW1haW5pbmcgLT0gYnl0ZV9jaHVuazsKICAgICAgICAgYnl0ZV9vZmZzZXQgKz0gYnl0ZV9j
aHVuazsKICAgICB9IHdoaWxlIChieXRlX3JlbWFpbmluZyA+IDApOwpAQCAtMzQyLDUzICszNDQs
NTMgQEAgc3RhdGljIGJvb2wgYmxrX3NwbGl0X2Rpc2NhcmQoc3RydWN0IGlvcmVxICppb3JlcSwg
YmxraWZfc2VjdG9yX3Qgc2VjdG9yX251bWJlciwKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAotc3Rh
dGljIGludCBpb3JlcV9ydW5pb19xZW11X2FpbyhzdHJ1Y3QgaW9yZXEgKmlvcmVxKQorc3RhdGlj
IGludCBpb3JlcV9ydW5pb19xZW11X2FpbyhYZW5RZGlza1JlcXVlc3QgKnJlcXVlc3QpCiB7Ci0g
ICAgWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSA9IGlvcmVxLT5kYXRhcGxhbmU7Ci0KLSAg
ICBpb3JlcS0+YnVmID0gcWVtdV9tZW1hbGlnbihYQ19QQUdFX1NJWkUsIGlvcmVxLT5zaXplKTsK
LSAgICBpZiAoaW9yZXEtPnJlcS5ucl9zZWdtZW50cyAmJgotICAgICAgICAoaW9yZXEtPnJlcS5v
cGVyYXRpb24gPT0gQkxLSUZfT1BfV1JJVEUgfHwKLSAgICAgICAgIGlvcmVxLT5yZXEub3BlcmF0
aW9uID09IEJMS0lGX09QX0ZMVVNIX0RJU0tDQUNIRSkgJiYKLSAgICAgICAgaW9yZXFfZ3JhbnRf
Y29weShpb3JlcSkpIHsKLSAgICAgICAgcWVtdV92ZnJlZShpb3JlcS0+YnVmKTsKKyAgICBYZW5R
ZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lID0gcmVxdWVzdC0+ZGF0YXBsYW5lOworCisgICAgcmVx
dWVzdC0+YnVmID0gcWVtdV9tZW1hbGlnbihYQ19QQUdFX1NJWkUsIHJlcXVlc3QtPnNpemUpOwor
ICAgIGlmIChyZXF1ZXN0LT5yZXEubnJfc2VnbWVudHMgJiYKKyAgICAgICAgKHJlcXVlc3QtPnJl
cS5vcGVyYXRpb24gPT0gQkxLSUZfT1BfV1JJVEUgfHwKKyAgICAgICAgIHJlcXVlc3QtPnJlcS5v
cGVyYXRpb24gPT0gQkxLSUZfT1BfRkxVU0hfRElTS0NBQ0hFKSAmJgorICAgICAgICBpb3JlcV9n
cmFudF9jb3B5KHJlcXVlc3QpKSB7CisgICAgICAgIHFlbXVfdmZyZWUocmVxdWVzdC0+YnVmKTsK
ICAgICAgICAgZ290byBlcnI7CiAgICAgfQogCi0gICAgaW9yZXEtPmFpb19pbmZsaWdodCsrOwot
ICAgIGlmIChpb3JlcS0+cHJlc3luYykgewotICAgICAgICBibGtfYWlvX2ZsdXNoKGlvcmVxLT5k
YXRhcGxhbmUtPmJsaywgcWVtdV9haW9fY29tcGxldGUsIGlvcmVxKTsKKyAgICByZXF1ZXN0LT5h
aW9faW5mbGlnaHQrKzsKKyAgICBpZiAocmVxdWVzdC0+cHJlc3luYykgeworICAgICAgICBibGtf
YWlvX2ZsdXNoKHJlcXVlc3QtPmRhdGFwbGFuZS0+YmxrLCBxZW11X2Fpb19jb21wbGV0ZSwgcmVx
dWVzdCk7CiAgICAgICAgIHJldHVybiAwOwogICAgIH0KIAotICAgIHN3aXRjaCAoaW9yZXEtPnJl
cS5vcGVyYXRpb24pIHsKKyAgICBzd2l0Y2ggKHJlcXVlc3QtPnJlcS5vcGVyYXRpb24pIHsKICAg
ICBjYXNlIEJMS0lGX09QX1JFQUQ6Ci0gICAgICAgIHFlbXVfaW92ZWNfYWRkKCZpb3JlcS0+diwg
aW9yZXEtPmJ1ZiwgaW9yZXEtPnNpemUpOwotICAgICAgICBibG9ja19hY2N0X3N0YXJ0KGJsa19n
ZXRfc3RhdHMoZGF0YXBsYW5lLT5ibGspLCAmaW9yZXEtPmFjY3QsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgaW9yZXEtPnYuc2l6ZSwgQkxPQ0tfQUNDVF9SRUFEKTsKLSAgICAgICAgaW9yZXEt
PmFpb19pbmZsaWdodCsrOwotICAgICAgICBibGtfYWlvX3ByZWFkdihkYXRhcGxhbmUtPmJsaywg
aW9yZXEtPnN0YXJ0LCAmaW9yZXEtPnYsIDAsCi0gICAgICAgICAgICAgICAgICAgICAgIHFlbXVf
YWlvX2NvbXBsZXRlLCBpb3JlcSk7CisgICAgICAgIHFlbXVfaW92ZWNfYWRkKCZyZXF1ZXN0LT52
LCByZXF1ZXN0LT5idWYsIHJlcXVlc3QtPnNpemUpOworICAgICAgICBibG9ja19hY2N0X3N0YXJ0
KGJsa19nZXRfc3RhdHMoZGF0YXBsYW5lLT5ibGspLCAmcmVxdWVzdC0+YWNjdCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICByZXF1ZXN0LT52LnNpemUsIEJMT0NLX0FDQ1RfUkVBRCk7CisgICAg
ICAgIHJlcXVlc3QtPmFpb19pbmZsaWdodCsrOworICAgICAgICBibGtfYWlvX3ByZWFkdihkYXRh
cGxhbmUtPmJsaywgcmVxdWVzdC0+c3RhcnQsICZyZXF1ZXN0LT52LCAwLAorICAgICAgICAgICAg
ICAgICAgICAgICBxZW11X2Fpb19jb21wbGV0ZSwgcmVxdWVzdCk7CiAgICAgICAgIGJyZWFrOwog
ICAgIGNhc2UgQkxLSUZfT1BfV1JJVEU6CiAgICAgY2FzZSBCTEtJRl9PUF9GTFVTSF9ESVNLQ0FD
SEU6Ci0gICAgICAgIGlmICghaW9yZXEtPnJlcS5ucl9zZWdtZW50cykgeworICAgICAgICBpZiAo
IXJlcXVlc3QtPnJlcS5ucl9zZWdtZW50cykgewogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg
IH0KIAotICAgICAgICBxZW11X2lvdmVjX2FkZCgmaW9yZXEtPnYsIGlvcmVxLT5idWYsIGlvcmVx
LT5zaXplKTsKLSAgICAgICAgYmxvY2tfYWNjdF9zdGFydChibGtfZ2V0X3N0YXRzKGRhdGFwbGFu
ZS0+YmxrKSwgJmlvcmVxLT5hY2N0LAotICAgICAgICAgICAgICAgICAgICAgICAgIGlvcmVxLT52
LnNpemUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgaW9yZXEtPnJlcS5vcGVyYXRpb24gPT0g
QkxLSUZfT1BfV1JJVEUgPworICAgICAgICBxZW11X2lvdmVjX2FkZCgmcmVxdWVzdC0+diwgcmVx
dWVzdC0+YnVmLCByZXF1ZXN0LT5zaXplKTsKKyAgICAgICAgYmxvY2tfYWNjdF9zdGFydChibGtf
Z2V0X3N0YXRzKGRhdGFwbGFuZS0+YmxrKSwgJnJlcXVlc3QtPmFjY3QsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgcmVxdWVzdC0+di5zaXplLAorICAgICAgICAgICAgICAgICAgICAgICAgIHJl
cXVlc3QtPnJlcS5vcGVyYXRpb24gPT0gQkxLSUZfT1BfV1JJVEUgPwogICAgICAgICAgICAgICAg
ICAgICAgICAgIEJMT0NLX0FDQ1RfV1JJVEUgOiBCTE9DS19BQ0NUX0ZMVVNIKTsKLSAgICAgICAg
aW9yZXEtPmFpb19pbmZsaWdodCsrOwotICAgICAgICBibGtfYWlvX3B3cml0ZXYoZGF0YXBsYW5l
LT5ibGssIGlvcmVxLT5zdGFydCwgJmlvcmVxLT52LCAwLAotICAgICAgICAgICAgICAgICAgICAg
ICAgcWVtdV9haW9fY29tcGxldGUsIGlvcmVxKTsKKyAgICAgICAgcmVxdWVzdC0+YWlvX2luZmxp
Z2h0Kys7CisgICAgICAgIGJsa19haW9fcHdyaXRldihkYXRhcGxhbmUtPmJsaywgcmVxdWVzdC0+
c3RhcnQsICZyZXF1ZXN0LT52LCAwLAorICAgICAgICAgICAgICAgICAgICAgICAgcWVtdV9haW9f
Y29tcGxldGUsIHJlcXVlc3QpOwogICAgICAgICBicmVhazsKICAgICBjYXNlIEJMS0lGX09QX0RJ
U0NBUkQ6CiAgICAgewotICAgICAgICBzdHJ1Y3QgYmxraWZfcmVxdWVzdF9kaXNjYXJkICpyZXEg
PSAodm9pZCAqKSZpb3JlcS0+cmVxOwotICAgICAgICBpZiAoIWJsa19zcGxpdF9kaXNjYXJkKGlv
cmVxLCByZXEtPnNlY3Rvcl9udW1iZXIsIHJlcS0+bnJfc2VjdG9ycykpIHsKKyAgICAgICAgc3Ry
dWN0IGJsa2lmX3JlcXVlc3RfZGlzY2FyZCAqcmVxID0gKHZvaWQgKikmcmVxdWVzdC0+cmVxOwor
ICAgICAgICBpZiAoIWJsa19zcGxpdF9kaXNjYXJkKHJlcXVlc3QsIHJlcS0+c2VjdG9yX251bWJl
ciwgcmVxLT5ucl9zZWN0b3JzKSkgewogICAgICAgICAgICAgZ290byBlcnI7CiAgICAgICAgIH0K
ICAgICAgICAgYnJlYWs7CkBAIC0zOTgsMTkgKzQwMCwxOSBAQCBzdGF0aWMgaW50IGlvcmVxX3J1
bmlvX3FlbXVfYWlvKHN0cnVjdCBpb3JlcSAqaW9yZXEpCiAgICAgICAgIGdvdG8gZXJyOwogICAg
IH0KIAotICAgIHFlbXVfYWlvX2NvbXBsZXRlKGlvcmVxLCAwKTsKKyAgICBxZW11X2Fpb19jb21w
bGV0ZShyZXF1ZXN0LCAwKTsKIAogICAgIHJldHVybiAwOwogCiBlcnI6Ci0gICAgaW9yZXFfZmlu
aXNoKGlvcmVxKTsKLSAgICBpb3JlcS0+c3RhdHVzID0gQkxLSUZfUlNQX0VSUk9SOworICAgIGlv
cmVxX2ZpbmlzaChyZXF1ZXN0KTsKKyAgICByZXF1ZXN0LT5zdGF0dXMgPSBCTEtJRl9SU1BfRVJS
T1I7CiAgICAgcmV0dXJuIC0xOwogfQogCi1zdGF0aWMgaW50IGJsa19zZW5kX3Jlc3BvbnNlX29u
ZShzdHJ1Y3QgaW9yZXEgKmlvcmVxKQorc3RhdGljIGludCBibGtfc2VuZF9yZXNwb25zZV9vbmUo
WGVuUWRpc2tSZXF1ZXN0ICpyZXF1ZXN0KQogewotICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRh
cGxhbmUgPSBpb3JlcS0+ZGF0YXBsYW5lOworICAgIFhlblFkaXNrRGF0YVBsYW5lICpkYXRhcGxh
bmUgPSByZXF1ZXN0LT5kYXRhcGxhbmU7CiAgICAgaW50IHNlbmRfbm90aWZ5ID0gMDsKICAgICBp
bnQgaGF2ZV9yZXF1ZXN0cyA9IDA7CiAgICAgYmxraWZfcmVzcG9uc2VfdCAqcmVzcDsKQEAgLTQz
Niw5ICs0MzgsOSBAQCBzdGF0aWMgaW50IGJsa19zZW5kX3Jlc3BvbnNlX29uZShzdHJ1Y3QgaW9y
ZXEgKmlvcmVxKQogICAgICAgICByZXR1cm4gMDsKICAgICB9CiAKLSAgICByZXNwLT5pZCA9IGlv
cmVxLT5yZXEuaWQ7Ci0gICAgcmVzcC0+b3BlcmF0aW9uID0gaW9yZXEtPnJlcS5vcGVyYXRpb247
Ci0gICAgcmVzcC0+c3RhdHVzID0gaW9yZXEtPnN0YXR1czsKKyAgICByZXNwLT5pZCA9IHJlcXVl
c3QtPnJlcS5pZDsKKyAgICByZXNwLT5vcGVyYXRpb24gPSByZXF1ZXN0LT5yZXEub3BlcmF0aW9u
OworICAgIHJlc3AtPnN0YXR1cyA9IHJlcXVlc3QtPnN0YXR1czsKIAogICAgIGRhdGFwbGFuZS0+
cmluZ3MuY29tbW9uLnJzcF9wcm9kX3B2dCsrOwogCkBAIC00NjYsMTMgKzQ2OCwxMyBAQCBzdGF0
aWMgaW50IGJsa19zZW5kX3Jlc3BvbnNlX29uZShzdHJ1Y3QgaW9yZXEgKmlvcmVxKQogLyogd2Fs
ayBmaW5pc2hlZCBsaXN0LCBzZW5kIG91dHN0YW5kaW5nIHJlc3BvbnNlcywgZnJlZSByZXF1ZXN0
cyAqLwogc3RhdGljIHZvaWQgYmxrX3NlbmRfcmVzcG9uc2VfYWxsKFhlblFkaXNrRGF0YVBsYW5l
ICpkYXRhcGxhbmUpCiB7Ci0gICAgc3RydWN0IGlvcmVxICppb3JlcTsKKyAgICBYZW5RZGlza1Jl
cXVlc3QgKnJlcXVlc3Q7CiAgICAgaW50IHNlbmRfbm90aWZ5ID0gMDsKIAogICAgIHdoaWxlICgh
UUxJU1RfRU1QVFkoJmRhdGFwbGFuZS0+ZmluaXNoZWQpKSB7Ci0gICAgICAgIGlvcmVxID0gUUxJ
U1RfRklSU1QoJmRhdGFwbGFuZS0+ZmluaXNoZWQpOwotICAgICAgICBzZW5kX25vdGlmeSArPSBi
bGtfc2VuZF9yZXNwb25zZV9vbmUoaW9yZXEpOwotICAgICAgICBpb3JlcV9yZWxlYXNlKGlvcmVx
LCB0cnVlKTsKKyAgICAgICAgcmVxdWVzdCA9IFFMSVNUX0ZJUlNUKCZkYXRhcGxhbmUtPmZpbmlz
aGVkKTsKKyAgICAgICAgc2VuZF9ub3RpZnkgKz0gYmxrX3NlbmRfcmVzcG9uc2Vfb25lKHJlcXVl
c3QpOworICAgICAgICBpb3JlcV9yZWxlYXNlKHJlcXVlc3QsIHRydWUpOwogICAgIH0KICAgICBp
ZiAoc2VuZF9ub3RpZnkpIHsKICAgICAgICAgeGVuX2RldmljZV9ub3RpZnlfZXZlbnRfY2hhbm5l
bChkYXRhcGxhbmUtPnhlbmRldiwKQEAgLTQ4MCwyOSArNDgyLDI5IEBAIHN0YXRpYyB2b2lkIGJs
a19zZW5kX3Jlc3BvbnNlX2FsbChYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lKQogICAgIH0K
IH0KIAotc3RhdGljIGludCBibGtfZ2V0X3JlcXVlc3QoWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFw
bGFuZSwgc3RydWN0IGlvcmVxICppb3JlcSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgIFJJ
TkdfSURYIHJjKQorc3RhdGljIGludCBibGtfZ2V0X3JlcXVlc3QoWGVuUWRpc2tEYXRhUGxhbmUg
KmRhdGFwbGFuZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIFhlblFkaXNrUmVxdWVzdCAq
cmVxdWVzdCwgUklOR19JRFggcmMpCiB7CiAgICAgc3dpdGNoIChkYXRhcGxhbmUtPnByb3RvY29s
KSB7CiAgICAgY2FzZSBCTEtJRl9QUk9UT0NPTF9OQVRJVkU6IHsKICAgICAgICAgYmxraWZfcmVx
dWVzdF90ICpyZXEgPQogICAgICAgICAgICAgUklOR19HRVRfUkVRVUVTVCgmZGF0YXBsYW5lLT5y
aW5ncy5uYXRpdmUsIHJjKTsKIAotICAgICAgICBtZW1jcHkoJmlvcmVxLT5yZXEsIHJlcSwgc2l6
ZW9mKGlvcmVxLT5yZXEpKTsKKyAgICAgICAgbWVtY3B5KCZyZXF1ZXN0LT5yZXEsIHJlcSwgc2l6
ZW9mKHJlcXVlc3QtPnJlcSkpOwogICAgICAgICBicmVhazsKICAgICB9CiAgICAgY2FzZSBCTEtJ
Rl9QUk9UT0NPTF9YODZfMzI6IHsKICAgICAgICAgYmxraWZfeDg2XzMyX3JlcXVlc3RfdCAqcmVx
ID0KICAgICAgICAgICAgIFJJTkdfR0VUX1JFUVVFU1QoJmRhdGFwbGFuZS0+cmluZ3MueDg2XzMy
X3BhcnQsIHJjKTsKIAotICAgICAgICBibGtpZl9nZXRfeDg2XzMyX3JlcSgmaW9yZXEtPnJlcSwg
cmVxKTsKKyAgICAgICAgYmxraWZfZ2V0X3g4Nl8zMl9yZXEoJnJlcXVlc3QtPnJlcSwgcmVxKTsK
ICAgICAgICAgYnJlYWs7CiAgICAgfQogICAgIGNhc2UgQkxLSUZfUFJPVE9DT0xfWDg2XzY0OiB7
CiAgICAgICAgIGJsa2lmX3g4Nl82NF9yZXF1ZXN0X3QgKnJlcSA9CiAgICAgICAgICAgICBSSU5H
X0dFVF9SRVFVRVNUKCZkYXRhcGxhbmUtPnJpbmdzLng4Nl82NF9wYXJ0LCByYyk7CiAKLSAgICAg
ICAgYmxraWZfZ2V0X3g4Nl82NF9yZXEoJmlvcmVxLT5yZXEsIHJlcSk7CisgICAgICAgIGJsa2lm
X2dldF94ODZfNjRfcmVxKCZyZXF1ZXN0LT5yZXEsIHJlcSk7CiAgICAgICAgIGJyZWFrOwogICAg
IH0KICAgICB9CkBAIC01MTQsNyArNTE2LDcgQEAgc3RhdGljIGludCBibGtfZ2V0X3JlcXVlc3Qo
WGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSwgc3RydWN0IGlvcmVxICppb3JlcSwKIHN0YXRp
YyB2b2lkIGJsa19oYW5kbGVfcmVxdWVzdHMoWGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSkK
IHsKICAgICBSSU5HX0lEWCByYywgcnA7Ci0gICAgc3RydWN0IGlvcmVxICppb3JlcTsKKyAgICBY
ZW5RZGlza1JlcXVlc3QgKnJlcXVlc3Q7CiAKICAgICBkYXRhcGxhbmUtPm1vcmVfd29yayA9IDA7
CiAKQEAgLTUyOCwxOCArNTMwLDE4IEBAIHN0YXRpYyB2b2lkIGJsa19oYW5kbGVfcmVxdWVzdHMo
WGVuUWRpc2tEYXRhUGxhbmUgKmRhdGFwbGFuZSkKICAgICAgICAgaWYgKFJJTkdfUkVRVUVTVF9D
T05TX09WRVJGTE9XKCZkYXRhcGxhbmUtPnJpbmdzLmNvbW1vbiwgcmMpKSB7CiAgICAgICAgICAg
ICBicmVhazsKICAgICAgICAgfQotICAgICAgICBpb3JlcSA9IGlvcmVxX3N0YXJ0KGRhdGFwbGFu
ZSk7Ci0gICAgICAgIGlmIChpb3JlcSA9PSBOVUxMKSB7CisgICAgICAgIHJlcXVlc3QgPSBpb3Jl
cV9zdGFydChkYXRhcGxhbmUpOworICAgICAgICBpZiAocmVxdWVzdCA9PSBOVUxMKSB7CiAgICAg
ICAgICAgICBkYXRhcGxhbmUtPm1vcmVfd29yaysrOwogICAgICAgICAgICAgYnJlYWs7CiAgICAg
ICAgIH0KLSAgICAgICAgYmxrX2dldF9yZXF1ZXN0KGRhdGFwbGFuZSwgaW9yZXEsIHJjKTsKKyAg
ICAgICAgYmxrX2dldF9yZXF1ZXN0KGRhdGFwbGFuZSwgcmVxdWVzdCwgcmMpOwogICAgICAgICBk
YXRhcGxhbmUtPnJpbmdzLmNvbW1vbi5yZXFfY29ucyA9ICsrcmM7CiAKICAgICAgICAgLyogcGFy
c2UgdGhlbSAqLwotICAgICAgICBpZiAoaW9yZXFfcGFyc2UoaW9yZXEpICE9IDApIHsKKyAgICAg
ICAgaWYgKGlvcmVxX3BhcnNlKHJlcXVlc3QpICE9IDApIHsKIAotICAgICAgICAgICAgc3dpdGNo
IChpb3JlcS0+cmVxLm9wZXJhdGlvbikgeworICAgICAgICAgICAgc3dpdGNoIChyZXF1ZXN0LT5y
ZXEub3BlcmF0aW9uKSB7CiAgICAgICAgICAgICBjYXNlIEJMS0lGX09QX1JFQUQ6CiAgICAgICAg
ICAgICAgICAgYmxvY2tfYWNjdF9pbnZhbGlkKGJsa19nZXRfc3RhdHMoZGF0YXBsYW5lLT5ibGsp
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCTE9DS19BQ0NUX1JFQUQpOwpA
QCAtNTU1LDE1ICs1NTcsMTUgQEAgc3RhdGljIHZvaWQgYmxrX2hhbmRsZV9yZXF1ZXN0cyhYZW5R
ZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lKQogICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg
ICAgICAgfTsKIAotICAgICAgICAgICAgaWYgKGJsa19zZW5kX3Jlc3BvbnNlX29uZShpb3JlcSkp
IHsKKyAgICAgICAgICAgIGlmIChibGtfc2VuZF9yZXNwb25zZV9vbmUocmVxdWVzdCkpIHsKICAg
ICAgICAgICAgICAgICB4ZW5fZGV2aWNlX25vdGlmeV9ldmVudF9jaGFubmVsKGRhdGFwbGFuZS0+
eGVuZGV2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZGF0YXBsYW5lLT5ldmVudF9jaGFubmVsKTsKICAgICAgICAgICAgIH0KLSAgICAgICAgICAgIGlv
cmVxX3JlbGVhc2UoaW9yZXEsIGZhbHNlKTsKKyAgICAgICAgICAgIGlvcmVxX3JlbGVhc2UocmVx
dWVzdCwgZmFsc2UpOwogICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgIH0KIAotICAgICAg
ICBpb3JlcV9ydW5pb19xZW11X2Fpbyhpb3JlcSk7CisgICAgICAgIGlvcmVxX3J1bmlvX3FlbXVf
YWlvKHJlcXVlc3QpOwogICAgIH0KIAogICAgIGlmIChkYXRhcGxhbmUtPm1vcmVfd29yayAmJgpA
QCAtNjE3LDE3ICs2MTksMTcgQEAgWGVuUWRpc2tEYXRhUGxhbmUgKnhlbl9xZGlza19kYXRhcGxh
bmVfY3JlYXRlKFhlbkRldmljZSAqeGVuZGV2LAogCiB2b2lkIHhlbl9xZGlza19kYXRhcGxhbmVf
ZGVzdHJveShYZW5RZGlza0RhdGFQbGFuZSAqZGF0YXBsYW5lKQogewotICAgIHN0cnVjdCBpb3Jl
cSAqaW9yZXE7CisgICAgWGVuUWRpc2tSZXF1ZXN0ICpyZXF1ZXN0OwogCiAgICAgaWYgKCFkYXRh
cGxhbmUpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIHdoaWxlICghUUxJU1RfRU1Q
VFkoJmRhdGFwbGFuZS0+ZnJlZWxpc3QpKSB7Ci0gICAgICAgIGlvcmVxID0gUUxJU1RfRklSU1Qo
JmRhdGFwbGFuZS0+ZnJlZWxpc3QpOwotICAgICAgICBRTElTVF9SRU1PVkUoaW9yZXEsIGxpc3Qp
OwotICAgICAgICBxZW11X2lvdmVjX2Rlc3Ryb3koJmlvcmVxLT52KTsKLSAgICAgICAgZ19mcmVl
KGlvcmVxKTsKKyAgICAgICAgcmVxdWVzdCA9IFFMSVNUX0ZJUlNUKCZkYXRhcGxhbmUtPmZyZWVs
aXN0KTsKKyAgICAgICAgUUxJU1RfUkVNT1ZFKHJlcXVlc3QsIGxpc3QpOworICAgICAgICBxZW11
X2lvdmVjX2Rlc3Ryb3koJnJlcXVlc3QtPnYpOworICAgICAgICBnX2ZyZWUocmVxdWVzdCk7CiAg
ICAgfQogCiAgICAgcWVtdV9iaF9kZWxldGUoZGF0YXBsYW5lLT5iaCk7Ci0tIAoyLjExLjAKCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpYZW4tZGV2ZWwg
bWFpbGluZyBsaXN0Clhlbi1kZXZlbEBsaXN0cy54ZW5wcm9qZWN0Lm9yZwpodHRwczovL2xpc3Rz
LnhlbnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8veGVuLWRldmVs
