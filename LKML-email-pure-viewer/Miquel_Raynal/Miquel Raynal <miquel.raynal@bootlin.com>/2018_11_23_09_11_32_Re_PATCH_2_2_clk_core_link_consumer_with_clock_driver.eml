Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 23:32:48 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga005.fm.intel.com (fmsmga005.fm.intel.com [10.253.24.32])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 2BD2D58040F;
	Fri, 23 Nov 2018 01:12:01 -0800 (PST)
Received: from fmsmga102.fm.intel.com ([10.1.193.69])
  by fmsmga005-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 01:12:01 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AcVilqRNTFMBHykRaOPwl6mtUPXoX/o7sNwtQ0KIM?=
 =?us-ascii?q?zox0KPnypcbcNUDSrc9gkEXOFd2Cra4c26yO6+jJYi8p2d65qncMcZhBBVcuqP?=
 =?us-ascii?q?49uEgeOvODElDxN/XwbiY3T4xoXV5h+GynYwAOQJ6tL1LdrWev4jEMBx7xKRR6?=
 =?us-ascii?q?JvjvGo7Vks+7y/2+94fcbglUhzexe69+IAmrpgjNq8cahpdvJLwswRXTuHtIfO?=
 =?us-ascii?q?pWxWJsJV2Nmhv3+9m98p1+/SlOovwt78FPX7n0cKQ+VrxYES8pM3sp683xtBnM?=
 =?us-ascii?q?VhWA630BWWgLiBVIAgzF7BbnXpfttybxq+Rw1DWGMcDwULs5Qiqp4bt1RxD0iS?=
 =?us-ascii?q?cHLz85/3/Risxsl6JQvRatqwViz4LIfI2ZMfxzdb7fc9wHX2pMRshfWSxfDI2h?=
 =?us-ascii?q?bIUADeQBPeFfoYbyu1QAogC+BRGuCe701j9GhGX70bEg3ug9EwzL2hErEdIUsH?=
 =?us-ascii?q?TTqdX4LKAcUeGszKnV0zrDa+5d1yvn54nIdBAuu/WMVq93fMrUyEkvDh7FgUuU?=
 =?us-ascii?q?qYD/JTOazOQMs26B4OpkTu+gkGknqwZtojirx8csjJPFiZ4SylDB7Ch0xps+K9?=
 =?us-ascii?q?O/SE5+e9GkEZ1QujmZN4RoWMMiRX9nuCIgxr0Bo567czAGyJsmxx7Da/yHbpOH?=
 =?us-ascii?q?4g/4VOmPOzd3mHVleLSjhxms90ig1vfwWdWz0FZPtiZFndjMtmwN1xzO8ceLUO?=
 =?us-ascii?q?dy/kCk2TqXywzf9/tIIUcularULZMq370+loILvEjdAiP7nF/6gLKYe0k64OSk?=
 =?us-ascii?q?9ufqbqn8qpKdNYJ4kgXzPrg0lsG8Auk0KAYDUmiB9eiiyLHu/Uv0S6hQgPIsiK?=
 =?us-ascii?q?nWqpXaKNwbpqGnBw9V1Z4u6wiwDzi4ytQUh3oHI0xfeBKBkYfpP0vCIPfiDfew?=
 =?us-ascii?q?m1iskTFryO7aPrD5HJnBMnzOnK38cbtz9UJQ0hc/wNND655OC7wMIur/Wkrru9?=
 =?us-ascii?q?zZCh85PRa0w+HiCNhl0oMeWGSPArKWMa/Lsl+H+PgvI++Sa48RoTr9LPYk5/jw?=
 =?us-ascii?q?gn8jglIdY6ap0oUNaHyiHfRpPV+ZYXzyjdcFC2sKuRA+TOPyhF2YTTFTf2qyX7?=
 =?us-ascii?q?475jwjDIKmDITDSZ63jL2OwSe2BZlWZmFAClCRHnbkbYSEW/EQaC2MJs9tiCAL?=
 =?us-ascii?q?Vb+kS4U5zxGhqBf6y6Z7LurT4iAYtYjs1Nlp5+LJkhE+7zx0D9mH3GGLQGF5hW?=
 =?us-ascii?q?cIRz4w3KBirk1x0FaD0a5kg/NGEdxf/e9GUgA/NZTE1ex1F8jyWh7dfteOUFum?=
 =?us-ascii?q?QNKmDi8rQtIyxN8OZUB9G9K5gxDH3iqqBaIVlrORCJw19KLcw2b+J8Jnx3na06?=
 =?us-ascii?q?khikEsQtFTOm2+mq5/6w/TCpbTnEWCl6aqcqcc0DTX9GiZz2qDp0VYUA92UaXY?=
 =?us-ascii?q?UnETfErWrdLl5kzcS7+iE6goMgxEycSaMKtFdsXpjUlaRPfkINneYHi+m2GqCR?=
 =?us-ascii?q?aMx7ODdozqe2oG0SXZCUgElR0T/HmcOQg/ACehv3zRDDh0GV3zZEPs9PF0qGmn?=
 =?us-ascii?q?QU8s0wGKc0ph2qKo9REPm/yTVekf3rIetycnsDV7AlC909XSC9qDogpheL5RYd?=
 =?us-ascii?q?c84FdByGLYuBZxPp2mL6B+mFEedx57sF/p1xVyEo9Ai9QlrGs2zApuLqKVyE5O?=
 =?us-ascii?q?eCmG3Z/uILHXKnP9/Ba0a6HI3FHTy9KW+qYJ6PQlpFTvpgCpFkw+83p519lZyW?=
 =?us-ascii?q?eT5pLPDAAKS5L+Tl439wRmp7HdeiQ9+4LU1XhrMamosj/D28glBPc/xhanZddf?=
 =?us-ascii?q?NKKEFAn9E8ABA8iuKeoqm0Wmbx4ePeBS8rI0MN2id/ecxKGrO+Ngliq8jWtb+I?=
 =?us-ascii?q?B9zl6M9y1kR+HS25YK3f6Z0RWHVjvml1ihr934lppCZTERGWq/1zPpBIpQZq10?=
 =?us-ascii?q?YIYKBn2iI8yxxtVimZHtX2RU+0KkB1MDwMWpYwadb0Th3Q1M0kQauXymmTaiwz?=
 =?us-ascii?q?NoiT0or6qf0zbIw+TtbxcHPm9LRG9/jVbjO4S0jtYaXFS2YAgtjheq+UH6x61D?=
 =?us-ascii?q?rqRlM2bTWVtIfzTxL2x6SKuwt6aNbNRV6Jw1tiVbSuK8bk6ASr78uhcVzznsH2?=
 =?us-ascii?q?9Dyz8lbTGqvZP5kgd+iGKcKnZzsXXYddtxxRfZ+NzTW/pR0iAaSyl/jDndHkK8?=
 =?us-ascii?q?MMWx/dWIi5fDtfizVmKgVpFJcSjn15iAtDa95WBxBR2/nvazmsDoEAQg0C/70c?=
 =?us-ascii?q?VqWjvMrBrmfobr0KG6O/p9fkZ0HF/899Z6GoZmn4synp4Qw3sahpaS/XYdimf8?=
 =?us-ascii?q?K9Zb2aH/bHoLWzELxcXY4Azk2E1lM3KIyJj1VnSbwst9eda6Znka1T4678BPEK?=
 =?us-ascii?q?2U9qBLnTNpolqkqgLcefh8kS0ayfc06n4agucJtREpziWcBLASAEZZMTbtlxSO?=
 =?us-ascii?q?89CxsqFXaHyzfri30Up0hcqhA62aogFARHb5fY8vHSxq4cV+Kl7M0GDz5ZvieN?=
 =?us-ascii?q?nfdt8TshyUkxHdj+laMp4xl/wKhTZ5NmL5p3Eq1+k7jRl215GgoIeHM3lt/L6+?=
 =?us-ascii?q?AhNAMz31ZsAT9Sv3gadQgMmWxJyvEYt7GjoQQpToV/2oHSkWtfTmMQaODTI9pm?=
 =?us-ascii?q?2aGbrZAQ+Q9kNmo2jTHJCsMnGdPGMZwsl6RBmBOExfhxgZXCk9np48DAyrxdbu?=
 =?us-ascii?q?cEFk5jAK/V74qwBByuZpNxn5T2feqx2kajYySJiDMhVW6htO6FvSMcyb9uhzBT?=
 =?us-ascii?q?1X/oW9rAyRLWyWfx9HAnsOWkyAGlDvJL2u5cTb/uicB+q+KebOYLqUpexfUfeI?=
 =?us-ascii?q?2Yyg0o988zmQMcWPO2FoD+cn1UpbQXB5B8PZli0NSyMNkiLCcdWbqA2g+iFtrc?=
 =?us-ascii?q?C/7ffrWB/p5YSVELtfKtFv+xGwgaeeOO+cnid5KTBE1pwSwX/E0qQQ3FkXiyt2?=
 =?us-ascii?q?bTmiDawAtTLRTKLXgqJWDxkbaz5qNMtV9a082BNBOdXcitPz2b51lfo1C1ZDVV?=
 =?us-ascii?q?z8lcClf80KI2ehNFzZAEaHLqiJJTrOw8vve6OzVaVQjPlItx23oTubE1HsPjWA?=
 =?us-ascii?q?lznqVhCjK+JMjDucPBxRpo69aAttCXP4QdLiax27NsJ3jDIszb01gHPKKXATMT?=
 =?us-ascii?q?xmf0xRqb2Q6DtSgu9jFGxZ8nplMe6Elj6D4OnFMZkWq+VkAyRum+Je4XQ30L9V?=
 =?us-ascii?q?7CBCRPxolyretN9uo1e6kuaRzjprSgZBqjFOhIiTp0VtJb3Z9oVcWXbD5B8N8W?=
 =?us-ascii?q?SQCxEQq9R5ENHgp6BQxcbJlK/oLDdC8tTU/dYTBsTOKcKHNmYhPgTtGDLOEAQF?=
 =?us-ascii?q?SjurP3nFh0NBiPGS6mGVrp8ip5nsgpUOTLpbVF0zFvwCC0VlHMYNIJF4Xj4/lb?=
 =?us-ascii?q?6bjcgI5WexrRXLRcVauIzHWeyWAfn1NDmZirxENFM0xub7J5kSMoGzx0F5dhFg?=
 =?us-ascii?q?m47NBwKEWdNViixncgIw5k5K9S4tYHc03hfAaxqw7XtbL/elmBcywl97YP0w+T?=
 =?us-ascii?q?Oq+V4mIFPOjCE3l1U1mNOjijeUJm2iZJysVJ1bXnKn/3M6NYn2FkMsNVW/?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AxAAAfw/dbh0O0hNFiHgEGBwaBUwcLA?=
 =?us-ascii?q?QGCaIECJ4N5iHeLHoINFJcngXMsDQYBiFQiNgcNAQMBAQEBAQECARMBAQEIDQk?=
 =?us-ascii?q?IKSMMQgEQAYFiJAGCYgECAgEBAgsVBAwyFAUBCQEBChoCBSECAgMMGQQrBhMFg?=
 =?us-ascii?q?xwBgXkIBAEKpx18M4QtAYVkBYELin6BVz+BEYMSgwIZAgOEYoJXAoksgWWEGJB?=
 =?us-ascii?q?ZBwKCHASEG0GGGIQQIwqBT4ULiiSNQ4c7hH8NgXkzGiODPIInF4NKhRSFPz8yA?=
 =?us-ascii?q?YEEAQEhgwqIdwEB?=
X-IPAS-Result: =?us-ascii?q?A0AxAAAfw/dbh0O0hNFiHgEGBwaBUwcLAQGCaIECJ4N5iHe?=
 =?us-ascii?q?LHoINFJcngXMsDQYBiFQiNgcNAQMBAQEBAQECARMBAQEIDQkIKSMMQgEQAYFiJ?=
 =?us-ascii?q?AGCYgECAgEBAgsVBAwyFAUBCQEBChoCBSECAgMMGQQrBhMFgxwBgXkIBAEKpx1?=
 =?us-ascii?q?8M4QtAYVkBYELin6BVz+BEYMSgwIZAgOEYoJXAoksgWWEGJBZBwKCHASEG0GGG?=
 =?us-ascii?q?IQQIwqBT4ULiiSNQ4c7hH8NgXkzGiODPIInF4NKhRSFPz8yAYEEAQEhgwqIdwE?=
 =?us-ascii?q?B?=
X-IronPort-AV: E=Sophos;i="5.56,269,1539673200"; 
   d="scan'208";a="54037765"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 23 Nov 2018 01:12:00 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2408846AbeKWTzU convert rfc822-to-8bit (ORCPT
        <rfc822;like.xu@linux.intel.com> + 23 others);
        Fri, 23 Nov 2018 14:55:20 -0500
Received: from mail.bootlin.com ([62.4.15.54]:48831 "EHLO mail.bootlin.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1731917AbeKWTzU (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 14:55:20 -0500
Received: by mail.bootlin.com (Postfix, from userid 110)
        id A09F620D29; Fri, 23 Nov 2018 10:11:55 +0100 (CET)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on mail.bootlin.com
X-Spam-Level: 
X-Spam-Status: No, score=-1.0 required=5.0 tests=ALL_TRUSTED,SHORTCIRCUIT,
        URIBL_BLOCKED shortcircuit=ham autolearn=disabled version=3.4.2
Received: from xps13 (aaubervilliers-681-1-94-205.w90-88.abo.wanadoo.fr [90.88.35.205])
        by mail.bootlin.com (Postfix) with ESMTPSA id 03A45207AB;
        Fri, 23 Nov 2018 10:11:32 +0100 (CET)
Date: Fri, 23 Nov 2018 10:11:32 +0100
From: Miquel Raynal <miquel.raynal@bootlin.com>
To: kbuild test robot <lkp@intel.com>
Cc: kbuild-all@01.org, Michael Turquette <mturquette@baylibre.com>,
        Stephen Boyd <sboyd@kernel.org>,
        Russell King <linux@armlinux.org.uk>,
        linux-clk@vger.kernel.org, linux-kernel@vger.kernel.org,
        linux-arm-kernel@lists.infradead.org,
        Thomas Petazzoni <thomas.petazzoni@bootlin.com>,
        Antoine Tenart <antoine.tenart@bootlin.com>,
        Maxime Chevallier <maxime.chevallier@bootlin.com>,
        Gregory Clement <gregory.clement@bootlin.com>,
        Nadav Haklai <nadavh@marvell.com>
Subject: Re: [PATCH 2/2] clk: core: link consumer with clock driver
Message-ID: <20181123101132.6be3829c@xps13>
In-Reply-To: <201811231627.H7ojlKLL%fengguang.wu@intel.com>
References: <20181122212212.16039-3-miquel.raynal@bootlin.com>
        <201811231627.H7ojlKLL%fengguang.wu@intel.com>
Organization: Bootlin
X-Mailer: Claws Mail 3.17.1 (GTK+ 2.24.32; x86_64-pc-linux-gnu)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8BIT
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hello,

kbuild test robot <lkp@intel.com> wrote on Fri, 23 Nov 2018 16:30:00
+0800:

> Hi Miquel,
> 
> I love your patch! Yet something to improve:
> 
> [auto build test ERROR on clk/clk-next]
> [also build test ERROR on v4.20-rc3 next-20181122]
> [if your patch is applied to the wrong git tree, please drop us a note to help improve the system]
> 
> url:    https://github.com/0day-ci/linux/commits/Miquel-Raynal/Link-consumer-with-clock-driver/20181123-113833
> base:   https://git.kernel.org/pub/scm/linux/kernel/git/clk/linux.git clk-next
> config: sh-titan_defconfig (attached as .config)
> compiler: sh4-linux-gnu-gcc (Debian 7.2.0-11) 7.2.0
> reproduce:
>         wget https://raw.githubusercontent.com/intel/lkp-tests/master/sbin/make.cross -O ~/bin/make.cross
>         chmod +x ~/bin/make.cross
>         # save the attached .config to linux build tree
>         GCC_VERSION=7.2.0 make.cross ARCH=sh 
> 
> All errors (new ones prefixed by >>):
> 
>    drivers//clk/clkdev.c: In function 'clk_get':
> >> drivers//clk/clkdev.c:209:3: error: implicit declaration of function '__clk_device_link'; did you mean '__clk_free_clk'? [-Werror=implicit-function-declaration]  
>       __clk_device_link(dev, clk);
>       ^~~~~~~~~~~~~~~~~
>       __clk_free_clk
>    drivers//clk/clkdev.c: In function 'clk_put':
> >> drivers//clk/clkdev.c:217:2: error: implicit declaration of function '__clk_device_unlink'; did you mean 'device_online'? [-Werror=implicit-function-declaration]  
>      __clk_device_unlink(clk);
>      ^~~~~~~~~~~~~~~~~~~
>      device_online
>    cc1: some warnings being treated as errors

I figured thanks to this report that this code won't compile with
architectures not compliant to the common clock framework. I see there
is the following block in clkdev.c.

#if defined(CONFIG_OF) && defined(CONFIG_COMMON_CLK)
#else
#endif

Would you agree with me adding dummy functions in the #else section
like:

static inline void __clk_device_link(struct device *consumer, struct clk *clk)
{
       return;
}

static inline void __clk_device_unlink(struct clk *clk)
{
       return;
}

Do you want me to also declare these functions in the #if section
(with the external keyword) to balance the above declarations?

Thanks for your input.
Miquèl

> 
> vim +209 drivers//clk/clkdev.c
> 
>    193	
>    194	struct clk *clk_get(struct device *dev, const char *con_id)
>    195	{
>    196		const char *dev_id = dev ? dev_name(dev) : NULL;
>    197		struct clk *clk = NULL;
>    198	
>    199		if (dev && dev->of_node) {
>    200			clk = __of_clk_get_by_name(dev->of_node, dev_id, con_id);
>    201			if (PTR_ERR(clk) == -EPROBE_DEFER)
>    202				return clk;
>    203		}
>    204	
>    205		if (IS_ERR_OR_NULL(clk))
>    206			clk = clk_get_sys(dev_id, con_id);
>    207	
>    208		if (!IS_ERR(clk))
>  > 209			__clk_device_link(dev, clk);  
>    210	
>    211		return clk;
>    212	}
>    213	EXPORT_SYMBOL(clk_get);
>    214	
>    215	void clk_put(struct clk *clk)
>    216	{
>  > 217		__clk_device_unlink(clk);  
>    218		__clk_put(clk);
>    219	}
>    220	EXPORT_SYMBOL(clk_put);
>    221	
> 
> ---
> 0-DAY kernel test infrastructure                Open Source Technology Center
> https://lists.01.org/pipermail/kbuild-all                   Intel Corporation
