Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 24 Nov 2018 12:38:06 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga005.jf.intel.com (orsmga005.jf.intel.com [10.7.209.41])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 2FAFD58037D;
	Fri, 23 Nov 2018 18:04:17 -0800 (PST)
Received: from fmsmga101.fm.intel.com ([10.1.193.65])
  by orsmga005-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 18:04:16 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AeS07fhGpbLiyUL2PafIUoZ1GYnF86YWxBRYc798d?=
 =?us-ascii?q?s5kLTJ75os24bnLW6fgltlLVR4KTs6sC17KG9fi4EUU7or+5+EgYd5JNUxJXwe?=
 =?us-ascii?q?43pCcHRPC/NEvgMfTxZDY7FskRHHVs/nW8LFQHUJ2mPw6arXK99yMdFQviPgRp?=
 =?us-ascii?q?OOv1BpTSj8Oq3Oyu5pHfeQpFiCa+bL9oMBm6sRjau9ULj4dlNqs/0AbCrGFSe+?=
 =?us-ascii?q?RRy2NoJFaTkAj568yt4pNt8Dletuw4+cJYXqr0Y6o3TbpDDDQ7KG81/9HktQPC?=
 =?us-ascii?q?TQSU+HQRVHgdnwdSDAjE6BH6WYrxsjf/u+Fg1iSWIdH6QLYpUjm58axlVAHnhz?=
 =?us-ascii?q?sGNz4h8WHYlMpwjL5AoBm8oxBz2pPYbJ2JOPZ7eK7WYNEUSndbXstJSiJPHI28?=
 =?us-ascii?q?YYsMAeQPM+lXoIvyqEcBoxulHQmhBvjiyiNKi3LswaE2z+osHAXA0Qc9H9wOqn?=
 =?us-ascii?q?PUrNDtOakVUOC60KnIwi/dYPNSxDzz9ZTHchAkofGNQbJxcNfaxE40FwzZjlWQ?=
 =?us-ascii?q?rI3lPy+U1+QIsmiU8/FtVe2qi2E9qgFxpiKjydsrionMn48YzE3P+yZhwIstO9?=
 =?us-ascii?q?G0VEp2bcS5HJZeqS2WLZZ6T8A+T21yuSs3yKUKtYOlcCQU0pgqxx3SZ+aaf4WK?=
 =?us-ascii?q?4x/vTuKcLSl+iXl4YrywnQyy/lKlyuDkVsm7zlJKri1dn9nSuXACyQbT5tKESv?=
 =?us-ascii?q?Rj5Eeh3yiA1wTJ5uFDO0A0mrLXK58nwrEuipoeqVrPEjPylUnskaObeFso9vK1?=
 =?us-ascii?q?5+nkfrnqvJ6ROo1shgH7KKsum8i/AeoiMggJWmiW4eC81Lzl/U3kT7RGl/42nb?=
 =?us-ascii?q?fDsJDcO8sbore1Awhb04Yl9Rm/FSyr0MoXnXYZNlJJYhGHgJbzO1HIPv/4Ce2z?=
 =?us-ascii?q?g1O2kDdk3/zGJKHuAo3RLnjfl7fsZbJ9609fyAUt19xe6I9UB6oFIPLyXE/xqd?=
 =?us-ascii?q?PZAgU4Mwyy3+boFtF92pkCVmKIB6+TKLnSvkOQ5uIzP+mMY5cYuDbnJPgk+/7h?=
 =?us-ascii?q?l3g5lUUdfam0x5QXbn+4E+9iI0WYZ3rsn9gAHX0Lvgo4UOzlllmCXSRPaHa1Wq?=
 =?us-ascii?q?I2/is7B56+DYffWoCth6SM3CW8HpJIfGxGCVeMEXHud4WDQPoMbCOSIsl8kj0L?=
 =?us-ascii?q?T7ShSokh1Q2wuw/+0bZoMu3U+igAv5L5yNd1//HTlQ019TFsFcudyGGNT2Z3nm?=
 =?us-ascii?q?8SXT85xqJ/rFd5yleC16h4nvNZGcZS5/NPTgc1K5rcw/ZmBND1XwLLZs2JR0q+?=
 =?us-ascii?q?QtW6HTExSco8w9wUbEZ7AdmiihHD0DCsA78ajLGLAJ008qTB33n+Pcp9ynDG1L?=
 =?us-ascii?q?U/gFkiWMdAKWqmhqtn/QjJG4HJi1mZl7qtdakEwSHC7nmDwnSUsEFYSgFwV77F?=
 =?us-ascii?q?Um4ZZkfRqdT55UbCT7u1BLQjMwtBz9OCK6RQZt3oi1VGWOnsONDEb22tnGewAA?=
 =?us-ascii?q?6CxqmQY4ryZ2UdwCLdBVAZnA8J43aJKxIyBie7rGLYFzxhC1Tvbljo8el/rnO7?=
 =?us-ascii?q?U0A1wxuLb01ny7q65BoVieaARPMU27IOoD0hpClsHFahw9LWDMKNpxZgfKVZZt?=
 =?us-ascii?q?M9/FdH1GLDuwxhJJCgKLpihlofcwRxsEPjzBF3CoRGkcg3o3Im1gtyKaSE0Fxf?=
 =?us-ascii?q?czOUx4z/OrrSKmPq5hCgd7bW2k3C0NaR4qoA8vA4pEvsvQ63Fksu6W5o08RI3H?=
 =?us-ascii?q?SG4JXKDw0SUYzqX0Yz9hh6oazaYyYn64PV031sLbe7sjvY1901A+slzw6qf81D?=
 =?us-ascii?q?P6OcCA/yD8oaCtCuKew3gVSmcggIPeFS9KEuOcOmeOCL2KqqPOZmgTKngn5L4I?=
 =?us-ascii?q?F70kKQ6SV8TvTE0IoCw/GdxgGHTSvzjE+9ssDrnoBJfSsSHmujxif+Ho5ee6py?=
 =?us-ascii?q?cZwNCWiwOc23x8xyiIL3VH5c6VGsGUkG2MiveReJa1z93AtQ1VkYoHC9mCu4yS?=
 =?us-ascii?q?B0nC8trqaFwCPOxOHifgIdOmFXXGlikUvsIY+sgtEaXUikdQgomAG+5UbnwahW?=
 =?us-ascii?q?v6B/L2jVQUdVcCn6NWBiUq2strWcZ85D8o8nsSJSUO6ke1CVVqb9owcG0yPkB2?=
 =?us-ascii?q?Zexio0dyupupX6mBx2knmdI2xwrHraeMFwwwnQ5NrHSP5V3zoGQjR4iDbNCli9?=
 =?us-ascii?q?Odmp4cubl5PZvu+iUGKhU4VZcTP3woOYqCu7+WpqDAW/nv+pnd3rCwo60S7919?=
 =?us-ascii?q?RxUSXIrRD8YpTk1qigMOJneFVoC0H468ZgBo5+lY4wjokK2XcGnpWV4WYHkWDr?=
 =?us-ascii?q?PNVYw63+bWABRT4Ww9HP5gjl11ZuLnaIx4L/S3WczdFtZ9i8YmMKxC0969pGB7?=
 =?us-ascii?q?uT7LxBhSF1uEa3rRrNYfhhmTcQ0f4u6H8Zg+4TogYswDuSAqsOHUZGJyzjjAqH?=
 =?us-ascii?q?78qxrKhMYGavcL6w1FdxnNy7DbGCpB1cV2j9eps4ASBw6cB/OkrW0HLv8oHkZM?=
 =?us-ascii?q?XQbdULux2IlBfAivJZKZMrmfoMmCpnInn9vXw+xu4/jBxu24y6vYedJ2Vs+qK5?=
 =?us-ascii?q?HgBXNjnva8wP/THtiL5UntyK0IC3ApVhBjILUYPzQv2yFzISsennOxyKED0hsX?=
 =?us-ascii?q?qbHbvfHQmC6EZptX7PEparN22JK3kd19ltWB6dJElHigAOQDo6hoI5FhytxMH5?=
 =?us-ascii?q?ckd2/DUR6UDjqhdW1uJkLRr/UnrcpAe1bDc7UoOfIQFS7gFD4UfVLMOf4vhyHy?=
 =?us-ascii?q?Fe4p2usgiNJnaHaARPCGEDQlaECEz7Prmy+dnA9PCVB+q5L/vTeLWOtPZRV/GS?=
 =?us-ascii?q?yZK01Ytm+TmMO96LPnljCf07x0VCUWp4G8TfhzUAVSgXmzjRYM6coRe24jd3od?=
 =?us-ascii?q?yn8PT3RALv4pOCC7tMPtVu+BC2gqaDO/SThCZjLjZY2Y0DxWXVyLgEx1MSjyBu?=
 =?us-ascii?q?dz+wEbUPryLNTaTQmrNJAB4fcS98KMxI76ck1AlXJcHbks/11qJ/jvMtEVhFSE?=
 =?us-ascii?q?fumtu3as0KOW29MFLHCV2PNLSHIz3L3s72bbm9Sb1WkOVbqRmwtSyHHE/kOzSJ?=
 =?us-ascii?q?jyPpWAy3MeFQkCGbOwRTuJ28chZoE2TsUMjqZQG7MNBpiz072rk0hnLMNW4BPj?=
 =?us-ascii?q?lwaUJNrruM7SxGhvVzAXBO7n1gLeOcgSaW8/HYKooKsftsGil1l/hV4HI/y7tU?=
 =?us-ascii?q?6iFLXP10mCvIod5orFGrie2PyjthUBpTpTdHnoOLvUN+OarH8plMQ2rL/BUI7T?=
 =?us-ascii?q?bYNxNfjt1pENDmoOhrwdjQnai7fCxJ883d9+MYBs7JOIeCbioidx3zF2iQRC8E?=
 =?us-ascii?q?SyOwfV7Wg0hQkfPaonmUqIUh7IflnJ4DS71zUF0zH+kdTEN/E4pRDo1wW2YBkL?=
 =?us-ascii?q?WbhcMMrUG1rBzQWNcS6ovMVveTHefqKT2xgrxNZh9OyrT9e9dAfrbn0lBvPwEp?=
 =?us-ascii?q?1L/BHFDdCJUU+nVs?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0A0AgDzsPhbh0O0hNFjHQEBBQEHBQGBV?=
 =?us-ascii?q?AUBCwGCbH8nh3SQHYINFIkJboRKilcVAQEYEwGIWiI3Bg0BAwEBAQEBAQIBEwE?=
 =?us-ascii?q?BAQgNCQgpIwyCNiQBgmEBAQEBAgEBAjUIARsdAQMBAQkBAQUFCw0uAyARAQUBH?=
 =?us-ascii?q?AYBDAYCAgGDHIFpAQMNBwEFmw48jB8FAReCdwWCRIFrChknDVqBNwIGEot3F4F?=
 =?us-ascii?q?/gTiCa4pZAosRhEuQJgmRKQYYiVEQhyeYCQIEAgQFAgUPIYE7gXczGiOBAYI7g?=
 =?us-ascii?q?huDbYpoKjKBBQEBjCEBAQ?=
X-IPAS-Result: =?us-ascii?q?A0A0AgDzsPhbh0O0hNFjHQEBBQEHBQGBVAUBCwGCbH8nh3S?=
 =?us-ascii?q?QHYINFIkJboRKilcVAQEYEwGIWiI3Bg0BAwEBAQEBAQIBEwEBAQgNCQgpIwyCN?=
 =?us-ascii?q?iQBgmEBAQEBAgEBAjUIARsdAQMBAQkBAQUFCw0uAyARAQUBHAYBDAYCAgGDHIF?=
 =?us-ascii?q?pAQMNBwEFmw48jB8FAReCdwWCRIFrChknDVqBNwIGEot3F4F/gTiCa4pZAosRh?=
 =?us-ascii?q?EuQJgmRKQYYiVEQhyeYCQIEAgQFAgUPIYE7gXczGiOBAYI7ghuDbYpoKjKBBQE?=
 =?us-ascii?q?BjCEBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,272,1539673200"; 
   d="scan'208";a="63742836"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mga01b.intel.com with ESMTP; 23 Nov 2018 18:04:14 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729291AbeKXMuk (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sat, 24 Nov 2018 07:50:40 -0500
Received: from mail-pf1-f196.google.com ([209.85.210.196]:36496 "EHLO
        mail-pf1-f196.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1729235AbeKXMuj (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sat, 24 Nov 2018 07:50:39 -0500
Received: by mail-pf1-f196.google.com with SMTP id b85so4018263pfc.3
        for <linux-kernel@vger.kernel.org>; Fri, 23 Nov 2018 18:04:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=subject:to:references:cc:from:message-id:date:user-agent
         :mime-version:in-reply-to:content-transfer-encoding;
        bh=RZkyLHU2aNHt1BBAhRCWOt7m4B6ldNg4tf1ZoxGZyf8=;
        b=UPtE53q+bVhPcUVyETHMCLSQcWNU5e8j1lH/hWR6vYEza7QBD0DyIFRwQwAbqJZFM9
         ssxrYilx7/xAkkr+hiv+Snpeg0QWdKQ+2y3wQhn5l/+t/EmG+iYC3Anh971DA/pqVp3W
         YzCZjL7ICwWwCocZ9IxxtHME0InduEjXj2uLo4nHCnkbjASDsvUPcmTaCc3Khy439pNb
         A4dDSe7Yjlz3UagaSXuQowbbDoc6c23CTWacxeHzXAAI317UhoWoio6xiuD4yqgzILRN
         iMpaHYv62p55NsyHBqRauET1z1dCXWwCkuB5Y62nWFo+eMmUMmhaXl9hm2SvbHt6KUNC
         j+qA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:subject:to:references:cc:from:message-id:date
         :user-agent:mime-version:in-reply-to:content-transfer-encoding;
        bh=RZkyLHU2aNHt1BBAhRCWOt7m4B6ldNg4tf1ZoxGZyf8=;
        b=QDdsmdTFAWnXgtsyfVzWN7d2cofIVijJfly0MPxiNANaWnR5rHrws6BmzuUiztqBkP
         9PSZ8mUUyLfvjG0uzigJ+LBE4ZAHY2i9XrjWnxxNnGGjDXZI6+LOTayuDEwSeA5rj9b/
         gNIhCeNyaSgKagpjhG91HeHRIeD5Iyf38F/+hpcnxfACc+AvBhHwwc/07nQSUS/Z7im0
         jxrjO7YverVeJsPT5FDVx+Y02bcPzJzkHY+eW3Z9L58uO+Miqa2HMKznxO3G/uxNzRy3
         +sIgyWXdsHYUfceE2rNb9fiqTPR7dktbjSY0NwHAQpQEbIgWnNQEA7a8e00dv4PcuUj3
         f59w==
X-Gm-Message-State: AA+aEWY5VkdHe5ZJi/c97M4WA50XwSfJ/aAr3PSGw435FyDmcv4urrQ3
        KqFQyh8l6wVNnsnVCp44euIoI/G6u6c=
X-Google-Smtp-Source: AFSGD/VpO6piIzhEzizFKEasNJkMAxYYsKSPMZLu2rhmHwvCpBmlWKZebhsa6+arMRacUa/jdF7hXA==
X-Received: by 2002:a63:4745:: with SMTP id w5mr16648121pgk.377.1543025044284;
        Fri, 23 Nov 2018 18:04:04 -0800 (PST)
Received: from [192.168.1.101] (122-58-176-92-adsl.sparkbb.co.nz. [122.58.176.92])
        by smtp.gmail.com with ESMTPSA id b26sm25598576pfe.91.2018.11.23.18.03.57
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Fri, 23 Nov 2018 18:04:03 -0800 (PST)
Subject: Re: [RFC PATCH v2 07/14] m68k: atari: Convert to clocksource API
To: Andreas Schwab <schwab@linux-m68k.org>,
        Linus Walleij <linus.walleij@linaro.org>
References: <cover.1542589838.git.fthain@telegraphics.com.au>
 <b94b3aed32c0ae0f5de786ffc746ffb20fbe2d1e.1542589838.git.fthain@telegraphics.com.au>
 <CACRpkdZOoA8y7nAmE2JAQT8QgfNSpzXPVdjZfDBrnsy2jmgW7w@mail.gmail.com>
 <mvmk1l8m5hg.fsf@linux-m68k.org>
Cc: fthain@telegraphics.com.au,
        Geert Uytterhoeven <geert@linux-m68k.org>,
        Arnd Bergmann <arnd@arndb.de>, schivers@csc.com.au,
        Thomas Gleixner <tglx@linutronix.de>,
        Daniel Lezcano <daniel.lezcano@linaro.org>,
        John Stultz <john.stultz@linaro.org>,
        linux-m68k@lists.linux-m68k.org,
        "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>
From: Michael Schmitz <schmitzmic@gmail.com>
Message-ID: <9035c015-85ef-6d14-d12c-f1d5002ee49a@gmail.com>
Date: Sat, 24 Nov 2018 15:03:54 +1300
User-Agent: Mozilla/5.0 (X11; Linux ppc; rv:45.0) Gecko/20100101
 Icedove/45.4.0
MIME-Version: 1.0
In-Reply-To: <mvmk1l8m5hg.fsf@linux-m68k.org>
Content-Type: text/plain; charset=iso-8859-15; format=flowed
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org


Am 20.11.2018 um 23:02 schrieb Andreas Schwab:
> On Nov 20 2018, Linus Walleij <linus.walleij@linaro.org> wrote:
>
>> Yes you already see the same as I see: this chip MK68901 has
>> no less than four timers. I bet the kernel is just using one of them,
>> out of habit.
>
> Note that not all timers can be used freely.  Some of them are hardwired
> to generate the clock for the serial interfaces.

Timer A is used by the DMA sound driver - no workaround possible there.

Timer B is used by the framebuffer driver, but it's used only once to 
reprogram the screen base address at driver init. This one could 
potentially be used after framebuffer init to improve the clocksource 
accuracy.

Timer D is already used to generate timer interrupts used to poll the 
ROM port network card / USB adapters. This timer is initialized early in 
the boot process, which prevents using the MFP UART as serial console 
(something that I hadn't properly considered before). I'll send a patch 
for that. I'll also consider using timer B or timer C interrupts instead 
to poll ROM port hardware.

There are no serial drivers anymore that could use the MFP UART 
hardware, so that point is somewhat moot at present.

Cheers,

	Michael

> Andreas.
>
