Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:32:55 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga006.jf.intel.com (orsmga006.jf.intel.com [10.7.209.51])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 02D3A580460;
	Thu, 22 Nov 2018 16:26:19 -0800 (PST)
Received: from fmsmga101.fm.intel.com ([10.1.193.65])
  by orsmga006-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 16:26:18 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3A2gvC5R8+rWr4af9uRHKM819IXTAuvvDOBiVQ1KB9?=
 =?us-ascii?q?1eseIJqq85mqBkHD//Il1AaPAd2Lraocw8Pt8InYEVQa5piAtH1QOLdtbDQizf?=
 =?us-ascii?q?ssogo7HcSeAlf6JvO5JwYzHcBFSUM3tyrjaRsdF8nxfUDdrWOv5jAOBBr/KRB1?=
 =?us-ascii?q?JuPoEYLOksi7ze+/94HQbglSmDaxfa55IQmrownWqsQYm5ZpJLwryhvOrHtIeu?=
 =?us-ascii?q?BWyn1tKFmOgRvy5dq+8YB6/ShItP0v68BPUaPhf6QlVrNYFygpM3o05MLwqxbO?=
 =?us-ascii?q?SxaE62YGXWUXlhpIBBXF7A3/U5zsvCb2qvZx1S+HNsDtU7s6RSqt4LtqSB/wiS?=
 =?us-ascii?q?cIKTg58H3MisdtiK5XuQ+tqwBjz4LRZoyeKfhwcb7Hfd4CS2RPXthfWTFCDIOy?=
 =?us-ascii?q?YIQAE/cOMuRWoInmv1sDrwCzBRWwCO/z1jNEmmX70bM83u88EQ/GxgsgH9cWvX?=
 =?us-ascii?q?rIsdX1L7wSXv6xzKnM0D7NavJW2THy6IPVaxwqvO2BU653f8HMz0cvFgXFjkif?=
 =?us-ascii?q?qIf4OD6V0uUNs26G7+tvTu+gkXQnqwR1ojiuwMcsl4bIipgSylDe+iV12ps1Jd?=
 =?us-ascii?q?6hRUN9fNWqHpxQtySAOIt3RMMvW3tnuDw/yr0CuJ67ejUKyZs9yx7YcfyHfJKE?=
 =?us-ascii?q?4g/gVOqJOjd4nGxqd6yiiBau70eg0fH8WtOy0FlUsipIlMTHuHMV1xHL9MSLVv?=
 =?us-ascii?q?9w8l281TuByQzf8PxILEMomabBKpMswKY8moQPvUjfACP7nUr7g7GIekk4/+Wk?=
 =?us-ascii?q?9vrobaj8qZKZKoN5jx/yPrkhl8G6D+Q3LwYOX2ae9OSyyrLv4FH1TbBFg/04ka?=
 =?us-ascii?q?TUsZbXLtkBqKGjGQ9ayIMj5g6/Dzi41NQYmmEKLExKeB2ZlYjlIVLOL+7iDfe5?=
 =?us-ascii?q?nVuslC1nx/fcPr3uGpnNL37Dn6n9fbtl9UJQ1A4+wcpC659aFL0NOu//V0ztuN?=
 =?us-ascii?q?DCDxI0MRS4w+P9B9V80oMeV3iPAqicMK7KtV+I5+QvI/SDZYMMuzbyNeIl5/jw?=
 =?us-ascii?q?gn89gFMdeqeo3Z0JZ3CiBflmPUqZbmT2gtsbEmcFoBA+TOr0h12GSzJTYGyyX6?=
 =?us-ascii?q?0k6jEhFI2mFZvDRpyqgLGZ2Ce7H55WaX5cBlGDDHflbIGEW/YKaCKPLc5tiD0E?=
 =?us-ascii?q?Vb69S4A/0RGirhP1y71iLuDM4C0XqYrj1MRp5+3UjRwy9SZ7D8WB026XSGF4hG?=
 =?us-ascii?q?MIRyIs06B5rkxw0VOD0al+g/xFGt1f/fJJUgEmNZHCy+x2Ecz9WgXEft2RUlap?=
 =?us-ascii?q?Xs2mAS0tTtI229IOYUF9FMu4ghDA2CqqBbkVl7uQCZww86Lc2WXxJslnx3bH0q?=
 =?us-ascii?q?khk0cpQs9VOWK6ga5/8hDZB5TVnEWBi6aqaaMc0TbX+2eYzWqOu0JYXBRqUarf?=
 =?us-ascii?q?X3ASfU/WrdX/5kPfQL6iE7UnMg1dycGcLqtGcMHmjVJDRP37ItTRf3qxm3usBR?=
 =?us-ascii?q?aP3r6Mb5Dle2MH0CXZCUgLiQYT/XmdOAg6ByehpX/eDTN0GVLuZUPs7fdxqHeh?=
 =?us-ascii?q?QkAoyAGKalVr16Cp9R4NmfycV/QT06oZtyg7tTV7Akyx39LMBNqGvApuYqNcbd?=
 =?us-ascii?q?Q54FdE0GLZsxdwPpihL6Bkm14ffB57v0Lo1xVrFIpAldImo28tzAp3MaiYyk9O?=
 =?us-ascii?q?dyuE3ZDsPb3aMnT98wqxa6HIwF3e0MyZ+qEU6PsmrVXupwWpFksk83V63NhZyX?=
 =?us-ascii?q?qc5pPWDAUMVZL9SFo49x9/p7vCeCky+5vU1WFwMamzqjLCx9MpBO4iyha8f9de?=
 =?us-ascii?q?MLmIFBPoH80dHciuLO0qm16mbh8fOOBS9ag0P96pdvec2a6rOvpgkyyijWhd/I?=
 =?us-ascii?q?991UeM/TJmSuHUx5YF3+2Y3gyfWjjmiFeurM/2lp5EZD0IBWW/1DXrC5RXZq1x?=
 =?us-ascii?q?eoYLF3yjI8m2xtV4mp7sVGRU9F+lB1MaxsCpfQCeYED63Q1VzU4Xu2ComTOkzz?=
 =?us-ascii?q?xolDEktqqe3DHUz+v+bhYGO25LS3NkjVfjOoW0i9EaXE61bwkmjhel5ED6x7RF?=
 =?us-ascii?q?q6R7NWXcXUBIfy3uJWF4TqSwrqaCY9JI6J4wqyVXUfizbkqASrHgpBsWySXjEH?=
 =?us-ascii?q?VExDA6bj2lpo/2nxhnh22DNnZzq3zZdNp0xRfe4tzcWPFQ0iAHRCl+lTnYGFy8?=
 =?us-ascii?q?M8O18tWTkpfJqvq+WH65Vp1PbSnrypuNtSu65WFwARyzheuzmsDhEQUh1S/71t?=
 =?us-ascii?q?9qVTjHrRrmY4nr0bi6PvxjfkVyGFD87M96EJlkkoQsnJEQxWQahpKN8HoFi2jz?=
 =?us-ascii?q?K9Zb2aH5bHYXXj4E2d3V4Avk2E1lMH2JwZn0VnGcwstnetm7bXka2iM778BWFq?=
 =?us-ascii?q?iU6KZIkjdyolq9tQjRe+Ryni8Byfsy734Xm+EItxAqzimHALASHE9YMDfolxSJ?=
 =?us-ascii?q?6dC+sapWaHyucbi2yEpxg9ShAKuerQFbXXbzYo0iEjNo7sVjLFLM12X+6oL+d9?=
 =?us-ascii?q?nRd94TtgCUnA3Gj+haM58xkvsKhSx6OWPyp3Elyug7jQBw0pG+poSIN2Jt/Keh?=
 =?us-ascii?q?CB5CKjL1f98T+i3qjatGm8aW3oOvEY97FjQFQpToVu6oHywItfv8KQmOCjI8p2?=
 =?us-ascii?q?yfGbreGw+f9Uhno2jOE5CtK3GYOn0Zwc9+SxmaIUxVmBoUUykinp4lCgCqw9Ts?=
 =?us-ascii?q?cFt+5jAU/FL5qwFDyuR1NxnkSWffpRylajM1SJiZMRpX4RtO50bTMcyC8O1zGz?=
 =?us-ascii?q?tU8YGmrAyIMmabfRhHDXkVWkyYAFDuJqKh6sPH8+icG+qyNf/OYaiVpOxaVveI?=
 =?us-ascii?q?w4+v04R88zaNMMWPImdtD/kh1kVfWnB5HtzTmy8TRCwPiyLNc8mbqQ+++iJtq8?=
 =?us-ascii?q?Cw7u/rVBjz5YeVCLtSLNZv+w2wgaiZLO6dnyJ5KTde1pMRyn7E0rkf3FgOiy5w?=
 =?us-ascii?q?czmhC6gPtSnITKjIgK9YEwYbaz9vNMtP96893g5NOdPCitPozLF4iOQ5C0xCVV?=
 =?us-ascii?q?znlcGkfsgKI2C7NFPaC0eHLrWGJTvXw87pZaOwU6FfjOJRtxeoozaUD1fjPiif?=
 =?us-ascii?q?lznuTx2vMf9DjCCYPBxduYGxaBVtCXLkTNLpdBK7KsJ3jSYtzL0wh3PKM3McMD?=
 =?us-ascii?q?dmf0NMqL2Q8T1XgvFlF2Nd6XplKPGOmzyF4OnANpYWrfxrDzxumOJH+3s60aVa?=
 =?us-ascii?q?7SFeSPxxmSvftdpuo1CgkumSxTtrShtOqjBXhI2VuUVuI7nW9p5FWXzc5hIC8X?=
 =?us-ascii?q?2QCwgWp9tiEtDvp6FQyt3VmK3vMjtN79LU8tUaB8XPLMKHMXwhMQfmGTLODQsF?=
 =?us-ascii?q?SyKrOn/bh0BHjP6S8XiVpIAgqpfwgJoOVqNbVFstG/IaEEtlGtkCIJZxXjw8kL?=
 =?us-ascii?q?+bjNQH5XyxrBTKQMVav5bHVu+dAPn1KTaZi6VEaAUMwb/iMYsTMYj7iARebQxT?=
 =?us-ascii?q?lZ7NU2nXRtNMpCBnJls9qV9Ktnt5VW4y3U/jQgKu4TkdFKjnsAQxj15EfP82+T?=
 =?us-ascii?q?Poq3Q2IFWC4WMZqmx5vdTjnCDZJDrwKrqgdYhMDi71sVUhdJThTEBoblvhzgRf?=
 =?us-ascii?q?KD7YSucJ3PNbfmdxhVqZ4MMXFA=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ANAACuSPdbh0O0hNFiGwEBAQEDAQEBB?=
 =?us-ascii?q?wMBAQGBUwQBAQELAYEwgTmBAicEmhkUlyeBcRYYCwgBiFIiNgcNAQMBAQEBAQE?=
 =?us-ascii?q?CARMBAQEIDQkIKSMMgjYkAYJiAQIDAQI3BgEBNwEFCQEBChgJJQMMBSghCg4Wg?=
 =?us-ascii?q?wYBggEBAwEKpnyCH4J2AQEFhxYIjAkXPoFBgRABgxKDEIFchW2gBAmRJAsYgVm?=
 =?us-ascii?q?PLyyJQY5DgU0LgXszGggsBIMnCYISi2eCWEAygQUBAYxVAQE?=
X-IPAS-Result: =?us-ascii?q?A0ANAACuSPdbh0O0hNFiGwEBAQEDAQEBBwMBAQGBUwQBAQE?=
 =?us-ascii?q?LAYEwgTmBAicEmhkUlyeBcRYYCwgBiFIiNgcNAQMBAQEBAQECARMBAQEIDQkIK?=
 =?us-ascii?q?SMMgjYkAYJiAQIDAQI3BgEBNwEFCQEBChgJJQMMBSghCg4WgwYBggEBAwEKpny?=
 =?us-ascii?q?CH4J2AQEFhxYIjAkXPoFBgRABgxKDEIFchW2gBAmRJAsYgVmPLyyJQY5DgU0Lg?=
 =?us-ascii?q?XszGggsBIMnCYISi2eCWEAygQUBAYxVAQE?=
X-IronPort-AV: E=Sophos;i="5.56,267,1539673200"; 
   d="scan'208";a="63628843"
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mga01b.intel.com with ESMTP; 22 Nov 2018 16:26:17 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2439134AbeKWLIC (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 06:08:02 -0500
Received: from pandora.armlinux.org.uk ([78.32.30.218]:42792 "EHLO
        pandora.armlinux.org.uk" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2405050AbeKWLIC (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 06:08:02 -0500
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
        d=armlinux.org.uk; s=pandora-2014; h=Sender:In-Reply-To:Content-Type:
        MIME-Version:References:Message-ID:Subject:Cc:To:From:Date:Reply-To:
        Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:
        Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:List-Id:
        List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive;
         bh=P8eN/TfoExd2pqRphUlEH0sS3BJPdvFIkq5RPGepous=; b=ciRAm0bY97OyZirsVNQmeQZDj
        89cpwSWWHIwkUlBfCHE6+rpLTnPzVyCg3OfzyijC1EkaPSzgvkJYLYsGIQ7hItN2iU8YyIUH5agXb
        3joPjCO7ZnfrCZIpGCYa87HxfeyZ+kBYUZ5CJzv6wrMLTHwqNrvknQ0beaETi0B0/kDQo=;
Received: from n2100.armlinux.org.uk ([2002:4e20:1eda:1:214:fdff:fe10:4f86]:45848)
        by pandora.armlinux.org.uk with esmtpsa (TLSv1.2:ECDHE-RSA-AES128-GCM-SHA256:128)
        (Exim 4.90_1)
        (envelope-from <linux@armlinux.org.uk>)
        id 1gPzIB-0004t7-Hx; Fri, 23 Nov 2018 00:25:55 +0000
Received: from linux by n2100.armlinux.org.uk with local (Exim 4.90_1)
        (envelope-from <linux@n2100.armlinux.org.uk>)
        id 1gPzI7-0007xU-Oz; Fri, 23 Nov 2018 00:25:51 +0000
Date: Fri, 23 Nov 2018 00:25:49 +0000
From: Russell King - ARM Linux <linux@armlinux.org.uk>
To: Aaro Koskinen <aaro.koskinen@iki.fi>
Cc: Peter Ujfalusi <peter.ujfalusi@ti.com>, vkoul@kernel.org,
        dan.j.williams@intel.com, dmaengine@vger.kernel.org,
        linux-kernel@vger.kernel.org, tony@atomide.com,
        linux-omap@vger.kernel.org
Subject: Re: [PATCH] dmaengine: ti: omap-dma: Configure LCH_TYPE for OMAP1
Message-ID: <20181123002549.GO6920@n2100.armlinux.org.uk>
References: <20181119104040.12885-1-peter.ujfalusi@ti.com>
 <20181119184649.GE16897@darkstar.musicnaut.iki.fi>
 <6af8c6e7-bf5c-5555-161b-5d3fb7ecae43@ti.com>
 <20181120210406.GB24888@darkstar.musicnaut.iki.fi>
 <20181122102948.GN6920@n2100.armlinux.org.uk>
 <20181122151236.GA9611@n2100.armlinux.org.uk>
 <20181122222426.GC11423@darkstar.musicnaut.iki.fi>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20181122222426.GC11423@darkstar.musicnaut.iki.fi>
User-Agent: Mutt/1.5.23 (2014-03-12)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Fri, Nov 23, 2018 at 12:24:26AM +0200, Aaro Koskinen wrote:
> Hi,
> 
> On Thu, Nov 22, 2018 at 03:12:36PM +0000, Russell King - ARM Linux wrote:
> > On Thu, Nov 22, 2018 at 10:29:48AM +0000, Russell King - ARM Linux wrote:
> > > On Tue, Nov 20, 2018 at 11:04:06PM +0200, Aaro Koskinen wrote:
> > > > I had switched to PIO mode in 2015 since the WARNs about legacy DMA
> > > > API were too annoying and flooding the console. And now that I tried
> > > > using DMA again with g_ether, it doesn't work anymore. The device get's
> > > > recognized on host side, but no traffic goes through. Switching back to
> > > > PIO makes it to work again.
> > > 
> > > A solution to that would be to do what the warning message says, and
> > > update the driver to the DMAengine API.
> 
> Fully agreed, but I was busy debugging other more serious issues, and
> just wanted to get a reliable ssh or USB serial access to the device
> without any extra noise, so switching to PIO using a module parameter
> is probably what most users do in such situations.
> 
> > Here's a partial conversion (not even build tested) - it only supports
> > OUT transfers with dmaengine at the moment.
> 
> Thanks, I'll take a closer look and try to do some testing hopefully
> during the weekend.

The patch was more for Peter to take a peek at - there's definitely
some bits missing in the dmaengine driver (like the write to the
LCH_CTRL register) that would need to be fixed somehow.

However, it's worth noting that there is exactly one user of
omap_set_dma_channel_mode(), which is omap-udc, which means any DMA
channel made use of by omap-udc will have the LCH_CTRL register
modified to LCH_P, and it will remain that way even if someone else
subsequently makes use of the same channel.  That's rather suspicious
to me... maybe we can just initialise all LCH_CTRL registers to LCH_P
in the dmaengine driver in that case!  If not, then there's a bug
right there.

-- 
RMK's Patch system: http://www.armlinux.org.uk/developer/patches/
FTTC broadband for 0.8mile line in suburbia: sync at 12.1Mbps down 622kbps up
According to speedtest.net: 11.9Mbps down 500kbps up
