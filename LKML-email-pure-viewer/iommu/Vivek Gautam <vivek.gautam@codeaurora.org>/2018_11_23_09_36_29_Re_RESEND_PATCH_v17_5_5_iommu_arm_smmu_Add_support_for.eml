Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 23:33:27 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga004.jf.intel.com (orsmga004.jf.intel.com [10.7.209.38])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id C0F6258037D;
	Fri, 23 Nov 2018 01:36:52 -0800 (PST)
Received: from fmsmga104.fm.intel.com ([10.1.193.100])
  by orsmga004-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 01:36:50 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3ATLCNVh3V8lncJTDSsmDT+DRfVm0co7zxezQtwd8Z?=
 =?us-ascii?q?segTI/jxwZ3uMQTl6Ol3ixeRBMOHs6IC07KempujcFRI2YyGvnEGfc4EfD4+ou?=
 =?us-ascii?q?JSoTYdBtWYA1bwNv/gYn9yNs1DUFh44yPzahANS47xaFLIv3K98yMZFAnhOgpp?=
 =?us-ascii?q?POT1HZPZg9iq2+yo9JDffwZFiCChbb9uMR67sRjfus4KjIV4N60/0AHJonxGe+?=
 =?us-ascii?q?RXwWNnO1eelAvi68mz4ZBu7T1et+ou+MBcX6r6eb84TaFDAzQ9L281/szrugLd?=
 =?us-ascii?q?QgaJ+3ART38ZkhtMAwjC8RH6QpL8uTb0u+ZhxCWXO9D9QKsqUjq+8ahkVB7oiD?=
 =?us-ascii?q?8GNzEn9mHXltdwh79frB64uhBz35LYbISTOfFjfK3SYMkaSHJOUcZfVSNPAo2y?=
 =?us-ascii?q?YYgSAeQfIelYtJH9qlkVoBuiGQWhHv/jxiNUinL026AxzuQvERvB3AwlB98Bv3?=
 =?us-ascii?q?XUrMvrO6cRTOu7zbPHzSjfb/xM3Df29Y/Fcg4gofGSQ71wctDdyUY1GAPYklWf?=
 =?us-ascii?q?s4nlMiiJ2eQKrmeU8fBvVf+1i24gsQF+uCKjxsA2ionGn48YzE3P+yt+wIYwP9?=
 =?us-ascii?q?K4SUh7bMagEJtRsSGaKoR3Qs0lQ2F1viY116cJuYK6fCgNzpQr3Rnfa+aIc4WO?=
 =?us-ascii?q?/xntV/6RLC9miH55fL+znQu+/Ea+xuHmS8W500pGojBEn9TOrnwByQDf58ydRv?=
 =?us-ascii?q?Z+/kqtwyiD2x7N5u1ePEw5l6TWJpg8ybAqjJUTq17MHirulUX2kqCWckIk9/C2?=
 =?us-ascii?q?6+TofLrmvIWQN4xqhQHkNKQhhMi/Df4/MggUUGiX4eW81Lv98k3lWLhGkOE6n6?=
 =?us-ascii?q?3DvJzHK8kXuLS1DxJW34o/8RqyDjWr3MwdnXYdLVJFfByHj5LuO1HLOP34Cfa/?=
 =?us-ascii?q?g1KxkDZk3vzGPaPuAo/LLnfdlLftZLF96kBayAUt19BS/IxUCr4fL/LpQEPxt8?=
 =?us-ascii?q?LXDgU/MwOqx+brEtJ91pkRWW6XGK+WLLvSsUOU5uIoO+SMYI4VuDXjJPQ/6P/u?=
 =?us-ascii?q?kGQ0mVscfamvwJsWZ2q0HvVgI0WFf3Xshs0NHnsNvgo7VObqkkGNUSZPZ3auWK?=
 =?us-ascii?q?Ix/jE7B5inDYffXI+th6aN3CemHpJMYGBGBUuBEXPpd4WCRvcNZzieIs5nkjwY?=
 =?us-ascii?q?S7ehT5Ut2g2ptA//07BnNPbb+jUEtZL/09h4/+/TlRYs+jBuDMSd1GeNT2dznm?=
 =?us-ascii?q?4TQz823aZ/oVFyy1uZ0Kh4heBYGsJX5/9TTgg6MpvcxfRgC9/uQgLBYsuJSFG+?=
 =?us-ascii?q?T9q8GjExTtUxw9wUb0ZnAdqijAvO3y6rA78TiryKC4Y48qPa33jtOcl9z2zK27?=
 =?us-ascii?q?Umj1kjWsFPL3GphrZj9wjPAI7Ei0aZmLysdagG2C7N9X2MzWyBvExDVA5wUKPF?=
 =?us-ascii?q?XW0QZ0fMrNT54F/CQKGqCbg9LgRBzsuCILNQatL1lVVGWOvjONPGbm2sgWiwGw?=
 =?us-ascii?q?iHyqmMbIXwfWUdxzvSCE4DnwAX/naGMAw+Czylo2LfCjxuCF3ub1nt8el4tHO0?=
 =?us-ascii?q?UEs0wxuWYE1m0rq/4gQViuCES/MPwrIEvz8spChuE1ajwd3aEdqAqBBnfKVHf9?=
 =?us-ascii?q?w95kxK1WbYtwx7I5yhILpuhl8YcwRroUzu0w97BZlHkcgvtHkq1hZ9KbqE0FNd?=
 =?us-ascii?q?cDOVxYzwOrzSKmn14BCva67X1kvC0NqM/acP8vA4q1TlvAGmDUci93Rn099I03?=
 =?us-ascii?q?qT/JnKDQwSUY7vXUYz7RR1u7baYiwl7YPOyXJsKbW0siPF298xHuQlzgivfthB?=
 =?us-ascii?q?P6KEDgP9CNAaCNW0J+wsmFipaQwEMftW9K41OcOmavSH1LSqPOZmgDKpk2BH7J?=
 =?us-ascii?q?ph3UKL8ip2UvTI0Iodw/GEwguHUC/xjVe8sszthY9IfzATHmqlxijiC45cfaly?=
 =?us-ascii?q?fYcNCWezLMy73NR+h5jxW3FG8F6vHU8J2MiseRCKdVzywRVQ1VgLoXyggSa41T?=
 =?us-ascii?q?10nC0zoaqFwSPOxP7udBwZNW5RRWlulEvjLpKwj98HQkeodQ8plB2+6Eb+xqhb?=
 =?us-ascii?q?orl/LmbJTUdJeSj2M39tUq+qurWeZM5P7YsisT9LX+SkfVCaVrn9rgMa0iPiBW?=
 =?us-ascii?q?dfxCo3dyq3upX/hBF6jGOdLHBurHvWY81wxBHf5MDCSv5VxDYJWC54iTzPDFim?=
 =?us-ascii?q?I9ap5cmUl4vEsu2mVWKuTIdTcSrozYOHrie7/ndlAR68n/CynN3oDw463DT/19?=
 =?us-ascii?q?lrUyXIsRn9bpPq16S8LeJoYE1oCEXg5Mp9H4F0ipEwi40I2XgGmpWV+mIKkGfp?=
 =?us-ascii?q?PtVcw67+bnsNRTgQzt7R4Qjl3lBjL32Ty4L4UHWd3tVuZ92gbmwK3SI96thACL?=
 =?us-ascii?q?2I47xcgSt1vl24oBrSYfdnnzcR0/su6GMAjOEPtwog1SGdArEUHUlFMi3gjRWI?=
 =?us-ascii?q?79airKpJYGaja6S/1E17ndq5FrGNvhlcWGrlepclBSJw68R/MFHW33Hp5IDrZs?=
 =?us-ascii?q?LQbc4NuR2OiBjPkfJVKJ0qm/oOhCpnP3/9vHI/x+46ixxuwY+1vIydJ2px+6K5?=
 =?us-ascii?q?BwZSNifpaMML5jHtkaFek96K34CoG5VtADQKU4HuTfK1CzISrvXnOh2KED09rH?=
 =?us-ascii?q?ebBLXeERWe6Edgs3LADZSrO2uLK3keyNVoXAOdK1BHgAAIQDU6mYY0GRuwy8zm?=
 =?us-ascii?q?dEd5+yod5lrlqhZXzuJoNh//UnrQpQuyazc0ToSfIwRS7g1Y+0jVNsme5PppHy?=
 =?us-ascii?q?5E5p2hsBCNKmuDagRKF24JX1KLB0v5Mrmy/9XA8PWYBumjL/vIe7qOsvdTV/OJ?=
 =?us-ascii?q?xZKpz4tn8CyANsSJPnl+EfI73lBPUmx+G8Tcgz8PUTAYlzrRb86Hoxex4i12rs?=
 =?us-ascii?q?ei8PTyRQLg/42PB6FJMdVo/RC2jryON+qRhCZ/NDZZ2YkAxX7OyLgDwlESjzti?=
 =?us-ascii?q?eCWqEbQFrSTNVr7fmrdLDx4HbCN+LMtI4Lw93glOOs7bi8n51r1ijv4yBFdKS0?=
 =?us-ascii?q?bhmtyyZcERJ2G9NVXHBFuENbicJD3Lxd33br24SbFKkOpUsBiwsy6BE0D/JjSD?=
 =?us-ascii?q?iyXpVxe3PO5WkSGUJwZet5+9cxp3DWjjTcnrahm6MN9xkD03zqc4hnLMNW4ALz?=
 =?us-ascii?q?d8d1lBoaGX7SNdmv9/AXBO7mJ5LemYnCaU9/XYKpcTsfdxHit4jf5V4HQkxLtT?=
 =?us-ascii?q?9yxEQP11mC3Prt9huV2mk++PyiZ5XxpKsDpEmIWLvUB6M6XD6pZAQWrE/A4K7W?=
 =?us-ascii?q?iICxUFvd1lCtjuu6BW0tfOlaLzJy1E89Lb5sYcA8nUKMSaMHsuKxbpGTjUDBcb?=
 =?us-ascii?q?Qj6vL23Qm0tdkPTBvkGS+6c7rpyktJcHQbhdHAgqF/ceTEhoFdcFJr9+RDZimr?=
 =?us-ascii?q?me2opA+Xq5tl/NRMxLs4rvUvOUHOWpKTCFgL0CbBwNhfvEKoEaLZ+z9U1tYxEu?=
 =?us-ascii?q?gIrLFEP4VtBXpShgcwpyp19CpitQVGo2jnzkdA6uqFAaCOK9m1ZilApgbOdr+z?=
 =?us-ascii?q?7x/14yDlHNqCY5jVM2g9yjhiqeJm2iZJysVJ1bXnKn/3M6NYn2FkMsNVW/?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AOAAAOyfdbh0O0hNFiHAEBAQQBAQcEA?=
 =?us-ascii?q?QGBUgYBAQsBggBpgQIng3mUFYINFJcngXMUGAsIAYhVIjUIDQEDAQEBAQEBAgE?=
 =?us-ascii?q?TAQEBCA0JCCkjDII2JAGCYQEBAQECAQEBASAdAQEsCwEEAQkBAQoLDQICJgICA?=
 =?us-ascii?q?x8FAQQIAQUBHAYBCggFA4MZAYF5CAUKm1Y8ih1wgS+CdgEBBYcSAwWBC4ligRy?=
 =?us-ascii?q?BVz+DJX6DGwEEgUKDIDGCJosThH6PLUYHAoIcBIRchhiEGxiJUYc3jUOKXg8hg?=
 =?us-ascii?q?ScCggkzGjBDMQaCNYIbiQGFRjgygQUBAYwiAQE?=
X-IPAS-Result: =?us-ascii?q?A0AOAAAOyfdbh0O0hNFiHAEBAQQBAQcEAQGBUgYBAQsBggB?=
 =?us-ascii?q?pgQIng3mUFYINFJcngXMUGAsIAYhVIjUIDQEDAQEBAQEBAgETAQEBCA0JCCkjD?=
 =?us-ascii?q?II2JAGCYQEBAQECAQEBASAdAQEsCwEEAQkBAQoLDQICJgICAx8FAQQIAQUBHAY?=
 =?us-ascii?q?BCggFA4MZAYF5CAUKm1Y8ih1wgS+CdgEBBYcSAwWBC4ligRyBVz+DJX6DGwEEg?=
 =?us-ascii?q?UKDIDGCJosThH6PLUYHAoIcBIRchhiEGxiJUYc3jUOKXg8hgScCggkzGjBDMQa?=
 =?us-ascii?q?CNYIbiQGFRjgygQUBAYwiAQE?=
X-IronPort-AV: E=Sophos;i="5.56,269,1539673200"; 
   d="scan'208";a="52365552"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 23 Nov 2018 01:36:49 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2502865AbeKWUUO (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 15:20:14 -0500
Received: from smtp.codeaurora.org ([198.145.29.96]:38676 "EHLO
        smtp.codeaurora.org" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2387987AbeKWUUO (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 15:20:14 -0500
Received: by smtp.codeaurora.org (Postfix, from userid 1000)
        id CEA1361385; Fri, 23 Nov 2018 09:36:43 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=codeaurora.org;
        s=default; t=1542965803;
        bh=J1MzUFUdQYVZ2dZZ9GBsro77cbb3hNvQAK6giLwbHUs=;
        h=References:In-Reply-To:From:Date:Subject:To:Cc:From;
        b=TbPSpcsnFS6mNy62H4w/C/YSvccu6oQTxj4RMxRnYesU7P58UdLzK5ow963edWOXO
         kR6KncKV2LE4eQdsqbO1NaL0T5ivIyuWsyHvL7EGuVaIfSNFdOYM7c7wXgZDHRQffp
         +/2MGc3dxEg9h8sGgMglBsLbYlMXK/ULd7NX6uEw=
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
        pdx-caf-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.7 required=2.0 tests=ALL_TRUSTED,BAYES_00,
        DKIM_INVALID,DKIM_SIGNED autolearn=no autolearn_force=no version=3.4.0
Received: from mail-qk1-f173.google.com (mail-qk1-f173.google.com [209.85.222.173])
        (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
        (No client certificate requested)
        (Authenticated sender: vivek.gautam@smtp.codeaurora.org)
        by smtp.codeaurora.org (Postfix) with ESMTPSA id F3B8B61385;
        Fri, 23 Nov 2018 09:36:41 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=codeaurora.org;
        s=default; t=1542965802;
        bh=J1MzUFUdQYVZ2dZZ9GBsro77cbb3hNvQAK6giLwbHUs=;
        h=References:In-Reply-To:From:Date:Subject:To:Cc:From;
        b=nkRX3OqEL0XB7cvHuzoqayc2vUa5ROAAPsdfYt6yRWDeCpjK2iLuXvx7VDABptGcY
         hTK5Z66nX1Ptfs+o6w7W034fAeEc4iDzSFcl7Wz+GS3kl512O15ut94PP7HKY4nUSg
         Hwlrp6cUGTZ3Z67SOHuxWqHlCSaWKJ0BkfzkNfNs=
DMARC-Filter: OpenDMARC Filter v1.3.2 smtp.codeaurora.org F3B8B61385
Authentication-Results: pdx-caf-mail.web.codeaurora.org; dmarc=none (p=none dis=none) header.from=codeaurora.org
Authentication-Results: pdx-caf-mail.web.codeaurora.org; spf=none smtp.mailfrom=vivek.gautam@codeaurora.org
Received: by mail-qk1-f173.google.com with SMTP id r71so8127256qkr.10;
        Fri, 23 Nov 2018 01:36:41 -0800 (PST)
X-Gm-Message-State: AA+aEWbaSA+6M4uZZnf9Ud0bQvqn5AuzYCVyySD7D9jdyNdIFR/ptbik
        oEiH3LQrShqPje7lSzicRXsq4mZDukYnC3icqaM=
X-Google-Smtp-Source: AFSGD/WJIFnktlPsodp5bB4H7tUAoMPcMR+MIBoGhuOJ6AKXiZ0uBy58sG0F5+5UFbr5lvBhF0T6IK1elRQ9CMvhfeE=
X-Received: by 2002:a37:6084:: with SMTP id u126mr12613436qkb.118.1542965800993;
 Fri, 23 Nov 2018 01:36:40 -0800 (PST)
MIME-Version: 1.0
References: <20181116112430.31248-1-vivek.gautam@codeaurora.org>
 <20181116112430.31248-6-vivek.gautam@codeaurora.org> <20181121173803.GB9801@arm.com>
 <CAFp+6iELH7Mw3Ue2ksEyV+Ac8hG8--Ki69xrPCA4F-AcireRow@mail.gmail.com> <CAAFQd5B-bZR8dmjARb8L4oqgET2YAjXhexAO0GKAvU4JoVU=7g@mail.gmail.com>
In-Reply-To: <CAAFQd5B-bZR8dmjARb8L4oqgET2YAjXhexAO0GKAvU4JoVU=7g@mail.gmail.com>
From: Vivek Gautam <vivek.gautam@codeaurora.org>
Date: Fri, 23 Nov 2018 15:06:29 +0530
X-Gmail-Original-Message-ID: <CAFp+6iFhBRJWGY4Hj30tWedGpEUcnkBJrOvffmbpD2m9QMZB3A@mail.gmail.com>
Message-ID: <CAFp+6iFhBRJWGY4Hj30tWedGpEUcnkBJrOvffmbpD2m9QMZB3A@mail.gmail.com>
Subject: Re: [RESEND PATCH v17 5/5] iommu/arm-smmu: Add support for
 qcom,smmu-v2 variant
To: Will Deacon <will.deacon@arm.com>, thor.thayer@linux.intel.com,
        Tomasz Figa <tfiga@chromium.org>
Cc: Mark Rutland <mark.rutland@arm.com>,
        "open list:OPEN FIRMWARE AND FLATTENED DEVICE TREE BINDINGS" 
        <devicetree@vger.kernel.org>, Linux PM <linux-pm@vger.kernel.org>,
        sboyd@kernel.org, linux-arm-msm <linux-arm-msm@vger.kernel.org>,
        "Rafael J. Wysocki" <rjw@rjwysocki.net>,
        open list <linux-kernel@vger.kernel.org>,
        "list@263.net:IOMMU DRIVERS <iommu@lists.linux-foundation.org>, Joerg
        Roedel <joro@8bytes.org>," <iommu@lists.linux-foundation.org>,
        alex.williamson@redhat.com, "robh+dt" <robh+dt@kernel.org>,
        freedreno <freedreno@lists.freedesktop.org>,
        Robin Murphy <robin.murphy@arm.com>
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Tomasz,

On Fri, Nov 23, 2018 at 2:52 PM Tomasz Figa <tfiga@chromium.org> wrote:
>
> Hi Vivek, Will,
>
> On Fri, Nov 23, 2018 at 6:13 PM Vivek Gautam
> <vivek.gautam@codeaurora.org> wrote:
> >
> > Hi Will,
> >
> > On Wed, Nov 21, 2018 at 11:09 PM Will Deacon <will.deacon@arm.com> wrote:
> > >
> > > [+Thor]
> > >
> > > On Fri, Nov 16, 2018 at 04:54:30PM +0530, Vivek Gautam wrote:
> > > > qcom,smmu-v2 is an arm,smmu-v2 implementation with specific
> > > > clock and power requirements.
> > > > On msm8996, multiple cores, viz. mdss, video, etc. use this
> > > > smmu. On sdm845, this smmu is used with gpu.
> > > > Add bindings for the same.
> > > >
> > > > Signed-off-by: Vivek Gautam <vivek.gautam@codeaurora.org>
> > > > Reviewed-by: Rob Herring <robh@kernel.org>
> > > > Reviewed-by: Tomasz Figa <tfiga@chromium.org>
> > > > Tested-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
> > > > Reviewed-by: Robin Murphy <robin.murphy@arm.com>
> > > > ---
> > > >  drivers/iommu/arm-smmu.c | 13 +++++++++++++
> > > >  1 file changed, 13 insertions(+)
> > > >
> > > > diff --git a/drivers/iommu/arm-smmu.c b/drivers/iommu/arm-smmu.c
> > > > index 2098c3141f5f..d315ca637097 100644
> > > > --- a/drivers/iommu/arm-smmu.c
> > > > +++ b/drivers/iommu/arm-smmu.c
> > > > @@ -120,6 +120,7 @@ enum arm_smmu_implementation {
> > > >       GENERIC_SMMU,
> > > >       ARM_MMU500,
> > > >       CAVIUM_SMMUV2,
> > > > +     QCOM_SMMUV2,
> > > >  };
> > > >
> > > >  struct arm_smmu_s2cr {
> > > > @@ -2026,6 +2027,17 @@ ARM_SMMU_MATCH_DATA(arm_mmu401, ARM_SMMU_V1_64K, GENERIC_SMMU);
> > > >  ARM_SMMU_MATCH_DATA(arm_mmu500, ARM_SMMU_V2, ARM_MMU500);
> > > >  ARM_SMMU_MATCH_DATA(cavium_smmuv2, ARM_SMMU_V2, CAVIUM_SMMUV2);
> > > >
> > > > +static const char * const qcom_smmuv2_clks[] = {
> > > > +     "bus", "iface",
> > > > +};
> > > > +
> > > > +static const struct arm_smmu_match_data qcom_smmuv2 = {
> > > > +     .version = ARM_SMMU_V2,
> > > > +     .model = QCOM_SMMUV2,
> > > > +     .clks = qcom_smmuv2_clks,
> > > > +     .num_clks = ARRAY_SIZE(qcom_smmuv2_clks),
> > > > +};
> > >
> > > These seems redundant if we go down the route proposed by Thor, where we
> > > just pull all of the clocks out of the device-tree. In which case, why
> > > do we need this match_data at all?
> >
> > Which is better? Driver relying solely on the device tree to tell
> > which all clocks
> > are required to be enabled,
> > or, the driver deciding itself based on the platform's match data,
> > that it should
> > have X, Y, & Z clocks that should be supplied from the device tree.
>
> The former would simplify the driver, but would also make it
> impossible to spot mistakes in DT, which would ultimately surface out
> as very hard to debug bugs (likely complete system lockups).

Thanks.
Yea, this is how I understand things presently. Relying on device tree
puts the things out of driver's control.

Hi Will,
Am I unable to understand the intentions here for Thor's clock-fetch
design change?

>
> For qcom_smmuv2, I believe we're eventually going to end up with
> platform-specific quirks anyway, so specifying the clocks too wouldn't
> hurt. Given that, I'd recommend sticking to the latter, i.e. what this
> patch does.
>
> Best regards,
> Tomasz


Best regards
Vivek

> _______________________________________________
> iommu mailing list
> iommu@lists.linux-foundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/iommu



-- 
QUALCOMM INDIA, on behalf of Qualcomm Innovation Center, Inc. is a member
of Code Aurora Forum, hosted by The Linux Foundation
