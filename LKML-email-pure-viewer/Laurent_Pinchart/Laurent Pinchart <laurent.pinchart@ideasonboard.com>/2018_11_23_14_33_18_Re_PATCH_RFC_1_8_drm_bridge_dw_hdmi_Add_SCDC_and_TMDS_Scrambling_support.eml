Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 23:36:05 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga006.fm.intel.com (fmsmga006.fm.intel.com [10.253.24.20])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 9A77258037D;
	Fri, 23 Nov 2018 06:33:21 -0800 (PST)
Received: from fmsmga102.fm.intel.com ([10.1.193.69])
  by fmsmga006-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 06:33:21 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3Ax/Z2khdir/OhAEqcB/0oL5XqlGMj4u6mDksu8pMi?=
 =?us-ascii?q?zoh2WeGdxc68ZBCN2/xhgRfzUJnB7Loc0qyK6/CmATRIyK3CmUhKSIZLWR4BhJ?=
 =?us-ascii?q?detC0bK+nBN3fGKuX3ZTcxBsVIWQwt1Xi6NU9IBJS2PAWK8TW94jEIBxrwKxd+?=
 =?us-ascii?q?KPjrFY7OlcS30P2594HObwlSizexfbB/IA+qoQnNq8IbnZZsJqEtxxXTv3BGYf?=
 =?us-ascii?q?5WxWRmJVKSmxbz+MK994N9/ipTpvws6ddOXb31cKokQ7NYCi8mM30u683wqRbD?=
 =?us-ascii?q?VwqP6WACXWgQjxFFHhLK7BD+Xpf2ryv6qu9w0zSUMMHqUbw5Xymp4rx1QxH0li?=
 =?us-ascii?q?gIKz858HnWisNuiqJbvAmhrAF7z4LNfY2ZKOZycqbbcNgHR2ROQ9xRWjRBDI2i?=
 =?us-ascii?q?coUBAekPPeFaoInzqFQAogexBRK0BO7t0TJImmL40Lcm3+g9DQ3KwgotFM8Ovn?=
 =?us-ascii?q?TOq9X1Mb8fX+avw6nV1zXMcfVW2Svg44bScxAhp+2DXbJqfsrL1UkkCgTIjlGK?=
 =?us-ascii?q?poz4JTOayOINs3SB4+p4VOKvjXIoqwFrrTi12schkYjJiZ8LxV/e7iV5x4A1Ks?=
 =?us-ascii?q?a/SEFhe96rDYFcuD2dN4tzW84vRXxjtig9yr0Do5G7fS4KxYwoxx7ed/yHc5WI?=
 =?us-ascii?q?7Qn5WOmNJjd4gXRoc6+8iRaq6UWs1PHwW82u3FpXoCdJjMPAum0O2hDP8MSKS/?=
 =?us-ascii?q?lw8l+/1TqTywzf9+RJLV07mKXAMZEsx6A8mocdsUnDGyL7mF75gLOKekgh5OSn?=
 =?us-ascii?q?9efqb7Tjq5KTNIJ5ix/yP6EwlcyxAOk3KA0DU3aY9Oig27Du+1DyTq9Qgf0siK?=
 =?us-ascii?q?bZtYjXJcQFqa69BA9Yypgj6xmhADe8ytgYnmcILEhDeB2Zi4jlIVbOIOr3Dfun?=
 =?us-ascii?q?glSslilkx+zeM7H/HpnAKmLPnKrvcLpj8UJQ1Qk+wcxF659VCLwNOPfzVVXwtN?=
 =?us-ascii?q?zcAB85KQu0w+P/BdV514MeX3+PA6CAPKPRr1CI/OQvLPeIZIMMvzb8Jf4l6OD0?=
 =?us-ascii?q?jXIih18dcrem3YENZHC7APtmOUOZbmTogtsbFmcKpAU+QPTwiFKeST5Te2qyX6?=
 =?us-ascii?q?Uk6zE/CYKmDpnMSpqigbycxyq7GpxWZmZbClGDC3vodoOEW+sSZyKWOMNujjsE?=
 =?us-ascii?q?Vb25QY87yR6urBP6y6ZgLufM+i0Xr5Pj1MRv6O3Ujx0y9SF0AN6b02GCVGx0mm?=
 =?us-ascii?q?IIRzkr3KFwu0B9y1GD0bRmjPxcD9Bc+/RJUgIiP57G0+N6E8zyWh7GftqRSlam?=
 =?us-ascii?q?RcupDSsyTtI2xd8OZUF9Fs6mjhDC2SqqHrAUm6aKBJwy7qLTwXzxK9xhxHbB0a?=
 =?us-ascii?q?krl0MmTddXNW26mq5/8BDeCJTSk0WZkKaqdr4Q3DTX+2eB1meOuEBYUAhtUaTK?=
 =?us-ascii?q?R3wfZ03Wrcjn6UPGVbOhFbMnMg5Zw86YNqRKcsHpjUlBRPr7O9TReWSxl320BR?=
 =?us-ascii?q?aJ3LyMaoXqdn4Z3CXcDkgEjg8S8WyHNQg4GieuvWbeACZyGlLoZkPm6fN+p2+j?=
 =?us-ascii?q?Tk8o0wGKaFVs2Kev9R4Lm/OQUfMT0agCuCc6tTp0GlGx39bVC9qFowpsZ6FcYd?=
 =?us-ascii?q?I74Fda2mPVrQ19Ppq8L698gl4SaRh4v0Tr1x9vEIVPjdAqrG82zAp1Ma+XzUlO?=
 =?us-ascii?q?dy2G0pzqOr3YMG/y/AuxZK7QwVze1NeW+qES6PU3sVnjvQepFlY8/HVjydVaz3?=
 =?us-ascii?q?yc5pDSBgoITZ3xSlo39wR9p7zCfik95obU1XpwMam0sj7Owc4pCPEiyha6e9df?=
 =?us-ascii?q?MaWEFADpHs0eBsiuLvEqmlezYhIFOuBS6LA7P8e8e/Sa366rOf5qnCi6gmRf/I?=
 =?us-ascii?q?B9zkWM+jJmRe7MwZkEzO+X3wudWzjnkVeur9r4mYZHZTEVAGqy0izkBI9XZq1v?=
 =?us-ascii?q?cocHE2auI8urxtpgg57hQWJX9FmmB1kews+mZQKSb0Dh3Q1XzUkWoWGnlTGkwD?=
 =?us-ascii?q?BukjAprrCQ3CrBw+n5cBoHO2hLRHRtjFv2IIi0icwaU1asbwQziBSl4kP6zbBB?=
 =?us-ascii?q?pKtjN2nTXVtIfy/uImF4U6u/qqCNY9RS55MvqylXVvqzYUqbSrLkvxQVySfjEH?=
 =?us-ascii?q?ZAyzAhcDGqvI70nxh7iGKbMXZyo2DVecB2xRfD+tPcQeRd0SYBRCl9kTPXHESz?=
 =?us-ascii?q?P8G1/dWIkJfOquC/V2O7WpxTayXr1p6AtC2g6G1uAB2/me2zm9L9HQg71y/7y8?=
 =?us-ascii?q?dlVSHSoBngZYnr0rywMfh7cUlwGF/89816F5l8koQqnpEQ2nsahpKP8Xoci2jz?=
 =?us-ascii?q?MtZb2aP4bHUTQz4G2NrV4Anj2E1+IXOF3YP5VnOBwsR/Y9m2eH8Z2iU478pSEq?=
 =?us-ascii?q?eb8KREnTdpolq/tQ/QYeJynjAHxfss6X4ahfoEuA4sziWbH7ATElNUPS3qlxSU?=
 =?us-ascii?q?8d++qL9ba3qocbi1zEB+h8yuDKmeogFAX3b0YpQiEjVx7sllMFLMzWf86ofreN?=
 =?us-ascii?q?TLadITtxuUkwrPjuRPKZIxkOYKijRjOW7noXIlzOs7hwR03Z6mpIiHN3lt/KWh?=
 =?us-ascii?q?Dx5dNz31ZNkc9ivjjKlAhcaWw56gHo96FToVRpvoQumlEDYTtfThKgaPHycwqn?=
 =?us-ascii?q?adGbrDAwCf7F1qoG7IE5CuL3uXPmUWzc1+RBmBI0xSmBwUXDI/npIjFwGl3srh?=
 =?us-ascii?q?cFpi5jAK5171sR9MyuNuNxniXWbTvgaoajEoSJeBKBpa9B1N50DQMcaG9OJ8Az?=
 =?us-ascii?q?lY/oG9rAyKMmGUfB5HDWYNWkyZHVzjOqSu6MLE8+iZAOq+MvTPba+PqexYS/eH?=
 =?us-ascii?q?25av3pF68DaLM8WFJmNiAOEj2kpfQXB5HNzUmzcVRCwSiS3NdNSXpAum9i10s8?=
 =?us-ascii?q?C/8+nrWAT16ouUELZSNdRv+xargaaMLeKQhSB5KSpG2ZMI33PH1L8f3FsKgSF0?=
 =?us-ascii?q?azatCagAtTLKTK/Imq5XCAMbazpuNMRS6aIwxBJNOcnditP6zbN4iv81C1FYVV?=
 =?us-ascii?q?3ugM2pZMoKI32jO1PDHkqEKLOGJTjTycHtfay8UaFQjPlTtxCouTaUDU7jPjeA?=
 =?us-ascii?q?lznoTRyvMvtMjCaUPBNAooG9bw1tBHPnTNLnbB27LdB2gSc3wb0ymnPFK2ocPS?=
 =?us-ascii?q?JgfENKq72a9TlYjelnG2xd8nplKvGJlDyE7+bDMJYZr/tqDj5wl+Jb+3k6z7pV?=
 =?us-ascii?q?7CdZRP16gifSr9huo024nemL0DZoTB1OqjNTjoKRoUpiIbnZ9oVHWXvc4BIN7G?=
 =?us-ascii?q?CQBw4WqNd/FtLvu75fyt7UmaL3KTdC9c/U/MQGC8jVLsKHLGQuMR7zFDHICwsF?=
 =?us-ascii?q?SCahNXvDiExFjPGS6nqVo4A6q5f2npoOT75bVFotGfIbCkRqBtoCIJhsUzMgkL?=
 =?us-ascii?q?6bitMI5HWkoBnQQsVaoo7IVvaIDfrzLzaZiOoMWxxd5775Kcw6LIjgx1ZlbFYy?=
 =?us-ascii?q?yILDAU/LQcpKpCJJZAYlpERH6nU4RWo2jRHLcASotVsaCOS5mAJ+sgp4auQk7i?=
 =?us-ascii?q?ukt1M+O0DHojd2iEg3ktXsmyy5cTL8Jby3W4tRAjD48UM2N8WoEE5OcQSukBk8?=
 =?us-ascii?q?Z3//TLVLgu4lLDgzhQ=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0B+AQB/D/hbh0O0hNFjHQEBBQEHBQGBZ?=
 =?us-ascii?q?YExgTmBAieMcIshgg0UjW+LKywLCAGIWiI4EgEDAQEBAQEBAgETAQEBCA0JCCk?=
 =?us-ascii?q?jDII2JAGCYQEBAQECAQECJBMGAQE3AQUJAQEKDgoJFRADDAFHBhMFgxwBgXkIA?=
 =?us-ascii?q?QMBCqYWgWwzgnYBAQWHFAMFeYl0gRyBVz+BEYJkLoMbAoc8iSKWYgcCghwEhFy?=
 =?us-ascii?q?KSwqQfo1DjEqBdk0jgzyCGwkDF4NKilQ+MoEEAQEBjCEBAQ?=
X-IPAS-Result: =?us-ascii?q?A0B+AQB/D/hbh0O0hNFjHQEBBQEHBQGBZYExgTmBAieMcIs?=
 =?us-ascii?q?hgg0UjW+LKywLCAGIWiI4EgEDAQEBAQEBAgETAQEBCA0JCCkjDII2JAGCYQEBA?=
 =?us-ascii?q?QECAQECJBMGAQE3AQUJAQEKDgoJFRADDAFHBhMFgxwBgXkIAQMBCqYWgWwzgnY?=
 =?us-ascii?q?BAQWHFAMFeYl0gRyBVz+BEYJkLoMbAoc8iSKWYgcCghwEhFyKSwqQfo1DjEqBd?=
 =?us-ascii?q?k0jgzyCGwkDF4NKilQ+MoEEAQEBjCEBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,270,1539673200"; 
   d="scan'208";a="54065339"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 23 Nov 2018 06:33:03 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2440024AbeKXBRZ (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 20:17:25 -0500
Received: from perceval.ideasonboard.com ([213.167.242.64]:43000 "EHLO
        perceval.ideasonboard.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2390803AbeKXBRZ (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 20:17:25 -0500
Received: from avalon.localnet (dfj612ybrt5fhg77mgycy-3.rev.dnainternet.fi [IPv6:2001:14ba:21f5:5b00:2e86:4862:ef6a:2804])
        by perceval.ideasonboard.com (Postfix) with ESMTPSA id 7782C58E;
        Fri, 23 Nov 2018 15:32:58 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=ideasonboard.com;
        s=mail; t=1542983578;
        bh=YPMBMQ16VTd7MCop0s8+RVEEOYhmKON9fwj3e9K3SmQ=;
        h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
        b=L8mS154ehwvhoUs4Suec+UA9vxZ4RuTvJjoI3ECXhmMTKkpO4bKPvxdR6WabtarUX
         woshI+GvqbbbnIzWRkgQMqsMLLi5WMYfWNK0spX13BnhNotzfd0zk/mLAJ2aDdhnfi
         AN3tG3sh7qOiBidJLyYZk3meR1EmkvMjYiF0LRCw=
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: Neil Armstrong <narmstrong@baylibre.com>
Cc: architt@codeaurora.org, a.hajda@samsung.com,
        dri-devel@lists.freedesktop.org, linux-amlogic@lists.infradead.org,
        linux-kernel@vger.kernel.org,
        Nickey Yang <nickey.yang@rock-chips.com>,
        Huicong Xu <xhc@rock-chips.com>
Subject: Re: [PATCH RFC 1/8] drm/bridge: dw-hdmi: Add SCDC and TMDS Scrambling support
Date: Fri, 23 Nov 2018 16:33:18 +0200
Message-ID: <18593437.RcPPLLf6y1@avalon>
Organization: Ideas on Board Oy
In-Reply-To: <ca86b176-603b-8983-f6af-95e2bdce4aab@baylibre.com>
References: <20181123140221.15700-1-narmstrong@baylibre.com> <1880382.AeP59NOuia@avalon> <ca86b176-603b-8983-f6af-95e2bdce4aab@baylibre.com>
MIME-Version: 1.0
Content-Transfer-Encoding: 7Bit
Content-Type: text/plain; charset="us-ascii"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Neil,

On Friday, 23 November 2018 16:29:15 EET Neil Armstrong wrote:
> On 23/11/2018 15:25, Laurent Pinchart wrote:
> > On Friday, 23 November 2018 16:02:14 EET Neil Armstrong wrote:
> >> Add support for SCDC Setup for TMDS Clock > 3.4GHz and enable TMDS
> >> Scrambling when supported or mandatory.
> >> 
> >> This patch also adds an helper to setup the control bit to support
> >> the hight TMDS Bit Period/TMDS Clock-Period Ratio as required with
> > 
> > s/hight/high/ ?
> 
> Thanks for catching !
> 
> >> TMDS Clock > 3.4GHz for HDMI2.0 3840x2160@60/50 modes.
> > 
> > Why do you need a helper for this, is there no way it could be handled
> > internally ?
> 
> I could, but all the platforms would also do it internally... seems better
> to have common helper, no ? And it will be usable by the PHY models handler
> in the dw-hdmi driver aswell.

I meant internally in the dw-hdmi driver, not in the glue layer.

> >> These changes were based on work done by Huicong Xu <xhc@rock-chips.com>
> >> and Nickey Yang <nickey.yang@rock-chips.com> to support HDMI2.0 modes
> >> on the Rockchip 4.4 BSP kernel at [1]
> >> 
> >> [1] https://github.com/rockchip-linux/kernel/tree/release-4.4
> >> 
> >> Cc: Nickey Yang <nickey.yang@rock-chips.com>
> >> Cc: Huicong Xu <xhc@rock-chips.com>
> >> Signed-off-by: Neil Armstrong <narmstrong@baylibre.com>
> >> ---
> >> 
> >>  drivers/gpu/drm/bridge/synopsys/dw-hdmi.c | 45 +++++++++++++++++++++--
> >>  drivers/gpu/drm/bridge/synopsys/dw-hdmi.h |  1 +
> >>  include/drm/bridge/dw_hdmi.h              |  1 +
> >>  3 files changed, 44 insertions(+), 3 deletions(-)
> >> 
> >> diff --git a/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c
> >> b/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c index
> >> 5971976284bf..523508af70b0 100644
> >> --- a/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c
> >> +++ b/drivers/gpu/drm/bridge/synopsys/dw-hdmi.c

[snip]

> >> @@ -1562,6 +1581,26 @@ static void hdmi_av_composer(struct dw_hdmi *hdmi,
> >>  		vsync_len /= 2;
> >>  	}
> >> 
> >> +	/* Scrambling Control */
> >> +	if (hdmi_info->scdc.supported) {
> >> +		if (vmode->mpixelclock > 340000000 ||
> >> +		    hdmi_info->scdc.scrambling.low_rates) {
> >> +			drm_scdc_readb(&hdmi->i2c->adap, SCDC_SINK_VERSION,
> >> +				       &bytes);
> >> +			drm_scdc_writeb(&hdmi->i2c->adap, SCDC_SOURCE_VERSION,
> >> +					bytes);
> > 
> > Shouldn't the source version be min(sink version, highest supported source
> > version) ?
> 
> How should the "highest supported source version" be defined ?

That's the highest version supported by the DW HDMI TX controller, and is an 
intrinsic property of the IP core. With the above code, a sink newer than the 
DW HDMI TX will incorrectly be told that the source supports the same version 
as the sink.

> >> +			drm_scdc_set_scrambling(&hdmi->i2c->adap, 1);
> >> +			hdmi_writeb(hdmi, (u8)~HDMI_MC_SWRSTZ_TMDSSWRST_REQ,
> >> +				    HDMI_MC_SWRSTZ);
> >> +			hdmi_writeb(hdmi, 1, HDMI_FC_SCRAMBLER_CTRL);
> >> +		} else {
> >> +			hdmi_writeb(hdmi, 0, HDMI_FC_SCRAMBLER_CTRL);
> >> +			hdmi_writeb(hdmi, (u8)~HDMI_MC_SWRSTZ_TMDSSWRST_REQ,
> >> +				    HDMI_MC_SWRSTZ);
> >> +			drm_scdc_set_scrambling(&hdmi->i2c->adap, 0);
> >> +		}
> >> +	}
> >> +
> >>  	/* Set up horizontal active pixel width */
> >>  	hdmi_writeb(hdmi, mode->hdisplay >> 8, HDMI_FC_INHACTV1);
> >>  	hdmi_writeb(hdmi, mode->hdisplay, HDMI_FC_INHACTV0);

[snip]

-- 
Regards,

Laurent Pinchart



