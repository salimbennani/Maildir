Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 23:33:59 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga001.jf.intel.com (orsmga001.jf.intel.com [10.7.209.18])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 3B3BD58040F;
	Fri, 23 Nov 2018 02:32:34 -0800 (PST)
Received: from fmsmga103.fm.intel.com ([10.1.193.90])
  by orsmga001-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 02:32:33 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AUuvcYxYK2XvF6LW6xB/C5hH/LSx+4OfEezUN459i?=
 =?us-ascii?q?sYplN5qZpcm8bB7h7PlgxGXEQZ/co6odzbaO4+a4ASQp2tWoiDg6aptCVhsI24?=
 =?us-ascii?q?09vjcLJ4q7M3D9N+PgdCcgHc5PBxdP9nC/NlVJSo6lPwWB6nK94iQPFRrhKAF7?=
 =?us-ascii?q?Ovr6GpLIj8Swyuu+54Dfbx9HiTahYr5+Ngm6oRnMvcQKnIVuLbo8xAHUqXVSYe?=
 =?us-ascii?q?RWwm1oJVOXnxni48q74YBu/SdNtf8/7sBMSar1cbg2QrxeFzQmLns65Nb3uhnZ?=
 =?us-ascii?q?TAuA/WUTX2MLmRdVGQfF7RX6XpDssivms+d2xSeXMdHqQb0yRD+v9LlgRgP2hy?=
 =?us-ascii?q?gbNj456GDXhdJ2jKJHuxKquhhzz5fJbI2JKPZye6XQds4YS2VcRMZcTzFPDJ2y?=
 =?us-ascii?q?b4UPDOQPM+hXoIb/qFQSohW+HhGsCeH0xz9UhXL7x7E23/gvHAzE2gErAtIAsG?=
 =?us-ascii?q?7TrNXwLKocX/q6zK/JzTrda/NdxDHz55bJcx89u/6MW7VwetfWxEYyDQzFiFSQ?=
 =?us-ascii?q?ppLhPz+P0uQCrWma4PZ6WuKpjG4qsAVxojmpxsg2kInJgZgZylfe9SV22Ys4I8?=
 =?us-ascii?q?CzRkB8Yd6hCpRQtieaOpNqQsIsQmFopDo6xaMcuZKhYCcKz5Enywbba/yGdYiH?=
 =?us-ascii?q?+AjjVOGLLTd/nnJld6qzhxio/ke81OLzTc600FFJriZfjtbMsXUN2hrO4caEUv?=
 =?us-ascii?q?tw5lmt1SqL2gzJ9+1JL144mbDGJ5Mi3rI8jJsevEbbEiL0mkj6lrKae0sl9+Sy?=
 =?us-ascii?q?6unqYq/qq5CTOoJylwrwKL4hmtalDuQ9KgUOX3aU+eC71LD74035T6tFjucsnq?=
 =?us-ascii?q?narp/aP8IbqbC9AwNP1YYj8Rm/Ay+n0NQeg3YHMEpIdAybg4XtIV3CPf71Aeml?=
 =?us-ascii?q?j1ixkzpn2+rKM7zjD5nVK3jMirbhfbJz605GzwozyMhS55ZVCrEHPfLyVVb9tN?=
 =?us-ascii?q?/GAR8jNQy73eLnBMx61oIQX2KAHLWZPbjMsV+H+O0vOfOAZIwLtzbnLfgq+fru?=
 =?us-ascii?q?gWU+mV8HcqmlxYEXZ2ygHvR6P0WZZmLhgtMAEWcJoAUyVuPriECZXD5XZnayWb?=
 =?us-ascii?q?885z4hBIKnC4fDWp6igLib0CinGZ1WY3hMCkqQHnfwa4WER/AMZTqSIsB7kzwE?=
 =?us-ascii?q?SaKuS4g72RGuqQ/10bxnLuXP9y0ctJLj0sV15uLJmREz8zx0E9qS02WXQ25omW?=
 =?us-ascii?q?MIQic83Lpjrkxl1leDza94juRaFdxU+fxFSAQ6NZnaz+x8DND/QQbBftaPSFa7?=
 =?us-ascii?q?TdSqGzAxTtQtw9AQZ0ZxAcmtjhfG3yCyGb8ai6SLBIAo8qLbx3X+Pd19y3bB1K?=
 =?us-ascii?q?kilVUmWNFANW+9i6579gjTAZPJkkqDm6arc6QcwDDC9GOZwWWSu0FYVRZ6Ub/Z?=
 =?us-ascii?q?UnAHekvWsdP561vBT7C0D7QrKA9Byc+YJatMZd3kllFGRPblONTDbGO9gWawBR?=
 =?us-ascii?q?CUxrySaIrmYXkS3CLYCEIciQAc4W6GNRQiBiemu2/RESZhFUzxbE/28elxsnW7?=
 =?us-ascii?q?TlQqwAGMaEFh07m1+hsRhfGHT/MT37QEuDouqjluHVa92c7WBMSEpwZ7YKpcZt?=
 =?us-ascii?q?Y96k9d1W3Frwx9IoCgL6d6i1EDaQt3oV3h2w93Copal8gqt20lzAxpJKKc0VNB?=
 =?us-ascii?q?cS6Y3J/qNr3WLGny4A6ga6rM1l7C19aW/78F6O4kpFX7oAGpCk0i/m1709lU1n?=
 =?us-ascii?q?uc4YnKDAoSUJ7rTkY77R96p6veYik84YPU2mZhMa21sj/ExtIoC/Epyhemf9dD?=
 =?us-ascii?q?LqyEEBX+HNEdB8irMOYqgUSmbgoYPOBO8645J9mpd/+Y16+kIulhnCiqgn9a4I?=
 =?us-ascii?q?9gyE2M8Sl8SunW35sex/GY3w2HVyrzjVu7s8D3n5xEai8WHmal1SfkA4tRbLVo?=
 =?us-ascii?q?fYkXEWeuP9G3xtJmip/tRn5U7kKsC0kH2c+pYxWSaVP90BZU1UQWp3ynhCS5wy?=
 =?us-ascii?q?Z1kzEvsqqQwijOz/7+exoAP25BXHNigkv0IYiok9AaW1ClbxIolBS5/0n63bVU?=
 =?us-ascii?q?pKNlI2nVX0hIZSn2I3h+XaSqsrqNftBA6IkvsSVRS+m8ZVGaSrjgoxoVyS/jHm?=
 =?us-ascii?q?1exCwleDGuoJn2gxt6iGeFJnZpsHXZYd1wxQvY5NHERf9R3yAKRSlihTnMG1i8?=
 =?us-ascii?q?OcKk/dGVl5fFr+C/WHitVpxVcSn304yAsDG36nFtAR26h/qzgMHoERAm0S/n0N?=
 =?us-ascii?q?lnTSfIowzmYono1KS6NvhrflJyC1//6Mp6G4d+nZU2hJwL3Xgah5OV/WcIkGvp?=
 =?us-ascii?q?MNVb377+Y2QJRTIR39HV5w3l0lV5Ln2V34L5Smmdwsx5ati6eGwW3Tgx78JLCK?=
 =?us-ascii?q?eS97FEmSp1olylrQPee/R9nzEdyecw534eme0GpA0tziCFCLAIAUZYJTDslwiP?=
 =?us-ascii?q?792mr6VYfmevfaKw1Epjh9+hCr6CrxpYWHb4fJciACBx4t9+MFLKzH389IXkdM?=
 =?us-ascii?q?PMYtIUsx2eiw3AgPRNKJItivoKgjJqOWf8vX0m0eE3lxJv0o+hvIibNWpt5rm2?=
 =?us-ascii?q?DQBCNj36fM4T/jDtjaBDnseZxYyvH5NhGikVU5vsV/6nDDUStfH/PQaUDDI8sm?=
 =?us-ascii?q?ubGabYHQKH9EdmqHfPH4qqNn6NInkZ0M5iRAKcJEFEhAAUXTM6noM2Fwywxczh?=
 =?us-ascii?q?dlt56S4V5lLithRMzedoPQHlUmjDvAeodis0SJ+HIRVN9A5C4EPVMdGE4uJ3Ai?=
 =?us-ascii?q?FV5ZmhrA2LKmyGaAVEF2AJWkqYB1/9Ormi/8XP8++dBuCmNfvBfa2OqfBCV/eP?=
 =?us-ascii?q?3Z+v0JFp/zOSOcWUJHViE+c32kleXXB6BsTZnS8ASzcMmiLJbs6bogq8+yJtos?=
 =?us-ascii?q?C+9vTrRBzg5Y+VB7RONtVv/gi8gb2fOO6ImCZ5NTFY24sMxH/P1bgfxUMShDto?=
 =?us-ascii?q?dzW3CrQAsijNTK3Ll69TDh4bbT5zNcRS46I92AlNJdDUitfv2rFkif41Dk9PVU?=
 =?us-ascii?q?b9lcGxecwKP2a9OUvHBEmVNbSGJj7Lw8DtbaO/U71Qi+pUuAOquTaGCE/uJTCD?=
 =?us-ascii?q?lzjvVxCyPuBAliCbPBpCuI6jdhZhE3TsTNXjahejKt94kSU2waEohnPNLWMTKy?=
 =?us-ascii?q?V8fFhXrrKO7SJUmPF/G21a43phLOmEnTuZ7ubCJpYXt/trHjp7l+ZA7HsmzLtV?=
 =?us-ascii?q?6TlOROZplyvKst5uv1amn/GTyjpmVRpCsCpEiJiXskViJ6rZ8IJNWXLF/BIL8G?=
 =?us-ascii?q?WRBA4Gp9pjCt3zpa9QzsLDm770KDdH69jU59cTB9DIKMKbN3osKRroFyTSDAsA?=
 =?us-ascii?q?TD6rM3nQhk1dkP6I8H2VoYM3qpztmJoIV79aW0Y5FvIcCkR5AtMCJI17US8jkb?=
 =?us-ascii?q?6e34Y04i+ArQPcX8USnY3CX+jaVevuMjuCjf9Heh4B25v8LIIaLIq93FZtPApU?=
 =?us-ascii?q?hoPPTmbZW9FApmVFYx0/qUNKuCxyR2sy1kajbg6/63YVEtawnxg/kAw4Zv4iom?=
 =?us-ascii?q?S/q2wrL0bH8XNj2HI6ns/o1HXIKGb8?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0DvAQDz1fdbh0O0hNFiHAEBAQQBAQcEA?=
 =?us-ascii?q?QGBZYJqA38ng3mUFYFgLRSZFRcBARgHDAGBS4F0hRYiOBIBAwEBAQEBAQIBEwE?=
 =?us-ascii?q?BAQgNCQgpIwyCNiQBgmIBAgMBAiAPAQ0BATcBBQkBAQoSBgICJgICAzEBBQEOD?=
 =?us-ascii?q?gYNCAEBAQSDGAGCAQQBCptHPIodcIEvgnYBAQWCQ4RPCBJ5iWKBHIFXP4E4gmu?=
 =?us-ascii?q?DEAsCAoRjgleHUoNBlHEHAoIcBIN7YYMthwAGGIImhysQhycsjReKRgIEAgQFA?=
 =?us-ascii?q?gUPIYE8gXYzGjCDLwmCEjWDOIUUhT8/MoEFAQGMIQEB?=
X-IPAS-Result: =?us-ascii?q?A0DvAQDz1fdbh0O0hNFiHAEBAQQBAQcEAQGBZYJqA38ng3m?=
 =?us-ascii?q?UFYFgLRSZFRcBARgHDAGBS4F0hRYiOBIBAwEBAQEBAQIBEwEBAQgNCQgpIwyCN?=
 =?us-ascii?q?iQBgmIBAgMBAiAPAQ0BATcBBQkBAQoSBgICJgICAzEBBQEODgYNCAEBAQSDGAG?=
 =?us-ascii?q?CAQQBCptHPIodcIEvgnYBAQWCQ4RPCBJ5iWKBHIFXP4E4gmuDEAsCAoRjgleHU?=
 =?us-ascii?q?oNBlHEHAoIcBIN7YYMthwAGGIImhysQhycsjReKRgIEAgQFAgUPIYE8gXYzGjC?=
 =?us-ascii?q?DLwmCEjWDOIUUhT8/MoEFAQGMIQEB?=
X-IronPort-AV: E=Sophos;i="5.56,269,1539673200"; 
   d="scan'208";a="53063972"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 23 Nov 2018 02:32:31 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2503267AbeKWVQL (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 16:16:11 -0500
Received: from mail-wr1-f66.google.com ([209.85.221.66]:43449 "EHLO
        mail-wr1-f66.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2390639AbeKWVQK (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 16:16:10 -0500
Received: by mail-wr1-f66.google.com with SMTP id r10so11809489wrs.10
        for <linux-kernel@vger.kernel.org>; Fri, 23 Nov 2018 02:32:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google;
        h=subject:to:cc:references:from:message-id:date:user-agent
         :mime-version:in-reply-to:content-language:content-transfer-encoding;
        bh=VAptEt8cRcnUr8KKnpmh3SAuON7v9IwmkhCWuFtd+UA=;
        b=Yivc6QOIzC8KYeFO0XKz0lYBs6eS3w+4lzV5l9Lw4hChAL8g8OBd0ojdCeksuLjWvY
         1uNowfqWIBIpEz3IVV1JDjy0grX47cz81UXHdvlyyRtThxQRRN9EYddYZJzuuzUcjtY9
         /oLxw2Gemc0OlFD921O3cKDOHQQuzAjJCLb28=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:subject:to:cc:references:from:message-id:date
         :user-agent:mime-version:in-reply-to:content-language
         :content-transfer-encoding;
        bh=VAptEt8cRcnUr8KKnpmh3SAuON7v9IwmkhCWuFtd+UA=;
        b=ImOAThrIBNnw/VnS74I76AE99xQkIUzbBJOmGEgDB0+77d5diWMvpCvr4uvgbeo0uF
         GVOFsfTNO1qAk5YseXZAnQQuzy+Mi1ZICYx+U1WYJcwc9Q1kAio8iO0Qlq75zbLLEeeZ
         LGiI+mLqgc+TiOM/D0uTTNV4yYSug39Oqf2nsxT6eAA2NFdJrvECLL1bnmP0GWgsVFj1
         FXYC8V6YIdD8a3V0S6voFC6NUIVUSfGFeZQaCtlDX/e14cEXUhEz5Ut6zebcEaPd9NTN
         PkP1xIU7ZoVn1kLU8acl0OW0BQRkvWh+vITnlNH+L9qZnZfP1pBcOHOOPW/Z5+w6F18C
         /3jg==
X-Gm-Message-State: AA+aEWYF68mXHgi8vtn/ouz4byLmCxmDUYy0o4tIVC8uO+H3GAuKXZ9p
        iy0cydB1Nx7ntcgBg5nd9/NVCA==
X-Google-Smtp-Source: AFSGD/VcjGB+72QRRTQ3C1FrcYygRAtztnyh1i2Zzo/+UkKz1p8swbR5M0IhiAAuE9D1eGji1nAAyQ==
X-Received: by 2002:a5d:4d46:: with SMTP id a6mr13565068wru.28.1542969146481;
        Fri, 23 Nov 2018 02:32:26 -0800 (PST)
Received: from [192.168.0.40] (44.65.136.77.rev.sfr.net. [77.136.65.44])
        by smtp.googlemail.com with ESMTPSA id k73sm10645196wmd.36.2018.11.23.02.32.25
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Fri, 23 Nov 2018 02:32:25 -0800 (PST)
Subject: Re: [PATCH V2 2/2] base/drivers/arch_topology: Default dmips-mhz if
 they are not set in DT
To: Viresh Kumar <viresh.kumar@linaro.org>
Cc: rjw@rjwysocki.net, linux-kernel@vger.kernel.org,
        Chris Redpath <chris.redpath@linaro.org>,
        Quentin Perret <quentin.perret@linaro.org>,
        Amit Kucheria <amit.kucheria@linaro.org>,
        Nicolas Dechesne <nicolas.dechesne@linaro.org>,
        Niklas Cassel <niklas.cassel@linaro.org>,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        "Rafael J. Wysocki" <rafael@kernel.org>
References: <1542890209-3263-1-git-send-email-daniel.lezcano@linaro.org>
 <1542890209-3263-2-git-send-email-daniel.lezcano@linaro.org>
 <20181123100441.nlapxupdcqehwj6m@vireshk-i7>
From: Daniel Lezcano <daniel.lezcano@linaro.org>
Message-ID: <400c34c5-18f4-70ab-d660-8b4c45c8eec4@linaro.org>
Date: Fri, 23 Nov 2018 11:32:24 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.2.1
MIME-Version: 1.0
In-Reply-To: <20181123100441.nlapxupdcqehwj6m@vireshk-i7>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 8bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On 23/11/2018 11:04, Viresh Kumar wrote:
> On 22-11-18, 13:36, Daniel Lezcano wrote:
>> In the case of asymmetric SoC with the same micro-architecture, we
>> have a group of CPUs with smaller OPPs than the other group. One
>> example is the 96boards dragonboard 820c. There is no dmips/MHz
>> difference between both groups, so no need to specify the values in
>> the DT. Unfortunately, without these defined, there is no scaling
>> capacity computation triggered, so we need to write
>> 'capacity-dmips-mhz' for each CPU with the same value in order to
>> force the scaled capacity computation.
>>
>> Fix this by setting a default capacity to SCHED_CAPACITY_SCALE, if no
>> 'capacity-dmips-mhz' is defined in the DT.
> 
> We aren't doing this anymore. You should rather explain that we just
> allocate raw_capacity now and rest is left for
> init_cpu_capacity_callback() to fix.

What about?

"In the case of asymmetric SoC with the same micro-architecture, we
have a group of CPUs with smaller OPPs than the other group. One
example is the 96boards dragonboard 820c. There is no dmips/MHz
difference between both groups, so no need to specify the values in
the DT. Unfortunately, without these defined, there is no scaling
capacity computation triggered, so we need to write
'capacity-dmips-mhz' for each CPU with the same value in order to
force the scaled capacity computation.

In order to fix this situation, allocate 'raw_capacity' so the pointer
is set and the init_cpu_capacity_callback() function can be called."

-- 
 <http://www.linaro.org/> Linaro.org â”‚ Open source software for ARM SoCs

Follow Linaro:  <http://www.facebook.com/pages/Linaro> Facebook |
<http://twitter.com/#!/linaroorg> Twitter |
<http://www.linaro.org/linaro-blog/> Blog

