Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 15:31:26 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga003.jf.intel.com (orsmga003.jf.intel.com [10.7.209.27])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id A741E58040F;
	Thu, 22 Nov 2018 22:15:29 -0800 (PST)
Received: from fmsmga104.fm.intel.com ([10.1.193.100])
  by orsmga003-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 22:15:29 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AHvfsPRHc2z0k2tlcj45qMZ1GYnF86YWxBRYc798d?=
 =?us-ascii?q?s5kLTJ75ocyybnLW6fgltlLVR4KTs6sC17KG9fi4EUU7or+5+EgYd5JNUxJXwe?=
 =?us-ascii?q?43pCcHRPC/NEvgMfTxZDY7FskRHHVs/nW8LFQHUJ2mPw6arXK99yMdFQviPgRp?=
 =?us-ascii?q?OOv1BpTSj8Oq3Oyu5pHfeQpFiCa+bL9oMBm6sRjau9ULj4dlNqs/0AbCrGFSe+?=
 =?us-ascii?q?RRy2NoJFaTkAj568yt4pNt8Dletuw4+cJYXqr0Y6o3TbpDDDQ7KG81/9HktQPC?=
 =?us-ascii?q?TQSU+HQRVHgdnwdSDAjE6BH6WYrxsjf/u+Fg1iSWIdH6QLYpUjm58axlVAHnhz?=
 =?us-ascii?q?sGNz4h8WHYlMpwjL5AoBm8oxBz2pPYbJ2JOPZ7eK7WYNEUSndbXstJSiJPHI28?=
 =?us-ascii?q?YYsMAeQPM+lXoIvyqEcBoxulHQmhBvjiyiNLi3LswaE2z+osHAPA0Qc9H9wOqn?=
 =?us-ascii?q?PUrNDtOakcS++1yqjIwivHb/hL3zny9onJfQw7rvGKWrJ7bM3cxlQ1GAPDj1Wf?=
 =?us-ascii?q?t4jlMymR1usTsmmU8/BvVeSoi2M8rwFxoz6vyd02ionOnI4VzUrE9SpgzYszON?=
 =?us-ascii?q?a2Rkl7Ydu+H5tRsSGXL5d2Q80jQ2F0pCY11KcGtYSncygNzZQr3xrfa/2Bc4eS?=
 =?us-ascii?q?+BLjU/ydITBihHJqYL6/hAi98VKmyuLiUsm4ylFKrjBKktXUuHACzQDc5dacRf?=
 =?us-ascii?q?t6+Ueh2iyD2BzU6uFBJ00/iKnVK4Y5z7IuipYetV7PEjL4lUnolqOaa0Yp9vSy?=
 =?us-ascii?q?5+nmYLjqvp2ROo1uhg3jPKkjm9azDOU4PwQUUGWW9uKx36D580LjWrVFlPg2n7?=
 =?us-ascii?q?HZsJ/EIcQboba0AxFa0ok98RazFTSm38oCnXkBMl1FfAiLj4/zO1HBOPz4DPG/?=
 =?us-ascii?q?jEqwkDpz2fzKIrnsDo/QInXNjrvtZ6tx5k1AxAYpzN1S5YpYCrQbL/LyXk/xus?=
 =?us-ascii?q?bYDhg8MwGsx+bnCdN91p4RWG6WAa+WLrnSsVmW6eIrOuWMY4EUuDDjJPg//PPu?=
 =?us-ascii?q?k3A5lkEHfaWz3psYdmq4HvJ4LEWde3bshc0BEWgSsgokUOPqkEGCUSJUZ3uqW6?=
 =?us-ascii?q?I85zI7B5y8AYbMW4Cgm7iB3Ca9Hp1LaWFKEFGMEXH0d4qaX/cAcj6dIshkkjYc?=
 =?us-ascii?q?T7iuV5ch1Q2ytA/907dnLvDb+iwEtZ3509h5/e3TlQwo+jxyAMSQyGWNT2Bynm?=
 =?us-ascii?q?MVSD46xqF/oUphylid1ah0meBXFdtW5/lRSAc1KYbcz/BmC9D1Qg/BfNCJR0i8?=
 =?us-ascii?q?TtWlBjExSNQxw9gVbkZ5GtWiiA3D3iWwD78UkbyLGII78qbG03ftIMZ9zm7M1L?=
 =?us-ascii?q?M9gFk+XstPKWqmi7Zl+AjIB47JlEaZm7ywdasG3i7A72ODzWuIvEFFXw98S6TF?=
 =?us-ascii?q?XXYDZkTIqdT1/F/NT7irCb4/KAtO1daCKrdWat3ulVhGR+3sONLEb2K1mme/Hx?=
 =?us-ascii?q?CIxryXYYruemUd2jjdCUcenwAS+3aGKRYxBiO7r23CCzxuEErlY1nw/ulmtHO7?=
 =?us-ascii?q?Ukg0whmXYEJ7ybq65AQZhfyGRPMVxbILpiEhpzJwHFa+2tLWD8GNpw5gfKVafN?=
 =?us-ascii?q?M8701L1WPftwxhIJOgK7puiUIZcwRyp0nuzQl4Cp1ckcg2q3Mn1Bd9JriG0Fxf?=
 =?us-ascii?q?bT+Y3Yr/OrvMKmbs+hCicKrW2lDY0NaL9aYD8vU4q1P/vA63Ekou6Wlo095Q03?=
 =?us-ascii?q?GE/JXFEBISUY7tUkYw7xV6u7DaYiw654PI1X1tMbO4siPY19IuHuslzhegf9FQ?=
 =?us-ascii?q?MK6fEA/yEssaB9WhKeAwmlipaA4EM/5W9KIuI8ymcP6G0raxPOl8hDKmkXhH4I?=
 =?us-ascii?q?dl302W8ypzVOHJ0IgFwv2CxQSHSirzg02nssD0noBEeyofHm6+ySjiGY5Qabd+?=
 =?us-ascii?q?fYcNCWeyPcK3ws9yiILqW35d7FSjHU8J2Ne1eRqOaFzwxQ1R1VkNrXO7gye5zj?=
 =?us-ascii?q?x0nCsvrqqQxyHOx+XidBwaOm9EXmVijFHsIZSqgNAeRkSncw8plB6970bg26db?=
 =?us-ascii?q?vLh/L3XUQUpQZSj2Ln1tXbGqtrWfZM5D8pUovjtNUOS9eFyVVqTyox8H3Cz9BW?=
 =?us-ascii?q?tewzY7eiquupX4mRx6lW2cIGxyrHrfZcF/2xPf6MbASv5W2zoMXDN4hiXPBlig?=
 =?us-ascii?q?I9mp+s2ZlpfCsuykV2OtTIZTcTTtzY6bsCu75GtqAQCwnvypm93nFxQ63jH/19?=
 =?us-ascii?q?VwSSrIqxP8aJHx16umKeJnYlVoBFjk5sp4AI5+iIgwhJIX2XQAnZWa53kHkWTy?=
 =?us-ascii?q?MdVdx63+amEARToKw97T/Qjk11dvLnOPx4LlSHqdxtFtaMW9YmMTwig99dxFCL?=
 =?us-ascii?q?+I7LxYmit4ulq5ohjWYfRnnDcdyP0u5WUeg+EIvgot0yqcDqoTHUleISzjiRCI?=
 =?us-ascii?q?48qio6VQYWalaaKw21ZmndC9ELGCpRlRWHXjdZcjByNw7th/P0jK0H388YzkfN?=
 =?us-ascii?q?jQbdQOthybiRvAju5VKI4vmfoOnyZoJWX9vXg9we4hkRNuxY26vJSAK2h1+aK5?=
 =?us-ascii?q?Ax1YOSfva8Id5D7tlrpekdiM34+0AJphADoLUYDsTfKpFjISqPvmOxyPED06tn?=
 =?us-ascii?q?eUB77fERWD50dhqnLFC4qrOG2PJHkF0dViQwGQJFBYgAARRjk7n4Q2Fga3xMz6?=
 =?us-ascii?q?a0d55ysc5lr5qhtK1+JpOAPzUmbZpAe0dDg0TIKTIwZR7gFH/03VK9CR7vpvHy?=
 =?us-ascii?q?FE+Z2stBeCJXacZwRMEGEFQEiEB034M7mq5NnA9fWYB+WkI/vPZ7WOtfJRV/OS?=
 =?us-ascii?q?yZ2z1Ytm+i6GNt+TMXl6E/07xk1DUGh7G8vDnjUAVTcXmzjRb8KBpxe85y53rt?=
 =?us-ascii?q?258PvxQwLi/o+PC7pUMdVy9BG6m6aDN+iMhClnLTZUzI8DxXjNyLIHxl4dlzlu?=
 =?us-ascii?q?dyWxEbQHrSPMTKXQmrJODx4GcSxzMtFE77k73glLNs7Wkdf11r9+jv4oBFZJT1?=
 =?us-ascii?q?3hmse1ZcMUJ2GxLk/IBEGONL6ePz3E39n3Yb+gSb1XlOhUtwO/uTeYE0/gPzSP?=
 =?us-ascii?q?jTrpVwqoMeFDki6bJgFeuJqmfxZpCGjjSs/maxKhPN92iz023aM7hnfQOWEANj?=
 =?us-ascii?q?h8dltHrqeM4iNAnvV/B2tB42J/IumZgCmZ9ffXK5YMvftvAyR5jOZa4HU8y7tI?=
 =?us-ascii?q?4yBIXv11mC3OrtFwp1GqiPWAyj1iUBBWsDZEmJqLvVl+OaXe7pRARXfE/BcX4W?=
 =?us-ascii?q?qMERgFu9tlBcPpu61LztjPlaTzKCpN8t7O/MscAdTUJ9yDMHY7LRXpHzvUBhMf?=
 =?us-ascii?q?TTG3LWHfm1BdkPaK+3yVtJc6rJ3smJsISrBDVV01FukVCkJqHNEZJJd3XzUkka?=
 =?us-ascii?q?OUjcIS5Hq+qgXRS9tevpzdSv2SBvDve36liuxhbgEUwLWwB4AOM4D9wFBjbFZ+?=
 =?us-ascii?q?1NDPElDMXNYLqCl8awIyu1lM9nd6ZmI03E3hZwak4XtVHvmxyE0YkAx7NMgk8j?=
 =?us-ascii?q?bh5x8TK0jBrS032B09kNPkjDTXdDPjJ662WqlSCiz9rU93NYn0FVUmJTaulFBp?=
 =?us-ascii?q?YW+XD4laiKFtICUy0FfR?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0BQAAAtmvdbh0O0hNFiHAEBAQQBAQcEA?=
 =?us-ascii?q?QGBVAQBAQsBgmkDfyeDeZQWgWAIJRSOI4p3EgEBGA0GAYFLhwciNwYNAQMBAQE?=
 =?us-ascii?q?BAQECARMBAQEIDQkIKSMMgjYkAYJiAQIDAQIgDwENAQE3AQUJAQEKGAICJgICA?=
 =?us-ascii?q?zEBBQEcBg0GAgEBAQSDGAGCAQQBCptXPIodcIEvgnYBAQWBMAGBEoRQCBJ5iWK?=
 =?us-ascii?q?BHIFXP4ERJwyCX4MQCwICGIRLgleHUoFTll8HAoIcBIN7YYotBhiBWU2EPoJtE?=
 =?us-ascii?q?IcnLI0XikYCBAIEBQIFDyGBO4F3Mxowgy8JghIMF4NKhRSFPz8yAQGBAwEBjCI?=
 =?us-ascii?q?BAQ?=
X-IPAS-Result: =?us-ascii?q?A0BQAAAtmvdbh0O0hNFiHAEBAQQBAQcEAQGBVAQBAQsBgmk?=
 =?us-ascii?q?DfyeDeZQWgWAIJRSOI4p3EgEBGA0GAYFLhwciNwYNAQMBAQEBAQECARMBAQEID?=
 =?us-ascii?q?QkIKSMMgjYkAYJiAQIDAQIgDwENAQE3AQUJAQEKGAICJgICAzEBBQEcBg0GAgE?=
 =?us-ascii?q?BAQSDGAGCAQQBCptXPIodcIEvgnYBAQWBMAGBEoRQCBJ5iWKBHIFXP4ERJwyCX?=
 =?us-ascii?q?4MQCwICGIRLgleHUoFTll8HAoIcBIN7YYotBhiBWU2EPoJtEIcnLI0XikYCBAI?=
 =?us-ascii?q?EBQIFDyGBO4F3Mxowgy8JghIMF4NKhRSFPz8yAQGBAwEBjCIBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,268,1539673200"; 
   d="scan'208";a="52351005"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 22 Nov 2018 22:15:27 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2502031AbeKWQ6K (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Fri, 23 Nov 2018 11:58:10 -0500
Received: from mail-wm1-f65.google.com ([209.85.128.65]:34654 "EHLO
        mail-wm1-f65.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S2387519AbeKWQ6K (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 23 Nov 2018 11:58:10 -0500
Received: by mail-wm1-f65.google.com with SMTP id y185so6859307wmd.1
        for <linux-kernel@vger.kernel.org>; Thu, 22 Nov 2018 22:15:22 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google;
        h=subject:to:cc:references:from:message-id:date:user-agent
         :mime-version:in-reply-to:content-language:content-transfer-encoding;
        bh=VTds35J0GFouJcnffD/GEMrn0+Sw7JBPNZKSRDaR6f4=;
        b=AZfztxBil9zDO5VkPwgWtbooLrgnW1HswAOSk0gPIrY69+9/wP5gYCwJCnFFW4kky1
         jQHnRRj5WBhZOPL+DcHtXfYAEQDItsOlgmOVgal9NrUPddq6Z1EtqVax2PQz2z2r+hd8
         eJVxoUCxKe/KPxsKEO4OWmZWFNcZxkW+1TLZk=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:subject:to:cc:references:from:message-id:date
         :user-agent:mime-version:in-reply-to:content-language
         :content-transfer-encoding;
        bh=VTds35J0GFouJcnffD/GEMrn0+Sw7JBPNZKSRDaR6f4=;
        b=bqlIznkNbeyhzG2J6aYydl+ZUN0xDNVyIeEYINUEPFgCWLZ5gfSfGyfDHvty2Kt3yp
         bA2A0k+l/0enAH1rNhToSOY1J6SAIw/PivbUjG3XEviYMa8+hCfmZfjRHC/sr6C9Bc/R
         09JYjl2K6RSZ34AP6amxm6jfOYB0f1Au7KCIsTk0Jc32KZsQmow92CdS12PZ2C9FxVuC
         FsEsO0j3Um85oaJlorspCOpel675Gpnw4zenQknzVO0YVTh2irkEVPXPuZn/80DxwzJf
         7k8zb4hrzlR4Yfrl357/KuR1qz6NVAZF4ls8XXhFv7vF1JbBEAgUZjysDnR41t6DPx3j
         WMsA==
X-Gm-Message-State: AA+aEWblHyFW9QumHQKs96TBCnVPzorLGmW2dLtzmtUzlkevUTgpb5kY
        Pn5O59BXnB7lIPprp/cWyYs0nA==
X-Google-Smtp-Source: AJdET5c2RM0pCfzH23sEPnvsr8lBHJ87u7OL8nrE8MIB1fm48mOCLzZrIGts7zxDAjyQ8uEgE9Kd+w==
X-Received: by 2002:a7b:c315:: with SMTP id k21mr11872552wmj.145.1542953721926;
        Thu, 22 Nov 2018 22:15:21 -0800 (PST)
Received: from [192.168.0.40] (44.65.136.77.rev.sfr.net. [77.136.65.44])
        by smtp.googlemail.com with ESMTPSA id w18sm14428089wru.54.2018.11.22.22.15.20
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Thu, 22 Nov 2018 22:15:20 -0800 (PST)
Subject: Re: [PATCH v2 0/2] clocksource/meson6_timer: implement ARM delay
 timer
To: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
Cc: linux-amlogic@lists.infradead.org, linux-kernel@vger.kernel.org,
        tglx@linutronix.de, linux-arm-kernel@lists.infradead.org
References: <20181115224657.14736-1-martin.blumenstingl@googlemail.com>
 <5ff1a888-cce2-8fd8-a98e-14c3d7c33acf@linaro.org>
 <CAFBinCDSLEAzJVVgFxKhN3LCUwgC3Rrr=4ZhtHCdvqEPBLWbJA@mail.gmail.com>
From: Daniel Lezcano <daniel.lezcano@linaro.org>
Message-ID: <a83b92fb-5950-01b8-521d-7b05939dce3a@linaro.org>
Date: Fri, 23 Nov 2018 07:15:19 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.2.1
MIME-Version: 1.0
In-Reply-To: <CAFBinCDSLEAzJVVgFxKhN3LCUwgC3Rrr=4ZhtHCdvqEPBLWbJA@mail.gmail.com>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 8bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On 22/11/2018 23:12, Martin Blumenstingl wrote:
> Hi Daniel,
> 
> On Sun, Nov 18, 2018 at 2:27 AM Daniel Lezcano
> <daniel.lezcano@linaro.org> wrote:
>>
>> On 15/11/2018 23:46, Martin Blumenstingl wrote:
>>> While trying to add support for the ARM TWD Timer and the ARM Global
>>> Timer on Meson8, Meson8b and Meson8m2 (ARM Cortex-A5 and Cortex-A9 SoCs)
>>> I did a review of the existing driver.
>>> Unfortunately I found it hard to review because the pre-processor
>>> #defines did not match the names from the public S805 datasheet. Thus
>>> patch #1 adjusts these. No functional changes here, this is just
>>> preparation work for patch #2.
>>>
>>> Using the ARM Global Timer (drivers/clocksource/arm_global_timer.c)
>>> would have given us a timer-based delay implementation (so udelay() and
>>> friends would use the timer instead of using a loop-based delay
>>> implementation). Unfortunately we can't use the ARM Global Timer yet
>>> because it's input clock is derived from the CPU clock (which can change
>>> once we enable CPU frequency scaling on these SoCs, for which I will be
>>> sending patches in the near future).
>>> Amlogic's 3.10 kernel uses Timer E as delay timer which (with the
>>> current configuration) has a resolution of 1us. So patch #2 uses
>>> register_current_timer_delay() to register Timer E as ARM delay timer
>>> (which will be especially useful as we have to use udelay() when
>>> changing the CPU clocks during DVFS).
>>>
>>>
>>> Changes since v1 at [0]:
>>> - convert the enums for the input clock (meson6_timera_input_clock and
>>>   meson6_timere_input_clock) to simple #defines as these are register
>>>   values and not something driver-internal. All other register values
>>>   are #defines so it makes sense that these are #defines as well.
>>>
>>>
>>> [0] https://patchwork.kernel.org/cover/10658591/
>>>
>>>
>>> Martin Blumenstingl (2):
>>>   clocksource: meson6_timer: use register names from the datasheet
>>>   clocksource: meson6_timer: implement ARM delay timer
>>>
>>>  drivers/clocksource/meson6_timer.c | 128 +++++++++++++++++++----------
>>>  1 file changed, 85 insertions(+), 43 deletions(-)
>>
>> Both applied, thanks!
> thank you for taking my patches
> 
> I have one question more: can you please push these patches to a
> repository/branch which is included in -next?
> I'm asking because I'd like to send patches that enable CPU frequency
> scaling on Meson8, Meson8b and Meson8m2. The code to change the CPU
> clock calls udelay(), which (in this special case) needs a delay timer
> to work properly (we can't use jiffies as we're using udelay() *while*
> changing the CPU clock).

branch pushed [1], should appear in linux-next very soon.

  -- Daniel

[1]
https://git.linaro.org/people/daniel.lezcano/linux.git/log/?h=clockevents/next


-- 
 <http://www.linaro.org/> Linaro.org │ Open source software for ARM SoCs

Follow Linaro:  <http://www.facebook.com/pages/Linaro> Facebook |
<http://twitter.com/#!/linaroorg> Twitter |
<http://www.linaro.org/linaro-blog/> Blog

