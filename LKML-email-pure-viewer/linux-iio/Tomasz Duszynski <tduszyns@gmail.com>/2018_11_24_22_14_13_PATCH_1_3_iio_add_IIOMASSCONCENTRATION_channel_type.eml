Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 25 Nov 2018 14:42:53 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga002.jf.intel.com (orsmga002.jf.intel.com [10.7.209.21])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 998DF5803C2;
	Sat, 24 Nov 2018 14:15:15 -0800 (PST)
Received: from fmsmga101.fm.intel.com ([10.1.193.65])
  by orsmga002-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 24 Nov 2018 14:15:14 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AHiEa/BJnQtlFd+5T8NmcpTZWNBhigK39O0sv0rFi?=
 =?us-ascii?q?tYgULvzyrarrMEGX3/hxlliBBdydt6oUzbKO+4nbGkU4qa6bt34DdJEeHzQksu?=
 =?us-ascii?q?4x2zIaPcieFEfgJ+TrZSFpVO5LVVti4m3peRMNQJW2aFLduGC94iAPERvjKwV1?=
 =?us-ascii?q?Ov71GonPhMiryuy+4ZLebxlLiTanfb9+MAi9oBnMuMURnYZsMLs6xAHTontPde?=
 =?us-ascii?q?RWxGdoKkyWkh3h+Mq+/4Nt/jpJtf45+MFOTav1f6IjTbxFFzsmKHw65NfqtRbY?=
 =?us-ascii?q?UwSC4GYXX3gMnRpJBwjF6wz6Xov0vyDnuOdxxDWWMMvrRr0yRD+s7bpkSAXwhS?=
 =?us-ascii?q?kHKTA37W/ZhM93gq1ZrhKuqBNxw5XMYIyXL/dyYqDQcMkGSWdbQspdSypMCZ68?=
 =?us-ascii?q?YYsVCOoBOP5VoZf6p1sLtxS+HgitD/7hxD9VnX/33K070+I6EQHF3QwrAtUDsG?=
 =?us-ascii?q?jJo9XoL6cTUOC0zK/TzTjYYPNW3C3y6InMchw7vf6MWrdwfNPXxEIyFA3Flk2d?=
 =?us-ascii?q?pZL5Mz6RzOgBrmaW4/R6We6yiGMrtxt9rzmty8s0iYTEgpgZx1LY+Slj3oo5O9?=
 =?us-ascii?q?y1RFR5bNK4FpZbqjuUOJFsQsw4RmFloCY6xaMCuZ68ZCUK1psnyADFa/CdcIiH?=
 =?us-ascii?q?/AjjVOCPLjd8nn5lf6i/hxmq/UihzO3zSNW03U5UoiZZltTArG0B2hLN5sSdV/?=
 =?us-ascii?q?dw/Vut1SyO2g3R8u1EJFo7lavfK54v2L4wkZ8TvFzHHi/3nkX2kaCXelwn+ue2?=
 =?us-ascii?q?8eTnZKvpppuFO49zhAD+NLohmtakDOQmPQgBQXKb9f6/1LL95035RqtFjvksnq?=
 =?us-ascii?q?neqpDaKtwXprSlDA9NzoYj9xG/Ai+i0NQZnnkIMkhJeR2aj4XyP1HOIfb4Deqw?=
 =?us-ascii?q?gli2kTdrwezGMaPlApnXMnfDl7Lhd65n60FA0Aoz0cxf55VMB7EBOv3zW1Pxu8?=
 =?us-ascii?q?bfDhMjMwy03vzoCNNy1o4FXWKPA6mZML7dsFOS5+IvJfWMa5ERuDrnN/cl4Pvu?=
 =?us-ascii?q?h2cjmVABZampwYcXaHegE/RkJEWWf2DggtQGEWcMuAo+S/fniFmDUT5VenazUL?=
 =?us-ascii?q?gw5jA9CIK6E4jDQpqhj6CG3Ce+BpdWfHxJCkiQEXf0cIWJQ+0DaDmSIs9mkTwI?=
 =?us-ascii?q?T6KhRJUj1Ry1sA/6yrxnLvfb+yECtJLj0sR16PPXlR0o6TN0CMGd2XmXT25ohm?=
 =?us-ascii?q?MIWyM23KdnrEx+0FiD17J0g/hZFdNJ4fNJXRw3NZrdz+x8FtDzVRjNftaPSFa6?=
 =?us-ascii?q?XNqmBSs9Qc42w98Le0x9Acmtjgjf3yq2BL8Yj6GEC4Yq8q3CxXTxJ9xyy3Dd1K?=
 =?us-ascii?q?Y/iVkqRc9PNW6jhq577AXTA4/Jk0OEl6elb6gc3SjN9HudwmqKpk1XTAlwUaDd?=
 =?us-ascii?q?V3AFekTWtcj55l/FT7K2FLsoKBVBxtCYJqtKcNLpi05GS+nlONnFZ2KxmmGwBQ?=
 =?us-ascii?q?uHx7+WbYrqfXkd0zvZCEQejw8T+nOGPxAkBii9u2LeECBuFVX3bkPw8Ol+rXS7?=
 =?us-ascii?q?TlM0zwCKdUFhy6C5+hkPhfyYSvMT2L0EtTwlqzV1Gla9wt3XB8CBpwpnYKVTf9?=
 =?us-ascii?q?c97E1b2mLesgx3JoagILx6hl4CbwR3uFvj2A9zCopensklsnMrwBBpJqKFzVxO?=
 =?us-ascii?q?bTWY3ZP3Or3JMWTy+BGva6jL2lDRytqW+6EP6OgmpFXnpg2mCk0i83B/2dlPz3?=
 =?us-ascii?q?Sc/onKDBYVUZ/pUkc36gJ2qK3Abig854Pbz3tsMaavvz/G2tIpAvYlyxm6c9de?=
 =?us-ascii?q?NqOECBH9E8kAC8eyL+wqnkCjbggYM+BK6K40I8SmeuOc2K6qIOlvhiimgnlA4I?=
 =?us-ascii?q?xn1EKD6TB8Su/R05kZ2f6Y2haIWCnmjFemtMD6goREZTAUHmqixinoHo9RZqtu?=
 =?us-ascii?q?fYkVDWeiOdG4xtJ7h5T1QX5X6EajB08a2M+uYReTb1390RdQ1EgNunynhC24wi?=
 =?us-ascii?q?dwkzEoqKqfwSPPz/7jdBoBJm5EWm1igU3wLoizitAQRFKoYBQxlBu5+Ub6wLBW?=
 =?us-ascii?q?pKZlIGnJQkdIfC/2I3t5UqSqtbqCYM9P6JU2viVRS+m8ZVGaSrjgoxoVyS/jHm?=
 =?us-ascii?q?1exCwleDGuoJn2gxt6iGeFJnZpsHXZYd1wxQvY5NHERf9exD0GSDN6iTnWAFix?=
 =?us-ascii?q?JN2p/dSSl5feveGyTWOhVptPcSb1yYOMrje05WpvARenhfC8hsXnERQm0S/8z9?=
 =?us-ascii?q?RqVj/HrBfmbonryqS1K+RnfkZzCV/46sp6HJx+k4QqiJER33gamoua/X4dnWjv?=
 =?us-ascii?q?NtVb3Lr0bGARSj4T397V/A/l1VVmLnKIxIL2TG+Rw8V/aNmhfmMZxDg94NtUB6?=
 =?us-ascii?q?eO47xJhi91olu+rQLMbvlxhDYdyf0y6HEEh+EFohYiziKYAroKB0lXITTslwiU?=
 =?us-ascii?q?79C5tKhXeGGvcb2q2Et/h9+hCqyCohpHWHb4YZoiGS5w7sNiMFPDynHz64fkeM?=
 =?us-ascii?q?XOYtIXrBGbjxDAj+1NIpIrivUKnTZnOX76vXA90OE0lxtu3ZWnvISdL2Vt4bm0?=
 =?us-ascii?q?AhpZNj3zesMS9SvhjadYnsaKwY+vGo9tFSkMXJvtVfioCi4dtez7NwaSFz0xsn?=
 =?us-ascii?q?WbFqDaHQCB80dqtW7PH4qoN3GKJ3kZ0NNiSwOGJEFEhAAUXTM6noM2Fwywxczh?=
 =?us-ascii?q?dlt56S4V5lLithRMzedoPQHlUmjDvAeodis0SJ+HIRtW6QFC+l7VMdGE4eJ1BS?=
 =?us-ascii?q?1Y5ZqhrAqCKmGAYwRIDGcJWlGLBlz5P7mu48XA/PacBuakM/TOZrCOo/REV/iU?=
 =?us-ascii?q?3ZKvzpdm/zGUO8WPIHZiDv472klCXXxjGMTZgTIPSyMJmCLXcs6bvwyx+il2rs?=
 =?us-ascii?q?C57fTqVxjj5YqJC7tOL9pv/wq6jruEN+6VnCx5MypX1osQxX/Uz7gSxEQdizx1?=
 =?us-ascii?q?eDm3D7sBtTTBTKbRmqJMCx4baiVzNNZH7q4m3wlNP9Lbhc3x1rJikvE1DFJFX0?=
 =?us-ascii?q?T7ms61fcwKP329NFTfCUaXNbSGICfHzN3tbaygSb1fkuNUuga0uTaaFU/jIzuC?=
 =?us-ascii?q?myPoVxCpLeFDkiWbMAZCt4G6dxZnEXLjQ87+ah2nLN93iiU7wL0uiXPMMG4cMD?=
 =?us-ascii?q?58fFtMr72Q9yxYhPp/FndF7npkK+mEhimY4/PZKpYQrftkHCB0m/hG73Q9zrsG?=
 =?us-ascii?q?pB1DEfh0njbC699vpHm4neSVjDlqShxDrnBMno3Yk19lPPDl8ZxJQmSM0A8W/3?=
 =?us-ascii?q?SWEBcL7495BsD0qbFW0fDAkavyLHFJ9NeCrphUPNTdNM/SaClpChHuAjOBVAY?=
 =?us-ascii?q?=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AjAAAczflbh0O0hNFjHgEGBwaBUQkLA?=
 =?us-ascii?q?YFaghEnjHCNQokGA4kohHeBcxIBARgTAYhaIjQJDQEDAQEBAQEBAgETAQEBCA0?=
 =?us-ascii?q?JCCkjDII2IoJlAwMBAi8BDQEbHQEDAgkBAQUQKRIDHgIRAQUBHBkFglFLgWkBA?=
 =?us-ascii?q?wgNBAGbJzyMHwUBF4J3BYQuChknDVqBNwIGEodMgw+BHBeBQD+GeYFxhhICn1Q?=
 =?us-ascii?q?uCY4EgyALGIlRhzcsjiGJPAIEAgQFAgUPIYElgg1NIxVsgjuCG4NtilM/MoEFA?=
 =?us-ascii?q?QGJOoJNAQE?=
X-IPAS-Result: =?us-ascii?q?A0AjAAAczflbh0O0hNFjHgEGBwaBUQkLAYFaghEnjHCNQok?=
 =?us-ascii?q?GA4kohHeBcxIBARgTAYhaIjQJDQEDAQEBAQEBAgETAQEBCA0JCCkjDII2IoJlA?=
 =?us-ascii?q?wMBAi8BDQEbHQEDAgkBAQUQKRIDHgIRAQUBHBkFglFLgWkBAwgNBAGbJzyMHwU?=
 =?us-ascii?q?BF4J3BYQuChknDVqBNwIGEodMgw+BHBeBQD+GeYFxhhICn1QuCY4EgyALGIlRh?=
 =?us-ascii?q?zcsjiGJPAIEAgQFAgUPIYElgg1NIxVsgjuCG4NtilM/MoEFAQGJOoJNAQE?=
X-IronPort-AV: E=Sophos;i="5.56,275,1539673200"; 
   d="scan'208";a="63804392"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mga01b.intel.com with ESMTP; 24 Nov 2018 14:14:55 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726580AbeKYJEF (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sun, 25 Nov 2018 04:04:05 -0500
Received: from mail-lj1-f193.google.com ([209.85.208.193]:37965 "EHLO
        mail-lj1-f193.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726317AbeKYJEE (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 25 Nov 2018 04:04:04 -0500
Received: by mail-lj1-f193.google.com with SMTP id c19-v6so13357405lja.5;
        Sat, 24 Nov 2018 14:14:36 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=from:to:cc:subject:date:message-id:in-reply-to:references
         :mime-version:content-transfer-encoding;
        bh=yCtBduGV4B1E1QfmnGTbr9pPcIEi4Z8uiLxVSHUATEY=;
        b=uaX2cJ8jR89J/vIbthqKpO/SCmxkg17OzwEn6bIgahoPqUfE8pGRhdoZFjfBaZQdem
         g6dawmC5mXH3KoTmNj7KbIGSkJDlZvtFx+rWii4JmlZpwtProoIFydmsJO4y3UsQvxWt
         IxBAuSp5IXqHuMUh7a/1GhtvHugykSFDFBlPxKwUBn+cLdiGRqPE/AVl49X2pMVuJPL6
         V2ycLS7/4XAAuPSxIEdT6USGnD9mQEF5plct6mraxF/iqhsY5AP6mTjE2Hu5xBAi4L4G
         q3K01o5WnT3x6o49fH0dw68ooHrK6WmIdoFMNkYlfNd8rgHYDVP7vHM2Pv6+OHyTlWL1
         JCCw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
         :references:mime-version:content-transfer-encoding;
        bh=yCtBduGV4B1E1QfmnGTbr9pPcIEi4Z8uiLxVSHUATEY=;
        b=j1kZiO11Ypbg+Eat8LnFVNEF1CaMtdaPbzmVvXXUzobkCUgXmjaiidms2Vn+r2TLr+
         PoQcGsX1YPPZoZFu6PlQiSNhjMSrJKQOliTwQIfJWDQTeEMbu9IncUJlS4dl+tzvD34H
         8JLG+qmLTRZFPGgu91aVChTe0IWQNUP8Btx5q+gUwwb0RwT9nazE3DeeWy1rjgOA0Hgn
         Md8wQx+ORWgU0Ic6gYThXfuGNgzndwx84vns6/K+DrsCnd29SA5fOtr/UMJ55Eayd9OV
         v8uIDhftItAs8kWPnJFUn7hRIqFegx91DtHVeW6gcnuqVl+uXZ2mTYVVXo+tvfN81kps
         oILw==
X-Gm-Message-State: AA+aEWaOO+6JWgF2h7GmCC3ZN3uMnmrAC/g1pO44q2Fmpy0HF2Bn9A6l
        OBOwUTRcAxMkFu9SZkdkmmhMgyX61HI=
X-Google-Smtp-Source: AFSGD/VEFaUyMM9OcAkI6LFl3NP/CMa+QQk1y73CjWU8ycaM0imC6KQXtpI1wz5bb1ATvXLoLaSZPA==
X-Received: by 2002:a2e:6503:: with SMTP id z3-v6mr12939024ljb.153.1543097675219;
        Sat, 24 Nov 2018 14:14:35 -0800 (PST)
Received: from arch.domain.name (89-70-226-70.dynamic.chello.pl. [89.70.226.70])
        by smtp.gmail.com with ESMTPSA id x16sm8369281lff.26.2018.11.24.14.14.34
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Sat, 24 Nov 2018 14:14:34 -0800 (PST)
From: Tomasz Duszynski <tduszyns@gmail.com>
To: linux-iio@vger.kernel.org
Cc: linux-kernel@vger.kernel.org, devicetree@vger.kernel.org,
        Tomasz Duszynski <tduszyns@gmail.com>
Subject: [PATCH 1/3] iio: add IIO_MASSCONCENTRATION channel type
Date: Sat, 24 Nov 2018 23:14:13 +0100
Message-Id: <20181124221415.10081-2-tduszyns@gmail.com>
X-Mailer: git-send-email 2.19.2
In-Reply-To: <20181124221415.10081-1-tduszyns@gmail.com>
References: <20181124221415.10081-1-tduszyns@gmail.com>
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Measuring particulate matter in ug / m3 (micro-grams per cubic meter)
is de facto standard. Existing air quality sensors usually follow
this convention and are capable of returning measurements using
this unit.

IIO currently does not offer suitable channel type for this
type of measurements hence this patch adds this.

In addition, two modifiers are introduced used for distinguishing
between coarse (PM10) and fine particles (PM2p5) measurements, i.e
IIO_MOD_PM10 and IIO_MOD_PM2p5.

Signed-off-by: Tomasz Duszynski <tduszyns@gmail.com>
---
 Documentation/ABI/testing/sysfs-bus-iio | 11 ++++++++++-
 drivers/iio/industrialio-core.c         |  3 +++
 include/uapi/linux/iio/types.h          |  3 +++
 tools/iio/iio_event_monitor.c           |  6 ++++++
 4 files changed, 22 insertions(+), 1 deletion(-)

diff --git a/Documentation/ABI/testing/sysfs-bus-iio b/Documentation/ABI/testing/sysfs-bus-iio
index 8127a08e366d..ce0ed140660d 100644
--- a/Documentation/ABI/testing/sysfs-bus-iio
+++ b/Documentation/ABI/testing/sysfs-bus-iio
@@ -1684,4 +1684,13 @@ KernelVersion:	4.18
 Contact:	linux-iio@vger.kernel.org
 Description:
 		Raw (unscaled) phase difference reading from channel Y
-		that can be processed to radians.
\ No newline at end of file
+		that can be processed to radians.
+
+What:		/sys/bus/iio/devices/iio:deviceX/in_massconcentration_pm2p5_input
+What:		/sys/bus/iio/devices/iio:deviceX/in_massconcentrationY_pm2p5_input
+What:		/sys/bus/iio/devices/iio:deviceX/in_massconcentration_pm10_input
+What:		/sys/bus/iio/devices/iio:deviceX/in_massconcentrationY_pm10_input
+KernelVersion:	4.21
+Contact:	linux-iio@vger.kernel.org
+Description:
+		Mass concentration reading of particulate matter in ug / m3.
diff --git a/drivers/iio/industrialio-core.c b/drivers/iio/industrialio-core.c
index a062cfddc5af..2a9ef600c1fb 100644
--- a/drivers/iio/industrialio-core.c
+++ b/drivers/iio/industrialio-core.c
@@ -87,6 +87,7 @@ static const char * const iio_chan_type_name_spec[] = {
 	[IIO_GRAVITY]  = "gravity",
 	[IIO_POSITIONRELATIVE]  = "positionrelative",
 	[IIO_PHASE] = "phase",
+	[IIO_MASSCONCENTRATION] = "massconcentration",
 };
 
 static const char * const iio_modifier_names[] = {
@@ -127,6 +128,8 @@ static const char * const iio_modifier_names[] = {
 	[IIO_MOD_Q] = "q",
 	[IIO_MOD_CO2] = "co2",
 	[IIO_MOD_VOC] = "voc",
+	[IIO_MOD_PM2p5] = "pm2p5",
+	[IIO_MOD_PM10] = "pm10",
 };
 
 /* relies on pairs of these shared then separate */
diff --git a/include/uapi/linux/iio/types.h b/include/uapi/linux/iio/types.h
index 92baabc103ac..465044b42af5 100644
--- a/include/uapi/linux/iio/types.h
+++ b/include/uapi/linux/iio/types.h
@@ -46,6 +46,7 @@ enum iio_chan_type {
 	IIO_GRAVITY,
 	IIO_POSITIONRELATIVE,
 	IIO_PHASE,
+	IIO_MASSCONCENTRATION,
 };
 
 enum iio_modifier {
@@ -87,6 +88,8 @@ enum iio_modifier {
 	IIO_MOD_VOC,
 	IIO_MOD_LIGHT_UV,
 	IIO_MOD_LIGHT_DUV,
+	IIO_MOD_PM2p5,
+	IIO_MOD_PM10,
 };
 
 enum iio_event_type {
diff --git a/tools/iio/iio_event_monitor.c b/tools/iio/iio_event_monitor.c
index ac2de6b7e89f..f0fcfeddba2b 100644
--- a/tools/iio/iio_event_monitor.c
+++ b/tools/iio/iio_event_monitor.c
@@ -60,6 +60,7 @@ static const char * const iio_chan_type_name_spec[] = {
 	[IIO_GRAVITY] = "gravity",
 	[IIO_POSITIONRELATIVE] = "positionrelative",
 	[IIO_PHASE] = "phase",
+	[IIO_MASSCONCENTRATION] = "massconcentration",
 };
 
 static const char * const iio_ev_type_text[] = {
@@ -115,6 +116,8 @@ static const char * const iio_modifier_names[] = {
 	[IIO_MOD_Q] = "q",
 	[IIO_MOD_CO2] = "co2",
 	[IIO_MOD_VOC] = "voc",
+	[IIO_MOD_PM2p5] = "pm2p5",
+	[IIO_MOD_PM10] = "pm10",
 };
 
 static bool event_is_known(struct iio_event_data *event)
@@ -156,6 +159,7 @@ static bool event_is_known(struct iio_event_data *event)
 	case IIO_GRAVITY:
 	case IIO_POSITIONRELATIVE:
 	case IIO_PHASE:
+	case IIO_MASSCONCENTRATION:
 		break;
 	default:
 		return false;
@@ -200,6 +204,8 @@ static bool event_is_known(struct iio_event_data *event)
 	case IIO_MOD_Q:
 	case IIO_MOD_CO2:
 	case IIO_MOD_VOC:
+	case IIO_MOD_PM2p5:
+	case IIO_MOD_PM10:
 		break;
 	default:
 		return false;
-- 
2.19.2

