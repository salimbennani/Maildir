Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 24 Nov 2018 12:37:24 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga003.jf.intel.com (orsmga003.jf.intel.com [10.7.209.27])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 6EB0358037D;
	Fri, 23 Nov 2018 12:24:43 -0800 (PST)
Received: from orsmga103.jf.intel.com ([10.7.208.35])
  by orsmga003-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 12:24:43 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3ARA+nshaE11OjGFqPL5toi2z/LSx+4OfEezUN459i?=
 =?us-ascii?q?sYplN5qZpcm8YB7h7PlgxGXEQZ/co6odzbaO4+a4ASQp2tWoiDg6aptCVhsI24?=
 =?us-ascii?q?09vjcLJ4q7M3D9N+PgdCcgHc5PBxdP9nC/NlVJSo6lPwWB6nK94iQPFRrhKAF7?=
 =?us-ascii?q?Ovr6GpLIj8Swyuu+54Dfbx9HiTahYr5+Ngm6oRnMvcQKnIVuLbo8xAHUqXVSYe?=
 =?us-ascii?q?RWwm1oJVOXnxni48q74YBu/SdNtf8/7sBMSar1cbg2QrxeFzQmLns65Nb3uhnZ?=
 =?us-ascii?q?TAuA/WUTX2MLmRdVGQfF7RX6XpDssivms+d2xSeXMdHqQb0yRD+v9LlgRgP2hy?=
 =?us-ascii?q?gbNj456GDXhdJ2jKJHuxKquhhzz5fJbI2JKPZye6XQds4YS2VcRMZcTzFPDJ2y?=
 =?us-ascii?q?b4UPDOQPM+hXoIb/qFQSohW+HhGsCeH0xz9UhHL7x7E23/gvHAzE2gErAtIAsG?=
 =?us-ascii?q?7TrNXwLKocTee1w7LVxjvFdfxW3yry6IzWfREhvPqBWqhwcc3KxkQ0EwPKlFOQ?=
 =?us-ascii?q?ppHhPzyL1uUBqW6b4PR8Ve+2jWMstg9/oj+qxsg2i4nJgJoYylTH9SV8xIY5P9?=
 =?us-ascii?q?q4SFR0YdK8C5RQqjqaNottTcMlTGBkoiA6xaMauZKjfygF1o4nxxjBZPyDaYSI?=
 =?us-ascii?q?5QjjVOmJLTd8inNlfqizhxCs/ki8zOD3S8q60E5SoyZbjtXBsmoB2wHd58SZUP?=
 =?us-ascii?q?dx40Ss1SqV2w3S6OxIOUQ5mKvBJ5MgwLM8jIcfvEfBEyPsmkj6kKmbfVg+9Oey?=
 =?us-ascii?q?8eToeLDmq4ecN4BqjgH+NbwjmtKwAesmKAgCRWub9vqm1L3l40L5RK9Gjvoskq?=
 =?us-ascii?q?nWqJzaJMIbqbClAwJNzIov9xKyAy273NkWg3ULNk9JdRGbg4TzOlzDIuj0DfKl?=
 =?us-ascii?q?jFStlDdryerGPrrkApjVKnjDkbHhfaty6kJFywo808pf55RKBbEFOf7zXUHwtN?=
 =?us-ascii?q?rGAR8jKAG03ennB8tn1o8EWmKAHLWZMKXMvl+M/O4vJPOMZIANtDbnN/cl/+Lu?=
 =?us-ascii?q?jWM+mVIFeamp3JgXZ26iEvVpPkWUen7sgtYHEWcXsQsyVu3qiFueUTFNY3a+Rb?=
 =?us-ascii?q?4z5jY+CIi+F4fMWpitgKCd3Ce8BpBWZnpJClGQEXjycIWIQfcMaD+ILc9nnTwJ?=
 =?us-ascii?q?TryhS44n1RGzuw720btnLuzI+iIGsZLvzsR65+rWlRsq7zx7E9yd032RT2Fzhm?=
 =?us-ascii?q?4IRTg2075lrUx+zVeD1654g/tDGNxX5vNJVBo6NJHGw+x7DdDyRhzOftOTRFm6?=
 =?us-ascii?q?RdWmBCk7TsgtzN8Wf0Z9B9KigwjZ0CqxA78VkL+LCIYu8q3G3Xj8PMJ9y3fA1K?=
 =?us-ascii?q?k8gFgqWMpPNWu6hqFh8wjfHZLGk0Kcl6yyb6QTwDbN9HufzWqJpExYUxR/UaPf?=
 =?us-ascii?q?UXAbZ0vZt9L55kzZQr+qCLQnNBZByMGYJqtLbN3pkUtJRPP5NNvCZGKxnn+6BQ?=
 =?us-ascii?q?yUybOUcIrqZ2Id0T3AB0cejQAc42yKNQgkCSenuGLREjpuGVXrY0Pv9Ol+rGi2?=
 =?us-ascii?q?Tks1zwGMck1g2KC5+h8ThfyAVfwT2qgItzsmqzVxBFy9xc7ZC8Kcpwp9e6VRec?=
 =?us-ascii?q?4y701Z1W3HrQB9PoavL6Z5hlEAdQR6pEfu1xRxCoVdnskmtnIqzAxuKa2G1FNN?=
 =?us-ascii?q?bS+X3Zf1OrfPMGn94Aiva7LK2lHZyNuW5qYP6PE/q1X/vAGoFlAu82l939lSyX?=
 =?us-ascii?q?uc4pTKDAwdUZ/qVkY39h56p6zVYyUn5oPU02FsPrewsjPYx90pA+4lwA66f9hD?=
 =?us-ascii?q?KKOECBPyE8oCCse0LOwlhVeoYQwEPexI76E0It6peOGA2K6oO+ZggimrjWBG4I?=
 =?us-ascii?q?B7z0KN+DBwSu/O35YZ3f6Y2hGLWCv7jFekqsr3g5xLZSkOHmqjzijpHI5QZrBo?=
 =?us-ascii?q?cYkXE2uvIs23yc94h57iQHNY8F+jB1Ub2M6mYxaSblr93RFO2kQTu3CohSy4zz?=
 =?us-ascii?q?lsmTEzsqWfxDDOw/jldBcfIG5LRXVtgk32IYepiNAWRk6oYBYzlBuk/Er127JU?=
 =?us-ascii?q?pKBiIGbNW0dIeC72InpmUquxsLqCfsFO5IkpsSVRTOSzf1SaRqThrBsd1iPpB3?=
 =?us-ascii?q?FeyywjdzG2ppX5mAR3iWKcLHpprHvVY9pwxQrZ5NHHQf5R3zwGRDR3iDXNB1i8?=
 =?us-ascii?q?OcWp8suQl5vZru++UGehXIVJcSb31YOAqDe75WpyDB29hf+zgN7nEQs90SPhzN?=
 =?us-ascii?q?llTybIrBX9Yontyau6N/lqfk1pBF/69sp7FZtykoo2hJEMx3cago+Z8mYAkWf2?=
 =?us-ascii?q?Kd9bw77xbGIRRT4XxN7Y+Ajk11dkLn6TxYL5V3Odz9BlZ9m7ZGMWxy0849pLCK?=
 =?us-ascii?q?eS8LxLgy91rkCkogLWZPh3hi0dxuc26H4Gn+EJvxIgziaHDbATB0VYPTHsmA6O?=
 =?us-ascii?q?79Cxt6hXYGevcb6t1Etxh9yhDbeCoh1CV3b9YJstAShw7sBnOlLWzHLz8p3keM?=
 =?us-ascii?q?XXbd8Lsx2UkhTAgPJPJJM/iPUKnjZnNnznvXI+1eE7lxNu0Iq+vIiGLWVt4a24?=
 =?us-ascii?q?DgRZNj3ze8Mc5DXtgbxCkcaR2oClBo9hFSkTXJv0UfKoFyoftejgNwaLCjE9q2?=
 =?us-ascii?q?2UGbzCHQ+E80dmrmnCE5SqN3GROXkYws9uRBibJExDng8UWC82kYI+FgCv3Mbh?=
 =?us-ascii?q?alt25igN5l7krRtB0vlnOAP4UmfbuQekcDM0SIWEIRpS7wFC4VrVMMOE4uJyGS?=
 =?us-ascii?q?FY4oOurAiXJmOHYARICHkDWlaYCFD7Irmu+d7A/vCaBuWkKvvBf66OpfZCV/uS?=
 =?us-ascii?q?xpKvz4hm/yuKNsqVJXlvFPk72ktFXXBkFMXVgTQPSyoLly3Ta86Xvguz+ipyrs?=
 =?us-ascii?q?qn6vTkRBrv5ZeTC7tVKdhu+xe2gbqaN+6Nnil5LyxU1ogLxX/Ox7gSx1oSiyBo?=
 =?us-ascii?q?dzmwHrUMry/NTKTMmqBJCx4XcT98NMxN76gkxAlCJdbbis/p1r5/lvM1C0lKVV?=
 =?us-ascii?q?3imsGqZMwGOWK9NEnABEaEKruGPyDLw9rsbKO4SL1QivhUthKqtTaaFU/jIiqM?=
 =?us-ascii?q?lz3zWx+zNuFMiTmRPAZCt4GlbhZtFW/jQcr8ZR2mK9B3lyM5wL0uinPONG4RKj?=
 =?us-ascii?q?x8c0JLrr2N4iJUmPR/G2pd7nV7KemIgTqW7+7dKpwOq/tkHjx0l/5G4HQ907ZV?=
 =?us-ascii?q?8CBERPlvlCTOtNJhv1GmnfeJyjd8VBpOqzBLhJ+EvEl4OKXZ8IVAVmjA/B4X8W?=
 =?us-ascii?q?qQDBEKrcN/CtLzo6BQ1sTPlKXrJTZC6d3U+84cB8nSKM2fMXshMQDmGDjbDAYe?=
 =?us-ascii?q?ST6rNGffh1FSkf2I932VqIQ6pYbomJYUVrBbU1k1RbsmDRFfG9YPOotwFggtiq?=
 =?us-ascii?q?WGxJoS4nCztgXWAt5TpYvafvKPCOriKXCSirwSI1MWwKn/BZYeMIzlnUhjbERq?=
 =?us-ascii?q?2oPQFAzNXoNjuCpkOzUzqg1p+X5ySmAikxb/bQmF5HYVGfq5j1gwhxcoMrdlzy?=
 =?us-ascii?q?vl/1pifgmCnyA3ikRk3Iy92T0=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ADAAD6YPhbh0O0hNFjGgEBAQEBAgEBA?=
 =?us-ascii?q?QEHAgEBAQGBUQUBAQEBCwGCaQN/J4N5iBiMAIFgLRSXJxSBEANKFAEBGAsIAYh?=
 =?us-ascii?q?aIjQJDQEDAQEBAQEBAgETAQEBCA0JCCkjDII2JAGCYQEBAQECAQECIB0BATcBB?=
 =?us-ascii?q?AEJAQEKGAICJgICAyUMAQUBHAYBDAgBAQGDHAGBeQgFCps2PIodcIEvgnYBAQW?=
 =?us-ascii?q?BMAELAYEGhFMIEnmJYoEcF4F/gTiCa4MCGQECAQGBKwESAYMjgjUijxtDNI9yC?=
 =?us-ascii?q?YIghFyGGIQVHoFZTYQ+gm0QhyeNQ4pGAgQCBAUCBQ8hgSWBHHFNLgpIEIJPCRa?=
 =?us-ascii?q?BfINthFk7hV0hMgGBBAEBiWOCPgEB?=
X-IPAS-Result: =?us-ascii?q?A0ADAAD6YPhbh0O0hNFjGgEBAQEBAgEBAQEHAgEBAQGBUQU?=
 =?us-ascii?q?BAQEBCwGCaQN/J4N5iBiMAIFgLRSXJxSBEANKFAEBGAsIAYhaIjQJDQEDAQEBA?=
 =?us-ascii?q?QEBAgETAQEBCA0JCCkjDII2JAGCYQEBAQECAQECIB0BATcBBAEJAQEKGAICJgI?=
 =?us-ascii?q?CAyUMAQUBHAYBDAgBAQGDHAGBeQgFCps2PIodcIEvgnYBAQWBMAELAYEGhFMIE?=
 =?us-ascii?q?nmJYoEcF4F/gTiCa4MCGQECAQGBKwESAYMjgjUijxtDNI9yCYIghFyGGIQVHoF?=
 =?us-ascii?q?ZTYQ+gm0QhyeNQ4pGAgQCBAUCBQ8hgSWBHHFNLgpIEIJPCRaBfINthFk7hV0hM?=
 =?us-ascii?q?gGBBAEBiWOCPgEB?=
X-IronPort-AV: E=Sophos;i="5.56,271,1539673200"; 
   d="scan'208";a="53495175"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 23 Nov 2018 12:24:41 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2441459AbeKXHHX (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sat, 24 Nov 2018 02:07:23 -0500
Received: from mail-it1-f195.google.com ([209.85.166.195]:39073 "EHLO
        mail-it1-f195.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1727635AbeKXHHX (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sat, 24 Nov 2018 02:07:23 -0500
Received: by mail-it1-f195.google.com with SMTP id m15so19445976itl.4
        for <linux-kernel@vger.kernel.org>; Fri, 23 Nov 2018 12:21:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=landley-net.20150623.gappssmtp.com; s=20150623;
        h=subject:to:cc:references:from:message-id:date:user-agent
         :mime-version:in-reply-to:content-language:content-transfer-encoding;
        bh=0ztVUjuR029DPuq6x1COYKxRhgpBTvFYUQJdXiWMSsY=;
        b=QHg+1Glvk7KVsuJp7mdds9RnOMm9MUE5lHaigz6dVIESzE+lM0ulpzN3RurgPx8/ii
         oltlMRx9XnrOFFyipqW1iqq/3+l34wHxJO68tYHKDe0K6Frvg7OJRLQaH+bVOaBu3qeG
         2TAkwyR4ial7zcNN7GOeFafLky+ns+WP6SCDLsqNIw30P0RDH+uSbot5WHNOp6CEtyA8
         vDBb+VRd89QGXGkVklJ7euvqXEkxuiq6cEwlEK/GSJsQP1Bxfq0Y10/FyXafr6gbOoRY
         eFPPJVr/cDdevfu/HtrkDV4AHnJzUtCnCiCkNjZC52JaHoJ/rS9Fd+K2qMhfJ0QHdXGz
         7AgA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:subject:to:cc:references:from:message-id:date
         :user-agent:mime-version:in-reply-to:content-language
         :content-transfer-encoding;
        bh=0ztVUjuR029DPuq6x1COYKxRhgpBTvFYUQJdXiWMSsY=;
        b=k+VhrPN++3hlOvo4ksVg8Da3LB0Jpw2FXqgGQBZdmTgLuClMCQh95CJzY6argqB+4g
         4PGNvLzNQcc4dRJHs0ttcBblrKU4BW1v9/mgQ0gyzXZicKgNwqvmkL+4Y5D0FOlawZsy
         Erm5+14b08J/niqVzDGzkte/ViWbI/zyyljDOB0KGMr/r4hXmYHQbzX9avOafDVSNkVk
         9ayBvOX5YGmRd+ku9H9Az91mQ+w2G7ojuhvYHT3focT9VUyY59t7KKAhlPMWHXceaRMQ
         2bAsYo7JFVxq9VLFc5gdlbB7+sCqVvzapSBrLdC8SHxhisTM6wi8ZJ3wgCw2+en8cM77
         8mUw==
X-Gm-Message-State: AA+aEWY1FwdZrZQxf981Qngg6pQ6BUqRX1uJ0PVcXOidnL/IG+Rs8ZmQ
        xScmn8Z0xQE8MyiGG0HqzOSaPg==
X-Google-Smtp-Source: AFSGD/UkBVJ3JEn5YKF8mCs+WCVZSToi4u1J1uWhCaeiE3Kvlovi9/SWVeDugs5UiSApLzwO239kkQ==
X-Received: by 2002:a24:76d0:: with SMTP id z199mr3048319itb.165.1543004496721;
        Fri, 23 Nov 2018 12:21:36 -0800 (PST)
Received: from [192.168.5.201] (96-67-187-70-static.hfc.comcastbusiness.net. [96.67.187.70])
        by smtp.googlemail.com with ESMTPSA id s13sm6521238ioj.71.2018.11.23.12.21.35
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Fri, 23 Nov 2018 12:21:35 -0800 (PST)
Subject: Re: [RFC][PATCH] fs: set xattrs in initramfs from regular files
To: Roberto Sassu <roberto.sassu@huawei.com>, viro@zeniv.linux.org.uk
Cc: linux-fsdevel@vger.kernel.org, linux-integrity@vger.kernel.org,
        linux-security-module@vger.kernel.org, initramfs@vger.kernel.org,
        linux-kernel@vger.kernel.org, zohar@linux.ibm.com,
        silviu.vlasceanu@huawei.com, dmitry.kasatkin@huawei.com,
        takondra@cisco.com, kamensky@cisco.com, hpa@zytor.com,
        arnd@arndb.de, james.w.mcmechan@gmail.com
References: <20181122154942.18262-1-roberto.sassu@huawei.com>
From: Rob Landley <rob@landley.net>
Message-ID: <7f2b0288-a173-e2bb-70ee-d552610bfc1e@landley.net>
Date: Fri, 23 Nov 2018 14:21:34 -0600
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.2.1
MIME-Version: 1.0
In-Reply-To: <20181122154942.18262-1-roberto.sassu@huawei.com>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 7bit
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On 11/22/18 9:49 AM, Roberto Sassu wrote:
> Although rootfs (tmpfs) supports xattrs, they are not set due to the
> limitation of the cpio format. A new format called 'newcx' was proposed to
> overcome this limitation.

I got email about that format the day before you posted this, by the way.

> However, it looks like that adding a new format is not simple: 15 kernel
> patches; user space tools must support the new format; mistakes made in the
> past should be avoided; it is unclear whether the kernel should switch from
> cpio to tar.

The kernel _can't_ switch from cpio to tar without breaking backwards
compatability, it could only add tar as a second format it supported (remember
cpio images can be sideloaded so a new rootfs can be used with an existing
initramfs, plus existing build systems generate them and would still need to if
they wanted to keep supporting older kernels), and then once you've got two
formats somebody will propose zip support, and let's just not go there please.

The changes to the userspace tools are trivial (I say that as the maintainer of
toybox, which has a cpio). The argument was about things like 64 bit timestamps
(y2038 problem), nanosecond support, sparse files, etc. And I think the argument
had largely died down?

Keep in mind the squashfs guy spent 5 years trying to get his filesystem merged
(https://lwn.net/Articles/563578/), I spent several years trying to get my perl
removal patch merged (and only work up the enthusiasm to resubmit
http://lists.busybox.net/pipermail/buildroot/2015-March/123385.html
https://patchwork.kernel.org/patch/9193529/ https://lkml.org/lkml/2017/9/13/651
about once a year because dealing with linux-kernel is just no fun for hobbyists
anymore).

> The aim of this patch is to provide the same functionality without
> introducing a new format. The value of xattrs is placed in regular files
> having the same file name as the files xattrs are added to, plus a
> separator and the xattr name (<filename>.xattr-<xattr name>).

I think you're solving the wrong problem, but that's just my opinion.

Rob
