Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:29:03 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga001.jf.intel.com (orsmga001.jf.intel.com [10.7.209.18])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 264D858037D
	for <like.xu@linux.intel.com>; Thu, 22 Nov 2018 07:33:22 -0800 (PST)
Received: from orsmga103.jf.intel.com ([10.7.208.35])
  by orsmga001-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 07:33:22 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3AlSf/XxZ7o/RCr0FmB2HALWv/LSx+4OfEezUN459i?=
 =?us-ascii?q?sYplN5qZpsy4ZB7h7PlgxGXEQZ/co6odzbaO4+a4ASQp2tWoiDg6aptCVhsI24?=
 =?us-ascii?q?09vjcLJ4q7M3D9N+PgdCcgHc5PBxdP9nC/NlVJSo6lPwWB6nK94iQPFRrhKAF7?=
 =?us-ascii?q?Ovr6GpLIj8Swyuu+54Dfbx9HiTahYr5+Ngm6oRnMvcQKnIVuLbo8xAHUqXVSYe?=
 =?us-ascii?q?RWwm1oJVOXnxni48q74YBu/SdNtf8/7sBMSar1cbg2QrxeFzQmLns65Nb3uhnZ?=
 =?us-ascii?q?TAuA/WUTX2MLmRdVGQfF7RX6XpDssivms+d2xSeXMdHqQb0yRD+v9LlgRgP2hy?=
 =?us-ascii?q?gbNj456GDXhdJ2jKJHuxKquhhzz5fJbI2JKPZye6XQds4YS2VcRMZcTzJPAo28?=
 =?us-ascii?q?YYsIDOQPM+hXoIb/qFQSohWwGBGsCeHtxDJHm3P707E23Po6EQzdwAwgBsgDvG?=
 =?us-ascii?q?jIoNj7NqofV/2+wqnSzTXEavNbwSnw6IzWfR86v/6MR697f9bWyUk0DQzOk1Kd?=
 =?us-ascii?q?ppD/PzOSzeQCqXOW7/B+Wu2yi24osR1xriKzyccrj4nEn4QYwU3K+yV+xYY6P9?=
 =?us-ascii?q?y4SEhjbN66FZtcrSCaN5BuTsMtRWFopTw2yrocuZ60eiUB1ZcpxwbHZvCZb4SF?=
 =?us-ascii?q?4QjvWPuMLTp7nn5pZryyihao/US9yODwTte43EpOoyZfj9XBuG4B2wbO5sWERP?=
 =?us-ascii?q?Zx5Fmt1DWJ2gvO8O9LO1o0mrDeK5M5wr4/iJ4TsUPbEy/ymUX2l7OWdl4+9uin?=
 =?us-ascii?q?7eTnf6/qppiGN497kg3+M6IuldKjAekgLAQCQ2uW9f6h2LH+/kD1WqtGg/M2n6?=
 =?us-ascii?q?XDrZzXJ9wXpqujDA9U1oYj5Qy/DzCj0NkAhHkIMldFeA+eg4f0JV7OPu73DfOm?=
 =?us-ascii?q?j1u3lzdr2vbGMaH/DZXWKXTDlLbhfbVj5EJGxwsz0MhS55ZVCrEHPfLyVVX9tN?=
 =?us-ascii?q?3eDh8lLQO0x/zrB8l61oMbQm+PBKiZMKXdsV+O++IjOe6MZJUauDrlMfgq++bu?=
 =?us-ascii?q?jWMlmV8aZaSp2ZoXaHOmEfh8LESZfGHhgtMAEWcMowo/Q/bmiFyEUT5PeXmyW7?=
 =?us-ascii?q?gw6S08CIKjXs/+QJuwiumBwDujBc8RIWRHEUyXV3HvcYqCRrELci3VJ8ZgljkN?=
 =?us-ascii?q?U/+mU5Mg0he18xb3zqciIufK9ylLiJT4ydIg4uTSkQ01pyV5CtnY32yTQmUxhG?=
 =?us-ascii?q?4RWjItwIh5pkpyzErF1rJ31OdFH95e7O8cTwEhKJTHxPZ7Ad2hZgWUQd6ITlu8?=
 =?us-ascii?q?CtmhGnkKR9QtxMRGRkFmENWvkgzKl361Cr4TmqaQAbQu/67c1mS3LMF4nSXozq?=
 =?us-ascii?q?4k2nIiT8FCLyWcgbV2v1zYHYnSmm2DmqqqfLha1ynIojTQhVGStV1VBVYjGZ7O?=
 =?us-ascii?q?WmoSMw6P9Yz0?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ABAADlyvZbhxHrdtBiGgEBAQEBAgEBA?=
 =?us-ascii?q?QEHAgEBAQGBUQUBAQEBCwGBMIE5gRYTg3iIGF+LIoINlzoUgV8UGAsJhECEEiI?=
 =?us-ascii?q?0CQ0BAwEBAQEBAQIBEwEBAQoLCQgpIwyCNgUCAxoBBoJcAQIDAQIgIwopAwMBA?=
 =?us-ascii?q?gYBAQgCGAICIgQCAgMBJC8GDQYCAQEBgxwBggEBBAqNbptQgS+ELQEDAoENhGO?=
 =?us-ascii?q?BC4p+F4FAP4ERJ4JrgUuBUAECAoEjO4MEglcCixGEf49yCYY9P4YYhBUGGIlRh?=
 =?us-ascii?q?zeNQ4ptgUaCDTMaCBsVgycJgh4XEohMhVwjMQGBBhyKQYF3AQE?=
X-IPAS-Result: =?us-ascii?q?A0ABAADlyvZbhxHrdtBiGgEBAQEBAgEBAQEHAgEBAQGBUQU?=
 =?us-ascii?q?BAQEBCwGBMIE5gRYTg3iIGF+LIoINlzoUgV8UGAsJhECEEiI0CQ0BAwEBAQEBA?=
 =?us-ascii?q?QIBEwEBAQoLCQgpIwyCNgUCAxoBBoJcAQIDAQIgIwopAwMBAgYBAQgCGAICIgQ?=
 =?us-ascii?q?CAgMBJC8GDQYCAQEBgxwBggEBBAqNbptQgS+ELQEDAoENhGOBC4p+F4FAP4ERJ?=
 =?us-ascii?q?4JrgUuBUAECAoEjO4MEglcCixGEf49yCYY9P4YYhBUGGIlRhzeNQ4ptgUaCDTM?=
 =?us-ascii?q?aCBsVgycJgh4XEohMhVwjMQGBBhyKQYF3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,266,1539673200"; 
   d="scan'208";a="53367401"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 22 Nov 2018 07:33:19 -0800
Received: from localhost ([::1]:47372 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gPqyk-0004dL-RH
	for like.xu@linux.intel.com; Thu, 22 Nov 2018 10:33:18 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:39549)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <crosa@redhat.com>) id 1gPqyF-0004UU-7A
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 10:32:48 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <crosa@redhat.com>) id 1gPqyA-000370-MA
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 10:32:46 -0500
Received: from mx1.redhat.com ([209.132.183.28]:50856)
	by eggs.gnu.org with esmtps (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.71) (envelope-from <crosa@redhat.com>) id 1gPqyA-00033p-8i
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 10:32:42 -0500
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
	[10.5.11.23])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mx1.redhat.com (Postfix) with ESMTPS id 69C887AE99
	for <qemu-devel@nongnu.org>; Thu, 22 Nov 2018 15:32:40 +0000 (UTC)
Received: from localhost.localdomain (ovpn-125-180.rdu2.redhat.com
	[10.10.125.180])
	by smtp.corp.redhat.com (Postfix) with ESMTPS id 2D74028DF2;
	Thu, 22 Nov 2018 15:32:36 +0000 (UTC)
To: Wainer dos Santos Moschetta <wainersm@redhat.com>
References: <20181121134151.23993-1-crosa@redhat.com>
	<20181121134151.23993-2-crosa@redhat.com>
	<6a0de6d4-8b53-4f8b-0b69-0841e1421e41@redhat.com>
From: Cleber Rosa <crosa@redhat.com>
Organization: Red Hat, Inc.
Message-ID: <59c939c0-9f2d-3aa0-5cd7-75c36c2f2575@redhat.com>
Date: Thu, 22 Nov 2018 10:32:35 -0500
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.3.0
MIME-Version: 1.0
In-Reply-To: <6a0de6d4-8b53-4f8b-0b69-0841e1421e41@redhat.com>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
	(mx1.redhat.com [10.5.110.25]);
	Thu, 22 Nov 2018 15:32:40 +0000 (UTC)
Content-Transfer-Encoding: quoted-printable
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 209.132.183.28
Subject: Re: [Qemu-devel] [PATCH 1/1] Acceptance tests: add test for
 set-numa-node error handler fix
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Eduardo Habkost <ehabkost@redhat.com>,
	Markus Armbruster <armbru@redhat.com>, qemu-devel@nongnu.org,
	=?UTF-8?Q?Philippe_Mathieu-Daud=c3=a9?= <pmathieu@redhat.com>,
	Caio Carrara <ccarrara@redhat.com>, Igor Mammedov <imammedo@redhat.com>
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>



On 11/22/18 7:19 AM, Wainer dos Santos Moschetta wrote:
>=20
> On 11/21/2018 11:41 AM, Cleber Rosa wrote:
>> Commit a22528b918 fixed an issue that is exposed by means of the
>> "set-numa-node" QMP command (introduced in f3be67812).=C2=A0 This adds=
 a
>> test that pretty much maps the steps documented on the fix.
>>
>> Additionally, given that 'set-numa-node' is only allowed in
>> 'preconfig' state, a specific check for that was added a separate
>> test.
>>
>> Tests: a22528b918c7d29795129b5a64c4cb44bb57a44d
>> Reference: f3be67812c226162f86ce92634bd913714445420
>> CC: Igor Mammedov <imammedo@redhat.com>
>> CC: Markus Armbruster <armbru@redhat.com>
>> Signed-off-by: Cleber Rosa <crosa@redhat.com>
>> ---
>> =C2=A0 tests/acceptance/set_numa_node.py | 41 ++++++++++++++++++++++++=
+++++++
>> =C2=A0 1 file changed, 41 insertions(+)
>> =C2=A0 create mode 100644 tests/acceptance/set_numa_node.py
>>
>> diff --git a/tests/acceptance/set_numa_node.py
>> b/tests/acceptance/set_numa_node.py
>> new file mode 100644
>> index 0000000000..0c55315231
>> --- /dev/null
>> +++ b/tests/acceptance/set_numa_node.py
>> @@ -0,0 +1,41 @@
>> +# Tests for QMP set-numa-node related behavior and regressions
>> +#
>> +# Copyright (c) 2018 Red Hat, Inc.
>> +#
>> +# Author:
>> +#=C2=A0 Cleber Rosa <crosa@redhat.com>
>> +#
>> +# This work is licensed under the terms of the GNU GPL, version 2 or
>> +# later.=C2=A0 See the COPYING file in the top-level directory.
>> +
>> +from avocado_qemu import Test
>> +
>> +
>> +class SetNumaNode(Test):
>> +=C2=A0=C2=A0=C2=A0 """
>> +=C2=A0=C2=A0=C2=A0 :avocado: enable
>> +=C2=A0=C2=A0=C2=A0 :avocado: tags=3Dquick,numa
>> +=C2=A0=C2=A0=C2=A0 """
>> +=C2=A0=C2=A0=C2=A0 def test_numa_not_supported(self):
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.add_args('-nodefau=
lts', '-S', '-preconfig')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.set_machine('none'=
)
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.launch()
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 res =3D self.vm.qmp('set-n=
uma-node', type=3D'node')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertIsNotNone(res, =
'Unexpected empty QMP response to
>> "set-numa-node"')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertEqual(res['erro=
r']['class'], 'GenericError')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertEqual(res['erro=
r']['desc'],
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 'NUMA is not supported by this machine-type')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertTrue(self.vm.is=
_running())
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.qmp('x-exit-precon=
fig')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.shutdown()
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertEqual(self.vm.e=
xitcode(), 0)
>> +
>> +=C2=A0=C2=A0=C2=A0 def test_no_preconfig(self):
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.add_args('-nodefau=
lts', '-S')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.set_machine('none'=
)
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.vm.launch()
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 res =3D self.vm.qmp('set-n=
uma-node', type=3D'node')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertIsNotNone(res, =
'Unexpected empty QMP response to
>> "set-numa-node"')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertEqual(res['erro=
r']['class'], 'GenericError')
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 self.assertEqual(res['erro=
r']['desc'],
>> +=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 "The command is permitted only in
>> 'preconfig' state")
>=20
> There is a qtest suite of tests for NUMA configuration on
> tests/numa-test.c, including one simple test for set-numa-node (pulled
> in as https://lists.gnu.org/archive/html/qemu-devel/2018-05/msg06930.ht=
ml).
>=20
> So did you consider to include those cases of test on tests/numa-test.c
> instead?
>=20
> - Wainer
>=20
>=20

Hi Wainer,

Thanks for the pointer.  Answering your question, I had not looked at
tests/numa-test.c while I was writing this.

Given that one of the points of this patch is to give more (real, useful
and practical) examples of how to write tests with this framework, I
think it was a good thing.

But, this type of question, the comparison of this type of test with
other types of tests in QEMU has been recurring, so I think we should
address the question with some kind of comparison/benefits/guidelines
write up in the near future.

- Cleber.

