Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 25 Nov 2018 14:43:00 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga004.fm.intel.com (fmsmga004.fm.intel.com [10.253.24.48])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 39E355803C2
	for <like.xu@linux.intel.com>; Sat, 24 Nov 2018 15:57:02 -0800 (PST)
Received: from fmsmga105.fm.intel.com ([10.1.193.10])
  by fmsmga004-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 24 Nov 2018 15:57:01 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3AkCVOxBAQb1G895m2JgtaUyQJP3N1i/DPJgcQr6Af?=
 =?us-ascii?q?oPdwSPXyoMbcNUDSrc9gkEXOFd2Cra4c26yO6+jJYi8p2d65qncMcZhBBVcuqP?=
 =?us-ascii?q?49uEgeOvODElDxN/XwbiY3T4xoXV5h+GynYwAOQJ6tL1LdrWev4jEMBx7xKRR6?=
 =?us-ascii?q?JvjvGo7Vks+7y/2+94fcbglUhzexe69+IAmrpgjNq8cahpdvJLwswRXTuHtIfO?=
 =?us-ascii?q?pWxWJsJV2Nmhv3+9m98p1+/SlOovwt78FPX7n0cKQ+VrxYES8pM3sp683xtBnM?=
 =?us-ascii?q?VhWA630BWWgLiBVIAgzF7BbnXpfttybxq+Rw1DWGMcDwULs5Qiqp4bt1RxD0iS?=
 =?us-ascii?q?cHLz85/3/Risxsl6JQvRatqwViz4LIfI2ZMfxzdb7fc9wHX2pMRsZfWTJPDI2/?=
 =?us-ascii?q?aIUBEvIBMORaoYTyulcDoweyChe3BO701jNEmmX70bEg3ug9DQ3L2hErEdIUsH?=
 =?us-ascii?q?TTqdX4LKkeX++wzKnJyTXDbvRW0ir85oTSbxssv/aMXa5qfsbf1EIiEB/KjlKM?=
 =?us-ascii?q?qYP/JD6azf4NvHKB4Op4T+6vjHQnqw5orzWp28wihI7JhocPxVDF8yV02Ik1Jd?=
 =?us-ascii?q?ykSE57fN6rC4FcuD2dN4tzWs8iTGdouDsgxr0Bo567cy4Hw4kkyR7Hc/GLbZSE?=
 =?us-ascii?q?7xH5WOqMPDt1h2hpdKyxihuy60Ss1+/xWtGp3FpUrSdJiNnBu3QX2xDN9sSLUO?=
 =?us-ascii?q?Vx8lqg1DuJygvd8PtLIVoumqreM5MhwqA/lp4UsUnbGi/2mV72jLONdkk+9eio?=
 =?us-ascii?q?7fnnbq/hpp+GOI94kgD+MqIwlcyjGek0LBQCUmuB9eihybHu/lf1TKtEg/A2iK?=
 =?us-ascii?q?XVrZLXKdwepqGjAg9V1ogj6wy4DzejyNkYhGcILFdYeB6ekofmJU/OL+78Dfum?=
 =?us-ascii?q?mFuslyprx/baMbL/GZXBKXzDkLbifblj8UJdxxczwMhb55JVDLEBPf3yVlXwtN?=
 =?us-ascii?q?zeEh82LQi0z/z7B9V604MTQmSPAqifMKPdt1+I+/gjI+6WZI8aoDr9MeQq5+by?=
 =?us-ascii?q?jX8lnl8QZa2p3ZoUaH+mBPhnLFiZbGHogtcAF2cKowU/QPbriF2ETT5ceXKyU7?=
 =?us-ascii?q?gg6TE8DYL1RbrFXZ2n1bydwD+gTNoRYmFdFkvKF3DueIOZHfAWZ2WXK85llzUC?=
 =?us-ascii?q?Er+5V44m0wrprQL/1v9rI/TZ/n4ls4n+3o1w7uzXiRZg7DFxEoGR3n+ASyRuk3?=
 =?us-ascii?q?oVSiQq9KZ4p0N71xGEy6cvmOFSF9FY+6ZUVBwnP4XX1e1wBoPOXVfYc9KUDVqr?=
 =?us-ascii?q?XNiiKTc2SN033pkJeUkuNc+li0WJ8i+rB74S35PNTLcz7quWlyz6INp043zc3a?=
 =?us-ascii?q?A5yV48TZ0cZiWdmqdj+l2LVMbymEKDmvPvLPxE0Q=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ASAADu5PlbhxHrdtBiHAEBAQQBAQcEA?=
 =?us-ascii?q?QGBUQcBAQsBgTCBOYEpjBFfpGqBbhkYCwmIWiI0CQ0BAwEBAQEBAQIBEwEBAQo?=
 =?us-ascii?q?LCQgbDiMMgjYFAgMaAQaCXwQCPQEBBAopAQIDAQIGAkgIAwEkTYMcAYIBAQQKo?=
 =?us-ascii?q?x+CH4J2AQEFgTABAwKBDYRSAwWHXoMPgRwRBoF/hz4BAQECgiuFDpASj3IHAgK?=
 =?us-ascii?q?GeoYYhBALGIlPhzmNQ4ptgUaCDX0IgyeCGwwXg0qFFIVcVAGBAQUhE4lcgXcBA?=
 =?us-ascii?q?Q?=
X-IPAS-Result: =?us-ascii?q?A0ASAADu5PlbhxHrdtBiHAEBAQQBAQcEAQGBUQcBAQsBgTC?=
 =?us-ascii?q?BOYEpjBFfpGqBbhkYCwmIWiI0CQ0BAwEBAQEBAQIBEwEBAQoLCQgbDiMMgjYFA?=
 =?us-ascii?q?gMaAQaCXwQCPQEBBAopAQIDAQIGAkgIAwEkTYMcAYIBAQQKox+CH4J2AQEFgTA?=
 =?us-ascii?q?BAwKBDYRSAwWHXoMPgRwRBoF/hz4BAQECgiuFDpASj3IHAgKGeoYYhBALGIlPh?=
 =?us-ascii?q?zmNQ4ptgUaCDX0IgyeCGwwXg0qFFIVcVAGBAQUhE4lcgXcBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,275,1539673200"; 
   d="scan'";a="139425433"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 24 Nov 2018 15:56:52 -0800
Received: from localhost ([::1]:58144 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gQhnA-0003Gx-39
	for like.xu@linux.intel.com; Sat, 24 Nov 2018 18:56:52 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:57456)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <cota@braap.org>) id 1gQhmV-0003G1-Sp
	for qemu-devel@nongnu.org; Sat, 24 Nov 2018 18:56:13 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <cota@braap.org>) id 1gQhmQ-0005Dz-Oq
	for qemu-devel@nongnu.org; Sat, 24 Nov 2018 18:56:11 -0500
Received: from wout2-smtp.messagingengine.com ([64.147.123.25]:58263)
	by eggs.gnu.org with esmtps (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.71) (envelope-from <cota@braap.org>) id 1gQhmO-0004eC-8P
	for qemu-devel@nongnu.org; Sat, 24 Nov 2018 18:56:05 -0500
Received: from compute4.internal (compute4.nyi.internal [10.202.2.44])
	by mailout.west.internal (Postfix) with ESMTP id 046D9C7D;
	Sat, 24 Nov 2018 18:56:00 -0500 (EST)
Received: from mailfrontend1 ([10.202.2.162])
	by compute4.internal (MEProxy); Sat, 24 Nov 2018 18:56:01 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=braap.org; h=
	from:to:cc:subject:date:message-id; s=mesmtp; bh=S3u/m3U1wOO6ItH
	q5W+kx8X7qQWK5Os8/AJI4GJKE1U=; b=dpMMN9/FmEHunoJmsFYUmuRSzFaRqrd
	pYzJ4FDdVP7ObIO9TcndaOhZ99ZzyjjMAWCoEjJJDyLrMRunxnZ9vwUTwPQdGdFq
	YfJGVzUtt0s+cYYKdrOYLa72F+D0Q96sa8FqMSfC6UHoWKsCpEyJyd8atSKp6m7Z
	VlpV4DxOkzOU=
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=
	messagingengine.com; h=cc:date:from:message-id:subject:to
	:x-me-proxy:x-me-proxy:x-me-sender:x-me-sender:x-sasl-enc; s=
	fm1; bh=S3u/m3U1wOO6ItHq5W+kx8X7qQWK5Os8/AJI4GJKE1U=; b=VW8Yl86w
	n1RhlIfJnjVr7/8zPjnTrIMbLgYX2K10bkoNHk3El+mXwuV9WJQCfgwxPr4BwIQN
	EMAOzzL6nvyo/Yi3IK+VNe7Hv/SvfkJZOkbXIidaq+cE2y87S/+WuU0u2Cw/Nge6
	y0wjx+ltrveW5OW5VG7Yxj6VR9ZqtJzpH4zneGztGWCrE775hCwQHloWz3Kwhtvc
	mjm8PbVUsu7lBdbwvLZWJ99eeveLigdgjdk7XnSQ31J4P+rzOnKqzqiT23KoAfhd
	lSQJtvnIt9q4HwPHkkxltPFOxsfgUtO4B4YDgJX90e1e9PbaMeJbJro6tUp2nX3B
	DrxzPLYwRP/CrA==
X-ME-Sender: <xms:EOX5WwFmcFJ4xEujlMhBXvupWG0khpRobM5728UDxp1Z7Lr-Mt0INA>
X-ME-Proxy: <xmx:EOX5W_ba-fh65ciuGiGqxCwT6_vqdgE0d2tePrRfakxkQhm21hEOUA>
	<xmx:EOX5W-k0LOB_vcc2WmeM81APCUU3X4zBKiTZeyk9igjMKjx_UQL5Gg>
	<xmx:EOX5WzwmAieIGf1ebL2hgzEUWz1Xd2dM0KwUA6zD9yVEqa5iqtBAWA>
	<xmx:EOX5W0OtWrvtqZljIVDIj0aLnKXuDG2IW8fwiFmBhhPGfseHMgaTDw>
	<xmx:EOX5W_Tioa52xdDqHFou3ZglwBdw8NGdaStxc2l796JnZ0VikhNMmg>
	<xmx:EOX5W6f-2SdsKZ7IDezoVgDJYUFp4Wya0g7xKrE4th11RZVpr_DWrw>
Received: from localhost (flamenco.cs.columbia.edu [128.59.20.216])
	by mail.messagingengine.com (Postfix) with ESMTPA id B51F2E47C4;
	Sat, 24 Nov 2018 18:55:59 -0500 (EST)
From: "Emilio G. Cota" <cota@braap.org>
To: qemu-devel@nongnu.org
Date: Sat, 24 Nov 2018 18:55:40 -0500
Message-Id: <20181124235553.17371-1-cota@braap.org>
X-Mailer: git-send-email 2.17.1
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 64.147.123.25
Subject: [Qemu-devel] [PATCH v6 00/13] hardfloat
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Richard Henderson <richard.henderson@linaro.org>,
	=?UTF-8?q?Alex=20Benn=C3=A9e?= <alex.bennee@linaro.org>
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

v5: https://lists.gnu.org/archive/html/qemu-devel/2018-10/msg02793.html

Changes since v5:

- Rebase on rth/tcg-next-for-4.0

- Use QEMU_FLATTEN instead of __attribute__((flatten))

- Merge rth's cleanups (thanks!). With this, we now use a union to
  hold {float|float32} or {double|float64} types, which gets
  rid of most macros. I added a few optimizations (i.e. likely
  hints in some branches, and not using temp variables to hold
  the result of fpclassify) to roughly match (and sometimes
  surpass) v5's performance.

- float64_sqrt: use fpclassify, which gives a 1.5x speedup.

This series introduces no regressions to fp-test. You can test
hardfloat by passing "-f x" to fp-test (so that the inexact flag
is set before each operation) and using even rounding (fp-test's
default). Note that hardfloat does not affect operations with
other rounding modes.

Perf numbers for fp-bench running on several host machines are in
each commit log; numbers for several benchmarks (NBench, SPEC06fp)
are in the last patch's commit log. These numbers are a bit
outdated (they're from v2 or so), but I've decided to keep them
because they give a good idea of the speedups to expect, and I don't
have time to re-run them =)

I did re-run the numbers for sqrt and cmp, though, since the
implementation has changed quite a bit since v5. I didn't
re-run these on Aarch64 and PPC hosts due to lack of time,
but I doubt they'd change significantly.

You can fetch this series from:
  https://github.com/cota/qemu/tree/hardfloat-v6

Thanks,

		Emilio



