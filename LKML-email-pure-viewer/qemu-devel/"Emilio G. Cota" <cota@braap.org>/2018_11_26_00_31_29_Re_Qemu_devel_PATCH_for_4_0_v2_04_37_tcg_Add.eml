Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 26 Nov 2018 08:53:00 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga001.fm.intel.com (fmsmga001.fm.intel.com [10.253.24.23])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 743655802E4
	for <like.xu@linux.intel.com>; Sun, 25 Nov 2018 16:32:14 -0800 (PST)
Received: from orsmga106.jf.intel.com ([10.7.208.65])
  by fmsmga001-1.fm.intel.com with ESMTP; 25 Nov 2018 16:32:14 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3AMJoFAx/B0oQQTf9uRHKM819IXTAuvvDOBiVQ1KB2?=
 =?us-ascii?q?2+ocTK2v8tzYMVDF4r011RmVBdWds6oMotGVmpioYXYH75eFvSJKW713fDhBt/?=
 =?us-ascii?q?8rmRc9CtWOE0zxIa2iRSU7GMNfSA0tpCnjYgBaF8nkelLdvGC54yIMFRXjLwp1?=
 =?us-ascii?q?Ifn+FpLPg8it2O2+557ebx9UiDahfLh/MAi4oQLNu8cMnIBsMLwxyhzHontJf+?=
 =?us-ascii?q?RZ22ZlLk+Nkhj/+8m94odt/zxftPw9+cFAV776f7kjQrxDEDsmKWE169b1uhTF?=
 =?us-ascii?q?UACC+2ETUmQSkhpPHgjF8BT3VYr/vyfmquZw3jSRMNboRr4oRzut86ZrSAfpiC?=
 =?us-ascii?q?gZMT457HrXgdF0gK5CvR6tuwBzz4vSbYqINvRxY7ndcMsUS2RBQMhfVCJBDYyg?=
 =?us-ascii?q?YIQSDeUOM/tWr5H/qlUMohayGAehCP/xxT9TnXL2wbE23v49HQ3axgEsAdQDu2?=
 =?us-ascii?q?nUotXvM6cSVPi4wKfHwzXGbvNW3Tb96I/VeR4gu/2HQKx9cc3NyUY1GQ/Ok1Kd?=
 =?us-ascii?q?ppDiPzOJzOsAqHOU7/B6Wu21k24rsQZxoiKgxso1jITCm4Ebykjc+Cln3Io4Js?=
 =?us-ascii?q?e0RFNmbdOnCpdcqS+XOotsTs8/QWxkoDs2xqMFtJKhfCUHzI4rywDDZ/CdbYSE?=
 =?us-ascii?q?/xPuWeCMKjlinn1lYqiwhxOq/Eig1OL8Us603U5OripEidnMqmsN2wbc6siBV/?=
 =?us-ascii?q?tx5ECh2SyA1wzL6+FEJ147lbbDJpI/3rI9lYAfvVneEiL1gkn6kqGbe0U+9uS1?=
 =?us-ascii?q?6enrerDmqYWdN49whAH+KKMumsmnDOQhLAcOWnWb9f2h27L94032XrFKguQtna?=
 =?us-ascii?q?nerZDaI9gUqbCiAwNS1oYj6hW/ACm83NUXgHkKNFZFeBOBj4j0NFDCOvH4DfGj?=
 =?us-ascii?q?g1uylDdn3ezJPrrkApjWKHjDl7Hhfbl7605B0gYzyspf551MBrEbPP3zQlPxtM?=
 =?us-ascii?q?DfDhIhNwy0wuXnB8tn2oIRRGKCGauZMKLUsV+V6eMjOeiMZIkJuDnjL/gp/eLh?=
 =?us-ascii?q?jXg8mQxVQK+ywJFCaGykBu80ZAKdYGHwmZEHFmEFuBd4S/blz1iLUDpWbnD1WL?=
 =?us-ascii?q?og5zY9E8W/AILeA4ygnrGFjxq9BYBcM2VPC1SQFiXxeoCZHvsBdi+WZ9VsiyEJ?=
 =?us-ascii?q?TqSJTYgn2hez8gjgxO18M+DW9yYE4I/lz8V//ObJlBs/pgBzWv6c2GGEVW08vm?=
 =?us-ascii?q?4OSzIsx6d56Rhny1yD2LJ0xfxVE9Be/ehOVC8+NJjV1es8DMr9DFHvZNCMHRyL?=
 =?us-ascii?q?R9SiADZ5YZR56NgSagw1T96lkhnr1TCjCqdTkKaEUs9nupnA1mT8cp4ug03N07?=
 =?us-ascii?q?Ms2hx/GpNC?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ACAAC8PvtbhxHrdtBhGQEBAQEBAQEBA?=
 =?us-ascii?q?QEBAQcBAQEBAQGBUQQBAQEBAQsBgTCCYowRX4sfgg2OBIRBhHeBdRIYFIMshS4?=
 =?us-ascii?q?iNAkNAQMBAQEBAQECARMBAQEKCwkIGw4jDII2BQIDGgEGglwBAgMBAjcGAQEEC?=
 =?us-ascii?q?ikBAgMBAgYBAQoYCR0IAwELBUkTBYMcggIBBKQngh+CdgEBBYcSCIptgRwRBoF?=
 =?us-ascii?q?/hCOIM4ImkBKPcgcCApEiIwqJRYc5LJgEgUaCDX0IgyeCGzWDOIUUhVxUgQIFI?=
 =?us-ascii?q?ROJZoF3AQE?=
X-IPAS-Result: =?us-ascii?q?A0ACAAC8PvtbhxHrdtBhGQEBAQEBAQEBAQEBAQcBAQEBAQG?=
 =?us-ascii?q?BUQQBAQEBAQsBgTCCYowRX4sfgg2OBIRBhHeBdRIYFIMshS4iNAkNAQMBAQEBA?=
 =?us-ascii?q?QECARMBAQEKCwkIGw4jDII2BQIDGgEGglwBAgMBAjcGAQEECikBAgMBAgYBAQo?=
 =?us-ascii?q?YCR0IAwELBUkTBYMcggIBBKQngh+CdgEBBYcSCIptgRwRBoF/hCOIM4ImkBKPc?=
 =?us-ascii?q?gcCApEiIwqJRYc5LJgEgUaCDX0IgyeCGzWDOIUUhVxUgQIFIROJZoF3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,280,1539673200"; 
   d="scan'208";a="41471554"
X-Amp-Result: UNSCANNABLE
X-Amp-File-Uploaded: False
Unscannable: 2
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 25 Nov 2018 16:32:05 -0800
Received: from localhost ([::1]:33626 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gR4om-0002nL-S1
	for like.xu@linux.intel.com; Sun, 25 Nov 2018 19:32:04 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:35720)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <cota@braap.org>) id 1gR4oI-0002mW-1z
	for qemu-devel@nongnu.org; Sun, 25 Nov 2018 19:31:34 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <cota@braap.org>) id 1gR4oE-0006Wy-RN
	for qemu-devel@nongnu.org; Sun, 25 Nov 2018 19:31:33 -0500
Received: from out4-smtp.messagingengine.com ([66.111.4.28]:43657)
	by eggs.gnu.org with esmtps (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.71) (envelope-from <cota@braap.org>) id 1gR4oE-0006Wi-O7
	for qemu-devel@nongnu.org; Sun, 25 Nov 2018 19:31:30 -0500
Received: from compute4.internal (compute4.nyi.internal [10.202.2.44])
	by mailout.nyi.internal (Postfix) with ESMTP id 72A9320F5C;
	Sun, 25 Nov 2018 19:31:30 -0500 (EST)
Received: from mailfrontend1 ([10.202.2.162])
	by compute4.internal (MEProxy); Sun, 25 Nov 2018 19:31:30 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=braap.org; h=
	date:from:to:cc:subject:message-id:references:mime-version
	:content-type:in-reply-to; s=mesmtp; bh=dQrEpRWdKrp1t96AEj1KeZcK
	aQiKn4JuGI3OGtI8VX4=; b=shOrqQmiOHB0/G0I10Nl1AUlyVy76VvAPy5ed2Gy
	geR/Ud5kX4hjePNURaW7Nl9sn5eHIHToyN89radqXikqYJMo1iyRL20BdKZ/DVyk
	fEJB/WfsbzXPKrACWcf21s2vFss9agG49yL6iHMRqIEY+RhUJJucPpmPlLGkmxAH
	dk0=
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=
	messagingengine.com; h=cc:content-type:date:from:in-reply-to
	:message-id:mime-version:references:subject:to:x-me-proxy
	:x-me-proxy:x-me-sender:x-me-sender:x-sasl-enc; s=fm1; bh=dQrEpR
	WdKrp1t96AEj1KeZcKaQiKn4JuGI3OGtI8VX4=; b=f2z+znSFMQDlES2gWdS2v6
	/JaLs5Afgydv/KXJ5elparhc04vNBx/JkXe5UOzxb0fj1wCzbchWOkaES3kB8bLf
	D+KcBfPlWZtjeIDHTxL/ZM1IPlW6MjyjeDJbb+X79DqHUrp7oE3OgM6AyYF+MnHt
	x2WZiAo/e9FRO/WAyZUzwyWo+JJcqmNOuHR/4b0ywIaP5yPbJk7tDeFEAXwGIusz
	KS0LJHnjw72DRQPb3ZBmeA5DiiaH5ifLdwevSNAL/0b1hIfGvGPCTQv4a/RwPR0C
	EX8md8b8+OpLOCkt7csHSJdUP3IqfkCNj/ap3TbP4ldyTTaUAAn7ducT5HNAShKA
	==
X-ME-Sender: <xms:4T77W244LKdataMDHmhU916U3pNsl9cSir4bZC9VeZNYBYaBzYwI6w>
X-ME-Proxy: <xmx:4T77WzNHRSLmmd-EYnSbGGcd9AkzWyGyHO8fNSiuHlnfXo9gHTXlWg>
	<xmx:4T77W-IYxOYHghyToH5J0zWkF30lkiLExGjUuA3n-aXPAvv8Oe2Y7g>
	<xmx:4T77W0HtC4TEhwthsZLaf1eUODiqQsntr0kVT8_x5HtevDEnphHKiQ>
	<xmx:4T77W2To7u9yM3oTwf2dB4j57udXkBf2swt3s3RIR8kZ7WN8XpXyYw>
	<xmx:4T77WwG2Sl-Cwn8jINjDaK3xu0DlOKMuykVAOXeq1eORY6IkxYQkMQ>
	<xmx:4j77WxrcPEWhoo5NLqYFLe9ZMqeRCogepBHBfCBsifmAvtziIIrhqQ>
Received: from localhost (flamenco.cs.columbia.edu [128.59.20.216])
	by mail.messagingengine.com (Postfix) with ESMTPA id 99616E4443;
	Sun, 25 Nov 2018 19:31:29 -0500 (EST)
Date: Sun, 25 Nov 2018 19:31:29 -0500
From: "Emilio G. Cota" <cota@braap.org>
To: Richard Henderson <richard.henderson@linaro.org>
Message-ID: <20181126003129.GB12936@flamenco>
References: <20181123144558.5048-1-richard.henderson@linaro.org>
	<20181123144558.5048-5-richard.henderson@linaro.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20181123144558.5048-5-richard.henderson@linaro.org>
User-Agent: Mutt/1.9.4 (2018-02-28)
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 66.111.4.28
Subject: Re: [Qemu-devel] [PATCH for-4.0 v2 04/37] tcg: Add
 TCG_TARGET_NEED_LDST_OOL_LABELS
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Alistair.Francis@wdc.com, qemu-devel@nongnu.org
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

On Fri, Nov 23, 2018 at 15:45:25 +0100, Richard Henderson wrote:
> This variant of tcg-ldst.inc.c allows the entire thunk to be
> moved out-of-line, with caching across TBs within a region.
> 
> Signed-off-by: Richard Henderson <richard.henderson@linaro.org>
> ---
(snip)
> +++ b/tcg/tcg-ldst-ool.inc.c
(snip)
> +typedef struct TCGLabelQemuLdstOol {
> +    QSIMPLEQ_ENTRY(TCGLabelQemuLdstOol) next;
> +    tcg_insn_unit *label;   /* label pointer to be updated */
> +    int reloc;              /* relocation type from label_ptr */
> +    intptr_t addend;        /* relocation addend from label_ptr */
> +    uint32_t key;           /* oi : is_64 : is_ld */
> +} TCGLabelQemuLdstOol;

Just a tiny nit, here we can move reloc down to plug a hole.

		Emilio

