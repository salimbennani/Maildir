Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:32:43 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga002.jf.intel.com (orsmga002.jf.intel.com [10.7.209.21])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 455A6580460
	for <like.xu@linux.intel.com>; Thu, 22 Nov 2018 14:46:47 -0800 (PST)
Received: from fmsmga105.fm.intel.com ([10.1.193.10])
  by orsmga002-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 14:46:47 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3Arf5njhW9VLlB+p4Lu1QfjOjhoazV8LGtZVwlr6E/?=
 =?us-ascii?q?grcLSJyIuqrYZRSGvadThVPEFb/W9+hDw7KP9fy4CSpYud6oizMrSNR0TRgLiM?=
 =?us-ascii?q?EbzUQLIfWuLgnFFsPsdDEwB89YVVVorDmROElRH9viNRWJ+iXhpTEdFQ/iOgVr?=
 =?us-ascii?q?O+/7BpDdj9it1+C15pbffxhEiCCybL9uLxi6txndutULioZ+N6g9zQfErGFVcO?=
 =?us-ascii?q?pM32NoIlyTnxf45siu+ZNo7jpdtfE8+cNeSKv2Z6s3Q6BWAzQgKGA1+dbktQLf?=
 =?us-ascii?q?QguV53sTSXsZnxxVCAXY9h76X5Pxsizntuph3SSRIMP7QawoVTmk8qxmTgLjhi?=
 =?us-ascii?q?UaOD4j6GzZlMJwgqJYrhyvqRNwzIzbb52aOvRjZqPQf9EUSGVcUstfSyBOHJi8?=
 =?us-ascii?q?YpATD+cCJ+tUs5XxqlUMoBa4GAKiBPnvyjhNhnLux6M60+UhEQXH3Aw4B9IBrm?=
 =?us-ascii?q?zbotLvO6cOUeC1zbfHzSjaY/1Ywzj99ZXHdQo8qvyLRbJwccvRyU0qFwzYlViQ?=
 =?us-ascii?q?s5LqMC6V1usXr2iX9fZvVeWqi2M+rQx6vzahxsApiobTh4IVzEjJ9T9nz4koJd?=
 =?us-ascii?q?23UlJ7bcS4H5tXsiGXMZZ9TMA6Q2xwpio21r4LtYSmcCQXy5kr3QDTZvKHfoSS?=
 =?us-ascii?q?/x7uVv6dLDR2iX5/eL+yhQy+/VWix+HiTMW50lZHoyxYmdfWrH8NzQbc6s2fR/?=
 =?us-ascii?q?t94Eih3TGP2hjX6uFFOkA0ibHbJ4Quwr42i5ofq0PDHjX5mEnuja+WcFsr+vSw?=
 =?us-ascii?q?5uj5frnrpYWQO5Jphgz9KKgihMKyDOQiPgQTXWWX4eG826fi/U39TrVKlPo2kq?=
 =?us-ascii?q?zBvZDDO8sbo7O5DxZI3Yk99RawETOm3M0DknkAMVJFfg6IgJbyO13JJPD4DPS/?=
 =?us-ascii?q?jEq2nDZk2vDLJrnhApTLLnjen7btZ7d960hAyAUtydBT/Y5bCrYEIP/oXE/xs9?=
 =?us-ascii?q?rYDhA/Mwyp2ernD8991owGVWKVHqCZKL/SsUOP5u83J+mMZYwVtyjnJ/kq+v7j?=
 =?us-ascii?q?lns5mV4bfam00pobcnG4HvJ6I0qHZXrgmMsOEWAPvll2cerxlVfXUSJPf23gGO?=
 =?us-ascii?q?U45yonE8SgCoHMQJ3rh6aOmyKyH5lTb2YBDUiQEHDubMKdVvIRLS6fPMJlwQEC?=
 =?us-ascii?q?TqWrHooo1BWys13jxr96a+bZ5CAc8IjuzcV4/PH7kxY0+jppScOH3DaWUmt2k2?=
 =?us-ascii?q?gUEiIwx711ukdny12OgpR/1tNVD9Abx/RHXAIzM5iUm+9gAsD/Xirbc9uJQUrg?=
 =?us-ascii?q?SdKjV3V5V9803poCblhwH/2kiRbM2TfsBKUaxJKRA5lhyqLd23npP8tK7n/a1K?=
 =?us-ascii?q?gskhwKS9ZDtCXynq5+8w3fL5TEn0WQi+ChcqFKj32Fz3uK0Wfb5BIQawV3S6iQ?=
 =?us-ascii?q?BX0=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AcAACLMPdbhxHrdtBiHAEBAQQBAQcEA?=
 =?us-ascii?q?QGBUQcBAQsBgTCBOQOBExODeYgYX4shgWgllzqBcBUBARgLCYhSIjQJDQEDAQE?=
 =?us-ascii?q?BAQEBAgETAQEBCgsJCCkjDII2BQIDGAmCWwEBAQECAQECIAQLARMKLAMBAgYBA?=
 =?us-ascii?q?QoOCgICIgQCAgMBMAEFARwGAQwGAgEBAYMcAYF0BQgBAwEKnE48iw18M4N6gUa?=
 =?us-ascii?q?DT4EIBRJ5in4XgX+BEScMgl+DGwQYhEuCVwKPGZBpCYZ8ii0GGIFZh3gQJocBj?=
 =?us-ascii?q?UOKRgIEAgQFAgUPIYElgg0zIhsVgyeCJxeDSopTcQGBBopegXcBAQ?=
X-IPAS-Result: =?us-ascii?q?A0AcAACLMPdbhxHrdtBiHAEBAQQBAQcEAQGBUQcBAQsBgTC?=
 =?us-ascii?q?BOQOBExODeYgYX4shgWgllzqBcBUBARgLCYhSIjQJDQEDAQEBAQEBAgETAQEBC?=
 =?us-ascii?q?gsJCCkjDII2BQIDGAmCWwEBAQECAQECIAQLARMKLAMBAgYBAQoOCgICIgQCAgM?=
 =?us-ascii?q?BMAEFARwGAQwGAgEBAYMcAYF0BQgBAwEKnE48iw18M4N6gUaDT4EIBRJ5in4Xg?=
 =?us-ascii?q?X+BEScMgl+DGwQYhEuCVwKPGZBpCYZ8ii0GGIFZh3gQJocBjUOKRgIEAgQFAgU?=
 =?us-ascii?q?PIYElgg0zIhsVgyeCJxeDSopTcQGBBopegXcBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,267,1539673200"; 
   d="scan'208";a="139255895"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 22 Nov 2018 14:46:46 -0800
Received: from localhost ([::1]:49613 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gPxkD-0002Qw-M9
	for like.xu@linux.intel.com; Thu, 22 Nov 2018 17:46:45 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:43452)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <philmd@redhat.com>) id 1gPxjz-0002N8-Mp
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 17:46:32 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <philmd@redhat.com>) id 1gPxjw-0000og-JW
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 17:46:31 -0500
Received: from mail-wm1-f68.google.com ([209.85.128.68]:54172)
	by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_128_CBC_SHA1:16)
	(Exim 4.71) (envelope-from <philmd@redhat.com>) id 1gPxjw-0000n2-DE
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 17:46:28 -0500
Received: by mail-wm1-f68.google.com with SMTP id y1so7041345wmi.3
	for <qemu-devel@nongnu.org>; Thu, 22 Nov 2018 14:46:28 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20161025;
	h=x-gm-message-state:subject:to:references:from:openpgp:message-id
	:date:user-agent:mime-version:in-reply-to:content-language
	:content-transfer-encoding;
	bh=Gts9j/MvTfNEGoAF/fw+VT6fjIRPPJY6UnMiwMhZaCA=;
	b=JHeY9JMMKgF9PAoj7vCZzpVk5MM1YG/jO6xfRTRrjMHZNTFEe0cRJzwCecNO24C74t
	N+FtrOFr+tskppk51QV3QUjPF/IbdTNy3tLd+7pbd3NksZPeuudznlq5fpCGIEbYjXCr
	9sbDJJPGLsxsgQf+REIq8X9gWaof43mnB2xNWXlMZ4fBZq1nb8LhIHzdb7XF2UZj5CF7
	1WKbfGRGthaMsHGFRhBWsdTyFcIGR6GW522ZoYgOlBw8Nd+my/JIQK1ZmTqXYt8qw5ca
	U9P/Z8ZWvVOZ+jR7byQ8tg/j0twddDRWQ5XZvZnBMorm5gF5RQoRxaujhrekIk3YTfJw
	zdRg==
X-Gm-Message-State: AGRZ1gJTlreLmwzxKRJ22P1b878MD7A3RqALlfJOwRzhACIiVdYzWuR1
	NWDkB3Gn9p5itSrydd1Mwx4VblleD8c=
X-Google-Smtp-Source: AFSGD/XjsZTqlLEk36pvkEY8VBcY7n3JsdxlRu7djXXeeVycfMJcV8vDv0jHMtyOoec+ZmPKGIVLtw==
X-Received: by 2002:a1c:d14d:: with SMTP id i74mr10873511wmg.100.1542926787244;
	Thu, 22 Nov 2018 14:46:27 -0800 (PST)
Received: from [192.168.1.33] (75.red-83-57-172.dynamicip.rima-tde.net.
	[83.57.172.75]) by smtp.gmail.com with ESMTPSA id
	j14sm27412701wrv.96.2018.11.22.14.46.26
	(version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
	Thu, 22 Nov 2018 14:46:26 -0800 (PST)
To: Gerd Hoffmann <kraxel@redhat.com>, qemu-devel@nongnu.org
References: <20181122133207.29928-1-kraxel@redhat.com>
From: =?UTF-8?Q?Philippe_Mathieu-Daud=c3=a9?= <philmd@redhat.com>
Openpgp: url=http://pgp.mit.edu/pks/lookup?op=get&search=0xA2A3FD6EDEADC0DE
Message-ID: <0e3834f7-7345-2e23-9b85-254ac354d20b@redhat.com>
Date: Thu, 22 Nov 2018 23:46:26 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.3.0
MIME-Version: 1.0
In-Reply-To: <20181122133207.29928-1-kraxel@redhat.com>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 8bit
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 209.85.128.68
Subject: Re: [Qemu-devel] [PATCH] audio/hda: fix guest triggerable assert
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

Hi Gerd,

On 22/11/18 14:32, Gerd Hoffmann wrote:
> Guest writes to a readonly register trigger the assert in
> intel_hda_reg_write().  Add a check and just ignore them.

Is this 3.1 material? It seems to apply.

> 
> Buglink: https://bugzilla.redhat.com/show_bug.cgi?id=1628433
> Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
> ---
>  hw/audio/intel-hda.c | 4 ++++
>  1 file changed, 4 insertions(+)
> 
> diff --git a/hw/audio/intel-hda.c b/hw/audio/intel-hda.c
> index 23a2cf6484..066532713c 100644
> --- a/hw/audio/intel-hda.c
> +++ b/hw/audio/intel-hda.c
> @@ -929,6 +929,10 @@ static void intel_hda_reg_write(IntelHDAState *d, const IntelHDAReg *reg, uint32
>      if (!reg) {
>          return;
>      }
> +    if (!reg->wmask) {
> +        /* read-only register */

Can you add:

           qemu_log_mask(LOG_GUEST_ERROR,
                         "intel-hda: Register %s is read-only\n",
                         reg->name);

Regardless:
Reviewed-by: Philippe Mathieu-Daud√© <philmd@redhat.com>

> +        return;
> +    }
>  
>      if (d->debug) {
>          time_t now = time(NULL);
> 

