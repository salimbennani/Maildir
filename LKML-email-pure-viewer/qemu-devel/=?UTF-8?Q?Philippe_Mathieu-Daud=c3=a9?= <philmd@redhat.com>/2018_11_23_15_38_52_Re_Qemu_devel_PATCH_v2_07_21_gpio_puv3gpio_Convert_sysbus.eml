Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 23:49:44 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga007.jf.intel.com (orsmga007.jf.intel.com [10.7.209.58])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id ACE365803EB
	for <like.xu@linux.intel.com>; Fri, 23 Nov 2018 07:50:43 -0800 (PST)
Received: from orsmga102-1.jf.intel.com (HELO mga09.intel.com) ([10.7.208.27])
  by orsmga007-1.jf.intel.com with ESMTP; 23 Nov 2018 07:50:43 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3A00w+Jh3I9Uaaz09NsmDT+DRfVm0co7zxezQtwd8Z?=
 =?us-ascii?q?sesWLfvxwZ3uMQTl6Ol3ixeRBMOHs6IC07KempujcFRI2YyGvnEGfc4EfD4+ou?=
 =?us-ascii?q?JSoTYdBtWYA1bwNv/gYn9yNs1DUFh44yPzahANS47xaFLIv3K98yMZFAnhOgpp?=
 =?us-ascii?q?POT1HZPZg9iq2+yo9JDffwZFiCChbb9uMR67sRjfus4KjIV4N60/0AHJonxGe+?=
 =?us-ascii?q?RXwWNnO1eelAvi68mz4ZBu7T1et+ou+MBcX6r6eb84TaFDAzQ9L281/szrugLd?=
 =?us-ascii?q?QgaJ+3ART38ZkhtMAwjC8RH6QpL8uTb0u+ZhxCWXO9D9QKsqUjq+8ahkVB7oiD?=
 =?us-ascii?q?8GNzEn9mHXltdwh79frB64uhBz35LYbISTOfFjfK3SYMkaSHJfUMZfVyJPAY2y?=
 =?us-ascii?q?YIUAAOUDIelWoJTzp0MMoBW8CgSgGe3ixiNWiX/txqA6z+csHBva0AA8Ed8Dsn?=
 =?us-ascii?q?LZp8j1OqcIVuC1ybHFwy/Db/NX3Tf96ZDIcgg/rv6UWrx/a9bRyUkuFwzbk1Wc?=
 =?us-ascii?q?sILrMCmI1usQqW+Q8u1tVfqvi24mrwFxpyWgy9w2iobXm40VykrL9TljzIkpIt?=
 =?us-ascii?q?24TVd2bNi5G5VTryGXL5V6Tt8hTm1ypSo2174LtYSlcCUEyJkr3QPTZv6ff4SW?=
 =?us-ascii?q?+B3vSPudLDJmi39reL+yghW//lK9xu3yU8S7zUpFojdZntTJrX8Cyxje5daCR/?=
 =?us-ascii?q?tz/0qtxDmC2gXN5u5ZIE07jq/WJpw9zbEskpcet1nIEDXsl0XslqCWc10p+ui2?=
 =?us-ascii?q?5OTjZbXrvpucN45vigHiKaQigMO/AeIlMgQUWGib4+u82KXi/U3/XrpKkuU7nr?=
 =?us-ascii?q?fFvJ3ZP8gXu7O1DgxP3oo95RuyDy2q3MkakHUfKVJKYhOHj4znO1HUJ/D4CO+y?=
 =?us-ascii?q?g02ynzdu2vDKJ6DuDYvTLnfdlLftZK1y60lByAo10d9Q+YlUBrYFIPLyWU/+qs?=
 =?us-ascii?q?bUDxAkMwGsx+bnCdN91p4RWG6VA6+ZNr/SvkGM5u41P+aMY4oVtS37K/gi4f7u?=
 =?us-ascii?q?gnk5mUIHcamux5sXZ2i0Hu56LEWBfXrsntABHH8Ovgo/T+zllkeOUDFOZ3upW6?=
 =?us-ascii?q?I85zc7CJ+pDIvZR4CthqCB0zm/HpFMem9GDVWMQj/VcZ6ZUaIMdD6KOZ0m1TgF?=
 =?us-ascii?q?TqS6DYkm0x6oqUn90bUgK+PV/igRs9XkzMR04OvI0gg/8CExA8mD3mXecmdvg2?=
 =?us-ascii?q?ldQjY32Lx481Vwz0rG3aVmjvgdD9FK+v5STi88MpjTyfE8DMr9DRncdNWEQ0rz?=
 =?us-ascii?q?X9O9HDsqRcgwydJdX0EoPtylxiLD2CylEr5dw7mCA4409aTTznnZLMNm0DDN1K?=
 =?us-ascii?q?gnhlwhSMpLOCutgasps0DKCovU1kmUiauuXaIb2iHL6SGE12XdkltfVVtIUaTB?=
 =?us-ascii?q?XGgHa3zzpMj5507fCpOnFLimel9Zyc+GL6dicNDljVxaAvzkPYKNMCqKh26sCE?=
 =?us-ascii?q?PQlfu3Z43wdjBYhX2FBQ=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AKAAC4IPhbhxHrdtBjGwEBAQEDAQEBB?=
 =?us-ascii?q?wMBAQGBUgUBAQELAYEwgmKDeYh3iyGBYC2XO4FxFAEBGBSIWiI1CA0BAwEBAQE?=
 =?us-ascii?q?BAQIBEwEBAQoLCQgbDi+CNgUCAxoBBoJcAQIDAQIgBAsBEwopAwMBAgYBAQoYA?=
 =?us-ascii?q?gIiBAICAwEwAQUBHAYBDAYCAQEBgxyBdQ0BBJs4PIsNfDOFQINNgQ0SeYp+F4F?=
 =?us-ascii?q?/gTiCa4gCglcCiSADll8JkSkGGIlRhzcsl10CBAIEBQIFDyGBJwGCCjMiGxWDJ?=
 =?us-ascii?q?4InFxKOC3GBByGKCYF3AQE?=
X-IPAS-Result: =?us-ascii?q?A0AKAAC4IPhbhxHrdtBjGwEBAQEDAQEBBwMBAQGBUgUBAQE?=
 =?us-ascii?q?LAYEwgmKDeYh3iyGBYC2XO4FxFAEBGBSIWiI1CA0BAwEBAQEBAQIBEwEBAQoLC?=
 =?us-ascii?q?QgbDi+CNgUCAxoBBoJcAQIDAQIgBAsBEwopAwMBAgYBAQoYAgIiBAICAwEwAQU?=
 =?us-ascii?q?BHAYBDAYCAQEBgxyBdQ0BBJs4PIsNfDOFQINNgQ0SeYp+F4F/gTiCa4gCglcCi?=
 =?us-ascii?q?SADll8JkSkGGIlRhzcsl10CBAIEBQIFDyGBJwGCCjMiGxWDJ4InFxKOC3GBByG?=
 =?us-ascii?q?KCYF3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,270,1539673200"; 
   d="scan'208";a="54548084"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 23 Nov 2018 07:50:12 -0800
Received: from localhost ([::1]:53140 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gQDid-00077a-Fj
	for like.xu@linux.intel.com; Fri, 23 Nov 2018 10:50:11 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:33551)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <philmd@redhat.com>) id 1gQDXo-0004Ek-0w
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 10:39:01 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <philmd@redhat.com>) id 1gQDXk-0008In-Sv
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 10:38:59 -0500
Received: from mail-wr1-f67.google.com ([209.85.221.67]:35505)
	by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_128_CBC_SHA1:16)
	(Exim 4.71) (envelope-from <philmd@redhat.com>) id 1gQDXj-000895-8s
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 10:38:56 -0500
Received: by mail-wr1-f67.google.com with SMTP id 96so12770375wrb.2
	for <qemu-devel@nongnu.org>; Fri, 23 Nov 2018 07:38:55 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20161025;
	h=x-gm-message-state:subject:to:cc:references:from:openpgp:message-id
	:date:user-agent:mime-version:in-reply-to:content-language
	:content-transfer-encoding;
	bh=V+a1/WBELptR7fpl2FKhpA9bebyx6hc9RZcmxo3BGhA=;
	b=TeV9j5dgn7JUzs80VehD8713rLvIlr1qA4UMhYL4fDoWpVe/9ZNEU/DjgW2KEZPl1p
	EPqejzvF9YDJI9C+PkHrSLe6Ds0liErj8E9OvvS7fI48izaiv/ksSHn6HCoVqG6hIaZz
	TxTSK3LbrG/+y9qcWtEzCP3+oUyiBAIMofpUv41e18a7vhcbC9EURhZCVLrRw818seZ1
	VVrrtm6bidpmGFj6GH77aoQNShR7eJN6v0NVDWXEFP5aelM923UoICHvSCfAXsRf8QTl
	0JujPI0qJZOMGj1+SVhQd1epLvkiPXbWqfO9N48krpWyinqNfL400y7wi5odF2qtcO7O
	Pufg==
X-Gm-Message-State: AA+aEWb3LnBXt9zP1aX0YiCwOLT2Q9ME6mlJllAT8UV9vNP9LE0oqkI1
	1JhCSdShMYrEuZOTj9g7phUoiA==
X-Google-Smtp-Source: AFSGD/X2seNvanYKjDNiUCPezWXgNqE2YE9n1o65Hfv+JTq/6PAfgw2QB/m/ITY9vLAsgTCDvn8uxg==
X-Received: by 2002:adf:f605:: with SMTP id t5mr13840530wrp.229.1542987534261; 
	Fri, 23 Nov 2018 07:38:54 -0800 (PST)
Received: from ?IPv6:2a01:e35:8a1f:dc10:bc9e:f614:2d6b:7cc9?
	([2a01:e35:8a1f:dc10:bc9e:f614:2d6b:7cc9])
	by smtp.gmail.com with ESMTPSA id
	b16sm64591133wrm.41.2018.11.23.07.38.53
	(version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
	Fri, 23 Nov 2018 07:38:53 -0800 (PST)
To: Mao Zhongyi <maozhongyi@cmss.chinamobile.com>, qemu-devel@nongnu.org
References: <20181123153040.18933-1-maozhongyi@cmss.chinamobile.com>
	<20181123153040.18933-8-maozhongyi@cmss.chinamobile.com>
From: =?UTF-8?Q?Philippe_Mathieu-Daud=c3=a9?= <philmd@redhat.com>
Openpgp: url=http://pgp.mit.edu/pks/lookup?op=get&search=0xA2A3FD6EDEADC0DE
Message-ID: <2bb9f1cc-9a01-4a11-e196-1597f960b2b9@redhat.com>
Date: Fri, 23 Nov 2018 16:38:52 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
	Thunderbird/60.3.0
MIME-Version: 1.0
In-Reply-To: <20181123153040.18933-8-maozhongyi@cmss.chinamobile.com>
Content-Type: text/plain; charset=utf-8
Content-Language: en-US
Content-Transfer-Encoding: 8bit
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 209.85.221.67
Subject: Re: [Qemu-devel] [PATCH v2 07/21] gpio/puv3_gpio: Convert sysbus
 init function to realize function
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: peter.maydell@linaro.org, gxt@mprc.pku.edu.cn,
	Zhang Shengju <zhangshengju@cmss.chinamobile.com>
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

On 23/11/18 16:30, Mao Zhongyi wrote:
> Use DeviceClass rather than SysBusDeviceClass in
> puv3_gpio_class_init().
> 
> Cc: gxt@mprc.pku.edu.cn
> Cc: peter.maydell@linaro.org
> 
> Signed-off-by: Mao Zhongyi <maozhongyi@cmss.chinamobile.com>
> Signed-off-by: Zhang Shengju <zhangshengju@cmss.chinamobile.com>

Reviewed-by: Philippe Mathieu-Daud√© <philmd@redhat.com>

> ---
>  hw/gpio/puv3_gpio.c | 29 ++++++++++++++---------------
>  1 file changed, 14 insertions(+), 15 deletions(-)
> 
> diff --git a/hw/gpio/puv3_gpio.c b/hw/gpio/puv3_gpio.c
> index 445afccf9f..33241b8564 100644
> --- a/hw/gpio/puv3_gpio.c
> +++ b/hw/gpio/puv3_gpio.c
> @@ -99,36 +99,35 @@ static const MemoryRegionOps puv3_gpio_ops = {
>      .endianness = DEVICE_NATIVE_ENDIAN,
>  };
>  
> -static int puv3_gpio_init(SysBusDevice *dev)
> +static void puv3_gpio_realize(DeviceState *dev, Error **errp)
>  {
>      PUV3GPIOState *s = PUV3_GPIO(dev);
> +    SysBusDevice *sbd = SYS_BUS_DEVICE(dev);
>  
>      s->reg_GPLR = 0;
>      s->reg_GPDR = 0;
>  
>      /* FIXME: these irqs not handled yet */
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW0]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW1]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW2]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW3]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW4]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW5]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW6]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOLOW7]);
> -    sysbus_init_irq(dev, &s->irq[PUV3_IRQS_GPIOHIGH]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW0]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW1]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW2]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW3]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW4]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW5]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW6]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOLOW7]);
> +    sysbus_init_irq(sbd, &s->irq[PUV3_IRQS_GPIOHIGH]);
>  
>      memory_region_init_io(&s->iomem, OBJECT(s), &puv3_gpio_ops, s, "puv3_gpio",
>              PUV3_REGS_OFFSET);
> -    sysbus_init_mmio(dev, &s->iomem);
> -
> -    return 0;
> +    sysbus_init_mmio(sbd, &s->iomem);
>  }
>  
>  static void puv3_gpio_class_init(ObjectClass *klass, void *data)
>  {
> -    SysBusDeviceClass *sdc = SYS_BUS_DEVICE_CLASS(klass);
> +    DeviceClass *dc = DEVICE_CLASS(klass);
>  
> -    sdc->init = puv3_gpio_init;
> +    dc->realize = puv3_gpio_realize;
>  }
>  
>  static const TypeInfo puv3_gpio_info = {
> 

