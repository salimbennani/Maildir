Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:30:08 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga008.fm.intel.com (fmsmga008.fm.intel.com [10.253.24.58])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 8239558037D
	for <like.xu@linux.intel.com>; Thu, 22 Nov 2018 09:13:07 -0800 (PST)
Received: from fmsmga101.fm.intel.com ([10.1.193.65])
  by fmsmga008-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 09:13:07 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3Ac/K+MBUl+Nnzb9X+kTDozdbrWMvV8LGtZVwlr6E/?=
 =?us-ascii?q?grcLSJyIuqrYbReGt8tkgFKBZ4jH8fUM07OQ7/iwHzRYqb+681k6OKRWUBEEjc?=
 =?us-ascii?q?hE1ycBO+WiTXPBEfjxciYhF95DXlI2t1uyMExSBdqsLwaK+i764jEdAAjwOhRo?=
 =?us-ascii?q?LerpBIHSk9631+ev8JHPfglEnjWwba9xIRmssQndqtQdjJd/JKo21hbHuGZDdf?=
 =?us-ascii?q?5MxWNvK1KTnhL86dm18ZV+7SleuO8v+tBZX6nicKs2UbJXDDI9M2Ao/8LrrgXM?=
 =?us-ascii?q?TRGO5nQHTGoblAdDDhXf4xH7WpfxtTb6tvZ41SKHM8D6Uaw4VDK/5KptVRTmij?=
 =?us-ascii?q?oINyQh/W/XlMJ+gqFVrhWuqBJw3oDUeIOYOvhxc6/Ac94WWXROXt1KWiBdAY6x?=
 =?us-ascii?q?dZcDAvAdMepEqYT2ulsArQG5BQmpHO7h0CFHhmPo0q0gzu8vFhvJ3Qw9EN0QtH?=
 =?us-ascii?q?TUqMj+OaAKUe+r0KnH0y/DY+lT2Tjn6InHbw4uofWIXb9rdcrRyE8vGBnfjlWX?=
 =?us-ascii?q?s4DlOCmV1usUvmWd8uFuVvqvhnY5pw1toTWj3NoghpTKi44P1FzJ+yV0zJwoKd?=
 =?us-ascii?q?C6UEJ3f8KoHIdNuyyfNIZ5Wd8uTmR1tCkn1rELvJu2cDYMxZ863RDQceaHfJKN?=
 =?us-ascii?q?4h/7VOaePzN4hHV9dbK7hhay6lSgyvbmWsm71lZKszBJkt7WtnACzxDT686HRe?=
 =?us-ascii?q?Vh/kq5xzqDywPe5vtZLUwplqfXMYAtz7Awm5YJrEjOHDf6mEDsg6+XckUk9PKo?=
 =?us-ascii?q?6+PiYrj+v5+TKYp0ihznPqszhMO/H/o3MgwXU2eA/uS8ybvj8lHnT7VRifE2lq?=
 =?us-ascii?q?jZsJPEKsgBqa+5HhdY0oIi6xa5Ejen384UnXgBLFJZZh2Hi5LlNE3JIPD9Fvq/?=
 =?us-ascii?q?hVOskDFkx/DAI73tGJLNLmLMkLv5Z7Zy91ZcyBYvzdBY/59UDrABIPHtVUPru9?=
 =?us-ascii?q?3YEwQ0Mwi1w+bhFdV82ZkSWWOJAq+FLqzStUWE6f4oI+mJN8covi3gIa0l++L2?=
 =?us-ascii?q?li1+3lscZrWym50Qbn++A7JhOUreZHPthtIIFyANphY/S+rxz0SPVCMWa3usUq?=
 =?us-ascii?q?Zv2zcgFYjzCI7CQpyq0qWM2Tr+EpBIa2QDEF2VDHrza62CXPEDbj/UJdVuxScZ?=
 =?us-ascii?q?X7qsQJN0yBe1qQXhwKBmJOeHxipNrJ/myZ156vPekTk08jp7Cdnb1HuCHE9umW?=
 =?us-ascii?q?ZdfzIq0bo3hEVsxlqH1eAsm/FEGMYV4vpYXgo+MbbYzupzEde0XRjOKITaAG26?=
 =?us-ascii?q?S8mrVGliBuk6xMUDNh5w?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AmAACE4vZbhxHrdtBiHgEGBwaBUQkLA?=
 =?us-ascii?q?YEwgmKMb4silFCEd4FxFhgUiFIiNAkNAQMBAQEBAQECARMBAQEKCwkIKS+CNgU?=
 =?us-ascii?q?CAxgJgl8EAiQLARMKKQMDAQIGAkgIAwFsBYMcggIBBKo9M4VAhF+HXoQrgVc/g?=
 =?us-ascii?q?RGIXYUOAokjll8HAoIcBI8ECxiRCCyYBIFGgg0zGjCDL4InFxKOCkExgQeKXYF?=
 =?us-ascii?q?3AQE?=
X-IPAS-Result: =?us-ascii?q?A0AmAACE4vZbhxHrdtBiHgEGBwaBUQkLAYEwgmKMb4silFC?=
 =?us-ascii?q?Ed4FxFhgUiFIiNAkNAQMBAQEBAQECARMBAQEKCwkIKS+CNgUCAxgJgl8EAiQLA?=
 =?us-ascii?q?RMKKQMDAQIGAkgIAwFsBYMcggIBBKo9M4VAhF+HXoQrgVc/gRGIXYUOAokjll8?=
 =?us-ascii?q?HAoIcBI8ECxiRCCyYBIFGgg0zGjCDL4InFxKOCkExgQeKXYF3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,266,1539673200"; 
   d="scan'208";a="63600378"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mga01b.intel.com with ESMTP/TLS/AES256-SHA; 22 Nov 2018 09:13:06 -0800
Received: from localhost ([::1]:47948 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gPsXJ-0001Lj-Vq
	for like.xu@linux.intel.com; Thu, 22 Nov 2018 12:13:06 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:41853)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <pm215@archaic.org.uk>) id 1gPsNu-0002CB-HD
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 12:03:23 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <pm215@archaic.org.uk>) id 1gPsNq-0003WP-Gt
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 12:03:22 -0500
Received: from orth.archaic.org.uk ([2001:8b0:1d0::2]:52774)
	by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_256_CBC_SHA1:32)
	(Exim 4.71) (envelope-from <pm215@archaic.org.uk>)
	id 1gPsNp-0003OX-00
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 12:03:18 -0500
Received: from pm215 by orth.archaic.org.uk with local (Exim 4.89)
	(envelope-from <pm215@archaic.org.uk>)
	id 1gPsNj-0005Zt-VH; Thu, 22 Nov 2018 17:03:11 +0000
From: Peter Maydell <peter.maydell@linaro.org>
To: qemu-devel@nongnu.org
Date: Thu, 22 Nov 2018 17:03:09 +0000
Message-Id: <20181122170309.4856-1-peter.maydell@linaro.org>
X-Mailer: git-send-email 2.19.1
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
X-detected-operating-system: by eggs.gnu.org: Genre and OS details not
	recognized.
X-Received-From: 2001:8b0:1d0::2
Subject: [Qemu-devel] [PATCH for-4.0] ui/console: Remove
 qemu_create_display_surface_guestmem()
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Gerd Hoffmann <kraxel@redhat.com>, patches@linaro.org
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

The qemu_create_display_surface_guestmem() function was added in
commit a77549b3ffcc24c32ee4e but apparently never used. Remove it.

(The API of this function is in any case awkward as a generic
function: it assumes that a physical address uniquely identifies
a piece of memory in the system, which is mostly but not
always true.)

Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
---
 include/ui/console.h |  4 ----
 ui/console.c         | 36 ------------------------------------
 2 files changed, 40 deletions(-)

diff --git a/include/ui/console.h b/include/ui/console.h
index c17803c530a..853fcf4eb75 100644
--- a/include/ui/console.h
+++ b/include/ui/console.h
@@ -257,10 +257,6 @@ DisplaySurface *qemu_create_displaysurface_from(int width, int height,
                                                 pixman_format_code_t format,
                                                 int linesize, uint8_t *data);
 DisplaySurface *qemu_create_displaysurface_pixman(pixman_image_t *image);
-DisplaySurface *qemu_create_displaysurface_guestmem(int width, int height,
-                                                    pixman_format_code_t format,
-                                                    int linesize,
-                                                    uint64_t addr);
 DisplaySurface *qemu_create_message_surface(int w, int h,
                                             const char *msg);
 PixelFormat qemu_default_pixelformat(int bpp);
diff --git a/ui/console.c b/ui/console.c
index 3a285bae00a..7076becedd5 100644
--- a/ui/console.c
+++ b/ui/console.c
@@ -1385,42 +1385,6 @@ DisplaySurface *qemu_create_displaysurface_pixman(pixman_image_t *image)
     return surface;
 }
 
-static void qemu_unmap_displaysurface_guestmem(pixman_image_t *image,
-                                               void *unused)
-{
-    void *data = pixman_image_get_data(image);
-    uint32_t size = pixman_image_get_stride(image) *
-        pixman_image_get_height(image);
-    cpu_physical_memory_unmap(data, size, 0, 0);
-}
-
-DisplaySurface *qemu_create_displaysurface_guestmem(int width, int height,
-                                                    pixman_format_code_t format,
-                                                    int linesize, uint64_t addr)
-{
-    DisplaySurface *surface;
-    hwaddr size;
-    void *data;
-
-    if (linesize == 0) {
-        linesize = width * PIXMAN_FORMAT_BPP(format) / 8;
-    }
-
-    size = (hwaddr)linesize * height;
-    data = cpu_physical_memory_map(addr, &size, 0);
-    if (size != (hwaddr)linesize * height) {
-        cpu_physical_memory_unmap(data, size, 0, 0);
-        return NULL;
-    }
-
-    surface = qemu_create_displaysurface_from
-        (width, height, format, linesize, data);
-    pixman_image_set_destroy_function
-        (surface->image, qemu_unmap_displaysurface_guestmem, NULL);
-
-    return surface;
-}
-
 DisplaySurface *qemu_create_message_surface(int w, int h,
                                             const char *msg)
 {
-- 
2.19.1


