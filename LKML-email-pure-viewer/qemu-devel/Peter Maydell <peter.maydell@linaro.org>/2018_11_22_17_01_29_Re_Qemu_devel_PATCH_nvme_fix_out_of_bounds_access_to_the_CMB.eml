Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:30:11 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga004.fm.intel.com (fmsmga004.fm.intel.com [10.253.24.48])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 7D01158037D
	for <like.xu@linux.intel.com>; Thu, 22 Nov 2018 09:17:06 -0800 (PST)
Received: from fmsmga103.fm.intel.com ([10.1.193.90])
  by fmsmga004-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 22 Nov 2018 09:17:06 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3AbWTeeRI85zw0ZKl0stmcpTZWNBhigK39O0sv0rFi?=
 =?us-ascii?q?tYgXKvz7rarrMEGX3/hxlliBBdydt6oUzbKO+4nbGkU4qa6bt34DdJEeHzQksu?=
 =?us-ascii?q?4x2zIaPcieFEfgJ+TrZSFpVO5LVVti4m3peRMNQJW2aFLduGC94iAPERvjKwV1?=
 =?us-ascii?q?Ov71GonPhMiryuy+4ZLebxlLiTanfb9+MAi9oBnMuMURnYZsMLs6xAHTontPde?=
 =?us-ascii?q?RWxGdoKkyWkh3h+Mq+/4Nt/jpJtf45+MFOTav1f6IjTbxFFzsmKHw65NfqtRbY?=
 =?us-ascii?q?UwSC4GYXX3gMnRpJBwjF6wz6Xov0vyDnuOdxxDWWMMvrRr0vRz+s87lkRwPpiC?=
 =?us-ascii?q?cfNj427mfXitBrjKlGpB6tvgFzz5LIbI2QMvd1Y6HTcs4ARWdZXMlRWSxPDI2/?=
 =?us-ascii?q?YYURE+UPIP5Yoov/qVYBsBezCxWgC/30yjJTmn/6wbc33/g9HQ3a3gEtGc8Fvn?=
 =?us-ascii?q?TOrNXyMacfSfq7w7fUzTrddfNdxDDz55LIcx88v/6MWbZwetfWxEk3CQzFkkuf?=
 =?us-ascii?q?qZb/MzOQzOsMs3WU4PRkVeKrkGMnrwBxoj61ycc2jYnFnIUVykrL9Shgxos+ON?=
 =?us-ascii?q?62SFZjbNK6DJddtDuWO5ZrTs4hWW1kpig3x70ctZKmfiUG0Ioryh/DZ/GFdoWI?=
 =?us-ascii?q?7BHuW/2NLTp9i39oe7Oyihm3/ES+1uHxU8y53VhFoydLlNTHq2oD2AbJ6sedT/?=
 =?us-ascii?q?tw5keh1iiL1wDU8uxEJUE0lbHHK5462LIwmZwTsVnZEi/xgkX2g7eadkQi+ue2?=
 =?us-ascii?q?9+TqeqvqqoOfOoNulw3yL6cjltahDek2MgUCRXWX9Oak2L3m50L5QbFKjvMskq?=
 =?us-ascii?q?netZDXPd0bqbC8Aw9Iy4os9giwDym439QchHUIN1VFeA+Bj4f1JV7OO/f0DfO+?=
 =?us-ascii?q?g1Svjjhn3f/HPqD5D5XJL3jDlqrhfLln505dzgoz0c5Q55ZOBr4dJ/LzX1T8tN?=
 =?us-ascii?q?rfDh8/PAy0xfvnBM961oMEVmKDGrWZP7/KsV+U+uIvJPGBZIsUuDb+Nfcp/fHv?=
 =?us-ascii?q?jWIilF8ZfKmp24YXaX+iEvRnJUWZfWTjgtMbHWgWuQo+Sb+itVuZTDQGZ2quR7?=
 =?us-ascii?q?luoXY/CZm6FsHFQYaihqHH2z20WZhfZ2RDA1bLFm/0doKCQLAVZSePZ8NsjDEA?=
 =?us-ascii?q?BoWnUJIrgBSntQvmzOh+I+/JvyEVq5/nkcJ4/vDejg0a8ztyAMKAlWaXQDZvg2?=
 =?us-ascii?q?kKSjQqib15ulF30VyZ0KJ10MBfQORa4PdOGi09M4zdye0yX8j4XQTTf9GIYEyr?=
 =?us-ascii?q?TtWvHXc6SddnkPEUZEMoI9i+gwqL+iO7D7IRk/TfHJEo/7ia2nHgK8t5z17C1a?=
 =?us-ascii?q?8olV5gRdFAYz71zpVj/hTeUtaa236SkLynIOFFhHbA?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AXAABm5PZbhxHrdtBiHgEGBwaBUQkLA?=
 =?us-ascii?q?YEwgmKDeIh3iyKCDZc6gXUSGBSIUiI0CQ0BAwEBAQEBAQIBEwEBAQoLCQgpIwy?=
 =?us-ascii?q?CNgUCAxoBBoJcAQIDAQIgBBkBAQQKKQECAwECBgEBCgsDCgICIgQCAgMBHhIBB?=
 =?us-ascii?q?QEcBhMFgxyCAgEEnXo8ih1wfDOCdgEBBYcaCBJ5in6BVz+BEYMSiAKCV4sTlHE?=
 =?us-ascii?q?HAoIcBI8PGIFZiC6HAZghDyGBJYINMxowdAaCNYIbCRqIXoU+QTGBB4pdgXcBA?=
 =?us-ascii?q?Q?=
X-IPAS-Result: =?us-ascii?q?A0AXAABm5PZbhxHrdtBiHgEGBwaBUQkLAYEwgmKDeIh3iyK?=
 =?us-ascii?q?CDZc6gXUSGBSIUiI0CQ0BAwEBAQEBAQIBEwEBAQoLCQgpIwyCNgUCAxoBBoJcA?=
 =?us-ascii?q?QIDAQIgBBkBAQQKKQECAwECBgEBCgsDCgICIgQCAgMBHhIBBQEcBhMFgxyCAgE?=
 =?us-ascii?q?EnXo8ih1wfDOCdgEBBYcaCBJ5in6BVz+BEYMSiAKCV4sTlHEHAoIcBI8PGIFZi?=
 =?us-ascii?q?C6HAZghDyGBJYINMxowdAaCNYIbCRqIXoU+QTGBB4pdgXcBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,266,1539673200"; 
   d="scan'208";a="52999556"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 22 Nov 2018 09:16:48 -0800
Received: from localhost ([::1]:48044 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gPsat-0004gU-7T
	for like.xu@linux.intel.com; Thu, 22 Nov 2018 12:16:47 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:41216)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <peter.maydell@linaro.org>) id 1gPsMW-0000XM-Fj
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 12:01:57 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <peter.maydell@linaro.org>) id 1gPsMR-0000qP-1g
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 12:01:56 -0500
Received: from mail-ot1-x343.google.com ([2607:f8b0:4864:20::343]:37692)
	by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_128_CBC_SHA1:16)
	(Exim 4.71) (envelope-from <peter.maydell@linaro.org>)
	id 1gPsMQ-0000on-TI
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 12:01:50 -0500
Received: by mail-ot1-x343.google.com with SMTP id 40so8582857oth.4
	for <qemu-devel@nongnu.org>; Thu, 22 Nov 2018 09:01:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
	h=mime-version:in-reply-to:references:from:date:message-id:subject:to
	:cc; bh=54xQ0ncum10mqQn9dbHicmHCPgB7PtnTMzc/VdLUmv8=;
	b=bRis1WtPBTAfmMHDVoXftrpD5c9QqdZM5gS8ruUROaypnoaC+npaXlzA92MEWwqsq5
	Dt6cxQZ5Y/06sdJ1k3nkaDsYXBstibSTGg3GAwADtA+fDdu1iOnj7VGV/Of8lqpMCqyt
	yx8canmP7eysN3d1OLEah3zS8eXAGKo+wAYvg=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20161025;
	h=x-gm-message-state:mime-version:in-reply-to:references:from:date
	:message-id:subject:to:cc;
	bh=54xQ0ncum10mqQn9dbHicmHCPgB7PtnTMzc/VdLUmv8=;
	b=VFkQiTAoSS0zDbUbYA4X1jnJ1uVvI/IZVvsl1bAQLiqaVZA7cZpLVAvOsBpEBR/ij/
	NRAYxVHPQpgPU5Fk4jYQHVFXSa+wffCj2tb/njKfoFHMKWkPbZrAYtcCoehEc4ibvP5c
	76lCA7tMwL/F+qt1Og5ALOxksnGV6v+OalMmGqMKOaWC0YRvVQ107wAvwIianqEtXHLy
	bSHAKQ3WwkaVXmARE5pwmPslC6Jw11g8Gei8VAxr2KKXc7te/slFEOJEEFctOEkPm+Zz
	HKQCcX2R+jEJz7aAKWbo0ZFy6TznsENQzKVMzmStdPM9T/bzOjPVlzOeQxyjRKHunpYu
	RMHg==
X-Gm-Message-State: AA+aEWYPlyXoPlGcThVtGM5EXhKDCoEhhLZ8wslGiX3VHA19fyaYCBWw
	cyDixHRbRjaIwgJedMkOHWdCOnuIk+uBN3+sO2eISA==
X-Google-Smtp-Source: AFSGD/WX4dknjclMDK3HsMKt9EIbpHLGDnbCkJe6tmhOHrwawlQBAu5eYz1cXydA6eXX+BGukYge901bIlTuSrWaoYg=
X-Received: by 2002:a9d:2cd3:: with SMTP id e19mr6322932otd.363.1542906110229; 
	Thu, 22 Nov 2018 09:01:50 -0800 (PST)
MIME-Version: 1.0
Received: by 2002:a9d:4b0e:0:0:0:0:0 with HTTP; Thu, 22 Nov 2018 09:01:29
	-0800 (PST)
In-Reply-To: <20181120184148.22501-1-pbonzini@redhat.com>
References: <20181120184148.22501-1-pbonzini@redhat.com>
From: Peter Maydell <peter.maydell@linaro.org>
Date: Thu, 22 Nov 2018 17:01:29 +0000
Message-ID: <CAFEAcA-7GePo8ycBHTW1D0WCC3ryToneSzGnY3kABKaT=YzWbA@mail.gmail.com>
To: Paolo Bonzini <pbonzini@redhat.com>
Content-Type: text/plain; charset="UTF-8"
X-detected-operating-system: by eggs.gnu.org: Genre and OS details not
	recognized.
X-Received-From: 2607:f8b0:4864:20::343
Subject: Re: [Qemu-devel] [PATCH] nvme: fix out-of-bounds access to the CMB
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, Qemu-block <qemu-block@nongnu.org>,
	Li Qiang <liq3ea@gmail.com>, QEMU Developers <qemu-devel@nongnu.org>,
	Max Reitz <mreitz@redhat.com>, Keith Busch <keith.busch@intel.com>
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

On 20 November 2018 at 18:41, Paolo Bonzini <pbonzini@redhat.com> wrote:
> Because the CMB BAR has a min_access_size of 2, if you read the last
> byte it will try to memcpy *2* bytes from n->cmbuf, causing an off-by-one
> error.  This is CVE-2018-16847.

Maybe we should change the MemoryRegionOps API so that
devices have to explicitly opt in to handling accesses
that span off the end of the region size they've registered?
IIRC we have one or two oddball devices that care about that
(probably mostly x86 IO port devices), but most device
implementations will not be expecting it.

I'm also surprised that the memory subsystem permits a
2 byte access at address sz-1 here, since .impl.unaligned
is not set...

thanks
-- PMM

