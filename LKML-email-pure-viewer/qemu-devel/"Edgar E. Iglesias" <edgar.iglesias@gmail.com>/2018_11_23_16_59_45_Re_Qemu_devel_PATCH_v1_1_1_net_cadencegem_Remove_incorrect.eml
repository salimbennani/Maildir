Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 24 Nov 2018 12:36:24 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga006.jf.intel.com (orsmga006.jf.intel.com [10.7.209.51])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 3F21E58037D
	for <like.xu@linux.intel.com>; Fri, 23 Nov 2018 09:11:29 -0800 (PST)
Received: from orsmga101.jf.intel.com ([10.7.208.22])
  by orsmga006-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 09:11:29 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3APePzURSkkNvTyhSdZXrgxSr2O9psv+yvbD5Q0YIu?=
 =?us-ascii?q?jvd0So/mwa67ZBWAt8tkgFKBZ4jH8fUM07OQ7/iwHzRYqb+681k6OKRWUBEEjc?=
 =?us-ascii?q?hE1ycBO+WiTXPBEfjxciYhF95DXlI2t1uyMExSBdqsLwaK+i764jEdAAjwOhRo?=
 =?us-ascii?q?LerpBIHSk9631+ev8JHPfglEnjWwba9xIRmssQndqtQdjJd/JKo21hbHuGZDdf?=
 =?us-ascii?q?5MxWNvK1KTnhL86dm18ZV+7SleuO8v+tBZX6nicKs2UbJXDDI9M2Ao/8LrrgXM?=
 =?us-ascii?q?TRGO5nQHTGoblAdDDhXf4xH7WpfxtTb6tvZ41SKHM8D6Uaw4VDK/5KpwVhTmlD?=
 =?us-ascii?q?kIOCI48GHPi8x/kqRboA66pxdix4LYeZyZOOZicq/Ye94RWGhPUdtLVyFZDI2y?=
 =?us-ascii?q?b5UBAekPPelXs4byulQAohmwCgexHOPiyD1Gi3Dr0aA0z+guDxrG0Rc8H98Nqn?=
 =?us-ascii?q?nYsMn5Ob0PXe2z0aLGzS/Db/RT2Trl5oTGfQ0uof6WUrJqbMHfxlMjHB7GgFWf?=
 =?us-ascii?q?rYzqISiV1uUXvGiA4eZrSOWihHA6pAF+uDev3N0giojGhoIR1F/E7iR5z5wuJd?=
 =?us-ascii?q?CjR057ZMSrEJpUty2AK4R2RcYiTnhutS0nybMGoYa2cDYWxJkk3RLTduGLfouS?=
 =?us-ascii?q?7h79WuucIS10iG9ndb6nhBu+7FKsxvPyW8WpylpGsCRInsfWunwQ2RHf9s6KQe?=
 =?us-ascii?q?Zn8Ei7wzaAzQXT5/lEIU8qkarbLIYswroxlpoIrUTDBTX6mErwjK+LbEkk/fKo?=
 =?us-ascii?q?6+v/brXnoJ+TKZN0hxngPqgymcGzG/k0PhUNUmSB5+ix2r3u8VfkTLhIlvE2l7?=
 =?us-ascii?q?PWsJHeJcQVvK65BApV35466xmhCjemzc0UkmQZI1JbZh2Hi5HlNErJIPDlC/ew?=
 =?us-ascii?q?n0qjkCxsy/DCP73hAYvCImLMkbf8Zbt9709cyAwuzdFQ/Z5UC7cBIO7tVU/1rt?=
 =?us-ascii?q?DXEhg5MwmvzubhD9V90IweWWSSAqODN6PSq1CI6vo1I+aQfI8VpCr9K/896v7q?=
 =?us-ascii?q?jH85mkEScbOm3JsKc324GvVmI0OEYXvjmNsBEGEKvhYgQ+zuklGNTTlTZ3PhF5?=
 =?us-ascii?q?86/SwxXYK6EZ/YFMfqhL2awDz9GJpQaWZbTFeWHjDtfoSAXv4KLyWKPs5mlCdD?=
 =?us-ascii?q?TLWkVsot2A+jsFzHzaF6JL/R8ywcqZWxzdVw+qjfmA8/8XluAt2A3nqRZ2dzmG?=
 =?us-ascii?q?wOWnkxxq8oulF3yFqIzf1lhedFH8dY/fJDX1QGMsvkz+1+CsjqV0rkd8uJSVu7?=
 =?us-ascii?q?B/mvHD2wBoYpw94KZkpVAdiujhnfmSGtBulGuaaMAcl+367T1mK5CoA16nnC2b?=
 =?us-ascii?q?IghkJsCp9COWKvnOh++AzeHI/AiG2Wkq+rceIX2yubpzTL9naHoEwNCF04aq7C?=
 =?us-ascii?q?R31KIxKO9dk=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0A2AAC6M/hbhxHrdtBjGwEBAQEDAQEBB?=
 =?us-ascii?q?wMBAQGBUgUBAQELAQGBL4JijHCLIYINiRxug3mJOIFuFwEBGBSENoQfBSI1CA0?=
 =?us-ascii?q?BAwEBAQEBAQIBEwEBAQoLCQgbDiMMQgEQAYFiBQIDGgEGglsBAQEBAgEBAi8BD?=
 =?us-ascii?q?QEFCgwdAQIBAgECBgEBBQUVAwkTCggDAQsFDxEBBQECIBMFgxyBaQEDDQgBAwG?=
 =?us-ascii?q?bPjyMHwUBF4J3BYQuChknDVqBNwIGEopbgRyBVz+EI4RHhhIClE+LMwcCApEiI?=
 =?us-ascii?q?wqJR4c3LJddBgIJBw8hgScBggpwgzyCG4NtilNxgQQDDgODHIYnVoF3AQE?=
X-IPAS-Result: =?us-ascii?q?A0A2AAC6M/hbhxHrdtBjGwEBAQEDAQEBBwMBAQGBUgUBAQE?=
 =?us-ascii?q?LAQGBL4JijHCLIYINiRxug3mJOIFuFwEBGBSENoQfBSI1CA0BAwEBAQEBAQIBE?=
 =?us-ascii?q?wEBAQoLCQgbDiMMQgEQAYFiBQIDGgEGglsBAQEBAgEBAi8BDQEFCgwdAQIBAgE?=
 =?us-ascii?q?CBgEBBQUVAwkTCggDAQsFDxEBBQECIBMFgxyBaQEDDQgBAwGbPjyMHwUBF4J3B?=
 =?us-ascii?q?YQuChknDVqBNwIGEopbgRyBVz+EI4RHhhIClE+LMwcCApEiIwqJR4c3LJddBgI?=
 =?us-ascii?q?JBw8hgScBggpwgzyCG4NtilNxgQQDDgODHIYnVoF3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,270,1539673200"; 
   d="scan'208";a="42010670"
X-Amp-Result: UNSCANNABLE
X-Amp-File-Uploaded: False
Unscannable: 2
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 23 Nov 2018 09:11:28 -0800
Received: from localhost ([::1]:53613 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gQEzH-0006o9-MV
	for like.xu@linux.intel.com; Fri, 23 Nov 2018 12:11:27 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:36320)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <edgar.iglesias@gmail.com>) id 1gQEo5-0005eP-8m
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 11:59:54 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <edgar.iglesias@gmail.com>) id 1gQEo1-0001nu-6e
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 11:59:53 -0500
Received: from mail-lf1-x141.google.com ([2a00:1450:4864:20::141]:45185)
	by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_128_CBC_SHA1:16)
	(Exim 4.71) (envelope-from <edgar.iglesias@gmail.com>)
	id 1gQEo0-0001la-NU; Fri, 23 Nov 2018 11:59:49 -0500
Received: by mail-lf1-x141.google.com with SMTP id b20so9116564lfa.12;
	Fri, 23 Nov 2018 08:59:48 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
	h=date:from:to:cc:subject:message-id:references:mime-version
	:content-disposition:content-transfer-encoding:in-reply-to
	:user-agent; bh=VdYXtIDgwdn+M+q/xQX/IbA9hN5w2jHVfP00jMaIb4c=;
	b=QQamrwxLoAjt2jiGuliAcON7vlV6npXwMm/tpe54Kb4LpkrFftGDyW6AXZxTCKe7Nt
	c3OlGdITbiT8aWO55cvuRDENl4rpw+7H7V/gNbH92a4Mj4onEscpn/nPgogcy9TslYIh
	pmpbQ888cDAAyFryGFQLbtbbeTi6qt5LDzgeAno1lMYWJQ6n1u/W+bPCAXjKJxDDBeaW
	bV+hEWZB9GqMEG+Tb9WhMVKp4PGQHDKwtwRS7aLlrxaEs6hi/B1A13v/cpivZ5p1XM0d
	E0VS99rKX7J6fzczYgs3ov8Ikm1KYhC2pyB7aGQIXCAKzcGEM7EfuxYI80yLrUxHuE+A
	I4iw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20161025;
	h=x-gm-message-state:date:from:to:cc:subject:message-id:references
	:mime-version:content-disposition:content-transfer-encoding
	:in-reply-to:user-agent;
	bh=VdYXtIDgwdn+M+q/xQX/IbA9hN5w2jHVfP00jMaIb4c=;
	b=bdmj4P9fov762dccRy4BA+5Bp2GRB5ajPTARLYtuS0f1vRcnUDQTIo6SjDR0LPGdu5
	mqvp0NPoXbj/qg9WKc36hJ8Ow0AsLyCukl0gEBfw6xqoWy7L/74mlq7WlVxmlDYfgviX
	af5lq4tmwwUBy6Ts0WKGvySclDlc3YyOMNYPcpqhMIBMxLwsxyWMRzFGDV0XZZfL7V2M
	vetGKW6DxhM9cP161aNdkiJH90+Icm/zxoXlvZos1Ip5qNybFYU79u2MJV8b7Mcdtc33
	188DO9epn2uMreFHBpgBXyN2oSInwmo//y8Z7WSAwLKD/uU3laZdzYqbCyJ6rhx5quw/
	uqMQ==
X-Gm-Message-State: AGRZ1gLUPzHstPkwKN8Sg1BFG68aGlNAlpxKUwNuab7Yzq9/e5GglaiB
	k+CQ+MvtIvaqH2l7n60glck=
X-Google-Smtp-Source: AJdET5eZdwQxUIB+vP8FLwkRc+p1dHIfyrJ8EQiAYyw2pGVB4gu0GDVWhahaYrLIzr0Umk4fK/XfWg==
X-Received: by 2002:a19:d8ea:: with SMTP id
	r103mr10667914lfi.146.1542992386866; 
	Fri, 23 Nov 2018 08:59:46 -0800 (PST)
Received: from gmail.com (81-231-232-130-no39.tbcn.telia.com. [81.231.232.130])
	by smtp.gmail.com with ESMTPSA id
	26-v6sm4562156ljb.16.2018.11.23.08.59.45
	(version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
	Fri, 23 Nov 2018 08:59:46 -0800 (PST)
Date: Fri, 23 Nov 2018 17:59:45 +0100
From: "Edgar E. Iglesias" <edgar.iglesias@gmail.com>
To: Philippe =?iso-8859-1?Q?Mathieu-Daud=E9?= <philmd@redhat.com>
Message-ID: <20181123165945.GM1148@toto>
References: <20181123135450.24829-1-edgar.iglesias@gmail.com>
	<20181123135450.24829-2-edgar.iglesias@gmail.com>
	<75bcddbc-da2d-aeb3-71d3-52b635520d2a@redhat.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <75bcddbc-da2d-aeb3-71d3-52b635520d2a@redhat.com>
User-Agent: Mutt/1.9.4 (2018-02-28)
X-detected-operating-system: by eggs.gnu.org: Genre and OS details not
	recognized.
X-Received-From: 2a00:1450:4864:20::141
Subject: Re: [Qemu-devel] [PATCH v1 1/1] net: cadence_gem: Remove incorrect
 assert()
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: figlesia@xilinx.com, peter.maydell@linaro.org, sstabellini@kernel.org,
	edgar.iglesias@xilinx.com, sai.pavan.boddu@xilinx.com,
	frasse.iglesias@gmail.com, alistair@alistair23.me,
	qemu-devel@nongnu.org, frederic.konrad@adacore.com,
	qemu-arm@nongnu.org, muhammad_bilal@mentor.com
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

On Fri, Nov 23, 2018 at 05:46:17PM +0100, Philippe Mathieu-Daudé wrote:
> Hi Edgar,

Hi Philippe,

> 
> On 23/11/18 14:54, Edgar E. Iglesias wrote:
> > From: "Edgar E. Iglesias" <edgar.iglesias@xilinx.com>
> > 
> > Don't assert on RX descriptor settings when the receiver is
> > disabled. This fixes an issue with incoming packets on an
> > unused GEM.
> > 
> > Reported-by: mbilal <muhammad_bilal@mentor.com>
> > Signed-off-by: Edgar E. Iglesias <edgar.iglesias@xilinx.com>
> > ---
> >  hw/net/cadence_gem.c | 1 -
> >  1 file changed, 1 deletion(-)
> > 
> > diff --git a/hw/net/cadence_gem.c b/hw/net/cadence_gem.c
> > index d95cc27f58..7f63411430 100644
> > --- a/hw/net/cadence_gem.c
> > +++ b/hw/net/cadence_gem.c
> > @@ -979,7 +979,6 @@ static ssize_t gem_receive(NetClientState *nc, const uint8_t *buf, size_t size)
> >  
> >          /* Do nothing if receive is not enabled. */
> >          if (!gem_can_receive(nc)) {
> > -            assert(!first_desc);
> 
> Maybe worth:
> 
>                trace_gem_receive_packet_drop(size);

Or perhaps a generic tracepoint on packet drops for any device.
Anyway this is probably something for after the release.

Not sure if it's too late to even get the removal of the assert into this release? Peter?

> 
> >              return -1;
> 
> Shouldn't this be 'return 0'?
> 
> The "net/net.h" doc is scarce...

If we return 0 my understanding is that we later need to actively
call qemu_flush_or_purge_queued_packets() to renable the rx
path which the GEM model doesn't do. So that would mean
refactoring the model a bit.

Cheers,
Edgar


> 
> Regards,
> 
> Phil.
> 
> >          }
> >  
> > 

