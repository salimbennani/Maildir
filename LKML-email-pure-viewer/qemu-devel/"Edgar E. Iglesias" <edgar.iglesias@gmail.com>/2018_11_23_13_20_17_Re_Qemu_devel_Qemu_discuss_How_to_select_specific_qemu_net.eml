Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 23:35:28 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga001.jf.intel.com (orsmga001.jf.intel.com [10.7.209.18])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id B36FE58037D
	for <like.xu@linux.intel.com>; Fri, 23 Nov 2018 05:21:59 -0800 (PST)
Received: from fmsmga103.fm.intel.com ([10.1.193.90])
  by orsmga001-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 05:21:59 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3APxqWSxenCVOxnHUG6tnrfUOllGMj4u6mDksu8pMi?=
 =?us-ascii?q?zoh2WeGdxc26YBeN2/xhgRfzUJnB7Loc0qyK6/CmATRIyK3CmUhKSIZLWR4BhJ?=
 =?us-ascii?q?detC0bK+nBN3fGKuX3ZTcxBsVIWQwt1Xi6NU9IBJS2PAWK8TW94jEIBxrwKxd+?=
 =?us-ascii?q?KPjrFY7OlcS30P2594HObwlSizexfbB/IA+qoQnNq8IbnZZsJqEtxxXTv3BGYf?=
 =?us-ascii?q?5WxWRmJVKSmxbz+MK994N9/ipTpvws6ddOXb31cKokQ7NYCi8mM30u683wqRbD?=
 =?us-ascii?q?VwqP6WACXWgQjxFFHhLK7BD+Xpf2ryv6qu9w0zSUMMHqUbw5Xymp4rx1QxH0li?=
 =?us-ascii?q?gIKz858HnWisNuiqJbvAmhrAF7z4LNfY2ZKOZycqbbcNgHR2ROQ9xRWjRPDI28?=
 =?us-ascii?q?cYUBDOQBMulEoIbgpVQBowawBRGuCe3txTJEm3H70bEk3OQ6CgzGwBAsEsgSvH?=
 =?us-ascii?q?jIttj5KqEfWv21wqnSyjXDautb1Tny5ofVfRAuu+uMVq9/f8bL1EIhFAzFjlGO?=
 =?us-ascii?q?poz+PjOazP8Nv2aG5OdnS+2glmEnpBtrojS1x8cshY3JiZwOylDF7yp52504Jd?=
 =?us-ascii?q?K9SEFhYN6kFIFcuD2dN4tzW84vRXxjtig9yr0Do5G7fS4KxYw6yxLBafGLaZSE?=
 =?us-ascii?q?7gj/WOqLPDt1gm9udrGnhxuq70Ss1u7xWtOp3FpXrSdJiMfAu34N2hDJ98SKSO?=
 =?us-ascii?q?Nx80S81TqVyQze5PxILVoqmafVNZIt2KM8m5QPvUnFAyT4gl/5jLWMeUUh4uWo?=
 =?us-ascii?q?6/roYrHhppKEM490ixr+Mrg1msClDuQ4NBUOU3Kc+eSm273v5Uz5QLNUgf0qiq?=
 =?us-ascii?q?TVrozWKMcBqqKkHgNY0Zwv5wixAjqmytgUgHsKIEpAeB2djojpP1/OIOr/Dfe6?=
 =?us-ascii?q?m1msiSlkx/XbPrH4H5rCMGbDn6nlfbpk8EFczxczzdZD6J1KEbENJ/bzWk7ytN?=
 =?us-ascii?q?PGFBM4PBG0zv7jCNV80IMeRG2ODrWYMKPUrV+H+OYvL/OQa48SvTbwMP4l5/no?=
 =?us-ascii?q?jX82n18dYLOl3ZwNaHC3BvhmOVmWYWLwgtcdFmcHpg4+TO3piFKcSzJSaGuyUr?=
 =?us-ascii?q?k45jE6DoKmEIjCSpqsgLyHwCe0AJlWanpaBVCLFHe7P7iCQOoGPSKOPtd6wHtD?=
 =?us-ascii?q?Ubm6V5Rn0xaouwnnjb19Ia3R8ywcsJvlk99t++zUkwp17DFxEoGR3n+ASzJJmH?=
 =?us-ascii?q?gVTWoz1aF7vUsv01qGzO10juJVEZlJ6upUXxwmHZjbyeN8Fpb1QA2WZcqDSlut?=
 =?us-ascii?q?XoC7ByosRMk62d4EbhVBHICnhBHH1i7iV7oIl7WOAZU4xajd23H1D8NwzWrBzu?=
 =?us-ascii?q?8qiFxwEeVVMmjzzINz+AHJT6OP22SWk6uxdK0HlmaZ+WuMxHDIvU5cXRVxWL7t?=
 =?us-ascii?q?UnUWZ0+QptP8sBCRB4SyAKgqZ1MSgfWJLbFHP5iw1Q1L?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AYAADP/fdbhxHrdtBjGgEBAQEBAgEBA?=
 =?us-ascii?q?QEHAgEBAQGBUgQBAQEBCwEBgS+BOYEpjHCKazWCDYJ7hw+DeYYjgxWBcxIBARg?=
 =?us-ascii?q?DEYNrhGcFIjUIDQEDAQEBAQEBAgETAQEBCgsJCCkjDEIBEAGBYgUCAxoBBoJbA?=
 =?us-ascii?q?QEBAQIBAQI3BgEFBgQMHQECAQIBAgYBAQUFEwUJEwoIAwELBQ8CDwEFAQIgCgk?=
 =?us-ascii?q?FYYI7AYFoAQMNAwUBAwGbNDyMHwUBF4J3BYEAMQGCewoZJw1agTcCBhKKW4Ecg?=
 =?us-ascii?q?Vc/gRGCZC6KWQKJGQqBboVNg3GLMwcCAoZ6iigjCoFPhQuCbYc3gnmNSYdHBgI?=
 =?us-ascii?q?JBw8hgSYBggtwgzwJghIJGoNKilNxAYEDAw4DgxyGfYF3AQE?=
X-IPAS-Result: =?us-ascii?q?A0AYAADP/fdbhxHrdtBjGgEBAQEBAgEBAQEHAgEBAQGBUgQ?=
 =?us-ascii?q?BAQEBCwEBgS+BOYEpjHCKazWCDYJ7hw+DeYYjgxWBcxIBARgDEYNrhGcFIjUID?=
 =?us-ascii?q?QEDAQEBAQEBAgETAQEBCgsJCCkjDEIBEAGBYgUCAxoBBoJbAQEBAQIBAQI3BgE?=
 =?us-ascii?q?FBgQMHQECAQIBAgYBAQUFEwUJEwoIAwELBQ8CDwEFAQIgCgkFYYI7AYFoAQMNA?=
 =?us-ascii?q?wUBAwGbNDyMHwUBF4J3BYEAMQGCewoZJw1agTcCBhKKW4EcgVc/gRGCZC6KWQK?=
 =?us-ascii?q?JGQqBboVNg3GLMwcCAoZ6iigjCoFPhQuCbYc3gnmNSYdHBgIJBw8hgSYBggtwg?=
 =?us-ascii?q?zwJghIJGoNKilNxAYEDAw4DgxyGfYF3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,269,1539673200"; 
   d="scan'208";a="53077989"
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 23 Nov 2018 05:21:58 -0800
Received: from localhost ([::1]:52300 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gQBPB-0002Rn-RJ
	for like.xu@linux.intel.com; Fri, 23 Nov 2018 08:21:57 -0500
Received: from eggs.gnu.org ([208.118.235.92]:52097)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <edgar.iglesias@gmail.com>) id 1gQBNt-0001pl-El
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 08:20:39 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <edgar.iglesias@gmail.com>) id 1gQBNp-0004T9-Do
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 08:20:37 -0500
Received: from mail-lj1-x242.google.com ([2a00:1450:4864:20::242]:40415)
	by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_128_CBC_SHA1:16)
	(Exim 4.71) (envelope-from <edgar.iglesias@gmail.com>)
	id 1gQBNd-0004CM-H3; Fri, 23 Nov 2018 08:20:21 -0500
Received: by mail-lj1-x242.google.com with SMTP id n18-v6so10657652lji.7;
	Fri, 23 Nov 2018 05:20:20 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
	h=date:from:to:cc:subject:message-id:references:mime-version
	:content-disposition:in-reply-to:user-agent;
	bh=thPndj0LFqQ71sWDgazer9zv4zfVadXlBPCUn+343tk=;
	b=N7boHjos0UYjC/G7a4UM66iwEjVWEuGL82WIFTQ7N3DXWCzame0OJuvMy29EInQm29
	2UM4mHF+JWkLsssZQvIEV/Qrrl+EziVzKEBVw5uOzMhOgFhblIycuZH5wCWVN+RMvUjK
	V258r2oz9olYJZl9+zHwUOng3L3A0X+CAdKa+9gxSNM8U0L2+tKJlP0hGhTBGEIEb8zn
	Q8piCTCVqiMfaA3qCMFsbOffocy3J8Bu0t1dPy6ZGvkL2oVPiGsqaAImKkHFlALQ2v/l
	wPcAZGv7ojMiOvrHUvI+hpcVARIok4xbXybpM9trRORiJOnujwN6PwL+Ioz/GkiirSiH
	PXkw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
	d=1e100.net; s=20161025;
	h=x-gm-message-state:date:from:to:cc:subject:message-id:references
	:mime-version:content-disposition:in-reply-to:user-agent;
	bh=thPndj0LFqQ71sWDgazer9zv4zfVadXlBPCUn+343tk=;
	b=QfgToLN7PzOrUMYoeh7GfAywTTgErnN1IJo+rbEZYy428nTA00ooYoaXQDH6YeAwwD
	HbgLBzihEN9gQvS+JQsnmxnBHWdFhpjnoOhHdyUVSzC0mQBOV72/4LJQcGXecwAdYVRJ
	kUuyq33KCV/7sHZuJjZKaq7d4/tjzrEgoPpBQPW44y2QVw8S/+PEa0sIYAJZGuzUUrgg
	8A2OnFHVdr3uUwUQAh5UwIgFNX3f6XXY/ZUBmvqkjHkBn3RY92L4tHRHk0AF6rqzwjhp
	2veTRBaOP/5rsmJJHl/A10lJG1pTYWllCvalf6ljIfC1S+2X5XjzmPygDIMF+g8EusEd
	IpBA==
X-Gm-Message-State: AA+aEWYE1/kDAHUDSbKbwTw0BunFCn19CKX8aJZFc004ijcX7TH3Yjni
	6oejRGIK0sICpEqiYlNtlWw=
X-Google-Smtp-Source: AFSGD/XSyPsgu5Kw/3QfVM7m2rCTtc+eFxt3jaPEnZan+qRCvszubJziePygYMlNRbO27iqFHkMN8w==
X-Received: by 2002:a2e:9957:: with SMTP id
	r23-v6mr7792878ljj.98.1542979219533; 
	Fri, 23 Nov 2018 05:20:19 -0800 (PST)
Received: from gmail.com (81-231-232-130-no39.tbcn.telia.com. [81.231.232.130])
	by smtp.gmail.com with ESMTPSA id
	l21-v6sm7780443ljj.48.2018.11.23.05.20.17
	(version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
	Fri, 23 Nov 2018 05:20:18 -0800 (PST)
Date: Fri, 23 Nov 2018 14:20:17 +0100
From: "Edgar E. Iglesias" <edgar.iglesias@gmail.com>
To: mbilal <muhammad_bilal@mentor.com>
Message-ID: <20181123132017.GJ1148@toto>
References: <e8dae726-8853-4e44-1eb8-b9cfb0bc44f2@mentor.com>
	<CAFEAcA_EM39P8HFoC=B=XP3Ax8NgNSotn=wMJJsG05P8Ywdruw@mail.gmail.com>
	<abd7b108-4d21-9c1c-16d3-6d31d47f74eb@mentor.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <abd7b108-4d21-9c1c-16d3-6d31d47f74eb@mentor.com>
User-Agent: Mutt/1.9.4 (2018-02-28)
X-detected-operating-system: by eggs.gnu.org: Genre and OS details not
	recognized.
X-Received-From: 2a00:1450:4864:20::242
Subject: Re: [Qemu-devel] [Qemu-discuss] How to select specific qemu net
 'nic' device
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Peter Maydell <peter.maydell@linaro.org>, qemu-arm <qemu-arm@nongnu.org>,
	QEMU Developers <qemu-devel@nongnu.org>,
	Alistair Francis <alistair@alistair23.me>,
	qemu-discuss <qemu-discuss@nongnu.org>
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

On Fri, Nov 23, 2018 at 02:59:32PM +0500, mbilal wrote:
> Hi,
> 
> Thanks for reply.
> 
> According to your suggestion I've tested with 3.1 rc2 release and problem is
> still exist in this release also.
> 
> Here is my reproducible scenario.


Thanks,

I've had a look and the assert looks bogus to me.
We shouldn't be asserting on RX descriptor setups when the receiver is disabled.

I'll send a patch in a moment.

Best regards,
Edgar



> 
> QEMU launching
> --------------
> 
> ./qemu-system-aarch64 -M xlnx-zcu102 -m 1G -kernel /dev/null -S -s  -net nic
> -net nic -net nic -net nic -net user,hostfwd=tcp::8080-:8080 -smp 1 -serial
> stdio -serial /dev/null
> 
> gdb session
> ------------
> 
> (gdb) file zcu102_net_uni.out
> Reading symbols from zcu102_net_uni.out...done.
> (gdb) tar rem :1234
> Remote debugging using :1234
> _ld_text_start () at os/arch/armv8/common/arch_asm.S:381
> 381	    MOV     X14, X0
> (gdb) load
> Loading section .text, size 0x59c0c lma 0x0
> Loading section .rodata, size 0x2bbc lma 0x59c0c
> Loading section .rtl.data, size 0x770 lma 0x5c7c8
> Loading section .data, size 0x4dc lma 0x5cf54
> Start address 0x0, load size 381972
> Transfer rate: 23313 KB/sec, 2021 bytes/write.
> (gdb) c
> Continuing.
> ^C
> 
> 
> So any breakpoint or Ctrl-C asserts the QEMU.
> 
> qemu-system-aarch64: qemu-3.1.0-rc2/hw/net/cadence_gem.c:982: gem_receive:
> Assertion `!first_desc' failed.
> 
> 
> Our networking demo application running fine unless you interrupt the GDB
> (either with breakpoints or interrupt signal).
> You can see following message on QEMU console which is the indication of
> demo is fine (it also well tested on actual hardware)
> 
> Open the following Nucleus node address in your web browser:
>     http://127.0.0.1:8080/
> 
> 
> I'm attaching demo application binary.
> 
> 
> 
> 
> Thanks for care about this issue,
> -Bilal
> 
> 
> 
> On 11/23/2018 01:59 PM, Peter Maydell wrote:
> > On 23 November 2018 at 04:13, mbilal <muhammad_bilal@mentor.com> wrote:
> > > Hi,
> > > 
> > > I'm using qemu emulation for xilinx zcu102 platform, this board have four
> > > networking GEM0, GEM1, GEM2 and GEM3 devices.
> > > 
> > > To run network demo on this board *only* require GEM3 device to be configure
> > > while other GEM devices don't need to be configure, that's why u-boot and
> > > other RTOS only configure GEM3 device.
> > > 
> > > 
> > > QEMU is enabling these GEM devices  with networking '-net nic' option and
> > > QEMU consider first '-net nic' option for GEM0 and second '-net nic' option
> > > for GEM1 and so on. that's why if need to enable GEM3 network device we must
> > > need to give following full command line options
> > > 
> > > -net nic -net nic -net nic -net nic -net user, ...
> > > 
> > > In this way all four GEM devices would be enable but first three GEM0-GEM2
> > > devices are un-configured and useless. In our case QEMU is being *crashed*
> > > due to trying to use these un-configured GEM devices to o send/receive GDB
> > > breakoint/interrupt cause. IIUC QEMU uses first device in the -nic loop
> > > i.e
> > > 
> > > qemu-system-aarch64: hw/net/cadence_gem.c:921: gem_receive: Assertion
> > > `!first_desc' failed.
> > 
> > If QEMU asserts like this, this is a bug in QEMU. I've cc'd
> > the maintainers of the Xilinx board.
> > 
> > Could you provide a complete set of instructions to reproduce
> > this bug, please ? (full command line, guest image, etc)
> > 
> > Could you also tell us which version of QEMU you are using?
> > If possible, try with the current git master or
> > with the 3.1 rc2 release candidate we've just put out, to
> > see if it's already been fixed.
> > 
> > thanks
> > -- PMM
> > 



