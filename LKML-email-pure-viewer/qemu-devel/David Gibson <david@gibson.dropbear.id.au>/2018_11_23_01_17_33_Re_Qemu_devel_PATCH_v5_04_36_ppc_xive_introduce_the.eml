Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 15:31:28 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga005.fm.intel.com (fmsmga005.fm.intel.com [10.253.24.32])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 867A958040F
	for <like.xu@linux.intel.com>; Thu, 22 Nov 2018 22:23:32 -0800 (PST)
Received: from orsmga106.jf.intel.com ([10.7.208.65])
  by fmsmga005-1.fm.intel.com with ESMTP; 22 Nov 2018 22:23:31 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3ATdb9uhbCwTWb+qCOFCP5C/T/LSx+4OfEezUN459i?=
 =?us-ascii?q?sYplN5qZpsy6Yx7h7PlgxGXEQZ/co6odzbaO4+a4ASQp2tWoiDg6aptCVhsI24?=
 =?us-ascii?q?09vjcLJ4q7M3D9N+PgdCcgHc5PBxdP9nC/NlVJSo6lPwWB6nK94iQPFRrhKAF7?=
 =?us-ascii?q?Ovr6GpLIj8Swyuu+54Dfbx9HiTahYr5+Ngm6oRnMvcQKnIVuLbo8xAHUqXVSYe?=
 =?us-ascii?q?RWwm1oJVOXnxni48q74YBu/SdNtf8/7sBMSar1cbg2QrxeFzQmLns65Nb3uhnZ?=
 =?us-ascii?q?TAuA/WUTX2MLmRdVGQfF7RX6XpDssivms+d2xSeXMdHqQb0yRD+v6bpgRh31hy?=
 =?us-ascii?q?cdLzM3/mHZhNJzgqJVrx2uuwFwzIzab4+ILPpzfKHTcNwHSWdPQspeSTdBD5iz?=
 =?us-ascii?q?b4cTFecMJ/pUopPgq1YIsBCwBROsBOTqyjJQiHH5x7M60+U8Hgrb3QIgHskBsG?=
 =?us-ascii?q?/TrNXzKawfVv26w7PWzTXCcvxbwjj96InTfRA6pvGMW6h8ftfLyUkoDwPKlUuf?=
 =?us-ascii?q?ppb/Pz+P1+QCrnKX4PB9Ve+2jWMstg9/oj+qxsg2i4nJgJoYylfF9CV92ok6Ps?=
 =?us-ascii?q?a4RFR8Yd6+H5tcrzyVN5FxQsM6WG5npjw1yqcctZ66YScHzoksyR3Ha/GfbYSE?=
 =?us-ascii?q?/hHuWPyMLTtlh39pYqyzihiy/ES61+HxVNG43EhWoidLiNXAq20B2wbR58SaUP?=
 =?us-ascii?q?dx40Gs0iuV2Q/J8OFLO0U0mLLbK5E/xr4wkYIesUDCHi/thEX2l7Wadkoi+ui1?=
 =?us-ascii?q?8ejnZa/mppCEO491jAHxLLgul9ShDegkMQUCRXWX9fm/2bH540H0TrVHgucrnq?=
 =?us-ascii?q?TbqJzaIN4Upq+9Aw9byIYj7BO/Ai+/0NsGmHkHMUtJdw+ZgIj3JV7OJOn0Auy4?=
 =?us-ascii?q?g1Sxljdk2+7JPqbmDpXJL3jDk6nucaxy6k5B0AczydFf55RJCrAOOv7zW0nxtM?=
 =?us-ascii?q?DGAR89KQC73+HnCNBm24MYXmKPBKCZMKXPsVOS4eIvOeaMaJcPuDnhM/gl++Lu?=
 =?us-ascii?q?jXghlF8ZfKmp3oUYZGq3H/R7OEiZZXvsgtEcEWYFpAY+TerqiEGcXj5XfXq9Q6?=
 =?us-ascii?q?U85jRoQL+gFprJE4CxnKSajmD8GpxNensADFeKHnH1MYKeVLAJYSOWJ8Zn1Tsc?=
 =?us-ascii?q?SbmmTZRmzByrqUr2xqRqKrnp/DYFv8fm3dlx++qBjBw36Hl4AtqQ1ySXQnhpk3?=
 =?us-ascii?q?gUbzkx2q95vAp60FjUyrVygfFTCYlO4ehUWBwxL5/Wwr9GDIXZ2w7bf9zBbFvu?=
 =?us-ascii?q?bdKvHTwrBoY6x9AmYE96F5OllB+VjASwBLpAu7WVBZB83aPWxH/3b5JxwmjH2I?=
 =?us-ascii?q?EujlM9Rc0JOXehnqRy/hKVBoKPmljPxPXiTrgVwCOYrDTL9mGJpkwNCAM=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0APAADMm/dbhxHrdtBiFgYBAQEEAQEHB?=
 =?us-ascii?q?AEBLoEjBwEBCwGBMIE5gSmMEV+LH4INlzuBbgcNBRgHDYhSIjQJDQEDAQEBAQE?=
 =?us-ascii?q?BAgETAQEBCgsJCCkjDII2BQIDGAmCWwEBAQECAQECPQEBBAopAQICAQECBgEBC?=
 =?us-ascii?q?hgJHQgDAQsFGDEYBIMYAYF5BwEBBKY2gh+CdgEBBYcMBwiCbYgAgRwXgX+BEYM?=
 =?us-ascii?q?SilmVOIpMCYIghFyKKAsYX4FHjmKQD4ghgUaCDTMaCBcZgycJghKCJ4ZahVItM?=
 =?us-ascii?q?YEEA4orgXcBAQ?=
X-IPAS-Result: =?us-ascii?q?A0APAADMm/dbhxHrdtBiFgYBAQEEAQEHBAEBLoEjBwEBCwG?=
 =?us-ascii?q?BMIE5gSmMEV+LH4INlzuBbgcNBRgHDYhSIjQJDQEDAQEBAQEBAgETAQEBCgsJC?=
 =?us-ascii?q?CkjDII2BQIDGAmCWwEBAQECAQECPQEBBAopAQICAQECBgEBChgJHQgDAQsFGDE?=
 =?us-ascii?q?YBIMYAYF5BwEBBKY2gh+CdgEBBYcMBwiCbYgAgRwXgX+BEYMSilmVOIpMCYIgh?=
 =?us-ascii?q?FyKKAsYX4FHjmKQD4ghgUaCDTMaCBcZgycJghKCJ4ZahVItMYEEA4orgXcBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,268,1539673200"; 
   d="asc'?scan'208";a="41265942"
X-Amp-Result: UNSCANNABLE
X-Amp-File-Uploaded: False
Unscannable: 2
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 22 Nov 2018 22:23:31 -0800
Received: from localhost ([::1]:50563 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gQ4sE-0003Fm-I5
	for like.xu@linux.intel.com; Fri, 23 Nov 2018 01:23:30 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:52462)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <dgibson@ozlabs.org>) id 1gQ4ra-0003Cs-0E
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 01:22:51 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <dgibson@ozlabs.org>) id 1gQ4rW-0002lC-Gg
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 01:22:49 -0500
Received: from ozlabs.org ([203.11.71.1]:33759)
	by eggs.gnu.org with esmtps (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.71) (envelope-from <dgibson@ozlabs.org>)
	id 1gQ4rS-0002RJ-J0; Fri, 23 Nov 2018 01:22:44 -0500
Received: by ozlabs.org (Postfix, from userid 1007)
	id 431R7D3yr4z9s29; Fri, 23 Nov 2018 17:22:32 +1100 (AEDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
	d=gibson.dropbear.id.au; s=201602; t=1542954152;
	bh=Lv4QIU2KgWKAzF2OJIlurWb3s+1rr+B7joCPRHMd5jc=;
	h=Date:From:To:Cc:Subject:References:In-Reply-To:From;
	b=UtEV+sgHb3SL8QN2afoKoimTu8YK2C5vVrmBsppdTAdkgpGfmhceA65VN4St28JXm
	8J4eKWSgPSNtrmBD3AlUeGIQOjzFXbWU0QidRzrg0AxFGog1vmBUreEhEM/gdJ0CBE
	3sWjoOVWwDEEwnPwItL2KvWld9lDK53X4xz7kb9U=
Date: Fri, 23 Nov 2018 12:17:33 +1100
From: David Gibson <david@gibson.dropbear.id.au>
To: =?iso-8859-1?Q?C=E9dric?= Le Goater <clg@kaod.org>
Message-ID: <20181123011733.GV10448@umbus.fritz.box>
References: <20181116105729.23240-1-clg@kaod.org>
	<20181116105729.23240-5-clg@kaod.org>
	<20181122044450.GF10448@umbus.fritz.box>
	<121d4f915a03c2e734feebceda023947aedb78a3.camel@kernel.crashing.org>
	<731ece35-0584-63b5-60dc-e53c7a0c5a93@kaod.org>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha256;
	protocol="application/pgp-signature"; boundary="EsfvRFssnM00t552"
Content-Disposition: inline
In-Reply-To: <731ece35-0584-63b5-60dc-e53c7a0c5a93@kaod.org>
User-Agent: Mutt/1.10.1 (2018-07-13)
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 203.11.71.1
Subject: Re: [Qemu-devel] [PATCH v5 04/36] ppc/xive: introduce the
 XiveRouter model
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: qemu-ppc@nongnu.org, qemu-devel@nongnu.org
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>


--EsfvRFssnM00t552
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Thu, Nov 22, 2018 at 08:59:32AM +0100, C=E9dric Le Goater wrote:
> On 11/22/18 7:50 AM, Benjamin Herrenschmidt wrote:
> > On Thu, 2018-11-22 at 15:44 +1100, David Gibson wrote:
> >>
> >> Sorry, didn't think of this in my first reply.
> >>
> >> 1) Does the hardware ever actually write back to the EAS?  I know it
> >> does for the END, but it's not clear why it would need to for the
> >> EAS.  If not, we don't need the setter.
> >=20
> > Nope, though the PAPR model will via hcalls
>=20
> Indeed. The H_INT_SET_SOURCE_CONFIG hcall updates the EAT.
>=20
> >> 2) The signatures are a bit odd here.  For the setter, a value would
> >> make sense than a (XiveEAS *), since it's just a word.  For the getter
> >> you could return the EAS value directly rather than using a pointer -
> >> there's already a valid bit in the EAS so you can construct a value
> >> with that cleared if the lisn is out of bounds.
>=20
> Yes we could. I think I made it that way to be consistent with the=20
> other XIVE internal structures which are bigger : END, NVT

Yeah, but as noted elsewhere I don't really like the get/set model for
the bigger-than-word-size structures.  It gives the impression that
they're atomic updates when they can't be, as well as unnecessarily
copying a bunch of stuff, sometimes on hot paths

> There might be other reasons in Pnv. One was to use generic accessors=20
> to the guest RAM but I didn't do it finally. Take a look at the Pnv
> model and we might decide to change the prototype then. I don't=20
> think it's a major change.

Hmmm.

--=20
David Gibson			| I'll have my music baroque, and my code
david AT gibson.dropbear.id.au	| minimalist, thank you.  NOT _the_ _other_
				| _way_ _around_!
http://www.ozlabs.org/~dgibson

--EsfvRFssnM00t552
Content-Type: application/pgp-signature; name="signature.asc"

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEdfRlhq5hpmzETofcbDjKyiDZs5IFAlv3VS0ACgkQbDjKyiDZ
s5JWFw//ZCM2Iw0OTWPRzhz+fb2HtoklzviDVLiNyt8RONKCUfrj69icgjr+g0LR
/JNDTvMEIAMA87uS5EXpiEbEk6RhRXtj+p2kC1F3l27Y/hLhCycGlxBlAa2WLcJv
lWGXqGo1WVTaO9CTbmrGLOm/ht6eUcAMhPnCHhM+bttP7Fjlff/8w8MuDABRYyA6
5mrp4eEAeg6X31EOB+D87mw7y9Dao6C6JDI2s6LgZikjUj41ROzylNZqt6NDRLjE
bVN38uoHHQWjlzaahyhZG4eyj46f+xl7JIe5wC2lvDYoCOBzLbek29T4yKpKdGze
3//ePHIk8PF8hbsTnTM0JgLxQ25NQIAKpJiJ98TzyQEgdfQM2d5agfl/mPgz+4aU
rztDQ8Z2kTDaguIBLaMHrbTFWHIdBqm4kerx5wuVUyb2Wh5TiOf61DKCH1HlZUW0
7jWzgWeO447davRJtTAAT0rwivjsjrUMuHq+abPAoEoizbQubTZnfApmOEq8ytCL
4vXFofupbkTzXD1pUvxn94lXw+S7Nm1dOaqle1fSOGPSbTBxUjgmC402SS6Hluj9
G67tEy5WHN2pP6BgE2czw804Fo9BYUI5u27e2PgDy7UATjVRqcI+4Nct+Q4iU2pC
lK/34T7AQJFFTppJhn1qekSPjTJjVdz8ucWYeXsHdZ8uwmYxxk0=
=fHgo
-----END PGP SIGNATURE-----

--EsfvRFssnM00t552--

