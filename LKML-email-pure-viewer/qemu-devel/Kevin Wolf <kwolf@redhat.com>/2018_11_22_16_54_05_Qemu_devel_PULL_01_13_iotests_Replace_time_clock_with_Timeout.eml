Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 23 Nov 2018 08:29:49 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga002.jf.intel.com (orsmga002.jf.intel.com [10.7.209.21])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id B1772580460
	for <like.xu@linux.intel.com>; Thu, 22 Nov 2018 08:55:38 -0800 (PST)
Received: from orsmga106.jf.intel.com ([10.7.208.65])
  by orsmga002-1.jf.intel.com with ESMTP; 22 Nov 2018 08:55:38 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3AYrjeHRzfFDgIOC3XCy+O+j09IxM/srCxBDY+r6Qd?=
 =?us-ascii?q?2uoWIJqq85mqBkHD//Il1AaPAd2Lraocw8Pt8InYEVQa5piAtH1QOLdtbDQizf?=
 =?us-ascii?q?ssogo7HcSeAlf6JvO5JwYzHcBFSUM3tyrjaRsdF8nxfUDdrWOv5jAOBBr/KRB1?=
 =?us-ascii?q?JuPoEYLOksi7ze+/94HQbglSmDaxfa55IQmrownWqsQYm5ZpJLwryhvOrHtIeu?=
 =?us-ascii?q?BWyn1tKFmOgRvy5dq+8YB6/ShItP0v68BPUaPhf6QlVrNYFygpM3o05MLwqxbO?=
 =?us-ascii?q?SxaE62YGXWUXlhpIBBXF7A3/U5zsvCb2qvZx1S+HNsDwULs6Wymt771zRRHoli?=
 =?us-ascii?q?kJOT03/2PZisN/kK1Vrw+vpwR9zoDWb4yZKfRzcr/DctMBXmdBQt9RWjZdDo+g?=
 =?us-ascii?q?c4cCDewMNvtYoYnnoFsOqAOzCwyyC+Pxyz9IgGL90q090+QlHwHNwQstH9EAsX?=
 =?us-ascii?q?TTqNX1OrwfUfqrw6bVzTXMde9W1S3h54jPdxAsuPeBVq9zf8rJ0UQjCR/Jg1aK?=
 =?us-ascii?q?pYD4Ij+Y1f4Bv3aV4udgT+6jlmwqpxlvrjSzwsogkJTFi4wLxlze6Cl0w4g4Kc?=
 =?us-ascii?q?emREN4Z9OvDYFeuDuAN4RsR8MvW2Fotzg+yr0BoZO7eCkKyI87xx7EcfCHfI6I?=
 =?us-ascii?q?4g/5WOaWOzd4i2ppeLO5hxms7Uit0vPwWtW33VpQsyZJj9rBumoT2xHd6sWLUO?=
 =?us-ascii?q?Zx80W51TaKzQ/T6+VEIU4ularcLp4s2qcwmYQWsUTeByP5hVv5jLGIeUUg4+Sn?=
 =?us-ascii?q?8OPnYqjgppCAKYB0kQbyMqAvmsy8H+s0KAcPX3WD9OS41b3j+1D5QbpQgv03lK?=
 =?us-ascii?q?nZrI7VJcABqqGlBA9V150u6xC4Dzeg39QYm2QHIEhCeBKdgIjlI0vOL+zgDfej?=
 =?us-ascii?q?n1Ssly9mx/THPr3iHJrBNHfCkKr6cLZ56k5czhczzN9F65JVDLEBPOz8WkvruN?=
 =?us-ascii?q?PECR85Nl/8/uD8Fd8o1p8CQXndReidMbjOqhmO4eQgJfTKY5Ua/zP0Kvwg7vip?=
 =?us-ascii?q?imclmFgbZu6w0J4KLXy1APlicHifemfm19IIEGMWuVgnQen3zVGPTzNXImy/Rr?=
 =?us-ascii?q?8x/S0TDoWgAoHeAIe3j+uawS25E5ZKM31AEU2GCnzydo+JCMsLPTufJ9IkmDgD?=
 =?us-ascii?q?XruJTYgn2hez8gjgxOlJNO3Rrw4Vq5PlnOdy4+ObwRIt8jh6J96Q32GEUyd/mW?=
 =?us-ascii?q?ZeFGx+57x2vUEokgTL6qN/mfENTdE=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AeAADv3vZbhxHrdtBiHgEGBwaBUQkLA?=
 =?us-ascii?q?YEwgmKDeIh3iyKZRxSBWhkYFIhSIjQJDQEDAQEBAQEBAgETAQEBCgsJCCkvgjY?=
 =?us-ascii?q?FAgMYCYJcAwMBAiAjCikDAwECBgEBJAIiBAICAwFTGQWDHIICAQSpLYEvhUCEX?=
 =?us-ascii?q?4ELin4XgUA/gRGHeGWCN4JXAokjll8JkSQLGIlRhzeYMIFGgg0zGggbFYMnkFt?=
 =?us-ascii?q?AMYEHHIpBgXcBAQ?=
X-IPAS-Result: =?us-ascii?q?A0AeAADv3vZbhxHrdtBiHgEGBwaBUQkLAYEwgmKDeIh3iyK?=
 =?us-ascii?q?ZRxSBWhkYFIhSIjQJDQEDAQEBAQEBAgETAQEBCgsJCCkvgjYFAgMYCYJcAwMBA?=
 =?us-ascii?q?iAjCikDAwECBgEBJAIiBAICAwFTGQWDHIICAQSpLYEvhUCEX4ELin4XgUA/gRG?=
 =?us-ascii?q?HeGWCN4JXAokjll8JkSQLGIlRhzeYMIFGgg0zGggbFYMnkFtAMYEHHIpBgXcBA?=
 =?us-ascii?q?Q?=
X-IronPort-AV: E=Sophos;i="5.56,266,1539673200"; 
   d="scan'208";a="41212380"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 22 Nov 2018 08:55:38 -0800
Received: from localhost ([::1]:47722 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gPsGO-00026P-VN
	for like.xu@linux.intel.com; Thu, 22 Nov 2018 11:55:37 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:37003)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <kwolf@redhat.com>) id 1gPsFM-0001eA-Du
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 11:54:37 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <kwolf@redhat.com>) id 1gPsFK-0000iP-Jf
	for qemu-devel@nongnu.org; Thu, 22 Nov 2018 11:54:32 -0500
Received: from mx1.redhat.com ([209.132.183.28]:35374)
	by eggs.gnu.org with esmtps (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.71) (envelope-from <kwolf@redhat.com>)
	id 1gPsFG-0000ee-K4; Thu, 22 Nov 2018 11:54:26 -0500
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
	[10.5.11.15])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mx1.redhat.com (Postfix) with ESMTPS id 999453001FE5;
	Thu, 22 Nov 2018 16:54:25 +0000 (UTC)
Received: from linux.fritz.box.com (ovpn-117-157.ams2.redhat.com
	[10.36.117.157])
	by smtp.corp.redhat.com (Postfix) with ESMTP id 8F6DE5D760;
	Thu, 22 Nov 2018 16:54:24 +0000 (UTC)
From: Kevin Wolf <kwolf@redhat.com>
To: qemu-block@nongnu.org
Date: Thu, 22 Nov 2018 17:54:05 +0100
Message-Id: <20181122165417.23894-2-kwolf@redhat.com>
In-Reply-To: <20181122165417.23894-1-kwolf@redhat.com>
References: <20181122165417.23894-1-kwolf@redhat.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
	(mx1.redhat.com [10.5.110.45]);
	Thu, 22 Nov 2018 16:54:25 +0000 (UTC)
Content-Transfer-Encoding: quoted-printable
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 209.132.183.28
Subject: [Qemu-devel] [PULL 01/13] iotests: Replace time.clock() with Timeout
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: kwolf@redhat.com, peter.maydell@linaro.org, qemu-devel@nongnu.org
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

time.clock() is deprecated since Python 3.3. Current Python versions
warn that the function will be removed in Python 3.8, and those warnings
make the test case 118 fail.

Replace it with the Timeout mechanism that is compatible with both
Python 2 and 3, and makes the code even a little nicer.

Signed-off-by: Kevin Wolf <kwolf@redhat.com>
Reviewed-by: John Snow <jsnow@redhat.com>
Reviewed-by: Philippe Mathieu-Daud=C3=A9 <philmd@redhat.com>
---
 tests/qemu-iotests/118 | 16 ++++++----------
 1 file changed, 6 insertions(+), 10 deletions(-)

diff --git a/tests/qemu-iotests/118 b/tests/qemu-iotests/118
index ff3b2ae3e7..c4f4c213ca 100755
--- a/tests/qemu-iotests/118
+++ b/tests/qemu-iotests/118
@@ -53,21 +53,17 @@ class ChangeBaseClass(iotests.QMPTestCase):
         if not self.has_real_tray:
             return
=20
-        timeout =3D time.clock() + 3
-        while not self.has_opened and time.clock() < timeout:
-            self.process_events()
-        if not self.has_opened:
-            self.fail('Timeout while waiting for the tray to open')
+        with iotests.Timeout(3, 'Timeout while waiting for the tray to o=
pen'):
+            while not self.has_opened:
+                self.process_events()
=20
     def wait_for_close(self):
         if not self.has_real_tray:
             return
=20
-        timeout =3D time.clock() + 3
-        while not self.has_closed and time.clock() < timeout:
-            self.process_events()
-        if not self.has_opened:
-            self.fail('Timeout while waiting for the tray to close')
+        with iotests.Timeout(3, 'Timeout while waiting for the tray to c=
lose'):
+            while not self.has_closed:
+                self.process_events()
=20
 class GeneralChangeTestsBaseClass(ChangeBaseClass):
=20
--=20
2.19.1


