Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 25 Nov 2018 14:42:51 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga007.jf.intel.com (orsmga007.jf.intel.com [10.7.209.58])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id E2CBE58037D;
	Sat, 24 Nov 2018 14:01:51 -0800 (PST)
Received: from fmsmga104.fm.intel.com ([10.1.193.100])
  by orsmga007-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 24 Nov 2018 14:01:51 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AghCzvhXcGNPwxO9QabZWupKloX/V8LGtZVwlr6E/?=
 =?us-ascii?q?grcLSJyIuqrYZhKDvadThVPEFb/W9+hDw7KP9fy4CSpYud6oizMrSNR0TRgLiM?=
 =?us-ascii?q?EbzUQLIfWuLgnFFsPsdDEwB89YVVVorDmROElRH9viNRWJ+iXhpTEdFQ/iOgVr?=
 =?us-ascii?q?O+/7BpDdj9it1+C15pbffxhEiCCybL9uLxi6txndutULioZ+N6g9zQfErGFVcO?=
 =?us-ascii?q?pM32NoIlyTnxf45siu+ZNo7jpdtfE8+cNeSKv2Z6s3Q6BWAzQgKGA1+dbktQLf?=
 =?us-ascii?q?QguV53sTSXsZnxxVCAXY9h76X5Pxsizntuph3SSRIMP7QawoVTmk8qxmTgLjhi?=
 =?us-ascii?q?UaOD4j6GzZitJ+gr9VrhyioBJ/2JbUbYOOOfZiYq/QZ88WSHBdUspNUSFKH4Oy?=
 =?us-ascii?q?b5EID+oEJetVsZPyp0ELrRSgAQmsBf7kxCFSiX/z3K06yfkqHAba0wM6BdIOtW?=
 =?us-ascii?q?rbrNH0NKsITeC61qzIzTTZb/5N1jf97ZLHchElof2WQb1wds/RxFApGgjYgFuQ?=
 =?us-ascii?q?ronlMCmU1uQLq2Wb9/dgWv+pi2I9tw5xpT2vyt8ii4bTnYIVylHE9SN2wIYpIt?=
 =?us-ascii?q?24TlR3bsC5H5tNry2aOIp2Qt8iQ2F1oyk20KEJuZm+fCUM1Z8pxAbfZuSZf4SU?=
 =?us-ascii?q?5h/vTvudLDlmiH5/Zb6yhAq+/VKhx+D+TsW50lJHojBYntTOtX0BzQLf58iZRv?=
 =?us-ascii?q?dn4Eus1yuD2gbO4e9eO080j7DUK5s5z74wiJUTtUPDEzfomEX5kqCWbF8o+uu2?=
 =?us-ascii?q?5OT9ZLXpuJucO5VzigHkPaQigs2/AeImPQgSR2WX5/iw2bn58UHkTrhGkOc6nr?=
 =?us-ascii?q?TavZzGP8gWp6y0DxdQ0ok56ha/Czmm0M4fnXkCNF9FfBOHj470O1DBOfz4Dumw?=
 =?us-ascii?q?g06qkDh1w/DKJ7rhA5vLLnfdirfsZqh960FCxwop19xf5IxbCqsHIP3tXk/9rt?=
 =?us-ascii?q?vYDgU2MwCs2eboFM191p8CWWKIGqKZNKLSsVyW6e41LOiMeZQYuDL8K/gj+v7v?=
 =?us-ascii?q?gmU1mV4bfam1w5QXbGq0EehhI0WceXDsmMsOEX8WvgoiS+znkF2CXiRSZ3auRa?=
 =?us-ascii?q?084Ss3CIK7DYjZQICtj6eM3CO6Hp1Qe2BHBUqAEXbud4WYRfgMbDieLdNmkjwB?=
 =?us-ascii?q?TbKhUZMu1QmytA/mzLpqNujU+ioGup7519h14OvTlRc19TFvC8Sd0meNT3x7n2?=
 =?us-ascii?q?8SRj822rx/rlJ5yluZzad4hPlYH8RJ5/xVSgc6KYLcz+tiBt/oQQLBftCJSFW8?=
 =?us-ascii?q?TtW8Gz4xTMk8w9sPY0Z7BtWjgQrP3yusA78JibOLAIY4/b7b33j0P8x90WrJ1L?=
 =?us-ascii?q?E9j1k6RctCLW6mibR59wTJA47Jkl+Wl6CldakH2C7N9WGDzXeBvU1CUQ5wV7nF?=
 =?us-ascii?q?Um4bZkfMsdv54UbCRae0Cbs7KgtB1dKCKqxSZ9L0l1pGWunsNM7eY22rnWewHg?=
 =?us-ascii?q?iHxrWLYIrueGUd2SHdBVMAkwAS+3aGKAc/Cj2go2LYEDxhC1bvb1nw/ul5rXOx?=
 =?us-ascii?q?VlU0wB2Sb019y7q1/QYYiuGGRPMNwL0IoichpC9yHFamwd3WDcGNpw5gfKVafN?=
 =?us-ascii?q?M8701L1WPftwxhIJOgK7puiUIZcwRyp0nuzQl4Cp1ckcg2q3Mn1BZyKaOd0FNG?=
 =?us-ascii?q?azOY3ZDxNqfLKmXo+xCvcarW2lDY0NaZ4aoP7PU4q1P+vACmDEYi8nNn08VL3H?=
 =?us-ascii?q?uY/JnFEA0SUZfpWEYt6xd6v63aYjU6547Mz3JsNbe7szDc1NMpHucq0QugcMpF?=
 =?us-ascii?q?P6OCFw/yFNMaCtOqKOwrnVipcx0FMPpT9K4yI8Opaf+G1LS3M+ZnmTKslX5H75?=
 =?us-ascii?q?xl0kKQ6yp8TfbF3pYYw/2CwgSLTTb9jFe7vcDxloBJfjUSHmu5ySj5C49dfKxy?=
 =?us-ascii?q?fYAXCWiwJ8273Mlxh5noW3RA7l6sG0sG2NO1eRqVd1H9xwxQ2lgNrny9hCS4yC?=
 =?us-ascii?q?Z4kzc3oaqF3SzC2vjtewADOmFWWmZil1DsIY6vgtAeXUioaRUplRS/6Ub7wahb?=
 =?us-ascii?q?uLpwL23JTUhUeCj2KnloUrGsubqaf85P9JQovD1XUeS9e1ybSqTxowAH0yPlBG?=
 =?us-ascii?q?ZewDE7dze3upT2hRB6iWSdLGpto3rdY81/2RDf5NnET/5LwjUGXDV4iSXQBlWk?=
 =?us-ascii?q?Pdmm58+Ul5TAsuC5TW6hTYdccSrozYOBsiu0+2tqDAa7n/CynN3nDAc73TX619?=
 =?us-ascii?q?lsSSXHshL8bpP32KS9NOJtZlNoC0Pk68pmBoF+lZM9hZEK1ngdnJmV/3sHkWHo?=
 =?us-ascii?q?PNVf2KL+amcNRDERz97U5gjlxFNsLnaTy43lUXWdx9NrZ8OmbWMOxiI988dKBb?=
 =?us-ascii?q?+X7LNenCt5uFq4rR/Lbvh7kTcQ0v8u6H8cg+EUtwsh1CSdArYOHUZGOSzgjQiH?=
 =?us-ascii?q?79e7rK9PfmagbaCw1FZindCmFLyCpwBcWHXjdZs4Ey5/8N5/ME7S333p8Y7rZs?=
 =?us-ascii?q?PQbd0Iux2QkhfAifVVKZ0rmvoLgypnJXzyvXk/x+Enihxu2ImwvJKbJGV14KK5?=
 =?us-ascii?q?HhlYOyXpZ8MU/zHhl6dfkdyQ34CyBZVhATQLUYDsTfKpFjISqPvmOxyPED06tn?=
 =?us-ascii?q?eUB77fERWD50dhqnLFC4qrOG2PJHkF0dViQwGQK1dFjwATWDU6g4Q1FgS3xMH6?=
 =?us-ascii?q?dEd55zYR5kP3qxdWy+JoMQX/XXnbpAuydjg0T52fJgJM7g5e/0fVLdCe7uVrEi?=
 =?us-ascii?q?Fa5JKhqRKCKneBawRUF20JWVGEB1P+Prmo/9bA6POVBu6/L/vIfLWPpvZSV/aO?=
 =?us-ascii?q?xZKzzIRm+yyAOdmIPnlnF/c7wFZMXWhlG8TFnDUCUywWlyXQb86CuRez4Ct3ot?=
 =?us-ascii?q?qk8PTsXgLv6pCCC79TMdVp5hC3jr2PN++WhCZlNzlY0okAymPPyLgaxFQSkT1h?=
 =?us-ascii?q?dyGxEbQcsi7AVKLQlbFWDx4YaCNzNdFE76Em3glKNs7UlMn11qNjjvMuD1dFVF?=
 =?us-ascii?q?rhmtymZMAQImG9Mk/HC1iPNLicOTLLxMT3a7umSbJMlOVUqwGwuTGDHkD5IzSM?=
 =?us-ascii?q?jCPpWA6vMO1WiCGbPQdTuIW8chZrFGjiQ8jqahy9MN9rkzI2xac4iW/NNW4ZKT?=
 =?us-ascii?q?J8aV9CrqWM7SNEhfVyA3BB7ntgLeWehymV9fXXKpYIvvttGSl0k+Na4HIny7pa?=
 =?us-ascii?q?9i1ERfp1mDfMod5quV2pju6Pyj9/WhpUtjlLnJ6LvVllOajB9phPQ3DE/BcM7W?=
 =?us-ascii?q?WWExsLpttlBcfpu6Bf0dXPkKPzKDFf89Pb58ccBs7UKN6ZP3olKxbmBDnUDA5W?=
 =?us-ascii?q?BQKsYGjPjUtQuPKf7HuYqt42qdykg5cURbJKEkc4EPQICk15B98TCJhyVzIg17?=
 =?us-ascii?q?WciYpA52a+sRzKRMRAuLjcS+mfR/nibH6Tk7BCbgATyrP1BY0YM8v8wUMmIlxz?=
 =?us-ascii?q?hpjLHQzIUMxAuDZsaCczukxG9HU4RWo2nwrhawWw8DoQGOSykxoelARze6Iu+S?=
 =?us-ascii?q?3q7lNxIUDF4GM7mVM0lNHkxyyYdT/rBKi1VIBSTSHzshsfKJT+Fi18dwi/mU0s?=
 =?us-ascii?q?CD7BRqgZ27Bpb2VmjA6apZJKGOR0QqhNYRtWzvaSMaZ7mW9AozmqkBcUrdDODo?=
 =?us-ascii?q?FvwVMn?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0BXAAALyvlbh0O0hNFjHgEGBwaBUwcLA?=
 =?us-ascii?q?QGCaIECFRKMcI1ClyiBbhcBARgNBgGIWiI2Bw0BAwEBAQEBAQIBEwEBAQgNCQg?=
 =?us-ascii?q?pIwxCARABgWIigmkDAj0BGx4DAgkCBRA7Ax4CEQEFASMSBYMcAYFoAQMVBAEKm?=
 =?us-ascii?q?xM8jB8FAReCdwWBMQELAYJwChknDVqBNwIGEodMhCuBVz+GeSwZAgEBhzoCkBC?=
 =?us-ascii?q?PRC4HAoIcBIRchwiDKwIWgVlNhD6CbTaFU4EtASyNF4EKiTwCBAIJAgUPIYEsB?=
 =?us-ascii?q?oIAMxojgQGCOwmCEoNtaooGIjIBgQMBAQGDUIg3AQE?=
X-IPAS-Result: =?us-ascii?q?A0BXAAALyvlbh0O0hNFjHgEGBwaBUwcLAQGCaIECFRKMcI1?=
 =?us-ascii?q?ClyiBbhcBARgNBgGIWiI2Bw0BAwEBAQEBAQIBEwEBAQgNCQgpIwxCARABgWIig?=
 =?us-ascii?q?mkDAj0BGx4DAgkCBRA7Ax4CEQEFASMSBYMcAYFoAQMVBAEKmxM8jB8FAReCdwW?=
 =?us-ascii?q?BMQELAYJwChknDVqBNwIGEodMhCuBVz+GeSwZAgEBhzoCkBCPRC4HAoIcBIRch?=
 =?us-ascii?q?wiDKwIWgVlNhD6CbTaFU4EtASyNF4EKiTwCBAIJAgUPIYEsBoIAMxojgQGCOwm?=
 =?us-ascii?q?CEoNtaooGIjIBgQMBAQGDUIg3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,275,1539673200"; 
   d="scan'208";a="52488334"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 24 Nov 2018 14:01:48 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726447AbeKYIvF (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sun, 25 Nov 2018 03:51:05 -0500
Received: from mail-wm1-f68.google.com ([209.85.128.68]:54564 "EHLO
        mail-wm1-f68.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726119AbeKYIvF (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 25 Nov 2018 03:51:05 -0500
Received: by mail-wm1-f68.google.com with SMTP id r63-v6so14750834wma.4
        for <linux-kernel@vger.kernel.org>; Sat, 24 Nov 2018 14:01:40 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=from:to:subject:date:message-id;
        bh=0Xi//oXh+pxyZDIhcSwHFoXu6Kl41Z2PaGpv0+WJec4=;
        b=KkRZaHyIeRD1mFHBEcEdWF8nBL1vTG/Y27MLny+ymeAnvBP16QG8GBk3TrzJijY8bN
         A5mn9Y6PxtAvIZ91KiugP8CHo1FWWnbbw2fzF4Spc7+rq2PRXFXZZP0aJG41fWdyqHac
         sNiXwwhAa51IomE+BseuA8Ej89t0Cg2wjv4lqyXqJ7cvx74I0HCknVNjiqyKSdaogUTd
         egAX5bc+mnttZi29Nx5QqEzE19QoNaBndaWFM13hmm5p2hFISEcS3r5vrrN3uGSkHDXv
         /0/LAe6deGJWcWTV6DlT0KwDbid6PnZMqE5UfaXfHjmozkFRFMEcWZvdfuymcczO/sq4
         e8cg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:from:to:subject:date:message-id;
        bh=0Xi//oXh+pxyZDIhcSwHFoXu6Kl41Z2PaGpv0+WJec4=;
        b=EQRbccrQYLFF2/9cV7okW6wznoUJp6voEQJwLKlIR7j2Jus95frM0QbN6Lw4OFXjpA
         tTymp79L8AuVWUD1Lwx53Cv7mXlLnGT2OmYUtuiw7CvBPHKw4vWr+RINjdEzQYGJZUZK
         jxLQ05U6Iws/T+gBDoIo7AqeM4HWL7byzCR58OhfbB+RYl+reyuIwuhhu+7/WuA3UCPV
         Q8cdR5QS9Ixt9gIzXOU3pbazbkjcaa/m04XmJI/rPXJc6G/A98SukjTcjVBMVdJA+Wc3
         OgH0Fsr7FzBkOraXcnTR5RBHMHD/6pUPsEzhWl990Yy9g0eD6h8MWL5n+z/FTJP0dSDo
         aVpQ==
X-Gm-Message-State: AA+aEWZKUwwwmyk6/gIC2jqiv+646YpKyTjK4ThT1kIXToSXT2kFKgnb
        sjVm9Xf2eVGDmSpLQtAOVp92xkCchQk=
X-Google-Smtp-Source: AJdET5cNNhbaEiABdRCB6dNSj8VWnsKlzUALyCWY8uvFJI3hRoZxpyHezDWumP0TxGnFWg7zpAl1MA==
X-Received: by 2002:a1c:8448:: with SMTP id g69-v6mr18615570wmd.63.1543096899493;
        Sat, 24 Nov 2018 14:01:39 -0800 (PST)
Received: from osboxes.localdomain (bzq-79-178-252-231.red.bezeqint.net. [79.178.252.231])
        by smtp.googlemail.com with ESMTPSA id e17sm13578999wrs.79.2018.11.24.14.01.37
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-SHA bits=128/128);
        Sat, 24 Nov 2018 14:01:38 -0800 (PST)
From: Carmeli Tamir <carmeli.tamir@gmail.com>
To: axboe@kernel.dk, sergey.senozhatsky@gmail.com, jthumshirn@suse.de,
        bvanassche@acm.org, martin.petersen@oracle.com,
        linux-kernel@vger.kernel.org, carmeli.tamir@gmail.com
Subject: [PATCH] fat: Replaced 11 magic to MSDOS_NAME for volume label
Date: Sat, 24 Nov 2018 17:01:19 -0500
Message-Id: <1543096879-82837-1-git-send-email-carmeli.tamir@gmail.com>
X-Mailer: git-send-email 2.7.4
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

The FAT file system volume label file stored in the root directory should
match the volume label field in the FAT boot sector. As consequence, the
max length of these fields ought to be the same. This patch replaces the
magic '11' usef in the struct fat_boot_sector with MSDOS_NAME,
which is used in struct msdos_dir_entry.

Please check the following references:
1. Microsoft FAT specification 2005 
(http://read.pudn.com/downloads77/ebook/294884/FAT32%20Spec%20%28SDA%20Contribution%29.pdf).
Search for 'volume label'.
2. Microsoft Extensible Firmware Initiative, FAT32 File System Specification
(https://staff.washington.edu/dittrich/misc/fatgen103.pdf). 
Search for 'volume label'.
3. User space code that creates FAT filesystem 
sometimes uses MSDOS_NAME for the label, sometimes not.
Search for 'if (memcmp(label, NO_NAME, MSDOS_NAME))'. 
I consider to make the same patch there as well.
https://github.com/dosfstools/dosfstools/blob/master/src/mkfs.fat.c


Signed-off-by: Carmeli Tamir <carmeli.tamir@gmail.com>
---
 include/uapi/linux/msdos_fs.h | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/include/uapi/linux/msdos_fs.h b/include/uapi/linux/msdos_fs.h
index fde7537..1216e6c 100644
--- a/include/uapi/linux/msdos_fs.h
+++ b/include/uapi/linux/msdos_fs.h
@@ -135,7 +135,7 @@ struct fat_boot_sector {
 						   for mount state. */
 			__u8	signature;  /* extended boot signature */
 			__u8	vol_id[4];	/* volume ID */
-			__u8	vol_label[11];	/* volume label */
+			__u8	vol_label[MSDOS_NAME];	/* volume label */
 			__u8	fs_type[8];		/* file system type */
 			/* other fields are not added here */
 		} fat16;
@@ -158,7 +158,7 @@ struct fat_boot_sector {
 						   for mount state. */
 			__u8	signature;  /* extended boot signature */
 			__u8	vol_id[4];	/* volume ID */
-			__u8	vol_label[11];	/* volume label */
+			__u8	vol_label[MSDOS_NAME];	/* volume label */
 			__u8	fs_type[8];		/* file system type */
 			/* other fields are not added here */
 		} fat32;
-- 
2.7.4

