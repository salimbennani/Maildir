Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 25 Nov 2018 22:12:55 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga007.fm.intel.com (fmsmga007.fm.intel.com [10.253.24.52])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id A5A1F580474;
	Sun, 25 Nov 2018 01:49:12 -0800 (PST)
Received: from fmsmga104.fm.intel.com ([10.1.193.100])
  by fmsmga007-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 25 Nov 2018 01:49:12 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AJ2su9h1k18lmKM4/smDT+DRfVm0co7zxezQtwd8Z?=
 =?us-ascii?q?segTLvvxwZ3uMQTl6Ol3ixeRBMOHs6IC07KempujcFRI2YyGvnEGfc4EfD4+ou?=
 =?us-ascii?q?JSoTYdBtWYA1bwNv/gYn9yNs1DUFh44yPzahANS47xaFLIv3K98yMZFAnhOgpp?=
 =?us-ascii?q?POT1HZPZg9iq2+yo9JDffwZFiCChbb9uMR67sRjfus4KjIV4N60/0AHJonxGe+?=
 =?us-ascii?q?RXwWNnO1eelAvi68mz4ZBu7T1et+ou+MBcX6r6eb84TaFDAzQ9L281/szrugLd?=
 =?us-ascii?q?QgaJ+3ART38ZkhtMAwjC8RH6QpL8uTb0u+ZhxCWXO9D9QKsqUjq+8ahkVB7oiD?=
 =?us-ascii?q?8GNzEn9mHXltdwh79frB64uhBz35LYbISTOfFjfK3SYMkaSHJOUcZfVSNPAo2y?=
 =?us-ascii?q?YYgSAeQfIelWoJL9p0MMoBalGQmsHfnixiNUinPq36A31fkqHwHc3AwnGtIDqH?=
 =?us-ascii?q?TarM/vO6cUUuC+0a/GwivdYPhL3jr99InIchYhoP2WU7NwcMzRxlQuFgLElViQ?=
 =?us-ascii?q?ponlMCmU1uQJqWSU8+1gVee2hmMhtgp/rD+vxsI2hYnIgIIY0kzE9Ct4wIYpOd?=
 =?us-ascii?q?23VlR7bcS4H5tXsiGWL492QsIkQ25yoiY6zacKuZmhfCgF0JgnyQTQZOCZfIeT?=
 =?us-ascii?q?5RLjU+WRLS1ki3JifbKygQu5/0u4yuDkSMW4zFJHojBYntTCqHwBzQHf58ubRv?=
 =?us-ascii?q?dn/0qs2y6D2x7P5uxAO0w5lqrWJ4Q8zrMxl5cfq1nPEyv5lUjwkaSYbF8r+vKy?=
 =?us-ascii?q?5OTierjmpoGTN4tzigzmLKQuldKwAf4iPggNQWeb4+K826Pn/UHjR7VKlPI2nr?=
 =?us-ascii?q?HYsJDcO8sbura0DxFJ3osn8RqzEjmr3MoCkXUaL19JZAiLgonrNl3WJfD3F/a/?=
 =?us-ascii?q?g1CikDdxwPDGO6XsApHMLnjFjbfgcq9x601Cxwopy9BQ+ZZUBqgGIPP9XE/+qs?=
 =?us-ascii?q?bYAwQnMwy73ennEs9x1oAAVmKVBK+WLqfSvUWP5uI1LOmAfJUVtyrlK/g5+/7u?=
 =?us-ascii?q?imc0mVscfamqw5Qbcn+5Hul9LkWdYHrshMoBEGgQsgo/SuzqlEONUTpJa3muWK?=
 =?us-ascii?q?I84ykxCJi6AofbWoCtnLuB0T+7HpJMZ2BGFkqDEXDye4WERvcDciSSIsB6nzwA?=
 =?us-ascii?q?VLihTZIh1B60uA/7zbpnMvTb+ikCuZ3/09h14vXZlQsu+jxsE8Sdz2aNQnl2nm?=
 =?us-ascii?q?MPWTA6xqN/oUt7yleF1qh1mPhYFd1V5/NUXQY2L5/cz+pmC9/sXgLNZMuGSFGj?=
 =?us-ascii?q?Qt++GzE+Usoxw8MSY0Z6A9itlAvD3yqtA78WjbCLHoY78qDH0nj1JsZ9zWvG1a?=
 =?us-ascii?q?Y7g1knRMtPKXOphqpl+wfPAI7Jll2Tl7y2eqQEwC7N6GCDwHKNvE5CVg58S6HF?=
 =?us-ascii?q?XXEFaUvQotT0/UfCT76oCbQ6PQpN08+CKq1WatL3iVVKXuvsONPbY2ipgWe/GQ?=
 =?us-ascii?q?6Ixq+QbIrtY2gSwT/SCFYanAwJ/XaJLw4+Bjy/rGLYCzBuEVHvY0bo8eRlrHO7?=
 =?us-ascii?q?T0k0zxyFbkF71rq1/AIViuKYS/8Jwr0EvyIhoS1uHFmhx9LWF8aApw15capBe9?=
 =?us-ascii?q?w9/klI2XjZtwNnOJygNL5thlgFfgRzvkPu0Qh3C4pancgrqnMq0BR9KaaC3Fxd?=
 =?us-ascii?q?cDOY2Ij6OqfLJWnq4BCvd6nW10nC0NaX/6cP7+g4q1XjvQ2zCkou6XJn08NR03?=
 =?us-ascii?q?ud4JXKAxEfUZbwUkYx6hh7qKvWYig754PIy3JsNbO4vSPF29IsHOEl0Aqvf89D?=
 =?us-ascii?q?MKOYEw//C9cVB8ywJ+0lhVeobggIM/tP9KEpJcymcfiG2Km1POt7mDKmjGJH4J?=
 =?us-ascii?q?1y006W9ip8TPLI0IgBw/2CwgSHUDL8hk+7ss/rgYBEeS0SHm2nxCnkGY5dfLF9?=
 =?us-ascii?q?cZwKCGeuOcK3wNp+ioXpW35Z8l6jGlwH1NWoeRqUc1zywwlQ2V4LrnygnCuy1y?=
 =?us-ascii?q?Z0nC0xrqqDwCzOxPzvdAAGOmFXXmZil0rjIY+ug9AcQkeodQkpmAK56kngw6hU?=
 =?us-ascii?q?ubpwL3PUQUdOZCX2K2BiUq2ttruNecJP6ZUosTlJX+S4e1yVVrn9ox4C2SP5A2?=
 =?us-ascii?q?Re3Cw7dy2tupjhnx16iXiRLXZpoHrCZMFwwwzS5NjdRf5XwzoHSzN0iTjRBlig?=
 =?us-ascii?q?Idap+c+YmIvEsuC7T2ihTIFccTH3zYOcsyu2/W9qDgeln/Cwmd3nFhI20TTh2N?=
 =?us-ascii?q?lpViXIrRD8bZft16mhNeJnf09oBELz6sZgG4F+lJcwi48U2XQAmpqV+n8Hm3/p?=
 =?us-ascii?q?MdpHwaL+cGYNRTkTzt/V+gfl31dvLnCIx4L/TXidxsphZ9+nYmIZwC497sZKCL?=
 =?us-ascii?q?uK47xAhyd6vl24rQfJa/hngjgd0ecu6GIdg+wRuwoi1CSdDqoSHUlFJyPskRuI?=
 =?us-ascii?q?4su6rKVWYmavbLex2FB/ndCnELGNvAVcVGzldZclGC969t9/P07U0H3v9oHkf8?=
 =?us-ascii?q?HdbdcSth2XiRjMleZUJ4wqlvoWmyVnI3nysmM/y+40lhFu2ZC6vI6aK2Ri5q65?=
 =?us-ascii?q?AxhYNiHraMMX4D3ikaFensOO1YC1ApphAikLXIfvTf+wDDISsvHnOxyPETImrH?=
 =?us-ascii?q?ebBKHfHRSe6Ep9q3LPEparN2yYJXUDzNViQgWdK1JbgAwOQDo6mZs5HBiwxMP9?=
 =?us-ascii?q?aEd5+iwR5lngpxRX0O1oMB3/UnrFqAesdzc5U5yfLBtQ7gFf6EbZK82e7uRvHy?=
 =?us-ascii?q?5G+p2tthCCKmueZw5QF2EGRlSEB0z/Prmp/dTA8fKXBu+gIPvVe7mOtfZSV/SV?=
 =?us-ascii?q?xZKsz4tm+SyDNt6UM3lmDv073FdDXH9jF8TYnTUPVzIYlybXY8GHoxe8/zV9rt?=
 =?us-ascii?q?qj//TzRALv+YyPBqNSMNVo5hC2mLqDOPSWhCpjMjZY0ZUMxXDTxbgb3V4SjTxu?=
 =?us-ascii?q?dja3HbQBsy7NULzfmqtNAxEHbCNzMdNC77gg0QlVJc7bltT126Z4jvErCldFVl?=
 =?us-ascii?q?/hmsCzacwJOWG9M1zHC1iRNLSbPj3G2MX3YaK6Sb1Ng+RYrRywuTCHE0D9OjSP?=
 =?us-ascii?q?jSXmVxeqMetUliGUIAReuJ2hchZqEWXsVs/mZQahMNBpjTw627k0hnLROG4YMD?=
 =?us-ascii?q?h8dV5Nr7KK4SNZhPV/B3JO7n5/IeaYnCaZ6vHSKowKvvtzHiR0i+Va7Wwmy7tU?=
 =?us-ascii?q?6SFIXuB6lDHOod5uvV6mlPKCyj5mUBpItzZKi5iHvURkOaXF6JZAXWzI8w4K7W?=
 =?us-ascii?q?WVEx4KvcdqCsXzu6BMzdjCjKLyJy1E89LR/MscAdDbKcOHMHU7NxrpFyXZDA8E?=
 =?us-ascii?q?TT6tKGHeiFZRkPCU9n2JsJc6roLgl4YJSr9eBxQJEaY2A0JkEdhKBJplVToilv?=
 =?us-ascii?q?bPgMcO5He66h3cVs5TuJfvUvOUCO/objGDgu8XSQEPxObWN40VNcXf1kEqPkV7?=
 =?us-ascii?q?mpWMBEvWUcJfiiJkZw4w5k5K9S4tHSUIx0v5Z1b1szcoHvmuk0tz01MmbA=3D?=
 =?us-ascii?q?=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AWAACPb/pbh0O0hNFjHgEGBwaBUQkLA?=
 =?us-ascii?q?YFagQMMgQIng3mDe5AcUgaBNQISiQaOIoFzLAcMAYFLgnWEGiI0CQ0BAwEBAQE?=
 =?us-ascii?q?BAQIBEwEBAQgNCQgpIwyCNiQBgmIBAgMBAiAdARsdAQMCCQEBBQULDQICJgICA?=
 =?us-ascii?q?x4BAREBBQEcBhMFBIJNSwGBaAEDCA0FCppkPIsNgRIFAReCdwWELAoZJw1agTc?=
 =?us-ascii?q?CBhJ5in6BD4EHhCOCVjoLAgKBX4MEglcCh1CIP49FLgcChhthhwiDKxiBWU2OY?=
 =?us-ascii?q?iyJQYNWgQqJVDCBJYINMxojgQGCOwmCEoNthRSFSzIzgQUBAYxrAQE?=
X-IPAS-Result: =?us-ascii?q?A0AWAACPb/pbh0O0hNFjHgEGBwaBUQkLAYFagQMMgQIng3m?=
 =?us-ascii?q?De5AcUgaBNQISiQaOIoFzLAcMAYFLgnWEGiI0CQ0BAwEBAQEBAQIBEwEBAQgNC?=
 =?us-ascii?q?QgpIwyCNiQBgmIBAgMBAiAdARsdAQMCCQEBBQULDQICJgICAx4BAREBBQEcBhM?=
 =?us-ascii?q?FBIJNSwGBaAEDCA0FCppkPIsNgRIFAReCdwWELAoZJw1agTcCBhJ5in6BD4EHh?=
 =?us-ascii?q?COCVjoLAgKBX4MEglcCh1CIP49FLgcChhthhwiDKxiBWU2OYiyJQYNWgQqJVDC?=
 =?us-ascii?q?BJYINMxojgQGCOwmCEoNthRSFSzIzgQUBAYxrAQE?=
X-IronPort-AV: E=Sophos;i="5.56,277,1539673200"; 
   d="scan'208";a="52509850"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 25 Nov 2018 01:49:11 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727274AbeKYUjt (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sun, 25 Nov 2018 15:39:49 -0500
Received: from mail-it1-f194.google.com ([209.85.166.194]:51596 "EHLO
        mail-it1-f194.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726526AbeKYUjt (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 25 Nov 2018 15:39:49 -0500
Received: by mail-it1-f194.google.com with SMTP id x19so24004298itl.1
        for <linux-kernel@vger.kernel.org>; Sun, 25 Nov 2018 01:49:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc:content-transfer-encoding;
        bh=hYA40ccOKm/+Hu87I5aK4kUNRv6S874U6Aq5f9kDZoo=;
        b=Y1iQlIBaKvvs/4XNQfZGevm/XygYlttei81egdQqHXaaz2BYzh1eAmnbiqDhtVbxkG
         GhAK5yYy08kCgH+dsPvtfAJdFMK8aVYEA/7ANaOtcKrdnX3K+j1C7EzFHW4cxc6rR+Rv
         e+fsU46aOYYWT2CFqzj48d9QwPucCdArI3NiGvuwtnYOIcMDI/CfF/055ngT+Xff8prw
         Y+eJYPWiIg10u8q81jTlvueX7FxmwPif3QOPrO+Tzn8dks4lfEOlnh00KjkHZwWaaG5R
         6cHbO0Pin5kK/ZJHsgZc2CJbih2GUrmYsVrw4WZbYgk/1ncVB1+rAny44xSjIJ/8DQiy
         HNsA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc:content-transfer-encoding;
        bh=hYA40ccOKm/+Hu87I5aK4kUNRv6S874U6Aq5f9kDZoo=;
        b=EgoW14T5hVeSmh+dY/VIJpX3uT+FazTOwoenY4LHb4CPi3ZmdAwCcHrkWe+WJRqkpd
         U2jsSJb3M+8+DjLySvVK7RUDQvewWWr4WlxnqdGShIk2PWAB/YnR4+UA07KTvWP5ImnD
         KVzCjmjDpH6ydyhEpOzm5HA24SYiOQPK5jsEQc9lz8Na/wHtp4vfVWdwEq1FMns1q9IB
         bOkRqNd5TTsqMQMCzj5BpXY1aBiTsN8LhrTqlZDcYOcRq+QMvmSARCGIezsmOXwY8m71
         koq0HcGXv1FR4qxrdk0jihGMedYwuZ5p1hHeNlypqygoZ5HseDCCEHbC4Nx4b65ZIWQr
         XMYw==
X-Gm-Message-State: AGRZ1gIryMQKXFhZVTA3gz8lzlm+uZ8+X0lvcI/hFrCDE6D8zlE6NBNr
        YgNvCoa08FEvh6fZx5X0ySIBMS2hTfy+jbQg598=
X-Google-Smtp-Source: AFSGD/Xm86mmjmLrzXI17xJeRyf/mFNejOr8s98zhkAn1nccASUxqkgOo43ekFl+TBEisOifV2LYtnk6kXB9M+ZxCr4=
X-Received: by 2002:a24:648f:: with SMTP id t137mr18569509itc.95.1543139346767;
 Sun, 25 Nov 2018 01:49:06 -0800 (PST)
MIME-Version: 1.0
References: <20181125050049.29685-1-tiny.windzz@gmail.com> <f4772a69-12c4-f79e-4ac2-4fe3add96f91@linaro.org>
In-Reply-To: <f4772a69-12c4-f79e-4ac2-4fe3add96f91@linaro.org>
From: Frank Lee <tiny.windzz@gmail.com>
Date: Sun, 25 Nov 2018 17:48:45 +0800
Message-ID: <CAEExFWuUU36hr3Xagy62GiJ-GeOytg7TJm+B0gpjW-W25hhc7w@mail.gmail.com>
Subject: Re: [PATCH v2] clocksource/drivers/integrator-ap: add missing of_node_put()
To: Daniel Lezcano <daniel.lezcano@linaro.org>
Cc: tglx@linutronix.de, linux-kernel@vger.kernel.org
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Sun, Nov 25, 2018 at 5:43 PM Daniel Lezcano
<daniel.lezcano@linaro.org> wrote:
>
> On 25/11/2018 06:00, Yangtao Li wrote:
> > of_find_node_by_path() acquires a reference to the node
> > returned by it and that reference needs to be dropped by its caller.
> > integrator_ap_timer_init_of() doesn't do that.The pri_node and the
> > sec_node are used as an identifier to compare against the current node,
> > we can directly drop the refcount after getting the node from path as
> > it is not used aspointer. In addition, a single variable is needed,
> > so fix it.
>
> I can apply the patch after adding a comment in the code below or
> alternatively you can resend a V3 after adding a comment yourself.
>
> What is your preference?
Hi Daniel:

You can add a comment in the code below,then apply the patch.

Thanks,
Yangtao
>
> > Signed-off-by: Yangtao Li <tiny.windzz@gmail.com>
> > ---
> > Changes in v2:
> > -update changeelog
> > -simplify fix
> > -change two variable to one
> > ---
> >  drivers/clocksource/timer-integrator-ap.c | 22 +++++++++++++---------
> >  1 file changed, 13 insertions(+), 9 deletions(-)
> >
> > diff --git a/drivers/clocksource/timer-integrator-ap.c b/drivers/clocks=
ource/timer-integrator-ap.c
> > index 76e526f58620..bbd0977d579a 100644
> > --- a/drivers/clocksource/timer-integrator-ap.c
> > +++ b/drivers/clocksource/timer-integrator-ap.c
> > @@ -181,8 +181,7 @@ static int __init integrator_ap_timer_init_of(struc=
t device_node *node)
> >       int irq;
> >       struct clk *clk;
> >       unsigned long rate;
> > -     struct device_node *pri_node;
> > -     struct device_node *sec_node;
> > +     struct device_node *alias_node;
> >
> >       base =3D of_io_request_and_map(node, 0, "integrator-timer");
> >       if (IS_ERR(base))
> > @@ -204,7 +203,14 @@ static int __init integrator_ap_timer_init_of(stru=
ct device_node *node)
> >               return err;
> >       }
> >
> > -     pri_node =3D of_find_node_by_path(path);
> > +     alias_node =3D of_find_node_by_path(path);
> > +
> > +     /* Drop the refcount of node */
> > +     of_node_put(alias_node);
> > +
> > +     if (node =3D=3D alias_node)
> > +             /* The primary timer lacks IRQ, use as clocksource */
> > +             return integrator_clocksource_init(rate, base);
> >
> >       err =3D of_property_read_string(of_aliases,
> >                               "arm,timer-secondary", &path);
> > @@ -213,14 +219,12 @@ static int __init integrator_ap_timer_init_of(str=
uct device_node *node)
> >               return err;
> >       }
> >
> > +     alias_node =3D of_find_node_by_path(path);
> >
> > -     sec_node =3D of_find_node_by_path(path);
> > -
> > -     if (node =3D=3D pri_node)
> > -             /* The primary timer lacks IRQ, use as clocksource */
> > -             return integrator_clocksource_init(rate, base);
> > +     /* Drop the refcount of node */
> > +     of_node_put(alias_node);
> >
> > -     if (node =3D=3D sec_node) {
> > +     if (node =3D=3D alias_node) {
> >               /* The secondary timer will drive the clock event */
> >               irq =3D irq_of_parse_and_map(node, 0);
> >               return integrator_clockevent_init(rate, base, irq);
> >
>
>
> --
>  <http://www.linaro.org/> Linaro.org =E2=94=82 Open source software for A=
RM SoCs
>
> Follow Linaro:  <http://www.facebook.com/pages/Linaro> Facebook |
> <http://twitter.com/#!/linaroorg> Twitter |
> <http://www.linaro.org/linaro-blog/> Blog
>
