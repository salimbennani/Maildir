Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 25 Nov 2018 14:42:19 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from orsmga004.jf.intel.com (orsmga004.jf.intel.com [10.7.209.38])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 2BACA5803C2;
	Sat, 24 Nov 2018 07:38:26 -0800 (PST)
Received: from fmsmga104.fm.intel.com ([10.1.193.100])
  by orsmga004-1.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 24 Nov 2018 07:38:25 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AQ2gTlxTiu0S8y8NTwTIGzRAKqdpsv+yvbD5Q0YIu?=
 =?us-ascii?q?jvd0So/mwa64YRaCt8tkgFKBZ4jH8fUM07OQ7/iwHzRYqb+681k6OKRWUBEEjc?=
 =?us-ascii?q?hE1ycBO+WiTXPBEfjxciYhF95DXlI2t1uyMExSBdqsLwaK+i764jEdAAjwOhRo?=
 =?us-ascii?q?LerpBIHSk9631+ev8JHPfglEnjWwba9xIRmssQndqtQdjJd/JKo21hbHuGZDdf?=
 =?us-ascii?q?5MxWNvK1KTnhL86dm18ZV+7SleuO8v+tBZX6nicKs2UbJXDDI9M2Ao/8LrrgXM?=
 =?us-ascii?q?TRGO5nQHTGoblAdDDhXf4xH7WpfxtTb6tvZ41SKHM8D6Uaw4VDK/5KptVRTmij?=
 =?us-ascii?q?oINyQh/W7YisJ+gqFVrg+/qRNj2I7UeIOYOeFifq/BZ94WWXZNUtpTWiFHH4iy?=
 =?us-ascii?q?b5EPD+0EPetAoYfyvUUOrRqjCgKxGu7i1iNGiHn106M1z+oqDAbL0xE+ENIQtn?=
 =?us-ascii?q?Tbstr0O7kUUe2uw6nIyC/Mb/JS2Tvn9IfIdRUhrOiKULltcsTR0VEiGx3ZgliU?=
 =?us-ascii?q?s4DpIj2Y2voXv2SG7OdsSfijhm8lpg1pvDSj2sMhhpPKi48V0FzI6CR0zYQvKd?=
 =?us-ascii?q?GlTEN2b9ipG4ZKuS6ALYt5WMYiTnlouCkkzr0Gvoa2fDYFyJs53R7Tcf+HfJaS?=
 =?us-ascii?q?4hLlSumRJS10hHV/eLKwnxqy8E6gxfPgVsSszlpGsi5InsPRun0DyRDf8NWLR/?=
 =?us-ascii?q?hh8ku72DuC1Rjf6uReLkA1karbJYQhwrk1lpcLtUTDHyn2mFj5jaOPdUUr5PKo?=
 =?us-ascii?q?6+L5bbXiv5OcMIF1igfgPaQ0gcG/H+s4PRYUX2SB+uSzyqfj/UvnT7VOlPE2lb?=
 =?us-ascii?q?PZsJ/CKcQBuqG5GxNV0pok6xunCzem0dcYkmcdIFNKZRKKlIzpO1DIIPDlAvaz?=
 =?us-ascii?q?mVWskDF3x//YOr3tGInCLn/GkL35Z7Zy91ZcyBYvzdBY/59UCqsOIPPvWkDrs9?=
 =?us-ascii?q?zUFB85MxGuzObhB9VwzYceWWOJAq+EP6Leq16I5uQzI+aSYI8ZoiryK/8g5/T2?=
 =?us-ascii?q?l382hUcdfbW13ZsQcH24HPNmLFuDbXrvhdcBF2EKvg0lQezuiV2CVyNTZnmoU6?=
 =?us-ascii?q?I94DE7FJypDYPZSo+xh7yB2T+xHodKaWBeFlCMDXDoep2eVPcXaCKSJcxhniYe?=
 =?us-ascii?q?Vbe7SY8szhWutA78y7p6IevY4CwYtZT/1Ndr4+3fjw099TtxD86FyWGCU3l0nn?=
 =?us-ascii?q?8URz8xxK1/olZyylGZ3ah8gvxXD9pT5/xSXwc+NJ7cyfF6Ct/oVgLAeNeJVEip?=
 =?us-ascii?q?QtG8DT4tSdIxxscEY1xhFNW6khDDwy2qDqcImLORGpw77LjQ33jrKMZ70HbJyq?=
 =?us-ascii?q?8hg14iQstMMG2mgrVy9wzSB47PjkWYmLymdaUa3C7R6miDyXCCs11fUA51Sa/F?=
 =?us-ascii?q?R2wQZlPKrdTl4UPPV6KhBq45MgRf08KCKrFFatvyjVpYQvfuI9DeY2O3m2etCh?=
 =?us-ascii?q?eE3LKMbIz2e2oD2CXRElQLkwcW/XyeLwgxGj+ho37CDDxpDV/vf0Ls8ex5qHOn?=
 =?us-ascii?q?Tk81zxuGb1F727qy4B4Vgf2cS/Uc3r8fvCchqjN0HEuy3t7MCtqAoRZhc7tYYd?=
 =?us-ascii?q?8n/FhH0mfZvRRnPpO8N6BimkIecwNvskz00xV4FIpBntYqrX8w1wVyNL+X30lH?=
 =?us-ascii?q?dzOb2pDwJKbaKm3z/BCpdq7X1UvS0NeQ+qcT9vs4r0/vsx2uFkon639nycVa02?=
 =?us-ascii?q?OA5pXWCwofSZLwUlst+xdmvb3bYyk96JnS1X1jKqS0tj7C29Q0BOoq0BqgftFf?=
 =?us-ascii?q?ML+aGw/2CcEVG8+uKOkykVizch0EJPxS9LIzP86+bfuG2bKkM/x6nD27imRL+o?=
 =?us-ascii?q?Z93VyW9yp9U+LHw4wKw/WF0QSZTTf8i1Ghv9vzmYBFYzESA2W+xTLlBI5Xeq19?=
 =?us-ascii?q?Y4ILBX2yLM2ww9V0n4TtVGJA9F6/G1MG39ekeBqTb1Dn3Qxcz18XoWGhmSajyz?=
 =?us-ascii?q?x0kjcprreQ3SDUwuTicgYHNXBPRGV4kVjsJo20hcgAXEe0dwgpiAel5UHiyqhZ?=
 =?us-ascii?q?vqt/NWrTQURPfyTsNGFtSKiwtrmDY85J9pwotz5aUOC9YVCcV778rAEW0yLlH2?=
 =?us-ascii?q?tC2j87cyumtYn+nxx/kGidNmp8rGLFecFswhfS/NzdSuRW3jYcRil4iD/XC0O4?=
 =?us-ascii?q?P9mo+9WUipjCvvq/V2KnSp1cby3rwZmcuyu84G1gGQe/kOyrmt37DQg61jf219?=
 =?us-ascii?q?pwWiXJthr8YpTr2L68MeJoZURoAF7868xnGoBxiIcwhZcQ2WQEiZWR53YIjWDz?=
 =?us-ascii?q?MdBD06LkcHUNXSILw8LS4AX93U1jL3GJyJjjWnST3MRhfMW6bX0M2i0m8c9KEq?=
 =?us-ascii?q?iU4adAnSt0pFq4sA3QbeJ8njcb1fsh9noaj/sVtwoqyyWXGqoSElVAPSzwixSI?=
 =?us-ascii?q?6MizrLlQZGaqa7Sx1VBxnda8DLGZuQFcWW30epMjHS9288V+P0jA0Hz16oH4Zt?=
 =?us-ascii?q?bQacgfuQGTkxfFl+JVMo4+luIWhSp7PmLwpWYqxPQ8jRxqwJG2poyHK3h28aK9?=
 =?us-ascii?q?Ax5YMCD1ZswJ9jHsi6ZegtiZ34S1Epp9HTULWYPiTei0HzIKqfTnKwGOHSU+qn?=
 =?us-ascii?q?iBHLrQAxSf5F16r37VEJCrKnKXJGQfzdp4XxmQP0hfgAESXDUnkZ81DAGqxMr9?=
 =?us-ascii?q?cEhn4jAd/EL3qhxJyuhwLRnwTn/fpBu0ajczUJWeLB1W7hxb50fIK8Oe6Ph/Hz?=
 =?us-ascii?q?pf/p2nowyAMWibZwVODWEUVU2IHVHjPr+y5dbe9+iUHPaxL/zLYb+Ws+xRS++I?=
 =?us-ascii?q?xY6z0oth5zuMNtuAPnhhD/0420pPR3N5G97emzUAVSMXjT/Nb9WAqRe4+y13qN?=
 =?us-ascii?q?2/8fvxVALu44uPF6VdMdF19x+qhqeDMvaahDxlJjZAypMM2XjIxaAF014PkC5u?=
 =?us-ascii?q?bSeiELQauS7JTaLdgatXDx8dayNuO8pE9aM83g9ROcHFjtP5zKJ3jvkwC11dT1?=
 =?us-ascii?q?zuhtmpZdAWI2G6LF7HGEeLNLGcKTLX2c34faO8RqNWjOhPsx2wuDCbE1LsPziZ?=
 =?us-ascii?q?ljnpUQyvPv9IjC2BIBNev4S9eA53CWf/VNLmdgG7MNhvgDw227I0gHbKNW8aMT?=
 =?us-ascii?q?dkckJNrqef7SVXgvhkH2xB73xlLfSLmiqD7unYLIoWvuVvAihui+1a53E6mPNp?=
 =?us-ascii?q?63RARfpoiG7Ro8RorlWOjOaC0HxkXQBIpzINg5iE+Q1rPajJ/59MVGyC5xIM9m?=
 =?us-ascii?q?WTChIio9pjF82puqZMx9yJn6X2bH9L6cPd98oaBs78NsOdLGcmIwjuXjXTCU9N?=
 =?us-ascii?q?QiSmOmLfr0hcluyC+HqIqJQztpnrntwJULAfHFUzGukbGwJ+HNEcK5d6WDAjub?=
 =?us-ascii?q?qaitMYo3u4sBTVAs5du8PpTPWXVNnmNjeVxZJtXT8p7ImweYgeKIv2y0FkQlZ/?=
 =?us-ascii?q?lYXOXUHXWIYe8WVacgYorRAVozBFRWop1he9Zw=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0C5AgCjb/lbh0O0hNFjHQEBHwUBBgGBT?=
 =?us-ascii?q?AKCXIEOJ4N5g3uPX4EPAQEGgUmJBgOFOIhngXUqEwGIWiI0CQ0BAwEBAQEBAQI?=
 =?us-ascii?q?BEwEBAQgNCQgpIwyCNiKCbAIgHQEbHgMCCQIFEAwDAiYCAgMcAgEBEQEFARQPE?=
 =?us-ascii?q?gWDHIFpAQMIDQWbDzyLDYESBQEXgncFhDAKGScNWoE3AgYSeYp+Fx0BWoEHhnm?=
 =?us-ascii?q?BcYM7glcCn1QuCRyNaIMrGIFKjz0BLI4hiVQwgSWCDXAVbII7gicXg0qKUj8zg?=
 =?us-ascii?q?QUBAYk/gk0BAQ?=
X-IPAS-Result: =?us-ascii?q?A0C5AgCjb/lbh0O0hNFjHQEBHwUBBgGBTAKCXIEOJ4N5g3u?=
 =?us-ascii?q?PX4EPAQEGgUmJBgOFOIhngXUqEwGIWiI0CQ0BAwEBAQEBAQIBEwEBAQgNCQgpI?=
 =?us-ascii?q?wyCNiKCbAIgHQEbHgMCCQIFEAwDAiYCAgMcAgEBEQEFARQPEgWDHIFpAQMIDQW?=
 =?us-ascii?q?bDzyLDYESBQEXgncFhDAKGScNWoE3AgYSeYp+Fx0BWoEHhnmBcYM7glcCn1QuC?=
 =?us-ascii?q?RyNaIMrGIFKjz0BLI4hiVQwgSWCDXAVbII7gicXg0qKUj8zgQUBAYk/gk0BAQ?=
X-IronPort-AV: E=Sophos;i="5.56,273,1539673200"; 
   d="scan'208";a="52464738"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 24 Nov 2018 07:38:23 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726665AbeKYCX5 (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sat, 24 Nov 2018 21:23:57 -0500
Received: from mail-oi1-f193.google.com ([209.85.167.193]:43283 "EHLO
        mail-oi1-f193.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726011AbeKYCX5 (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sat, 24 Nov 2018 21:23:57 -0500
Received: by mail-oi1-f193.google.com with SMTP id u18so12167300oie.10
        for <linux-kernel@vger.kernel.org>; Sat, 24 Nov 2018 07:35:17 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:from:date:message-id:subject:to;
        bh=/FuY6dgIuspQHr57QcxDIROVOnk4ZxSYqUTFxv9J2GE=;
        b=RLnPXe4JasnPuwQNW7n+lXR4QyKJ4P0OJXGm72UCGchI3wYQCzFxhMMO7upY96Kjcj
         nIciCaHW1OcawVqJf2JfcjNauX6w9crkRI9o/fUqtvh0Ne/wRfKELWRcL1UxVzTsDMD5
         iTEBtfULUMdjH811F1KkV1Pq3bBKcIokv6byt48cEAyRKcdDQDtwd1WyGmG8Gj8Z4069
         Comi1429HuqdyV2PgEcTnDsWJHaXN+QkXgCkbwNyZ6INj6diOcD/H11IVd7AdCf9vzyL
         UFmKBOBHR4vaRYH745eouPC0P9DJOYmMgCs/OZYeRo7mZ/sv9FAcXmTB9cb14oted8y7
         /Z9w==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:from:date:message-id:subject:to;
        bh=/FuY6dgIuspQHr57QcxDIROVOnk4ZxSYqUTFxv9J2GE=;
        b=SBaZ6yv2Cu5Vnild3JoiEyYLXyWwzn2dDR3le3qv3A8uA5HJ54Yr9wSgjyju8eBzUG
         VyZ89PVZx21iVBQYyo17YQsz1dg2iWngIRzI1+t6Qi1JUFed4QgvvVZVPXtwSGF0MJB3
         rEpOxbWWtlTgOV3ofkqh46wKd2Rvi+PTx7+AFuDjZ9G8N1q7VPru3kE5mF+4gkBp2jw1
         KDyRXT4l7BLR8BihO46hkxXIFhiqbfgSeBBLU4qsIZvZQLlc5pe45rtzsXIvC3KaG8Tn
         3V9T6OtOmdo0VxBeFAEusBdsDkhjLlBgjsUrmGcDB8DxyCqouMZTCcsajYmJAGJ2v3aB
         J7ag==
X-Gm-Message-State: AGRZ1gIeTAUr0YIPN0UHRDsmTltCho8MVOKXuy2zq0LmBCLfM6iohQOP
        kybllSjQWdUrKZxq6isGa4MW6h6FAQc9vUbK1WoyKs5j3l0=
X-Google-Smtp-Source: AJdET5fLiicJ7YaubKHHYpOjDsZMU/kLncyJ5XwdRwPU6BW8uUNcK3P1Ld5IxySLeo6JmDCVr/dhtquMrGCdBeHfjS0=
X-Received: by 2002:aca:d509:: with SMTP id m9mr10583311oig.82.1543073716617;
 Sat, 24 Nov 2018 07:35:16 -0800 (PST)
MIME-Version: 1.0
From: David CARLIER <devnexen@gmail.com>
Date: Sat, 24 Nov 2018 15:35:05 +0000
Message-ID: <CA+XhMqyP=OZ5=GF1L=1EkNuNWJfk0t=GJWvQd=K46vT-sq9L6A@mail.gmail.com>
Subject: [PATCH] Little memset_explicit optimisation
To: linux-kernel@vger.kernel.org, alexander.shishkin@linux.intel.com,
        aryabinin@virtuozzo.com, gregkh@linuxfoundation.org,
        andriy.shevchenko@linux.intel.com
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Subject: [PATCH] memzero_explicit, optimisation for size.


Using the return value of memset for save/load sake.


Signed-off-by: David Carlier <devnexen@gmail.com>

---

 lib/string.c | 2 +-

 1 file changed, 1 insertion(+), 1 deletion(-)


diff --git a/lib/string.c b/lib/string.c

index 38e4ca08e757..92da04a0213b 100644

--- a/lib/string.c

+++ b/lib/string.c

@@ -720,7 +720,7 @@ EXPORT_SYMBOL(memset);

  */

 void memzero_explicit(void *s, size_t count)

 {

- memset(s, 0, count);

+ s = memset(s, 0, count);

  barrier_data(s);

 }

 EXPORT_SYMBOL(memzero_explicit);

-- 

2.19.1
