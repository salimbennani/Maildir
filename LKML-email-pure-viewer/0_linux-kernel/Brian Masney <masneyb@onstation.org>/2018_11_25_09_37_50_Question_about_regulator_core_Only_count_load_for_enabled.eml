Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 25 Nov 2018 22:12:53 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga002.fm.intel.com (fmsmga002.fm.intel.com [10.253.24.26])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 0AFA65803EB;
	Sun, 25 Nov 2018 01:40:59 -0800 (PST)
Received: from orsmga106.jf.intel.com ([10.7.208.65])
  by fmsmga002-1.fm.intel.com with ESMTP; 25 Nov 2018 01:40:58 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AEBOdVBW8lHGXcW5tw5do9TwLG5zV8LGtZVwlr6E/?=
 =?us-ascii?q?grcLSJyIuqrYZhGEuadThVPEFb/W9+hDw7KP9fy4CSpYud6oizMrSNR0TRgLiM?=
 =?us-ascii?q?EbzUQLIfWuLgnFFsPsdDEwB89YVVVorDmROElRH9viNRWJ+iXhpTEdFQ/iOgVr?=
 =?us-ascii?q?O+/7BpDdj9it1+C15pbffxhEiCCybL9uLxi6txndutULioZ+N6g9zQfErGFVcO?=
 =?us-ascii?q?pM32NoIlyTnxf45siu+ZNo7jpdtfE8+cNeSKv2Z6s3Q6BWAzQgKGA1+dbktQLf?=
 =?us-ascii?q?QguV53sTSXsZnxxVCAXY9h76X5Pxsizntuph3SSRIMP7QawoVTmk8qxmUwHjhj?=
 =?us-ascii?q?sZODEl8WHXks1wg7xdoBK9vBx03orYbJiIOPZiYq/ReNUXTndDUMlMTSxMGo2y?=
 =?us-ascii?q?YYsRAeQcPuhXoJXyqEYAohulHQmhBvjiyiNUinLswaE2z/4sHR/A0Qc9H9wOqn?=
 =?us-ascii?q?PUrNDtOaoPS+C1zbPHzTPeZP1Rwzj9847IfQ4hoPqRWr9wdNDeyVIpFwzbjlSf?=
 =?us-ascii?q?spfoPzST1uQWr2iU9fZgVeOoi24hsQ1xpSKvxsg1h4TPm4kbyUjE+D1nzIopId?=
 =?us-ascii?q?C0UlN3bNC6HJdKqi2XNJd6TtkjTmxqoCo3zr4LtYSlcCUEzJkr3QPTZvOHfoSS?=
 =?us-ascii?q?/B7uWuacLDFlj3x/Yr2/nQy98U24x+38SMa01FFKozJbktnDqH8NzQbf6suZRf?=
 =?us-ascii?q?tn+EeuxzKP2xrU6uFeLkA4javbK5g/zb4sjpcfr1jPEyvslEnrgqKaaF8o9vWr?=
 =?us-ascii?q?5uj7eLnrp52RO5dxig7kM6QunsK/Af4/MggLR2Wb/eW81Lv+/Uz2WblKjeM5kr?=
 =?us-ascii?q?PfsJ/EIcQXv6m5AgFT0ok98RayFCmm0NsGknkdNl5FewyIj5LvO17QJPD0F/C/?=
 =?us-ascii?q?g06jkDtz3fDJIqXhAonRLnjEiLrhebd9601CxwYpwtFf+olZCrUAIPL1R0/wu8?=
 =?us-ascii?q?bUDh4/Mwyo3ennDM9x2Z8ZWWKKGqWZKr/dsUeU5uIzJOmBfI8Vtyz8K/g5/fHu?=
 =?us-ascii?q?imU1mV8Afaaz25sXZ2u1HvBnI0WffHrtjc0NEWYMvgoiUuPqjEeOXiJUZ3a3R6?=
 =?us-ascii?q?g8/C00CJq6DYffQYCgmL6B3CClEZFMZWBGDVaMEXHvd4ifX/cMaSSSItJukzAe?=
 =?us-ascii?q?VLihTZMh2g+qtAPg17VnKe/U8DUCtZ3/zNh1+/HTlRYq+DNuFMSd02aNT2Jukm?=
 =?us-ascii?q?MSXTA23rtyoUh8yleFzKh5jOZUFd1V5/NVTAg6MYTQwPB9C9D3QgjBZMuGSE66?=
 =?us-ascii?q?QtW6BjE8VtExzMUIY0pnH9WijwrM3yylA7IOk7yLBZo08r/T3nTrJsZ9zWrG27?=
 =?us-ascii?q?clj1U8XsRPMmimjLZl9wfPH47Jj1mZl6GyeKsBxiHN6nmMwXCOvE5CVg5wSrvK?=
 =?us-ascii?q?XXYYakvSrtT540fCQqSqCbQmNAtB1MGDJrFLat3vkVVJWvPjNM7CbGK2nme6HQ?=
 =?us-ascii?q?yIya+UbIr2Z2Ud2z3QB1UenAAN43mKLwg+CT2no2LFEjNuE0niY0ft8el4tXO6?=
 =?us-ascii?q?QVU4zwCMb019ybW1/gQZiuCbS/MWxrgEojsuqy1oHFah2NLbE8aApwtkfKVbfd?=
 =?us-ascii?q?M94FdG2XjFtwBnOZygNaRihl8YcwR4pE7u0xR3CoNdkckltn8qzQxyKb6G31NF?=
 =?us-ascii?q?bT+XwZfwOrjPIGno4B+vc7LW2k3Z0NuO4KgP7Oo3qlr9swCpDEYt6Ghn3MRP3H?=
 =?us-ascii?q?ua5ZXKCxQSXIn1UkY28Rh6ur7bbjM854PSyX1jL620viXe1NIuAesv0gygcMtH?=
 =?us-ascii?q?MKOYCA/yFNUXBsizKOAwh1eldBMFPOBI+64yMMOrbP+G2K+tPOZ9kzOql2VH4I?=
 =?us-ascii?q?Zh0k2S8ypwUPLH35EAw/uAxAuISy/8jEu9ssDwgY1EfzASEXalxij+GYFRYbd+?=
 =?us-ascii?q?fYAVBme0Is2738lxiITpW3FF6lGjHVQG2MmydBqWblz92xBQ1EsNrXymnyu40y?=
 =?us-ascii?q?J7kzUzoqWD2yzOxvzodAAbNW5TWGlikVDsLJC0jtAbRkSpbxIllAC45Ub83KVb?=
 =?us-ascii?q?oKV/L2/OQUZHZST2LmdiUreuubqGecJA9JQosSBPWuSmfV+aUqL9owcd0y77HW?=
 =?us-ascii?q?tR3io7dzKpupX+hRB6k3iSLHVwrHrYf8F/2xHf6cfYRf5Q2DoGWSZ5hSPWBli6?=
 =?us-ascii?q?I9mm49GUm43fveC5UmKrTodTfjXzzYOcqCu74nVnAB2lkPC0gNHnEwk60Sng2t?=
 =?us-ascii?q?luVCXIqgv8Y4bx26S7N+JnYldnBFvm58VmHYF+l5M6hIsM1ngCmpWV4X0HnH/w?=
 =?us-ascii?q?MdpB2KLydnoNRSMRzN7T7wjow0ljLnOPx4LkWXSR2MphZ9+mYmwI3iIx9dxFCK?=
 =?us-ascii?q?CR7LZchyt6vkK4rR7NYfh6hjodzPou6H0AjO0Ttgsi0D6dAqwMEklCJiPjiQ6I?=
 =?us-ascii?q?79+loaVTZWavd6Ww1UVkkdCgCrGCvh9TWHLjdpg+Gi9w6911MEjQ333r9oHkZN?=
 =?us-ascii?q?7QYMoPth2TlhfMlelUJ4g3lvoXnipnImP9sGYhy+46ixxuwJ67sJKGK2Vr4KK2?=
 =?us-ascii?q?HBpYOifpaMMU/zHnlbxekdqO34CzApVhHS0GU4DyQvKvFDISqO7rNwKTEDAnrn?=
 =?us-ascii?q?ebGLzfHRKQ6Ut8rnLPFYyrOG+TJHUD0dpiQxydLlRFgA8IRDU6goI5Fgeyyczj?=
 =?us-ascii?q?akh54y4e5kXiphtQ0O5oNAT/UmTCpAeucDg0U4OSLB5X7gFE+kfUPtaS7uN1Hy?=
 =?us-ascii?q?FE4JKhqBaBJXCcZwRNFWsJQFCLB0j/Prmy4tnN6+iZBu2jL/vXfLWBs+peW+2T?=
 =?us-ascii?q?xZKo1Itm8C2BNsGOPnlkEv061VBPXXF/G8TFhToPTzYbmD7Kb86evB284DF4rt?=
 =?us-ascii?q?ij8PT3XwLi/YuPBKVTMdVs+BC2gL2PN+2KhCZ+JjZXyIkMxWLTyLUE2F4Siidu?=
 =?us-ascii?q?dySiELgatC7NSr7QlbFTDxIBdyxzM85I5bom3gZRIc7bls/11rlgg/EvFldKTk?=
 =?us-ascii?q?bhld+pZMAQJ2G9NUjKBEKKNLSAOD3KzNv7YaK6Sb1MkupUswe8tiqcE0/mJj6D?=
 =?us-ascii?q?jSXmVwizMeFQiyGWJABeuIC4chp3FWfvVs7pah2lP99xljA2xbw0hnXXNW8TKz?=
 =?us-ascii?q?R8ckVNrqGO4iNcmPlwB2tB7n99J+mehymZ9/XYKooRsfZzAiV7jeRa4HE7y7tT?=
 =?us-ascii?q?9C5FRfx1lzHUrt5huFymluiPyjx6UBtBsDpLhYSLvVl8NqXd7JVPRXHE/BdepV?=
 =?us-ascii?q?mXXjgNutRhA8ankqZcx8LUk6S7fDtD+tTY8NEHL8PUMsWCMWckdx3zF2iQRC4M?=
 =?us-ascii?q?Vz3jH3vYmEoVxPuI8XqTr5USqZX2npcKDLhBWwpxXtcbA0EtM90YLIhwWT9sxb?=
 =?us-ascii?q?qUjdQE+n25oDHeQcxbutbMUffEUtv1LzPMp6NFbh1A5LrjK4kCftn+0ldkZ0hw?=
 =?us-ascii?q?tIPMAFbZQdFKpGtmdABi8xYFy2R3UmBmgxGtUQiq+nJGUKfsxhM=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AFAAD0bfpbh0O0hNFjGgEBAQEBAgEBA?=
 =?us-ascii?q?QEHAgEBAQGBUwMBAQEBCwGDayeMcIsggiGNcBGJJxSBcysBiFoiNgcNAQMBAQE?=
 =?us-ascii?q?BAQECARMBAQEIDQkIKSMMgjYkAYJpAjcGAQE3AQUJAhgTJQMMBUkBF4McggIDA?=
 =?us-ascii?q?qVCgh+CdgEBBYcTCIptgRwXgX+BEYd0BYNMgiaQEo9yCYFkiEWGeyMKkH6YMIF?=
 =?us-ascii?q?NAYIFMxoIKAiDJ4IbNYhMhVwiMoECAgEBASETjDcBAQ?=
X-IPAS-Result: =?us-ascii?q?A0AFAAD0bfpbh0O0hNFjGgEBAQEBAgEBAQEHAgEBAQGBUwM?=
 =?us-ascii?q?BAQEBCwGDayeMcIsggiGNcBGJJxSBcysBiFoiNgcNAQMBAQEBAQECARMBAQEID?=
 =?us-ascii?q?QkIKSMMgjYkAYJpAjcGAQE3AQUJAhgTJQMMBUkBF4McggIDAqVCgh+CdgEBBYc?=
 =?us-ascii?q?TCIptgRwXgX+BEYd0BYNMgiaQEo9yCYFkiEWGeyMKkH6YMIFNAYIFMxoIKAiDJ?=
 =?us-ascii?q?4IbNYhMhVwiMoECAgEBASETjDcBAQ?=
X-IronPort-AV: E=Sophos;i="5.56,277,1539673200"; 
   d="scan'208";a="41426407"
X-Amp-Result: UNSCANNABLE
X-Amp-File-Uploaded: False
Unscannable: 2
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 25 Nov 2018 01:40:56 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727222AbeKYU2b (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sun, 25 Nov 2018 15:28:31 -0500
Received: from onstation.org ([52.200.56.107]:43218 "EHLO onstation.org"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1726526AbeKYU2b (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 25 Nov 2018 15:28:31 -0500
Received: from localhost (c-98-239-145-235.hsd1.wv.comcast.net [98.239.145.235])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        (Authenticated sender: masneyb)
        by onstation.org (Postfix) with ESMTPSA id D1EB657D;
        Sun, 25 Nov 2018 09:37:50 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=onstation.org;
        s=default; t=1543138670;
        bh=0HR8EpxO2GEdmafSntDoyckcx8FOlg951VyJc3pZ5Lw=;
        h=Date:From:To:Cc:Subject:From;
        b=Ma23cGbXdq6/tZc9DMKKZ+zNX/aBkB1OFjQUxXOy4bjyX7PLgdE/nnF9fJBH3tyjk
         uLpw8kaQ7YuHhKCAvBnMFgFtAkUfk4/GD5JyjRMD/qNRDAKxrV1O1UGg8BADlkm04T
         zLI9XM1GoWRmgzsmhlAelK2YfpHHVWRPWBLl75UQ=
Date: Sun, 25 Nov 2018 04:37:50 -0500
From: Brian Masney <masneyb@onstation.org>
To: Douglas Anderson <dianders@chromium.org>,
        Mark Brown <broonie@kernel.org>,
        Liam Girdwood <lgirdwood@gmail.com>
Cc: linux-kernel@vger.kernel.org
Subject: Question about "regulator: core: Only count load for enabled
 consumers" in -next
Message-ID: <20181125093750.GA28055@basecamp>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.9.4 (2018-02-28)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hi all,

I see errors like the following in linux next-20181123 when trying to
boot a mainline kernel on a LG Nexus 5 phone:

[   14.495056] mmc1: Card stuck in wrong state! mmcblk1 card_busy_detect status: 0xe00
[   14.495185] mmc1: cache flush error -110
[   14.601547] mmc1: Reset 0x1 never completed.
[   14.601572] mmc1: sdhci: ============ SDHCI REGISTER DUMP ===========
[   14.604882] mmc1: sdhci: Sys addr:  0x00000000 | Version:  0x00003802
[   14.611240] mmc1: sdhci: Blk size:  0x00004000 | Blk cnt:  0x00000000
[   14.617664] mmc1: sdhci: Argument:  0x00000000 | Trn mode: 0x00000000
[   14.624064] mmc1: sdhci: Present:   0x01e80000 | Host ctl: 0x00000000
[   14.630508] mmc1: sdhci: Power:     0x00000000 | Blk gap:  0x00000000
[   14.636930] mmc1: sdhci: Wake-up:   0x00000000 | Clock:    0x00000003
[   14.643335] mmc1: sdhci: Timeout:   0x00000000 | Int stat: 0x00000000
[   14.649778] mmc1: sdhci: Int enab:  0x00000000 | Sig enab: 0x00000000
[   14.656200] mmc1: sdhci: ACmd stat: 0x00000000 | Slot int: 0x00000000
[   14.662606] mmc1: sdhci: Caps:      0x642dc8b2 | Caps_1:   0x00008007
[   14.669051] mmc1: sdhci: Cmd:       0x00000000 | Max curr: 0x00000000
[   14.675469] mmc1: sdhci: Resp[0]:   0x00000000 | Resp[1]:  0x00000000
[   14.681877] mmc1: sdhci: Resp[2]:   0x00000000 | Resp[3]:  0x00000000
[   14.688320] mmc1: sdhci: Host ctl2: 0x00000000
[   14.694720] mmc1: sdhci: ADMA Err:  0x00000000 | ADMA Ptr: 0x70042330
[   14.699080] mmc1: sdhci: ============================================

I bisected the issue to the following commit:

5451781dadf8 ("regulator: core: Only count load for enabled consumers")

We have to increase the load for the sdhci in device tree in order for
the phone to boot properly. This change was made with the commit:

03864e57770a ("ARM: dts: qcom: msm8974-hammerhead: increase load on l20
for sdhci")

Is there a change that I should make in device tree to get the SD card
working again on the phone?

Thanks,

Brian
