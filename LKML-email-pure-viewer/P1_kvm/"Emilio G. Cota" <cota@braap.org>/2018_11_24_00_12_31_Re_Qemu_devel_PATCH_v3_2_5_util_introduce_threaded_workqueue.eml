Return-Path: <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 24 Nov 2018 12:37:55 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga008.fm.intel.com (fmsmga008.fm.intel.com [10.253.24.58])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 74346580460
	for <like.xu@linux.intel.com>; Fri, 23 Nov 2018 16:12:56 -0800 (PST)
Received: from fmsmga103.fm.intel.com ([10.1.193.90])
  by fmsmga008-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 23 Nov 2018 16:12:56 -0800
IronPort-PHdr: =?us-ascii?q?9a23=3AO0cbjR/LO6XA7/9uRHKM819IXTAuvvDOBiVQ1KB2?=
 =?us-ascii?q?1uIcTK2v8tzYMVDF4r011RmVBdWds6oMotGVmpioYXYH75eFvSJKW713fDhBt/?=
 =?us-ascii?q?8rmRc9CtWOE0zxIa2iRSU7GMNfSA0tpCnjYgBaF8nkelLdvGC54yIMFRXjLwp1?=
 =?us-ascii?q?Ifn+FpLPg8it2O2+557ebx9UiDahfLh/MAi4oQLNu8cMnIBsMLwxyhzHontJf+?=
 =?us-ascii?q?RZ22ZlLk+Nkhj/+8m94odt/zxftPw9+cFAV776f7kjQrxDEDsmKWE169b1uhTF?=
 =?us-ascii?q?UACC+2ETUmQSkhpPHgjF8BT3VYr/vyfmquZw3jSRMNboRr4oRzut86ZrSAfpiC?=
 =?us-ascii?q?gZMT457HrXgdF0gK5CvR6tuwBzz4vSbYqINvRxY7ndcMsUS2RBQMhfVCJBDYyg?=
 =?us-ascii?q?YIQSAOQOP+hXoZTlp1YMrxWzChSgCe3zxjBWnX/7xrE63uc7HA3awAAtBdADvX?=
 =?us-ascii?q?LJp9v1LqcSVuW1wbHGwTvMavNW2DP96InPchs8oP+AR697fNTWyUkzDQzJgEib?=
 =?us-ascii?q?pIv5MDOSyuQCqXOW4PF6Ve21kWEnsxt9oj+1xscjk4TEgJ8exFPc9Shh3oo5Od?=
 =?us-ascii?q?61RFRmbdK5E5ZcrT+WOoV2T884Xm1luj42xqAYtZO4ZiQHyJAqywTBZ/CbaYSE?=
 =?us-ascii?q?/A/vWeeXLDxlnnxqYqi/iAy38UW4yu3zSM200FFSoypBk9nMrWwN1wfJ5siITP?=
 =?us-ascii?q?t9412t2TGV1wDc8u1EIEY0mrTHK5M53LI8ipkevV7eEiPrm0j6lrGae0sk9+Sy?=
 =?us-ascii?q?9ujqYK3qppqGOI91jgH+PL4umsu6AekgKwgBQW2b+fml2LL+40L5XqtFjvkvnq?=
 =?us-ascii?q?bCt5DaOMIbqbKnDA9O1Yoj7xe/DzS439gCkngHMUpIeBaGj4jvJlHPL+r0Dfa5?=
 =?us-ascii?q?g1Swjjhrw+rKMaHmApXINXXDlrDhfbBy605a1Qo/19df54hbCr0ZOvL8RlfxtM?=
 =?us-ascii?q?DEDh8+KwG0x+fnCNZj2Y8EVmOPH7SUMKfTsV+O++IuLPOAZI4TuDbhNfcl4+Ti?=
 =?us-ascii?q?gmM+mV8YLuGU24AKYiW4Auh+OBfeJn7tmcsaV2ENuAU4UartklLFVDdSY3O7We?=
 =?us-ascii?q?U7/i06D4S9Sp7OQ53ojLGf0SPoI5tNe2oTD1mNFWvvJZyJXupJZC+ML8skiDEd?=
 =?us-ascii?q?SLW6V6cn0hehshK8zKBoefHJ8C8Vvo62yd5u+ufIngsz/zEnM8PI3HyESW5umW?=
 =?us-ascii?q?UHAS831adXrkl0y1PF2q990NJCEtkGrd5MUwM7MtbziaRRDMz7EEqVddCVQX6s?=
 =?us-ascii?q?WNyvGXc2VN1nkIxGWFp0B9j31kOL5CGtGbJA0uXTXJE=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ALAAB9lvhbhxHrdtBjGgEBAQEBAgEBA?=
 =?us-ascii?q?QEHAgEBAQGBVAIBAQEBCwGBMIJig3mId4shgg2JDIR4iy0SGBSIWiI3Bg0BAwE?=
 =?us-ascii?q?BAQEBAQIBEwEBAQoLCQgbDiMMgjYFAgMaAQaCXAECAwECIA8BDQEBBAopAQIDA?=
 =?us-ascii?q?QIGAQEKGAICBR0EAgIDAQsFDU8FgxyBagMVAQSlaXCBL4J2AQEFhHgNghEIgQu?=
 =?us-ascii?q?JYoEcEQaBf4QjglaCdYI3MYImkBKPRC4HAgKOAoMgIwqJRYc5jk2JY4FcgXd9C?=
 =?us-ascii?q?IMnghuDbYUUhVxUgQIFIROJdoF3AQE?=
X-IPAS-Result: =?us-ascii?q?A0ALAAB9lvhbhxHrdtBjGgEBAQEBAgEBAQEHAgEBAQGBVAI?=
 =?us-ascii?q?BAQEBCwGBMIJig3mId4shgg2JDIR4iy0SGBSIWiI3Bg0BAwEBAQEBAQIBEwEBA?=
 =?us-ascii?q?QoLCQgbDiMMgjYFAgMaAQaCXAECAwECIA8BDQEBBAopAQIDAQIGAQEKGAICBR0?=
 =?us-ascii?q?EAgIDAQsFDU8FgxyBagMVAQSlaXCBL4J2AQEFhHgNghEIgQuJYoEcEQaBf4Qjg?=
 =?us-ascii?q?laCdYI3MYImkBKPRC4HAgKOAoMgIwqJRYc5jk2JY4FcgXd9CIMnghuDbYUUhVx?=
 =?us-ascii?q?UgQIFIROJdoF3AQE?=
X-IronPort-AV: E=Sophos;i="5.56,271,1539673200"; 
   d="scan'208";a="53126746"
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from lists.gnu.org ([208.118.235.17])
  by mtab.intel.com with ESMTP/TLS/AES256-SHA; 23 Nov 2018 16:12:55 -0800
Received: from localhost ([::1]:54706 helo=lists.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>)
	id 1gQLZ9-0008OS-1V
	for like.xu@linux.intel.com; Fri, 23 Nov 2018 19:12:55 -0500
Received: from eggs.gnu.org ([2001:4830:134:3::10]:35305)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <cota@braap.org>) id 1gQLYs-0008O4-QB
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 19:12:40 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <cota@braap.org>) id 1gQLYo-0001uY-CC
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 19:12:38 -0500
Received: from out4-smtp.messagingengine.com ([66.111.4.28]:49079)
	by eggs.gnu.org with esmtps (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.71) (envelope-from <cota@braap.org>) id 1gQLYo-0001ts-7u
	for qemu-devel@nongnu.org; Fri, 23 Nov 2018 19:12:34 -0500
Received: from compute4.internal (compute4.nyi.internal [10.202.2.44])
	by mailout.nyi.internal (Postfix) with ESMTP id C24CC21F51;
	Fri, 23 Nov 2018 19:12:33 -0500 (EST)
Received: from mailfrontend2 ([10.202.2.163])
	by compute4.internal (MEProxy); Fri, 23 Nov 2018 19:12:33 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=braap.org; h=
	date:from:to:cc:subject:message-id:references:mime-version
	:content-type:content-transfer-encoding:in-reply-to; s=mesmtp;
	bh=yo2BeRO8TxLfIBfy4yd9ajpbLvfCy5+lT828DYT1wA8=; b=Qo5lGdPfCzFJ
	AhfUK6OqwyOcC/31TBeLvy5L/9AXwHdwTrhgUlQbVBkhGrghVomc79cBynGyd87p
	9keZHEDAryx2rIN6q4e3VdZ5gBvL0atfHrrjky+XHRbR/fOvlM84pI7fWW6Y76x5
	dBvXBJHzPhwTF0QefGP/0Q+7nmYJ4PI=
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=
	messagingengine.com; h=cc:content-transfer-encoding:content-type
	:date:from:in-reply-to:message-id:mime-version:references
	:subject:to:x-me-proxy:x-me-proxy:x-me-sender:x-me-sender
	:x-sasl-enc; s=fm1; bh=yo2BeRO8TxLfIBfy4yd9ajpbLvfCy5+lT828DYT1w
	A8=; b=SLJ5zfgejZaxDeCyoU4bkGrzMvAD97z+bz3BJQMpAn/hmSXEiNBoIoS5O
	avjp1R9Rgd3WDWLrMZagGzKMzTu/vRoJLgAovKe2lnAFqZqnXuzIe4AE7LmQpAPR
	IVpZ9QVniw8gqp3vN/p9LOny3YhCOnAxFhl2D/424aaNQUgTswDPmaqP8Z9GedR/
	mixCi7YLLG3w/XErdlV8nF81qdyWkzmN5xbE1T+YSIfR4r4TpDAsm395iyR7C4SM
	LNB7FLFyQoXo5SzZQuGLUdVF5GTVQ0ebm+dWgr3rQc2Tb7OW9pg11LuucdE+iwXq
	01Bm4qF29+rijvzRCsgAGMrgKsXZw==
X-ME-Sender: <xms:cJf4W6a7MdqSEBHLf06zAOqcVPbVmPY9HtFQfq0jGrNpUWt-9UVRfg>
X-ME-Proxy: <xmx:cJf4W-vF9CZ-PB109a-K8gOQh7mdBjsOywfinmgsGB03x5Oo1mpABQ>
	<xmx:cJf4Wzpd9vJMqlVRyf4OxzZRngEA3MkwtXRjtLLzJSaIlpSZHcjGPA>
	<xmx:cJf4W7kW-i8R4a6W6aE2C7kz9fbcWT1geFycdALsrUR1BFZ-0fAtjA>
	<xmx:cJf4W3xgOGh5tXE4A2Re_FXniQsaSvGvmKdM7YykDMT6GGFQ63v0ag>
	<xmx:cJf4WzlomB4ZhONgBn9FGyTdIS2e7SSirHoHu74gRlAdua6qQWLrMg>
	<xmx:cZf4WxiwY_gZl0cTjj2HjRU9kcevRgbqYcI-0Vqc1k5UQEBQ-H5oxA>
Received: from localhost (flamenco.cs.columbia.edu [128.59.20.216])
	by mail.messagingengine.com (Postfix) with ESMTPA id BCF4D102A0;
	Fri, 23 Nov 2018 19:12:31 -0500 (EST)
Date: Fri, 23 Nov 2018 19:12:31 -0500
From: "Emilio G. Cota" <cota@braap.org>
To: guangrong.xiao@gmail.com
Message-ID: <20181124001231.GE17229@flamenco>
References: <20181122072028.22819-1-xiaoguangrong@tencent.com>
	<20181122072028.22819-3-xiaoguangrong@tencent.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20181122072028.22819-3-xiaoguangrong@tencent.com>
User-Agent: Mutt/1.9.4 (2018-02-28)
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
	[fuzzy]
X-Received-From: 66.111.4.28
Subject: Re: [Qemu-devel] [PATCH v3 2/5] util: introduce threaded workqueue
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <http://lists.nongnu.org/archive/html/qemu-devel/>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
	<mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: kvm@vger.kernel.org, mst@redhat.com, mtosatti@redhat.com,
	Xiao Guangrong <xiaoguangrong@tencent.com>, dgilbert@redhat.com,
	peterx@redhat.com, qemu-devel@nongnu.org, quintela@redhat.com,
	wei.w.wang@intel.com, jiang.biao2@zte.com.cn, pbonzini@redhat.com
Errors-To: qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+like.xu=linux.intel.com@nongnu.org>

On Thu, Nov 22, 2018 at 15:20:25 +0800, guangrong.xiao@gmail.com wrote:
> +   /*
> +     * the bit in these two bitmaps indicates the index of the ï¼ requests

This @ is not ASCII, is it?

> +     * respectively. If it's the same, the corresponding request is free
> +     * and owned by the user, i.e, where the user fills a request. Otherwise,
> +     * it is valid and owned by the thread, i.e, where the thread fetches
> +     * the request and write the result.
> +     */
> +
> +    /* after the user fills the request, the bit is flipped. */
> +    uint64_t request_fill_bitmap QEMU_ALIGNED(SMP_CACHE_BYTES);
> +    /* after handles the request, the thread flips the bit. */
> +    uint64_t request_done_bitmap QEMU_ALIGNED(SMP_CACHE_BYTES);

Use DECLARE_BITMAP, otherwise you'll get type errors as David
pointed out.

Thanks,

		Emilio

