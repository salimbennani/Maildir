Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 06 Dec 2018 08:57:45 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga004.fm.intel.com (fmsmga004.fm.intel.com [10.253.24.48])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id 1BC465804C1;
	Wed,  5 Dec 2018 11:01:32 -0800 (PST)
Received: from fmsmga101.fm.intel.com ([10.1.193.65])
  by fmsmga004-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 05 Dec 2018 11:01:31 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3AZpwS8RCCP/Di09eMgjCjUyQJP3N1i/DPJgcQr6Af?=
 =?us-ascii?q?oPdwSP/7osuwAkXT6L1XgUPTWs2DsrQY07qQ6/iocFdDyK7JiGoFfp1IWk1Nou?=
 =?us-ascii?q?QttCtkPvS4D1bmJuXhdS0wEZcKflZk+3amLRodQ56mNBXdrXKo8DEdBAj0OxZr?=
 =?us-ascii?q?KeTpAI7SiNm82/yv95HJbAhEmDmwbaluIBmqsA7cqtQYjYx+J6gr1xDHuGFIe+?=
 =?us-ascii?q?NYxWNpIVKcgRPx7dqu8ZBg7ipdpesv+9ZPXqvmcas4S6dYDCk9PGAu+MLrrxjD?=
 =?us-ascii?q?QhCR6XYaT24bjwBHAwnB7BH9Q5fxri73vfdz1SWGIcH7S60/VC+85Kl3VhDnlC?=
 =?us-ascii?q?YHNyY48G7JjMxwkLlbqw+lqxBm3oLYfJ2ZOP94c6jAf90VWHBBU95RWSJfH428?=
 =?us-ascii?q?c4UBAekPPelaronyu1QAohSlBQm0Bu7i0SNIhmbq0aEmz+gtDR/K0Qo9FNwOqn?=
 =?us-ascii?q?TUq9D1Ob8OXOCz0anI1y/Mb/xL0jn49YjIdwouoeuRVr1/bMrRzUgvFxjFjlqK?=
 =?us-ascii?q?tIfoOCma1uIQs2iB9eVgWuGvi3M8pgB+ozivwsYsio/Gh44P1l/E8iB5zZ8zKN?=
 =?us-ascii?q?alS0B7ecapHIVMuyyeLYd6X80vT39ytConybAKpYS3cSkIxZg/2hLSaOKLf5KV?=
 =?us-ascii?q?7h/gTuqdPDV1iXB/dL6ihRu+7VCsyuPiWcS3zFpHqy9In9jPu38TyhPe78yKRe?=
 =?us-ascii?q?dn8Uql3DuAywLe5fxeLk0xiKXWKZ8szaM2m5EOq0rMBDX2l1/zjKKOdkUr5Oyo?=
 =?us-ascii?q?6+P/b7X4qZ+TKZV0hhv9MqswgMy/B/o3MgwUU2ic4+S826Xv/Uz/QLpUkv07ir?=
 =?us-ascii?q?fVvIzeKMgBu6K0DRFZ3pw+5xu8EzuqytUVkHsfIFJAYh2HjozpO1/UIPD/CPey?=
 =?us-ascii?q?m1CskDZtx/DbMbztG5bNIWbZkLfnY7l971dQyA09zNBZ+Z1UEKoMIOz8WkDvrt?=
 =?us-ascii?q?zUFBw5PBKuw+bhFtp90pkSWWWVAq+WKK/Sq0OH5vozI+mQY48YoDL9K/km5/Hw?=
 =?us-ascii?q?l3M4lkIdcLKt3ZsWbnC4A/tnL1+YYXrqntcOD2MKshAiQ+ztjV2ISSRTaGqqX6?=
 =?us-ascii?q?Ig+jE7D5qrDYfZSYCsnLyOxiC7EodWZmBbEF+MF3joep6AW/cNbiKSP8BgniYF?=
 =?us-ascii?q?VbinV48uyxWuuBXmxLpgK+re4jcYuo771Nhp++3Tkgk/9T5zD8uDyW2NTGZ0nm?=
 =?us-ascii?q?UORz8xx61/pU19ylGe0al3mfBYFNpT5+9XXQc+L5LT0+t6C9XqUALbYtiJUEqm?=
 =?us-ascii?q?QsmhATwpVN0x2N8OY0F+G9m4lBDMxSiqDqQRl7yKApw0763d02LwJ8Z713bJyq?=
 =?us-ascii?q?0hg0M6TctIMG2snrR/+BTLB47Vj0WZkL6ndacG0y7L7muDyWuOs1teUA5/SqjF?=
 =?us-ascii?q?WXEfZk3LrdX2/E/CTrmuCag5PQtF08KNNqxKatjxh1VcWPjjIMjeY362m2qoGB?=
 =?us-ascii?q?mH3K2MY5Twd2UdxirdDlMEnB4V/XqBMQg+BSKho2bFATxqFFLvZV7s8OZkpHO6?=
 =?us-ascii?q?SE800x+Fb0l727Wp/R4VgOSWS+kP0bIcpCchtzJ0EU6g0N3MFdqPuRBtfKVGbt?=
 =?us-ascii?q?M7+1dIy2TZuhd5PpyhKaBim1Effx52v0PoyxV4FIFAndI2o3MtyQp4MbiY309Z?=
 =?us-ascii?q?dzOEwZDwPaXaKnXz/BCqbK7WxlHe0daM9qcT8vg4rE/jvAWoFkok/HVqyN1V03?=
 =?us-ascii?q?qa5pXXAwseS5PxUkAr9xdko7HWeDUy54TR1Xd0K6m7rifC2841BOsi0huvZdNf?=
 =?us-ascii?q?P72LFQDsE8wWHdOhKPE3lFezaBIEP+dS9LAvMsOidvuG3rOrPel6kDKni2RH/J?=
 =?us-ascii?q?5y0kaW+yVgTe7I2o4Pw+uE0QufSzf8kFChv9j3mIBZfz0dAnCzyCnkBIFLYK1y?=
 =?us-ascii?q?cp0GCWOvI82x29V/iIThW39e9F6/GVwG3NWldgaVb1z4xQdQz1gYoWS7mSukyD?=
 =?us-ascii?q?x5iysprquD0yPU2eTtaR0HNnRNRGZ8l1fsIJG4gMwAU0iscgcmigGl5UH8x6VA?=
 =?us-ascii?q?oKR/Lm/TQVpHfiTsLmFiVLewuaSGY8JV9JwotiBXWvymYV+GUr79vwca0yT7Em?=
 =?us-ascii?q?pexTA3bTGrto/inxxnjmKQN3JzrHvfecFtyhbT/t3cRfhN3jUYQCl0kyXYBl+5?=
 =?us-ascii?q?P9Ox59Wbi4/DsvyiV2KmTpBTczPkzZmDtCu44m1mGwa/kOqwmt3kEAg61zH019?=
 =?us-ascii?q?9xWCXMrRb8ZJTr1qugPeJmeEloGEHz685gFo5ilYswgYka2WIGiZWN4XoHjWDz?=
 =?us-ascii?q?PM1b2K3ka3oBXzwLw9/T4AX+3E1jL3SJx5/2V3mHw8thYcW6bX0S2i4n889KD6?=
 =?us-ascii?q?KU5qRenSRpulq4sR7RYf9lkzce0/Qu6WQWg+EUuAU3yCWdDasfHU1ZPSzqihSJ?=
 =?us-ascii?q?4MqyrKRRZGazb7ew0FByksymDLGHugtcQmr2eo8+HS9s6cVyKFfM0Hzw6o7+Yt?=
 =?us-ascii?q?XRY8wctgaIkxjelehaM4w+luAFhSd8PWL9vHsly/M0jBB03JG6upSHJHtp/K6j?=
 =?us-ascii?q?HhFYMTj1bdsJ+j7xlaZegtqW34e3E5V9HTULWYHkTPOyHzIUqPTnLB2OEDwnp3?=
 =?us-ascii?q?efGLrfGxKf6Uh8o3LOFZCrK2+YJH0Dwdp+QxmdIVRVgBoIUzUigp45CgeqydT6?=
 =?us-ascii?q?f0hj4TAR4kP4pgFIyuJ1LBT/VmbfpAG1ajY7UpSfLRxW7h1c6EfRK8CR8uVzHy?=
 =?us-ascii?q?RA9J27sAONMnCbZxhPDWwRWEyLHVXjMae15dXa7+iUHOm+L+bNYbWTr+xRTeyI?=
 =?us-ascii?q?yImr0otn+TaMK8qOMmNjD/09xkpMQ3R5F97FlDUITiwdjzjNYNKDpBeg5i13qd?=
 =?us-ascii?q?iy8fTsWALy/IuPFqFdMdN19xCthqeDMeGQiT19KTZZ0JMM2HDJxKIe3F4UlyFh?=
 =?us-ascii?q?aT2tHa4cui7KSaLagrVXAAIDayNvKMtI6Lox3glTNs7aidP11b94guQ2C1dfUl?=
 =?us-ascii?q?zhld+mZdYXI2GmL17HAEeLNLKbJTzE2c33YKW8SaFOg+VQrRG/pTGbE0r7NDSZ?=
 =?us-ascii?q?izbpTwyvMf1LjCyDJhNepZqycgxzBmnjVt7mbhy7PcRzjT03x700m3zLOXQdMT?=
 =?us-ascii?q?h6b0NCsLmQ4TlEjfV4HmxL9mBlIvWcmyaF8+nYLY4bsedqAiRxje5V/G42xKdV?=
 =?us-ascii?q?7C5aQvx4gy/Srt9oo1G7neiD0DtnUBxSqjlVgIKHp1ltOaLc9pNYQ3bL4AoN7X?=
 =?us-ascii?q?mMCxQNv9ZkCsfgu6ZVytjOkqL8MDZD89LO8ssaCMjZM8aHMHsnMRr0Fz/YFgoF?=
 =?us-ascii?q?TTi3NW7Bg0xRiu2d9nqQrstylp+5tpcKS6dWHHY8EvkbQhBvFdgIIb90UykinL?=
 =?us-ascii?q?rdi9QHsz72gwPcS415pJfOVreyCO/zLT+fxe1LfRYHwrPQKYUVK5313FFkZlBm?=
 =?us-ascii?q?nYPMXU3KUoYJ6hZhcwY06GZN+X42GnYzxkvlQgCg+nkeEbizhBFgzkNXZe0rvA?=
 =?us-ascii?q?zw7k0xbg7RuCYqlmErnsrhiDadNj74Nrm5R40QBibp4Qx5EJT7SgA9TQqsmkho?=
 =?us-ascii?q?fGPGQLJYiZNjeHpthQuavoFAT7oUb6RJYhgXw/7fRPQtmQBXriSiz0VNo+jEDL?=
 =?us-ascii?q?NtkQIrddinqHcWn0pJYdg3LKnRIuJpw0JKi6SVtS+t1+wtiFsUKkAN2GCfYigF?=
 =?us-ascii?q?vAoDLLA9Jyuu8apr8wPU33N5f2cBTbITv/tm7EQmc7CayC3tyadrNkH3POuaee?=
 =?us-ascii?q?fRnmHGiIanS04s30ZAw0xK9KVq2MILeE2YWkky1ryLHlIOL8WUbUkfasNI6HnV?=
 =?us-ascii?q?Oz6DrejX2p9zF4KnH+vsQKmFs6NeyhahFRw1HoJK9skdE4O33UfwKt3uJ7oIjx?=
 =?us-ascii?q?4q4VKvbH+MFugBRhuN2B4cuMq/wdcj15dUIDgGGm59PA2+7bORoRUl1r7LedY1?=
 =?us-ascii?q?bz8xXpEFLW43VYXuniVZpXVbEDifyO8VyAGeqTT7o3KURBz1c8ZjaejcWhJoA9?=
 =?us-ascii?q?amsWEg8qyymHbW9JvELm33PNgkvcXAv6dSjJGDCvUcbLB7+2TdnYYQE3etV2/J?=
 =?us-ascii?q?V920IZfYYIAqatr1AX++FFe4jmRmYd32OYOEKLWSiA6gZptRuZPT4i0nNNS9H3?=
 =?us-ascii?q?lKEhFtvegM579UdQwHYpwrJxXvslJtZOSEPA6E34D2EC6WIjxMQqwalL3iag?=
 =?us-ascii?q?=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0ANAAAzIAhch0O0hNFkDg4BAQEEAQEHB?=
 =?us-ascii?q?AEBgVEHAQELAYEwKiaBXAQLJwqHNgOET4tESoINFIh+jjqBJANMEwEYEwGEQAK?=
 =?us-ascii?q?DESI0CQ0BAwEBAQEBAQIBEwEBAQgNCQgpIwyCNiQBgmEBAQEBAwECJBMGAQE3A?=
 =?us-ascii?q?QUGAwEBAQEIEQQBAR8JBwMeERQJCAIEAQkEBQUDgk5LgWoDFAEBAgKbKAKKB4F?=
 =?us-ascii?q?sM4J2AQEFgQQBAYN8DQuCCQgUjAoRBoFAP4FXghc1gleBcz6DLoImiRGCE4pMi?=
 =?us-ascii?q?jouCY4Ug0aRL4kJhXaJWAIEAgQFAg0BAQWBRoINMxoIGxWDJ4IbNYM4gxaHAgQ?=
 =?us-ascii?q?BNnIBgQQBASGHboEuAYEeAQE?=
X-IPAS-Result: =?us-ascii?q?A0ANAAAzIAhch0O0hNFkDg4BAQEEAQEHBAEBgVEHAQELAYE?=
 =?us-ascii?q?wKiaBXAQLJwqHNgOET4tESoINFIh+jjqBJANMEwEYEwGEQAKDESI0CQ0BAwEBA?=
 =?us-ascii?q?QEBAQIBEwEBAQgNCQgpIwyCNiQBgmEBAQEBAwECJBMGAQE3AQUGAwEBAQEIEQQ?=
 =?us-ascii?q?BAR8JBwMeERQJCAIEAQkEBQUDgk5LgWoDFAEBAgKbKAKKB4FsM4J2AQEFgQQBA?=
 =?us-ascii?q?YN8DQuCCQgUjAoRBoFAP4FXghc1gleBcz6DLoImiRGCE4pMijouCY4Ug0aRL4k?=
 =?us-ascii?q?JhXaJWAIEAgQFAg0BAQWBRoINMxoIGxWDJ4IbNYM4gxaHAgQBNnIBgQQBASGHb?=
 =?us-ascii?q?oEuAYEeAQE?=
X-IronPort-AV: E=Sophos;i="5.56,319,1539673200"; 
   d="scan'208";a="65489482"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mga01b.intel.com with ESMTP; 05 Dec 2018 11:01:28 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728280AbeLETB1 (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Wed, 5 Dec 2018 14:01:27 -0500
Received: from mail-eopbgr780082.outbound.protection.outlook.com ([40.107.78.82]:9324
        "EHLO NAM03-BY2-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1727257AbeLETB1 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Wed, 5 Dec 2018 14:01:27 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=xilinx.onmicrosoft.com; s=selector1-xilinx-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=3t/93saH7cFdXWSMTIAz5V0rKKd/CEFRQG0Vb9mVVm8=;
 b=qJyC1z8YMO6X5KRh0hrjY6zQ/vaY0W0prZ+gJUKNVBpXk4aLvALgTXq7DhFHSQ1otLnSFTOXhA5qXMWsOcFAZ0CzazzvDxZNmq0BMIoY/aqDQ8d2E9QR7KuozcyNGovkbGaHvKrKPpC9MVDEtPHFUtUrAHw3tSvgTObqt98Ntzk=
Received: from BL0PR02MB5633.namprd02.prod.outlook.com (20.177.241.80) by
 BL0PR02MB4964.namprd02.prod.outlook.com (52.132.14.142) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1382.22; Wed, 5 Dec 2018 19:01:13 +0000
Received: from BL0PR02MB5633.namprd02.prod.outlook.com
 ([fe80::68ed:9ca9:c7da:d76d]) by BL0PR02MB5633.namprd02.prod.outlook.com
 ([fe80::68ed:9ca9:c7da:d76d%2]) with mapi id 15.20.1404.019; Wed, 5 Dec 2018
 19:01:12 +0000
From: Anurag Kumar Vulisha <anuragku@xilinx.com>
To: Felipe Balbi <balbi@kernel.org>,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
        Shuah Khan <shuah@kernel.org>,
        Alan Stern <stern@rowland.harvard.edu>,
        Johan Hovold <johan@kernel.org>,
        Jaejoong Kim <climbbb.kim@gmail.com>,
        Benjamin Herrenschmidt <benh@kernel.crashing.org>,
        Roger Quadros <rogerq@ti.com>,
        Manu Gautam <mgautam@codeaurora.org>,
        "martin.petersen@oracle.com" <martin.petersen@oracle.com>,
        Bart Van Assche <bvanassche@acm.org>,
        Mike Christie <mchristi@redhat.com>,
        Matthew Wilcox <willy@infradead.org>,
        Colin Ian King <colin.king@canonical.com>
CC: "linux-usb@vger.kernel.org" <linux-usb@vger.kernel.org>,
        "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
        "v.anuragkumar@gmail.com" <v.anuragkumar@gmail.com>,
        Thinh Nguyen <thinhn@synopsys.com>,
        Tejas Joglekar <tejas.joglekar@synopsys.com>,
        Ajay Yugalkishore Pandey <APANDEY@xilinx.com>
Subject: RE: [PATCH v7 09/10] usb: dwc3: Check for IOC/LST bit in both
 event->status and TRB->ctrl fields
Thread-Topic: [PATCH v7 09/10] usb: dwc3: Check for IOC/LST bit in both
 event->status and TRB->ctrl fields
Thread-Index: AQHUiWbqDI9WfI74TEmPyd+V2NlqDqVv4SkAgACgrWA=
Date: Wed, 5 Dec 2018 19:01:12 +0000
Message-ID: <BL0PR02MB563352F83A80E3B92347A7A4A7A80@BL0PR02MB5633.namprd02.prod.outlook.com>
References: <1543662811-5194-1-git-send-email-anurag.kumar.vulisha@xilinx.com>
 <1543662811-5194-10-git-send-email-anurag.kumar.vulisha@xilinx.com>
 <875zw82vfj.fsf@linux.intel.com>
In-Reply-To: <875zw82vfj.fsf@linux.intel.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-Auto-Response-Suppress: DR, RN, NRN, OOF, AutoReply
X-MS-TNEF-Correlator: 
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=anuragku@xilinx.com; 
x-originating-ip: [182.18.177.170]
x-ms-publictraffictype: Email
x-microsoft-exchange-diagnostics: 1;BL0PR02MB4964;6:wWpvqMkuUxkJjxw70njNAYKfGODYs31zAgAy+H1/XORnfKvS3Mu/hC9/mSoVwq7QFMZoe/axyKUzx95zUetKtNSyFUTJNSyt7gdWSkkGDOSdFU4Y+NJ57VpHUEACDvgm0BV0FAKwe8nhfbNHnapZvbZXZeGGtfgxdim3b2X7c3nhYvtwQDqFwykSn44UVzcMSSg56FdPO0xhwmBuv+UgG7MM42GukYz2yin1zswSEfGKx54ujg+5FFwIR+UidyVphOd1IzcWiL5NyxLHdv0Km+haeOcMi3IhCANw3Xntzs0137GtvLr+E8wZxKPiW16dI99c8pM5rCUZW1ww0Rue2TilockD07U4cSafInnu71HD4ezSf4Ni4i4xJ5EymiLv6sbmVwqCWNz8wj/uRZHIu1ynAjZd88wJu2ytbiNUQP8PG8ay8tAJWKzMpPmp/y2rFkRD+aoBdRfMgnOLFAuWPQ==;5:0uJk40TtgI+4RylwOgbxKyrPjkTEpJ03yvSHAnuGiBqbf7DxUy8QlBa1B7eFKrKYQs6gv0I754oMMEN9swmXYw8uGTzTK6sAqqUNWuo3nT86KubGbUiv7+05ijh28ypYZCXD1MOjb0Yt059ziGbnpIQLrfUo5p7XRLnSoB3Onhg=;7:BMYhOG/LC9/IJ+SX64o4Y0FZUuW9NU6Os1X2DMOM9EAyw9aapDH+ecFzDUcxI17VDmBpaBcI5tXLCXLeHLdGtqh2Pytm8s8n7iXoWGbP0dAux+B82pGi6dJvwkNZ2HoeA0bnQxb1ejWIZWVguB1TKg==
x-ms-office365-filtering-correlation-id: 1b58e590-74db-4711-816a-08d65ae4069f
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0;PCL:0;RULEID:(2390098)(7020095)(4652040)(8989299)(5600074)(711020)(4618075)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(2017052603328)(7153060)(7193020);SRVR:BL0PR02MB4964;
x-ms-traffictypediagnostic: BL0PR02MB4964:
x-ld-processed: 657af505-d5df-48d0-8300-c31994686c5c,ExtAddr
x-microsoft-antispam-prvs: <BL0PR02MB4964CBBF4BB8317F1B123356A7A80@BL0PR02MB4964.namprd02.prod.outlook.com>
x-ms-exchange-senderadcheck: 1
x-exchange-antispam-report-cfa-test: BCL:0;PCL:0;RULEID:(8211001083)(6040522)(2401047)(8121501046)(5005006)(93006095)(93001095)(3231455)(999002)(944501520)(52105112)(3002001)(10201501046)(6055026)(148016)(149066)(150057)(6041310)(20161123562045)(201703131423095)(201702281528075)(20161123555045)(201703061421075)(201703061406153)(20161123564045)(20161123560045)(20161123558120)(201708071742011)(7699051)(76991095);SRVR:BL0PR02MB4964;BCL:0;PCL:0;RULEID:;SRVR:BL0PR02MB4964;
x-forefront-prvs: 08770259B4
x-forefront-antispam-report: SFV:NSPM;SFS:(10009020)(396003)(136003)(366004)(376002)(346002)(39860400002)(13464003)(52084003)(199004)(189003)(6246003)(39060400002)(229853002)(5660300001)(81156014)(7696005)(53936002)(2171002)(99286004)(33656002)(4326008)(7416002)(54906003)(9686003)(25786009)(2906002)(102836004)(81166006)(105586002)(106356001)(6506007)(26005)(186003)(8676002)(8936002)(71200400001)(71190400001)(107886003)(76176011)(68736007)(305945005)(256004)(486006)(11346002)(74316002)(55016002)(86362001)(446003)(476003)(66066001)(110136005)(2501003)(7736002)(14444005)(478600001)(316002)(3846002)(97736004)(14454004)(6116002)(6436002)(921003)(1121003);DIR:OUT;SFP:1101;SCL:1;SRVR:BL0PR02MB4964;H:BL0PR02MB5633.namprd02.prod.outlook.com;FPR:;SPF:None;LANG:en;PTR:InfoNoRecords;A:1;MX:1;
x-microsoft-antispam-message-info: X5oSukz1tEeZQLr8aqEdSjOQqi0j3A4vBaASCoTR0PxWMwLFcuva9Ze7sdMqpU7tOsbiXWeYQ/zirbpy4E9g2DGCQ8hT2pY73mz6IDIWEKqSiOVcAK5p/5CyQY30zFM8BlELQ90SsMTM2aKJXLyQxZZtRdlGBUa32TBRmvjlOqujtYrbtrtQ9Xfn68x6huJzEgvKDayOReoZEamCWCHzpihWBh5jBj5rOUKWcT5h+GCAS6NZN1oaCfDfZtBuCuVqwnnAscM4KPbAbZ5UZF2l8DN5E8Bq3P/4R+98c185ZqNjqueQ5Hr4//yTfj7PzSI1Z9Pc00SFxQGcgzYUcuRkdtXiQXURVkuBvsTSyFzbAo0=
spamdiagnosticoutput: 1:99
spamdiagnosticmetadata: NSPM
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-OriginatorOrg: xilinx.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 1b58e590-74db-4711-816a-08d65ae4069f
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Dec 2018 19:01:12.7682
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 657af505-d5df-48d0-8300-c31994686c5c
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BL0PR02MB4964
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org


Hi Felipe,
>-----Original Message-----
>From: Felipe Balbi [mailto:balbi@kernel.org]
>Sent: Wednesday, December 05, 2018 2:38 PM
>To: Anurag Kumar Vulisha <anuragku@xilinx.com>; Greg Kroah-Hartman
><gregkh@linuxfoundation.org>; Shuah Khan <shuah@kernel.org>; Alan Stern
><stern@rowland.harvard.edu>; Johan Hovold <johan@kernel.org>; Jaejoong Kim
><climbbb.kim@gmail.com>; Benjamin Herrenschmidt <benh@kernel.crashing.org>=
;
>Roger Quadros <rogerq@ti.com>; Manu Gautam <mgautam@codeaurora.org>;
>martin.petersen@oracle.com; Bart Van Assche <bvanassche@acm.org>; Mike
>Christie <mchristi@redhat.com>; Matthew Wilcox <willy@infradead.org>; Coli=
n Ian
>King <colin.king@canonical.com>
>Cc: linux-usb@vger.kernel.org; linux-kernel@vger.kernel.org;
>v.anuragkumar@gmail.com; Thinh Nguyen <thinhn@synopsys.com>; Tejas Jogleka=
r
><tejas.joglekar@synopsys.com>; Ajay Yugalkishore Pandey <APANDEY@xilinx.co=
m>;
>Anurag Kumar Vulisha <anuragku@xilinx.com>
>Subject: Re: [PATCH v7 09/10] usb: dwc3: Check for IOC/LST bit in both eve=
nt->status
>and TRB->ctrl fields
>
>
>Hi,
>
>Anurag Kumar Vulisha <anurag.kumar.vulisha@xilinx.com> writes:
>> The present code in dwc3_gadget_ep_reclaim_completed_trb() will check
>> for IOC/LST bit in the event->status and returns if IOC/LST bit is
>> set. This logic doesn't work if multiple TRBs are queued per
>> request and the IOC/LST bit is set on the last TRB of that request.
>> Consider an example where a queued request has multiple queued TRBs
>> and IOC/LST bit is set only for the last TRB. In this case, the Core
>> generates XferComplete/XferInProgress events only for the last TRB
>> (since IOC/LST are set only for the last TRB). As per the logic in
>> dwc3_gadget_ep_reclaim_completed_trb() event->status is checked for
>> IOC/LST bit and returns on the first TRB. This makes the remaining
>> TRBs left unhandled.
>> To aviod this, changed the code to check for IOC/LST bits in both
>> event->status & TRB->ctrl. This patch does the same.
>>
>> Signed-off-by: Anurag Kumar Vulisha <anurag.kumar.vulisha@xilinx.com>
>> Reviewed-by: Thinh Nguyen <thinhn@synopsys.com>
>> Tested-by: Tejas Joglekar <tejas.joglekar@synopsys.com>
>> ---
>>  Changes in v7:
>> 	1. None
>>
>>  Changes in v6:
>> 	1. None
>>
>>  Changes in v5:
>> 	1. None
>>
>>  Changes in v4:
>> 	1. None
>>
>>  Changes in v3:
>> 	1. None
>>
>>  Changes in v2:
>> 	1. None
>> ---
>>  drivers/usb/dwc3/gadget.c | 7 ++++++-
>>  1 file changed, 6 insertions(+), 1 deletion(-)
>>
>> diff --git a/drivers/usb/dwc3/gadget.c b/drivers/usb/dwc3/gadget.c
>> index 9ddc9fd..216179e 100644
>> --- a/drivers/usb/dwc3/gadget.c
>> +++ b/drivers/usb/dwc3/gadget.c
>> @@ -2286,7 +2286,12 @@ static int
>dwc3_gadget_ep_reclaim_completed_trb(struct dwc3_ep *dep,
>>  	if (event->status & DEPEVT_STATUS_SHORT && !chain)
>>  		return 1;
>>
>> -	if (event->status & (DEPEVT_STATUS_IOC | DEPEVT_STATUS_LST))
>> +	if ((event->status & DEPEVT_STATUS_IOC) &&
>> +	    (trb->ctrl & DWC3_TRB_CTRL_IOC))
>> +		return 1;
>
>this shouldn't be necessary. According to databook, event->status
>contains the bits from the completed TRB.  Which means that
>event->status & IOC will always be equal to trb->ctrl & IOC.
>
Thanks for reviewing this patch. Lets consider an example where a request
has num_sgs > 0 and each sg is mapped to a TRB and the last TRB has the
IOC bit set. Once the controller is done with the transfer, it  generates=20
XferInProgress for the last TRB (since IOC bit is set). As a part of trb re=
claim
process  dwc3_gadget_ep_reclaim_trb_sg() calls
dwc3_gadget_ep_reclaim_completed_trb() for req->num_sgs times. Since
the event already has the IOC bit set, the loop is exited from the loop at =
the
very first TRB and the remaining TRBs (mapped to the sglist) are left unhan=
dled.
To avoid this we modified the code to exit only if both TRB & event has the=
 IOC
bit set.
=20
>Can you further describe the situation here? Perhaps share tracepoints
>exposing the problem?

Sure, will capture the traces and reply back

Thanks,
Anurag Kumar Vulisha
