Return-Path: <xen-devel-bounces@lists.xenproject.org>
Delivered-To: unknown
Received: from pop3.zju.edu.cn (61.164.42.155:110) by
  likexu-MOBL1.ccr.corp.intel.com with POP3; 21 Nov 2018 11:01:19 -0000
Received: from icoremail.net (unknown [209.85.214.169])
	by mail-app2 (Coremail) with SMTP id by_KCgD3_yfCMfVb3xHHAQ--.58403S3;
	Wed, 21 Nov 2018 18:21:54 +0800 (CST)
Received: from mail-pl1-f169.google.com (unknown [209.85.214.169])
	by mx2.icoremail.net (Coremail) with SMTP id AQAAfwCnhUG8MfVbiNhiAA--.1402S3;
	Wed, 21 Nov 2018 18:21:48 +0800 (CST)
Received: by mail-pl1-f169.google.com with SMTP id x21-v6so4879729pln.9
        for <xuliker@zju.edu.cn>; Wed, 21 Nov 2018 02:21:48 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-original-authentication-results:x-gm-message-state:delivered-to
         :from:to:date:message-id:in-reply-to:references:mime-version:subject
         :precedence:list-id:list-unsubscribe:list-post:list-help
         :list-subscribe:cc:content-transfer-encoding:errors-to:sender;
        bh=9ConPnXNFmptgE/n7FuFC4a86EAW00347VDD/vgg59U=;
        b=as4XINo4LCEQCDNuTCTFzhdNRhEHDk694I5rxv1nL2D3rrnGDBwAzz+1wrmhBfbIMU
         hKJTK+oyxlLaj0wLi4FRfkrm0WVW9xT4XYUhbgWtqzwCf5ubdf2VvWOqMmRz6FrfObFL
         3TfZkR15/5ucJV9vWQYKpVgaYDYV+4v139vd6PYvatfZau9vvU/rqKIpdiQeQsgHiOMq
         vHbQdXt8szknhkthxgteHaTyATDaOGG69H8C21zHydEbNqDxE26szo64TeQkp113PTfY
         hfUxWHOIfJvWaZkWL2pCymzPHqyY7JnKUbQikO5h+TGJNNV/4gU7/v7cXZruQYasTr8z
         Y53w==
X-Original-Authentication-Results: mx.google.com;       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
X-Gm-Message-State: AA+aEWbuvCF+MrJVlAaKGXc6f8RkRqe7hVCOLngdoY5LzcXS3m/S6C8U
	lDPNvw+qfhGby5wPp11warDtNDsjIMPOqBnmnBmz35RCtk5GOlA=
X-Received: by 2002:a63:4613:: with SMTP id t19-v6mr5467029pga.197.1542795708371;
        Wed, 21 Nov 2018 02:21:48 -0800 (PST)
X-Forwarded-To: xuliker@zju.edu.cn
X-Forwarded-For: liker.xu@gmail.com xuliker@zju.edu.cn
Delivered-To: liker.xu@gmail.com
Received: by 2002:a17:90a:d106:0:0:0:0 with SMTP id l6-v6csp1756249pju;
        Wed, 21 Nov 2018 02:21:47 -0800 (PST)
X-Google-Smtp-Source: AJdET5cmhPLRv8mTW6lBs1xRlrwIAkfE/z98H6JwVfy7sQsyB5noxBQUNAQgN5wzaANjQNXnUhGF
X-Received: by 2002:a81:2082:: with SMTP id g124mr5682705ywg.481.1542795707330;
        Wed, 21 Nov 2018 02:21:47 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1542795707; cv=none;
        d=google.com; s=arc-20160816;
        b=crIDFQcSP9DUQyLdRlzN9bqSramXNbjgvAhQh1235u9pjtny4O3g6AUtWNaOlOUc3j
         fh74EFlOYhmXcdmUOtB+jDF4CbKX5bW6Vb52g3jgYkMFjwsPQgk1+68cCbvIfeAhJjz0
         2pBhIUNSSUTmRdFJyjPfxo8mp3F7zshmHB3EZluAc8VZ4oXL0BRlINSg864XSDxq8BGA
         bAXT3IfStMrfScS2RWggv/zCUiKlPG83FXAWdQtaDW67jWS8E617r3kiis6Tx4hGLkb8
         LzKtqvHnzS+9UjiFuO5nLA5XEePfLi9PTqblrXPkA0wZzQcRZIR5eziP2W1p45yWm2Wn
         wp/g==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-unsubscribe:list-id:precedence:subject
         :mime-version:references:in-reply-to:message-id:date:to:from;
        bh=9ConPnXNFmptgE/n7FuFC4a86EAW00347VDD/vgg59U=;
        b=SbopWx1i3wkmIBHbYGe8kD+XMPxpUGZGmh791SLDAiDB3+6J6SunW2Oi7oMOyNTe1z
         84/gRvtIdpniF7dXR2TwWSbEWRXoVKCxk/AL0FIZ94TAST5z7rieUZH0p7v6q5YJcClF
         bSYwyAmYDFk+SAIP9OMxVu3NBvztI3H9obI9f0uHfF6LbYCTLLPy1xnmnTUNmlbULsq1
         +sNQiRdQp6cglGVaCEG6wOVoc2F1CuOUmhnvim/AZShfz5pKnRntjgNP8fa7fS296PFp
         QC2XkxW6dvfcSvNUhfWbEhhtwgFPMbEj48K0PdXXya3rNy0llVgTybfoE3Kt6HRSkJ+y
         K0eQ==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) smtp.mailfrom=xen-devel-bounces@lists.xenproject.org
Received: from lists.xenproject.org (lists.xenproject.org. [192.237.175.120])
        by mx.google.com with ESMTPS id f67si17300339ywb.244.2018.11.21.02.21.46
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 21 Nov 2018 02:21:47 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of xen-devel-bounces@lists.xenproject.org designates 192.237.175.120 as permitted sender) client-ip=192.237.175.120;
Received: from localhost ([127.0.0.1] helo=lists.xenproject.org)
	by lists.xenproject.org with esmtp (Exim 4.89)
	(envelope-from <xen-devel-bounces@lists.xenproject.org>)
	id 1gPPc3-0001co-SD; Wed, 21 Nov 2018 10:20:03 +0000
Received: from all-amaz-eas1.inumbo.com ([34.197.232.57]
 helo=us1-amaz-eas2.inumbo.com)
 by lists.xenproject.org with esmtp (Exim 4.89) (envelope-from
 <SRS0=RqMg=OA=bitdefender.com=rcojocaru@srs-us1.protection.inumbo.net>)
 id 1gPPc2-0001Xt-Ep
 for xen-devel@lists.xenproject.org; Wed, 21 Nov 2018 10:20:02 +0000
X-Inumbo-ID: 00d2bb54-ed77-11e8-834d-12d6303a7972
Received: from mx01.bbu.dsd.mx.bitdefender.com (unknown [91.199.104.161])
 by us1-amaz-eas2.inumbo.com (Halon) with ESMTPS
 id 00d2bb54-ed77-11e8-834d-12d6303a7972;
 Wed, 21 Nov 2018 10:20:01 +0000 (UTC)
Received: from smtp.bitdefender.com (smtp01.buh.bitdefender.com [10.17.80.75])
 by mx01.bbu.dsd.mx.bitdefender.com (Postfix) with ESMTPS id
 AB4C4305FFB0; Wed, 21 Nov 2018 12:19:58 +0200 (EET)
Received: from rcojocaru.npunix.bitdefender.biz (unknown [10.17.12.174])
 by smtp.bitdefender.com (Postfix) with ESMTPSA id 7D6A23084EF4;
 Wed, 21 Nov 2018 12:19:58 +0200 (EET)
From: Razvan Cojocaru <rcojocaru@bitdefender.com>
To: xen-devel@lists.xenproject.org
Date: Wed, 21 Nov 2018 12:19:52 +0200
Message-Id: <1542795594-4252-6-git-send-email-rcojocaru@bitdefender.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1542795594-4252-1-git-send-email-rcojocaru@bitdefender.com>
References: <1542795594-4252-1-git-send-email-rcojocaru@bitdefender.com>
MIME-Version: 1.0
Subject: [Xen-devel] [PATCH V8 5/7] x86/altp2m: fix display frozen when
 switching to a new view early
X-BeenThere: xen-devel@lists.xenproject.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Xen developer discussion <xen-devel.lists.xenproject.org>
List-Unsubscribe: <https://lists.xenproject.org/mailman/options/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=unsubscribe>
List-Post: <mailto:xen-devel@lists.xenproject.org>
List-Help: <mailto:xen-devel-request@lists.xenproject.org?subject=help>
List-Subscribe: <https://lists.xenproject.org/mailman/listinfo/xen-devel>,
 <mailto:xen-devel-request@lists.xenproject.org?subject=subscribe>
Cc: Kevin Tian <kevin.tian@intel.com>, Wei Liu <wei.liu2@citrix.com>,
 Jun Nakajima <jun.nakajima@intel.com>,
 Razvan Cojocaru <rcojocaru@bitdefender.com>,
 George Dunlap <george.dunlap@eu.citrix.com>,
 Andrew Cooper <andrew.cooper3@citrix.com>, Jan Beulich <jbeulich@suse.com>,
 =?UTF-8?q?Roger=20Pau=20Monn=C3=A9?= <roger.pau@citrix.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: xen-devel-bounces@lists.xenproject.org
Sender: liker.xu+caf_=xuliker=zju.edu.cn@gmail.com
X-CM-TRANSID: AQAAfwCnhUG8MfVbiNhiAA--.1402S3
Authentication-Results: mail-app2; spf=pass smtp.mail=liker.xu+caf_=xu
	liker=zju.edu.cn@gmail.com;
X-Coremail-Antispam: 1UD129KBjvJXoW3tF18uF1Dur1fCFy3JrWkJFb_yoWDCrW5pF
	yYyrn8WF45tFW2ga1fGws8ZrWYy3yxWF95GFZ3t345t342qF17Wr4I9w1UCr18GF93ZF1F
	ya4fKF1UCayjyaDanT9S1TB71UUUUUUqnTZGkaVYY2UrUUUU0bIjqfuFe4nvWSU8nxnvy2
	9KBjDU0xBIdaVrnRJUUUlab7Iv0xC_Kw4lb4IE77IF4wAFF20E14v26r1j6r4UM7CIcVAF
	z4kK6r1j6r18M28lY4IEw2IIxxk0rwA2F7IY1VAKz4vEj48ve4kI8wA2z4x0Y4vE2Ix0cI
	8IcVAFwI0_Ar0_tr1l84ACjcxK6xIIjxv20xvEc7CjxVAFwI0_Cr0_Gr1UM28EF7xvwVC2
	z280aVAFwI0_GcCE3s1l84ACjcxK6I8E87Iv6xkF7I0E14v26rxl6s0DM2vj6VCEFcxC0V
	AYjxAxZF0EFcxC0VAYjxAxZF0Ew4CEw7xC0VCjxxvEa2IrM2AIxVAIcxkEcVAq07x20xvE
	ncxIr21l5I8CrVACY4xI64kE6c02F40Ex7xfMcIj6xIIjxv20xvE14v26r1Y6r17McIj6I
	8E87Iv67AKxVWxJVW8Jr1lOx8S6xCaFVCjc4AY6r1j6r4UM4x0Y48IcxkI7VAKI48JM4xv
	F2IEb7IF0Fy264kE64k0F24l7I0Y6sxI4wCY1x0264kExVAvwVAq07x20xylc7Ca8VAvwV
	CFzxkY4VCF77xAMxkIecxEwVCI4VW8twCY0x0Ix7I2Y4AK64vIr41lcIIF0xvE2Ix0cI8I
	cVAFwI0_Ar0_tr1lcIIF0xvE2Ix0cI8IcVCY1x0267AKxVWxJVW8Jr1lcIIF0xvEx4A2js
	IE14v26F4UJVW0owCYIxAIcVC2z280aVCY1x0267AKxVWxJr0_GcWl42xK82IYc2Ij64vI
	r41l42xK82IY64kExVAvwVAq07x20xyl4x8a6x804xWl4I8I3I0E4IkC6x0Yz7v_Jr0_Gr
	1lx2IqxVAqx4xG67AKxVWUJVWUGwC20s026x8GjcxK67AKxVWUGVWUWwC2zVAF1VAY17CE
	14v26r1q6r43MIIYrxkI7VAKI48JMIIF0xvE42xK8VAvwI8IcIk0rVWUJVWUCwCE64xvF2
	IEb7IF0Fy7YxBIdaVFxhVjvjDU0xZFpf9x07barWwUUUUU=

V2hlbiBhbiBuZXcgYWx0cDJtIHZpZXcgaXMgY3JlYXRlZCB2ZXJ5IGVhcmx5IG9uIGd1ZXN0IGJv
b3QsIHRoZQpkaXNwbGF5IHdpbGwgZnJlZXplIChhbHRob3VnaCB0aGUgZ3Vlc3Qgd2lsbCBydW4g
bm9ybWFsbHkpLiBUaGlzCm1heSBhbHNvIGhhcHBlbiBvbiByZXNpemluZyB0aGUgZGlzcGxheS4g
VGhlIHJlYXNvbiBpcyB0aGUgd2F5ClhlbiBjdXJyZW50bHkgKG1pcyloYW5kbGVzIGxvZ2RpcnR5
IFZHQTogaXQgaW50ZW50aW9uYWxseQptaXNjb25maWd1cmVzIFZHQSBwYWdlcyBzbyB0aGF0IHRo
ZXkgd2lsbCBmYXVsdC4KClRoZSBwcm9ibGVtIGlzIHRoYXQgaXQgb25seSBkb2VzIHRoaXMgaW4g
dGhlIGhvc3QgcDJtLiBPbmNlIHdlCnN3aXRjaCB0byBhIG5ldyBhbHRwMm0sIHRoZSBtaXNjb25m
aWd1cmVkIGVudHJpZXMgd2lsbCBubyBsb25nZXIKZmF1bHQsIHNvIHRoZSBkaXNwbGF5IHdpbGwg
bm90IGJlIHVwZGF0ZWQuCgpUaGlzIHBhdGNoOgoqIHVwZGF0ZXMgZXB0X2hhbmRsZV9taXNjb25m
aWcoKSB0byB1c2UgdGhlIGFjdGl2ZSBhbHRwMm0gaW5zdGVhZAogIG9mIHRoZSBob3N0cDJtOwoq
IG1vZGlmaWVzIHAybV9jaGFuZ2VfZW50cnlfdHlwZV9nbG9iYWwoKSwKICBwMm1fbWVtb3J5X3R5
cGVfY2hhbmdlZCgpLCBwMm1fY2hhbmdlX3R5cGVfcmFuZ2UoKSBhbmQKICBwMm1fZmluaXNoX3R5
cGVfY2hhbmdlKCkgdG8gcHJvcGFnYXRlIHRoZWlyIGNoYW5nZXMgdG8gYWxsCiAgdmFsaWQgYWx0
cDJtcy4KCldpdGggdGhlIGludHJvZHVjdGlvbiBvZiBhbHRwMm0gZmllbGRzIGluIHAybV9tZW1v
cnlfdHlwZV9jaGFuZ2VkKCkKdGhlIHdob2xlIGZ1bmN0aW9uIGhhcyBiZWVuIHB1dCB1bmRlciBD
T05GSUdfSFZNLgoKU3VnZ2VzdGVkLWJ5OiBHZW9yZ2UgRHVubGFwIDxnZW9yZ2UuZHVubGFwQGNp
dHJpeC5jb20+ClNpZ25lZC1vZmYtYnk6IFJhenZhbiBDb2pvY2FydSA8cmNvam9jYXJ1QGJpdGRl
ZmVuZGVyLmNvbT4KCi0tLQpDQzogSnVuIE5ha2FqaW1hIDxqdW4ubmFrYWppbWFAaW50ZWwuY29t
PgpDQzogS2V2aW4gVGlhbiA8a2V2aW4udGlhbkBpbnRlbC5jb20+CkNDOiBHZW9yZ2UgRHVubGFw
IDxnZW9yZ2UuZHVubGFwQGV1LmNpdHJpeC5jb20+CkNDOiBKYW4gQmV1bGljaCA8amJldWxpY2hA
c3VzZS5jb20+CkNDOiBBbmRyZXcgQ29vcGVyIDxhbmRyZXcuY29vcGVyM0BjaXRyaXguY29tPgpD
QzogV2VpIExpdSA8d2VpLmxpdTJAY2l0cml4LmNvbT4KQ0M6ICJSb2dlciBQYXUgTW9ubsOpIiA8
cm9nZXIucGF1QGNpdHJpeC5jb20+CgotLS0KQ2hhbmdlcyBzaW5jZSBWNzoKIC0gUmV2ZXJzZWQg
dGFnIG9yZGVyIChzdWdnZXN0ZWQgYnkgSmFuIEJldWxpY2gpLgotLS0KIHhlbi9hcmNoL3g4Ni9t
bS9wMm0tZXB0LmMgfCAgIDkgKystCiB4ZW4vYXJjaC94ODYvbW0vcDJtLXB0LmMgIHwgICA4ICsr
KwogeGVuL2FyY2gveDg2L21tL3AybS5jICAgICB8IDE2NSArKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKy0tLS0tLS0tCiB4ZW4vaW5jbHVkZS9hc20teDg2L3AybS5oIHwgICA2
ICstCiA0IGZpbGVzIGNoYW5nZWQsIDE1NyBpbnNlcnRpb25zKCspLCAzMSBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS94ZW4vYXJjaC94ODYvbW0vcDJtLWVwdC5jIGIveGVuL2FyY2gveDg2L21t
L3AybS1lcHQuYwppbmRleCBmYWJjZDA2Li4zNmU2NDhjIDEwMDY0NAotLS0gYS94ZW4vYXJjaC94
ODYvbW0vcDJtLWVwdC5jCisrKyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0tZXB0LmMKQEAgLTY1Nyw2
ICs2NTcsOSBAQCBib29sX3QgZXB0X2hhbmRsZV9taXNjb25maWcodWludDY0X3QgZ3BhKQogICAg
IGJvb2xfdCBzcHVyaW91czsKICAgICBpbnQgcmM7CiAKKyAgICBpZiAoIGFsdHAybV9hY3RpdmUo
Y3Vyci0+ZG9tYWluKSApCisgICAgICAgIHAybSA9IHAybV9nZXRfYWx0cDJtKGN1cnIpOworCiAg
ICAgcDJtX2xvY2socDJtKTsKIAogICAgIHNwdXJpb3VzID0gY3Vyci0+YXJjaC5odm0udm14LmVw
dF9zcHVyaW91c19taXNjb25maWc7CkBAIC0xNDQwLDkgKzE0NDMsMTMgQEAgdm9pZCBwMm1faW5p
dF9hbHRwMm1fZXB0KHN0cnVjdCBkb21haW4gKmQsIHVuc2lnbmVkIGludCBpKQogICAgIHN0cnVj
dCBwMm1fZG9tYWluICpob3N0cDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOwogICAgIHN0cnVjdCBl
cHRfZGF0YSAqZXB0OwogCisgICAgcDJtLT5kZWZhdWx0X2FjY2VzcyA9IGhvc3RwMm0tPmRlZmF1
bHRfYWNjZXNzOworICAgIHAybS0+ZG9tYWluID0gaG9zdHAybS0+ZG9tYWluOworCisgICAgcDJt
LT5nbG9iYWxfbG9nZGlydHkgPSBob3N0cDJtLT5nbG9iYWxfbG9nZGlydHk7CiAgICAgcDJtLT5l
cHQuYWQgPSBob3N0cDJtLT5lcHQuYWQ7CiAgICAgcDJtLT5taW5fcmVtYXBwZWRfZ2ZuID0gZ2Zu
X3goSU5WQUxJRF9HRk4pOwotICAgIHAybS0+bWF4X3JlbWFwcGVkX2dmbiA9IDA7CisgICAgcDJt
LT5tYXhfbWFwcGVkX3BmbiA9IHAybS0+bWF4X3JlbWFwcGVkX2dmbiA9IDA7CiAgICAgZXB0ID0g
JnAybS0+ZXB0OwogICAgIGVwdC0+bWZuID0gcGFnZXRhYmxlX2dldF9wZm4ocDJtX2dldF9wYWdl
dGFibGUocDJtKSk7CiAgICAgZC0+YXJjaC5hbHRwMm1fZXB0cFtpXSA9IGVwdC0+ZXB0cDsKZGlm
ZiAtLWdpdCBhL3hlbi9hcmNoL3g4Ni9tbS9wMm0tcHQuYyBiL3hlbi9hcmNoL3g4Ni9tbS9wMm0t
cHQuYwppbmRleCA1NWRmMTg1Li4zODI4MDg4IDEwMDY0NAotLS0gYS94ZW4vYXJjaC94ODYvbW0v
cDJtLXB0LmMKKysrIGIveGVuL2FyY2gveDg2L21tL3AybS1wdC5jCkBAIC0yOSw2ICsyOSw3IEBA
CiAjaW5jbHVkZSA8eGVuL2V2ZW50Lmg+CiAjaW5jbHVkZSA8eGVuL3RyYWNlLmg+CiAjaW5jbHVk
ZSA8cHVibGljL3ZtX2V2ZW50Lmg+CisjaW5jbHVkZSA8YXNtL2FsdHAybS5oPgogI2luY2x1ZGUg
PGFzbS9kb21haW4uaD4KICNpbmNsdWRlIDxhc20vcGFnZS5oPgogI2luY2x1ZGUgPGFzbS9wYWdp
bmcuaD4KQEAgLTQ2NCw2ICs0NjUsMTMgQEAgaW50IHAybV9wdF9oYW5kbGVfZGVmZXJyZWRfY2hh
bmdlcyh1aW50NjRfdCBncGEpCiAgICAgc3RydWN0IHAybV9kb21haW4gKnAybSA9IHAybV9nZXRf
aG9zdHAybShjdXJyZW50LT5kb21haW4pOwogICAgIGludCByYzsKIAorICAgIC8qCisgICAgICog
U2hvdWxkIGFsdHAybSBldmVyIGJlIGVuYWJsZWQgZm9yIE5QVCAvIHNoYWRvdyB1c2UsIHRoaXMg
Y29kZQorICAgICAqIHNob3VsZCBiZSB1cGRhdGVkIHRvIG1ha2UgdXNlIG9mIHRoZSBhY3RpdmUg
YWx0cDJtLCBsaWtlCisgICAgICogZXB0X2hhbmRsZV9taXNjb25maWcoKS4KKyAgICAgKi8KKyAg
ICBBU1NFUlQoIWFsdHAybV9hY3RpdmUoY3VycmVudC0+ZG9tYWluKSk7CisKICAgICBwMm1fbG9j
ayhwMm0pOwogICAgIHJjID0gZG9fcmVjYWxjKHAybSwgUEZOX0RPV04oZ3BhKSk7CiAgICAgcDJt
X3VubG9jayhwMm0pOwpkaWZmIC0tZ2l0IGEveGVuL2FyY2gveDg2L21tL3AybS5jIGIveGVuL2Fy
Y2gveDg2L21tL3AybS5jCmluZGV4IDk3NzM0OTUuLjgyM2ZlYjQgMTAwNjQ0Ci0tLSBhL3hlbi9h
cmNoL3g4Ni9tbS9wMm0uYworKysgYi94ZW4vYXJjaC94ODYvbW0vcDJtLmMKQEAgLTI3Nyw3ICsy
NzcsNiBAQCBpbnQgcDJtX2luaXQoc3RydWN0IGRvbWFpbiAqZCkKIGludCBwMm1faXNfbG9nZGly
dHlfcmFuZ2Uoc3RydWN0IHAybV9kb21haW4gKnAybSwgdW5zaWduZWQgbG9uZyBzdGFydCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBlbmQpCiB7Ci0gICAgQVNTRVJU
KHAybV9pc19ob3N0cDJtKHAybSkpOwogICAgIGlmICggcDJtLT5nbG9iYWxfbG9nZGlydHkgfHwK
ICAgICAgICAgIHJhbmdlc2V0X2NvbnRhaW5zX3JhbmdlKHAybS0+bG9nZGlydHlfcmFuZ2VzLCBz
dGFydCwgZW5kKSApCiAgICAgICAgIHJldHVybiAxOwpAQCAtMjg2LDMxICsyODUsNzkgQEAgaW50
IHAybV9pc19sb2dkaXJ0eV9yYW5nZShzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLCB1bnNpZ25lZCBs
b25nIHN0YXJ0LAogICAgIHJldHVybiAwOwogfQogCitzdGF0aWMgdm9pZCBjaGFuZ2VfZW50cnlf
dHlwZV9nbG9iYWwoc3RydWN0IHAybV9kb21haW4gKnAybSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwMm1fdHlwZV90IG90LCBwMm1fdHlwZV90IG50KQoreworICAgIHAy
bS0+Y2hhbmdlX2VudHJ5X3R5cGVfZ2xvYmFsKHAybSwgb3QsIG50KTsKKyAgICBwMm0tPmdsb2Jh
bF9sb2dkaXJ0eSA9IChudCA9PSBwMm1fcmFtX2xvZ2RpcnR5KTsKK30KKwogdm9pZCBwMm1fY2hh
bmdlX2VudHJ5X3R5cGVfZ2xvYmFsKHN0cnVjdCBkb21haW4gKmQsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcDJtX3R5cGVfdCBvdCwgcDJtX3R5cGVfdCBudCkKIHsKLSAgICBz
dHJ1Y3QgcDJtX2RvbWFpbiAqcDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOworICAgIHN0cnVjdCBw
Mm1fZG9tYWluICpob3N0cDJtID0gcDJtX2dldF9ob3N0cDJtKGQpOwogCiAgICAgQVNTRVJUKG90
ICE9IG50KTsKICAgICBBU1NFUlQocDJtX2lzX2NoYW5nZWFibGUob3QpICYmIHAybV9pc19jaGFu
Z2VhYmxlKG50KSk7CiAKLSAgICBwMm1fbG9jayhwMm0pOwotICAgIHAybS0+Y2hhbmdlX2VudHJ5
X3R5cGVfZ2xvYmFsKHAybSwgb3QsIG50KTsKLSAgICBwMm0tPmdsb2JhbF9sb2dkaXJ0eSA9IChu
dCA9PSBwMm1fcmFtX2xvZ2RpcnR5KTsKLSAgICBwMm1fdW5sb2NrKHAybSk7CisgICAgcDJtX2xv
Y2soaG9zdHAybSk7CisKKyAgICBjaGFuZ2VfZW50cnlfdHlwZV9nbG9iYWwoaG9zdHAybSwgb3Qs
IG50KTsKKworI2lmZGVmIENPTkZJR19IVk0KKyAgICBpZiAoIHVubGlrZWx5KGFsdHAybV9hY3Rp
dmUoZCkpICkKKyAgICB7CisgICAgICAgIHVuc2lnbmVkIGludCBpOworCisgICAgICAgIGZvciAo
IGkgPSAwOyBpIDwgTUFYX0FMVFAyTTsgaSsrICkKKyAgICAgICAgICAgIGlmICggZC0+YXJjaC5h
bHRwMm1fZXB0cFtpXSAhPSBtZm5feChJTlZBTElEX01GTikgKQorICAgICAgICAgICAgeworICAg
ICAgICAgICAgICAgIHN0cnVjdCBwMm1fZG9tYWluICphbHRwMm0gPSBkLT5hcmNoLmFsdHAybV9w
Mm1baV07CisKKyAgICAgICAgICAgICAgICBwMm1fbG9jayhhbHRwMm0pOworICAgICAgICAgICAg
ICAgIGNoYW5nZV9lbnRyeV90eXBlX2dsb2JhbChhbHRwMm0sIG90LCBudCk7CisgICAgICAgICAg
ICAgICAgcDJtX3VubG9jayhhbHRwMm0pOworICAgICAgICAgICAgfQorICAgIH0KKyNlbmRpZgor
CisgICAgcDJtX3VubG9jayhob3N0cDJtKTsKK30KKworI2lmZGVmIENPTkZJR19IVk0KKy8qIFRo
ZXJlJ3MgYWxyZWFkeSBhIG1lbW9yeV90eXBlX2NoYW5nZWQoKSBpbiBhc20vbXRyci5oLiAqLwor
c3RhdGljIHZvaWQgX21lbW9yeV90eXBlX2NoYW5nZWQoc3RydWN0IHAybV9kb21haW4gKnAybSkK
K3sKKyAgICBpZiAoIHAybS0+bWVtb3J5X3R5cGVfY2hhbmdlZCApCisgICAgICAgIHAybS0+bWVt
b3J5X3R5cGVfY2hhbmdlZChwMm0pOwogfQogCiB2b2lkIHAybV9tZW1vcnlfdHlwZV9jaGFuZ2Vk
KHN0cnVjdCBkb21haW4gKmQpCiB7Ci0gICAgc3RydWN0IHAybV9kb21haW4gKnAybSA9IHAybV9n
ZXRfaG9zdHAybShkKTsKKyAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqaG9zdHAybSA9IHAybV9nZXRf
aG9zdHAybShkKTsKIAotICAgIGlmICggcDJtLT5tZW1vcnlfdHlwZV9jaGFuZ2VkICkKKyAgICBw
Mm1fbG9jayhob3N0cDJtKTsKKworICAgIF9tZW1vcnlfdHlwZV9jaGFuZ2VkKGhvc3RwMm0pOwor
CisgICAgaWYgKCB1bmxpa2VseShhbHRwMm1fYWN0aXZlKGQpKSApCiAgICAgewotICAgICAgICBw
Mm1fbG9jayhwMm0pOwotICAgICAgICBwMm0tPm1lbW9yeV90eXBlX2NoYW5nZWQocDJtKTsKLSAg
ICAgICAgcDJtX3VubG9jayhwMm0pOworICAgICAgICB1bnNpZ25lZCBpbnQgaTsKKworICAgICAg
ICBmb3IgKCBpID0gMDsgaSA8IE1BWF9BTFRQMk07IGkrKyApCisgICAgICAgICAgICBpZiAoIGQt
PmFyY2guYWx0cDJtX2VwdHBbaV0gIT0gbWZuX3goSU5WQUxJRF9NRk4pICkKKyAgICAgICAgICAg
IHsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqYWx0cDJtID0gZC0+YXJjaC5h
bHRwMm1fcDJtW2ldOworCisgICAgICAgICAgICAgICAgcDJtX2xvY2soYWx0cDJtKTsKKyAgICAg
ICAgICAgICAgICBfbWVtb3J5X3R5cGVfY2hhbmdlZChhbHRwMm0pOworICAgICAgICAgICAgICAg
IHAybV91bmxvY2soYWx0cDJtKTsKKyAgICAgICAgICAgIH0KICAgICB9CisKKyAgICBwMm1fdW5s
b2NrKGhvc3RwMm0pOwogfQorI2VuZGlmCiAKIGludCBwMm1fc2V0X2lvcmVxX3NlcnZlcihzdHJ1
Y3QgZG9tYWluICpkLAogICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBmbGFn
cywKQEAgLTk5MSwxOCArMTAzOCwxNCBAQCBpbnQgcDJtX2NoYW5nZV90eXBlX29uZShzdHJ1Y3Qg
ZG9tYWluICpkLCB1bnNpZ25lZCBsb25nIGdmbl9sLAogfQogCiAvKiBNb2RpZnkgdGhlIHAybSB0
eXBlIG9mIGEgcmFuZ2Ugb2YgZ2ZucyBmcm9tIG90IHRvIG50LiAqLwotdm9pZCBwMm1fY2hhbmdl
X3R5cGVfcmFuZ2Uoc3RydWN0IGRvbWFpbiAqZCwgCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICB1bnNpZ25lZCBsb25nIHN0YXJ0LCB1bnNpZ25lZCBsb25nIGVuZCwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHAybV90eXBlX3Qgb3QsIHAybV90eXBlX3QgbnQpCitzdGF0aWMgdm9pZCBj
aGFuZ2VfdHlwZV9yYW5nZShzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBzdGFydCwgdW5zaWduZWQgbG9uZyBlbmQsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMm1fdHlwZV90IG90LCBwMm1fdHlwZV90IG50
KQogewogICAgIHVuc2lnbmVkIGxvbmcgZ2ZuID0gc3RhcnQ7Ci0gICAgc3RydWN0IHAybV9kb21h
aW4gKnAybSA9IHAybV9nZXRfaG9zdHAybShkKTsKKyAgICBzdHJ1Y3QgZG9tYWluICpkID0gcDJt
LT5kb21haW47CiAgICAgaW50IHJjID0gMDsKIAotICAgIEFTU0VSVChvdCAhPSBudCk7Ci0gICAg
QVNTRVJUKHAybV9pc19jaGFuZ2VhYmxlKG90KSAmJiBwMm1faXNfY2hhbmdlYWJsZShudCkpOwot
Ci0gICAgcDJtX2xvY2socDJtKTsKICAgICBwMm0tPmRlZmVyX25lc3RlZF9mbHVzaCA9IDE7CiAK
ICAgICBpZiAoIHVubGlrZWx5KGVuZCA+IHAybS0+bWF4X21hcHBlZF9wZm4pICkKQEAgLTEwNDYs
MjMgKzEwODksNTQgQEAgdm9pZCBwMm1fY2hhbmdlX3R5cGVfcmFuZ2Uoc3RydWN0IGRvbWFpbiAq
ZCwKICAgICBwMm0tPmRlZmVyX25lc3RlZF9mbHVzaCA9IDA7CiAgICAgaWYgKCBuZXN0ZWRodm1f
ZW5hYmxlZChkKSApCiAgICAgICAgIHAybV9mbHVzaF9uZXN0ZWRwMm0oZCk7Ci0gICAgcDJtX3Vu
bG9jayhwMm0pOworfQorCit2b2lkIHAybV9jaGFuZ2VfdHlwZV9yYW5nZShzdHJ1Y3QgZG9tYWlu
ICpkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBzdGFydCwgdW5z
aWduZWQgbG9uZyBlbmQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBwMm1fdHlwZV90IG90
LCBwMm1fdHlwZV90IG50KQoreworICAgIHN0cnVjdCBwMm1fZG9tYWluICpob3N0cDJtID0gcDJt
X2dldF9ob3N0cDJtKGQpOworCisgICAgQVNTRVJUKG90ICE9IG50KTsKKyAgICBBU1NFUlQocDJt
X2lzX2NoYW5nZWFibGUob3QpICYmIHAybV9pc19jaGFuZ2VhYmxlKG50KSk7CisKKyAgICBwMm1f
bG9jayhob3N0cDJtKTsKKworICAgIGNoYW5nZV90eXBlX3JhbmdlKGhvc3RwMm0sIHN0YXJ0LCBl
bmQsIG90LCBudCk7CisKKyNpZmRlZiBDT05GSUdfSFZNCisgICAgaWYgKCB1bmxpa2VseShhbHRw
Mm1fYWN0aXZlKGQpKSApCisgICAgeworICAgICAgICB1bnNpZ25lZCBpbnQgaTsKKworICAgICAg
ICBmb3IgKCBpID0gMDsgaSA8IE1BWF9BTFRQMk07IGkrKyApCisgICAgICAgICAgICBpZiAoIGQt
PmFyY2guYWx0cDJtX2VwdHBbaV0gIT0gbWZuX3goSU5WQUxJRF9NRk4pICkKKyAgICAgICAgICAg
IHsKKyAgICAgICAgICAgICAgICBzdHJ1Y3QgcDJtX2RvbWFpbiAqYWx0cDJtID0gZC0+YXJjaC5h
bHRwMm1fcDJtW2ldOworCisgICAgICAgICAgICAgICAgcDJtX2xvY2soYWx0cDJtKTsKKyAgICAg
ICAgICAgICAgICBjaGFuZ2VfdHlwZV9yYW5nZShhbHRwMm0sIHN0YXJ0LCBlbmQsIG90LCBudCk7
CisgICAgICAgICAgICAgICAgcDJtX3VubG9jayhhbHRwMm0pOworICAgICAgICAgICAgfQorICAg
IH0KKyNlbmRpZgorCisgICAgcDJtX3VubG9jayhob3N0cDJtKTsKIH0KIAogLyoKICAqIEZpbmlz
aCBwMm0gdHlwZSBjaGFuZ2UgZm9yIGdmbnMgd2hpY2ggYXJlIG1hcmtlZCBhcyBuZWVkX3JlY2Fs
YyBpbiBhIHJhbmdlLgorICogVXNlcyB0aGUgY3VycmVudCBwMm0ncyBtYXhfbWFwcGVkX3BmbiB0
byBmdXJ0aGVyIGNsaXAgdGhlIGludmFsaWRhdGlvbgorICogcmFuZ2UgZm9yIGFsdGVybmF0ZSBw
Mm1zLgogICogUmV0dXJuczogMC8xIGZvciBzdWNjZXNzLCBuZWdhdGl2ZSBmb3IgZmFpbHVyZQog
ICovCi1pbnQgcDJtX2ZpbmlzaF90eXBlX2NoYW5nZShzdHJ1Y3QgZG9tYWluICpkLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZ2ZuX3QgZmlyc3RfZ2ZuLCB1bnNpZ25lZCBsb25nIG1heF9u
cikKK3N0YXRpYyBpbnQgZmluaXNoX3R5cGVfY2hhbmdlKHN0cnVjdCBwMm1fZG9tYWluICpwMm0s
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZm5fdCBmaXJzdF9nZm4sIHVuc2lnbmVk
IGxvbmcgbWF4X25yKQogewotICAgIHN0cnVjdCBwMm1fZG9tYWluICpwMm0gPSBwMm1fZ2V0X2hv
c3RwMm0oZCk7CiAgICAgdW5zaWduZWQgbG9uZyBnZm4gPSBnZm5feChmaXJzdF9nZm4pOwogICAg
IHVuc2lnbmVkIGxvbmcgbGFzdF9nZm4gPSBnZm4gKyBtYXhfbnIgLSAxOwogICAgIGludCByYyA9
IDA7CiAKLSAgICBwMm1fbG9jayhwMm0pOwotCiAgICAgbGFzdF9nZm4gPSBtaW4obGFzdF9nZm4s
IHAybS0+bWF4X21hcHBlZF9wZm4pOwogICAgIHdoaWxlICggZ2ZuIDw9IGxhc3RfZ2ZuICkKICAg
ICB7CkBAIC0xMDc3LDE0ICsxMTUxLDUxIEBAIGludCBwMm1fZmluaXNoX3R5cGVfY2hhbmdlKHN0
cnVjdCBkb21haW4gKmQsCiAgICAgICAgIGVsc2UgaWYgKCByYyA8IDAgKQogICAgICAgICB7CiAg
ICAgICAgICAgICBnZHByaW50ayhYRU5MT0dfRVJSLCAicDJtLT5yZWNhbGMgZmFpbGVkISBEb20l
ZCBnZm49JWx4XG4iLAotICAgICAgICAgICAgICAgICAgICAgZC0+ZG9tYWluX2lkLCBnZm4pOwor
ICAgICAgICAgICAgICAgICAgICAgcDJtLT5kb21haW4tPmRvbWFpbl9pZCwgZ2ZuKTsKICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICB9CiAKICAgICAgICAgZ2ZuKys7CiAgICAgfQogCi0gICAg
cDJtX3VubG9jayhwMm0pOworICAgIHJldHVybiByYzsKK30KKworaW50IHAybV9maW5pc2hfdHlw
ZV9jaGFuZ2Uoc3RydWN0IGRvbWFpbiAqZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIGdm
bl90IGZpcnN0X2dmbiwgdW5zaWduZWQgbG9uZyBtYXhfbnIpCit7CisgICAgc3RydWN0IHAybV9k
b21haW4gKmhvc3RwMm0gPSBwMm1fZ2V0X2hvc3RwMm0oZCk7CisgICAgaW50IHJjOworCisgICAg
cDJtX2xvY2soaG9zdHAybSk7CisKKyAgICByYyA9IGZpbmlzaF90eXBlX2NoYW5nZShob3N0cDJt
LCBmaXJzdF9nZm4sIG1heF9ucik7CisKKyAgICBpZiAoICFyYyApCisgICAgICAgIGdvdG8gb3V0
OworCisjaWZkZWYgQ09ORklHX0hWTQorICAgIGlmICggdW5saWtlbHkoYWx0cDJtX2FjdGl2ZShk
KSkgKQorICAgIHsKKyAgICAgICAgdW5zaWduZWQgaW50IGk7CisKKyAgICAgICAgZm9yICggaSA9
IDA7IGkgPCBNQVhfQUxUUDJNOyBpKysgKQorICAgICAgICAgICAgaWYgKCBkLT5hcmNoLmFsdHAy
bV9lcHRwW2ldICE9IG1mbl94KElOVkFMSURfTUZOKSApCisgICAgICAgICAgICB7CisgICAgICAg
ICAgICAgICAgc3RydWN0IHAybV9kb21haW4gKmFsdHAybSA9IGQtPmFyY2guYWx0cDJtX3AybVtp
XTsKKworICAgICAgICAgICAgICAgIHAybV9sb2NrKGFsdHAybSk7CisgICAgICAgICAgICAgICAg
cmMgPSBmaW5pc2hfdHlwZV9jaGFuZ2UoYWx0cDJtLCBmaXJzdF9nZm4sIG1heF9ucik7CisgICAg
ICAgICAgICAgICAgcDJtX3VubG9jayhhbHRwMm0pOworCisgICAgICAgICAgICAgICAgaWYgKCAh
cmMgKQorICAgICAgICAgICAgICAgICAgICBnb3RvIG91dDsKKyAgICAgICAgICAgIH0KKyAgICB9
CisjZW5kaWYKKworb3V0OgorICAgIHAybV91bmxvY2soaG9zdHAybSk7CiAKICAgICByZXR1cm4g
cmM7CiB9CmRpZmYgLS1naXQgYS94ZW4vaW5jbHVkZS9hc20teDg2L3AybS5oIGIveGVuL2luY2x1
ZGUvYXNtLXg4Ni9wMm0uaAppbmRleCBiNTJmZWZkLi5mMzUzZGNkIDEwMDY0NAotLS0gYS94ZW4v
aW5jbHVkZS9hc20teDg2L3AybS5oCisrKyBiL3hlbi9pbmNsdWRlL2FzbS14ODYvcDJtLmgKQEAg
LTYyNyw5ICs2MjcsNiBAQCBpbnQgcDJtX2ZpbmlzaF90eXBlX2NoYW5nZShzdHJ1Y3QgZG9tYWlu
ICpkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2ZuX3QgZmlyc3RfZ2ZuLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBtYXhfbnIpOwogCi0vKiBSZXBvcnQg
YSBjaGFuZ2UgYWZmZWN0aW5nIG1lbW9yeSB0eXBlcy4gKi8KLXZvaWQgcDJtX21lbW9yeV90eXBl
X2NoYW5nZWQoc3RydWN0IGRvbWFpbiAqZCk7Ci0KIGludCBwMm1faXNfbG9nZGlydHlfcmFuZ2Uo
c3RydWN0IHAybV9kb21haW4gKiwgdW5zaWduZWQgbG9uZyBzdGFydCwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBlbmQpOwogCkBAIC02NjAsNiArNjU3LDkgQEAgdm9p
ZCBwMm1fcG9kX2R1bXBfZGF0YShzdHJ1Y3QgZG9tYWluICpkKTsKIAogI2lmZGVmIENPTkZJR19I
Vk0KIAorLyogUmVwb3J0IGEgY2hhbmdlIGFmZmVjdGluZyBtZW1vcnkgdHlwZXMuICovCit2b2lk
IHAybV9tZW1vcnlfdHlwZV9jaGFuZ2VkKHN0cnVjdCBkb21haW4gKmQpOworCiAvKiBDYWxsZWQg
YnkgcDJtIGNvZGUgd2hlbiBkZW1hbmQtcG9wdWxhdGluZyBhIFBvRCBwYWdlICovCiBib29sCiBw
Mm1fcG9kX2RlbWFuZF9wb3B1bGF0ZShzdHJ1Y3QgcDJtX2RvbWFpbiAqcDJtLCBnZm5fdCBnZm4s
IHVuc2lnbmVkIGludCBvcmRlcik7Ci0tIAoyLjcuNAoKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fClhlbi1kZXZlbCBtYWlsaW5nIGxpc3QKWGVuLWRldmVs
QGxpc3RzLnhlbnByb2plY3Qub3JnCmh0dHBzOi8vbGlzdHMueGVucHJvamVjdC5vcmcvbWFpbG1h
bi9saXN0aW5mby94ZW4tZGV2ZWw=
