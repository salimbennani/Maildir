Return-Path: <linux-kernel-owner@vger.kernel.org>
Delivered-To: unknown
Received: from linux.intel.com (10.54.29.200:995) by likexu-workstation with
  POP3-SSL; 10 Dec 2018 08:55:49 -0000
X-Original-To: like.xu@linux.intel.com
Delivered-To: like.xu@linux.intel.com
Received: from fmsmga004.fm.intel.com (fmsmga004.fm.intel.com [10.253.24.48])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by linux.intel.com (Postfix) with ESMTPS id AC8145805FF;
	Sun,  9 Dec 2018 09:24:14 -0800 (PST)
Received: from fmsmga102.fm.intel.com ([10.1.193.69])
  by fmsmga004-1.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 09 Dec 2018 09:24:14 -0800
X-SG-BADATTACHMENTNOREPLY: True
IronPort-PHdr: =?us-ascii?q?9a23=3Agq+FlBbIhmptqzl6EbMjDJ3/LSx+4OfEezUN459i?=
 =?us-ascii?q?sYplN5qZpcm5Yh7h7PlgxGXEQZ/co6odzbaO4+a4ASQp2tWoiDg6aptCVhsI24?=
 =?us-ascii?q?09vjcLJ4q7M3D9N+PgdCcgHc5PBxdP9nC/NlVJSo6lPwWB6nK94iQPFRrhKAF7?=
 =?us-ascii?q?Ovr6GpLIj8Swyuu+54Dfbx9HiTahYr5+Ngm6oRnMvcQKnIVuLbo8xAHUqXVSYe?=
 =?us-ascii?q?RWwm1oJVOXnxni48q74YBu/SdNtf8/7sBMSar1cbg2QrxeFzQmLns65Nb3uhnZ?=
 =?us-ascii?q?TAuA/WUTX2MLmRdVGQfF7RX6XpDssivms+d2xSeXMdHqQb0yRD+v9LlgRgP2hy?=
 =?us-ascii?q?gbNj456GDXhdJ2jKJHuxKquhhzz5fJbI2JKPZye6XQctQHS2pcRcZRTzJODZ+g?=
 =?us-ascii?q?b4UBCOoBOPxXr4j7p1ATqRezCg2hCObpxzRVhHH5wLc63vwvHw/GwgIuAtEAsH?=
 =?us-ascii?q?rbo9rpKagdU+66zLLQzTjBdP5W1ivx5ZLSfxw9u/yAQ7R9etfRx0k1EAPFi02d?=
 =?us-ascii?q?p5b/MDOLyOsNt3WQ4e16Wu2zi24otQJxqSWoy8c0kIbJmJwaylTf+CVk3Ik0K8?=
 =?us-ascii?q?e0R1J6YNO9FpZbqi+UN4xzQsw4QmFovj43yrkHuZ6lYicKypMnxwPFa/yBaYeI?=
 =?us-ascii?q?5gjvW/qWITd9nH5qZK+/hxCz8US61uL9V8+520tJoCpditTAqGwB2hjJ5sSaRP?=
 =?us-ascii?q?Zx4F2t1SuM2gzP8O1JIEI5mbLGJ5MlwrM8jIcfvVnNEyPshkn7jbWaelgg9+Wm?=
 =?us-ascii?q?7ensf6/oqYWGN4BujwHzKqQuldK7AeQ/KgUOQWeb9vqm1LH5/k32Xq9Kjvsona?=
 =?us-ascii?q?ndqpzaIt4bpqGhDw9U1IYs9Qq/Ai+43NgEmXQLNk9JdRyZg4TzJl3DI+z0Ae2+?=
 =?us-ascii?q?jlmuiDtrwurJPrzlApXDNHjDl7LhcK55605dzgoz0N9e64tXCr4fOvLzXFH+tN?=
 =?us-ascii?q?jBAh8+PQ20xfjoCM9m24MAVmKAHLWZPLnRsVCW/OIvJfeDZIsPtDb6Mfgl6Obi?=
 =?us-ascii?q?jWUlll8FYampwZwXZWi8HvRnIEWWf2Dgg9gcEWoRugo+TerqiECNUDJJZnayWb?=
 =?us-ascii?q?486S8/CI68EYjDQYWtiqSb3CinBp1WenxGCleUHHfobYqEWusMZziVIsN7kjwE?=
 =?us-ascii?q?SKKuS4ku1Ry1sA/6yrxnLvfb+yECtJLj0sR16PPXlR0o6TN0CMGd2XmXT25ohm?=
 =?us-ascii?q?MIWyM23KdnrEx/zVeMz7J0g/9fFdxV4fNJVRw3NZrdz+x8FtDzVRjNftaPSFa6?=
 =?us-ascii?q?XNqmBSs9Qc42w98Le0x9Acmtjgjf3yq2BL8Yj6aEBIc08qLb3Hj9Pdx9xGzE1K?=
 =?us-ascii?q?Q6i1kmQ81PNXCph6Jl9gjTAZLJnFudl6qwaasc2yvN/n+ZzWWSpEFYTBJwUaLd?=
 =?us-ascii?q?UHAcfETWq8715kfDT7C0D7QnPRBMycqDKqtMd93ogk9KRPblONTCfW2xn328Cg?=
 =?us-ascii?q?qPxrOJdIDqYXkS3D3BCEgYlAAe5WuJOhIgBii/uW7eDCZhFVT0Y0zy9+lyr3e7?=
 =?us-ascii?q?TkwxzwGOdEBh07u1+hgIhf2TUf8T37QEuDs/pDVwBlqyw9XWC9+YrQp7YKpcec?=
 =?us-ascii?q?894EtA1W/BqgNyJIKgIL54il4eaQt3uVju2AtxCohblcgqrXUqzBd9KK6C0VNB?=
 =?us-ascii?q?cS+Y0o70OrHNNmby+xWvYbbM2l7CyNaW5rsP6PMgplX/vQGpE00i82ln09hVyX?=
 =?us-ascii?q?ec+o/GDA0IUZL1U0Y38Rd6qqreYik84YPUyHJtPbO1sj/Ex9ImGu8lxgy8cNdY?=
 =?us-ascii?q?NaOODBXyHNECB8iyNOwqnECkYQgAPO9M+687IcOne+Gd1662IelvhjSmjWdA4I?=
 =?us-ascii?q?BjyU+M8yt8SujV35cK2f2Y3w2HVyvig1elqMz4hYdEZTQKFGql1SfkHJJRZrF1?=
 =?us-ascii?q?fYsTCWauPte7yclki5/sW35X7lijB1wd1c+teBqSaUH93AJK2UQWp3ynhTW3zz?=
 =?us-ascii?q?hunz41qaqf2TTEw/7+exofJm5LWG5igE/2IYi1k98VRlKoYBUulBe/40b12bJb?=
 =?us-ascii?q?pKVmI2bPW0hIezX5IH94Uqu3sLqPeMpP6JIusSVKX+Wwe1GaSrjhoxQE1yPvBX?=
 =?us-ascii?q?dRxDc+dzuyoJX2gwR6iH6BLHZ0tHfYecBwyQ3f5dDGXv5RwzwGSTJ8iTnWAFi8?=
 =?us-ascii?q?Itao8c+Vl5fFruCxSWahWodPfinsyIOKrDG76nFyAR2jg/CzncXqEQog3i/h1N?=
 =?us-ascii?q?lqViLIoAznYobx1KS6MuNnfk92C1/68Md6HoB+ko0thJAfw3Qah5OV/WYZnmf3?=
 =?us-ascii?q?K9lUxaX+bH8VTz4R39HV+BTl2FFkLn+Rx4P2THKdztFjZ9m7ZGMbwSY978FMCK?=
 =?us-ascii?q?eJ471Ihyp1olykrQ3PZfhxhCsSyfwr6HQCmeEGpBItzjmBArAVBURYPjbjlxWS?=
 =?us-ascii?q?49C+saVYfmCvcber2Up6nNChCqyCow5GVHb4fJciATF/7sFlPF3Q133z75nueM?=
 =?us-ascii?q?PMYtILqh2UjxDAgvBQKJIwlfoFnzBrOGzjsn0+1+40kwZu0oqks4idJGVg56a5?=
 =?us-ascii?q?Ah9eNj3oaMIf4DDtjaBCnsmI24CjBIluGjIOXJHwV/KnDCoStej7NwaJCDA8tn?=
 =?us-ascii?q?CbGb/FEQ6e8khmqW/PE4uwN3GWP3QZydRiRB+AJE1QmgwUXTM6noInGQCu3sDu?=
 =?us-ascii?q?bEB55jUJ7F7ithRM0v5oNwX4UmrHvwincDA0SJyCLBZM6gFC+lzYMcif7uJ1Ai?=
 =?us-ascii?q?FZ8YetrA2LKmyHeQtICXsFVVCDB1DmJrOu/8XP8/CEBuqiKPvDebeOpvZbV/iW?=
 =?us-ascii?q?3pKjyJdm8yyPNsWSPXliEvs71VBYXX1iH8TZmjMPSzEYli7Xbs6bogu89TNzrs?=
 =?us-ascii?q?yl7PvrXwfv75OVC7ROKdVv5wy2gaCbOu+QgyZ5NC9Y1o4Wyn/O0rQfx1kSiydh?=
 =?us-ascii?q?dzS2FbQAtCjNTL/fm6NNDh4bbT9zO9VM764mwgZNPsvbgMvv1rFklv41F0tFVV?=
 =?us-ascii?q?v5l8Gpe8MKImK9NFDGBEqRN7SGPzrLw87pbqOmVL1Ql/5ZtxmxuTadDk/iMS6P?=
 =?us-ascii?q?lzjvVxCzL+5MiDuXMwBZuIG4ahxtE3TsTMr6ah2nN996lSc5waAviXPQK2EdMS?=
 =?us-ascii?q?Jwc0dMrrCL6SNYg/N/G3FO73Z/LOmEnTqZ4PfcKpoMrfRrBSF0nfpA4Hsm07tV?=
 =?us-ascii?q?8D1ERPttlSvOr95upkuqnfWVxjV7UBpBtDBLiZmPvUVjP6XZ65ZBVWzF/BIL8W?=
 =?us-ascii?q?WfFRAKq8F5Bd3ovqBa0sLPm77rKDde79LU+tMRBsjOJ8KBNXohMBzpFybVDQsF?=
 =?us-ascii?q?VzGrM27fildZkPGT8H2Vs5c7poLtmJoIVr9USlg1GukGBURiGdxRaKtwCw8jl6?=
 =?us-ascii?q?/TqM8O6XWkoR+ZENlduIHvX+6VBPTjJXCSirwSNDUSxratFY0NO4mz/kVpalR5?=
 =?us-ascii?q?1NDSElTdWfhQqTInZR1i8xYFy2R3UmBmgxGtUQiq+nJGUKPtkw=3D=3D?=
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A0AFAADQTg1ch0O0hNFjFgUBAQEBAwEBA?=
 =?us-ascii?q?QcDAQEBgVEGAQEBCwGCaYECJ4h/gxSMDoINFI15NIkQgW0BFB0LCAGHXSI0CQ0?=
 =?us-ascii?q?BAwEBAQEBAQIBEwEBAQoLCQgpIwyCNiSCYwECAwECdgYJAQEKGAklAwwFGDETB?=
 =?us-ascii?q?YMcAYIBBAEKpxqISYFKD4JtiTQXgX+EI4MTCwOBH4N2giYCiTmXPAmCJYRjijw?=
 =?us-ascii?q?jClaBSY8UjhWMYYIOMxoIMIMnCYIeF4NKKIosPjMBAYEDAQGMbwEB?=
X-IPAS-Result: =?us-ascii?q?A0AFAADQTg1ch0O0hNFjFgUBAQEBAwEBAQcDAQEBgVEGAQE?=
 =?us-ascii?q?BCwGCaYECJ4h/gxSMDoINFI15NIkQgW0BFB0LCAGHXSI0CQ0BAwEBAQEBAQIBE?=
 =?us-ascii?q?wEBAQoLCQgpIwyCNiSCYwECAwECdgYJAQEKGAklAwwFGDETBYMcAYIBBAEKpxq?=
 =?us-ascii?q?ISYFKD4JtiTQXgX+EI4MTCwOBH4N2giYCiTmXPAmCJYRjijwjClaBSY8UjhWMY?=
 =?us-ascii?q?YIOMxoIMIMnCYIeF4NKKIosPjMBAYEDAQGMbwEB?=
X-IronPort-AV: E=Sophos;i="5.56,335,1539673200"; 
   d="asc'?scan'208";a="56161638"
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from vger.kernel.org ([209.132.180.67])
  by mtab.intel.com with ESMTP; 09 Dec 2018 09:24:13 -0800
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726183AbeLIRYH (ORCPT <rfc822;like.xu@linux.intel.com>
        + 23 others); Sun, 9 Dec 2018 12:24:07 -0500
Received: from atrey.karlin.mff.cuni.cz ([195.113.26.193]:35583 "EHLO
        atrey.karlin.mff.cuni.cz" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726078AbeLIRYH (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 9 Dec 2018 12:24:07 -0500
Received: by atrey.karlin.mff.cuni.cz (Postfix, from userid 512)
        id 3BC8D8076A; Sun,  9 Dec 2018 18:24:01 +0100 (CET)
Date: Sun, 9 Dec 2018 18:24:04 +0100
From: Pavel Machek <pavel@ucw.cz>
To: Tony Lindgren <tony@atomide.com>
Cc: kernel list <linux-kernel@vger.kernel.org>,
        linux-arm-kernel <linux-arm-kernel@lists.infradead.org>,
        linux-omap@vger.kernel.org, sre@kernel.org, nekit1000@gmail.com,
        mpartap@gmx.net, merlijn@wizzup.org
Subject: Re: Droid 4: poweroff does not work? calls
Message-ID: <20181209172404.GA4593@amd>
References: <20181209121318.GA24478@amd>
 <20181209164650.GX6707@atomide.com>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
        protocol="application/pgp-signature"; boundary="W/nzBZO5zC0uMSeA"
Content-Disposition: inline
In-Reply-To: <20181209164650.GX6707@atomide.com>
User-Agent: Mutt/1.5.23 (2014-03-12)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org


--W/nzBZO5zC0uMSeA
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Sun 2018-12-09 08:46:50, Tony Lindgren wrote:
> * Pavel Machek <pavel@ucw.cz> [181209 12:13]:
> > Hi!
> >=20
> > Poweroff does not seem to work on Motorola droid 4 -- it reboots. It
> > seems to be problem "forever", 4.18 and 4.20-rc5 seem to be
> > affected. It is bad, because when your battery is low, you get into
> > reboot loop and discharge it furher, which batteries do not like.
> >=20
> > Any ideas, or at least idea how to debug this?
>=20
> Hmm can you check if this is happening with usb unloaded or
> unbind? I suspect ohci or musb..

Ok, let me try: musb unbound, v4.20:

root@devuan:/sys/devices/platform/44000000.ocp/4a0ab000.usb_otg_hs#
echo 4a0ab000.usb_otg_hs > driver/unbind

(I hope I did not pull the USB too late). It rebooted instead of
poweroff. Now on 4.18:

root@devuan:/sys/devices/platform/44000000.ocp/4a062000.usbhstll# echo
4a062000.usbhstll > driver/unbind
root@devuan:/sys/devices/platform/44000000.ocp/4a062000.usbhstll#
uname -a
Linux devuan 4.18.0-rc4-88970-gf075a2c-dirty #764 SMP Mon Jul 9
12:51:47 CEST 2018 armv7l GNU/Linux

I get nice oops doing that:

[  170.705383] ------------[ cut here ]------------
[  170.710235] WARNING: CPU: 0 PID: 2371 at drivers/clk/clk.c:697
clk_core_unpre
pare+0xcc/0xec
[  170.718749] Unpreparing enabled l3_init_cm:clk:0048:8
[  170.723968] Modules linked in:

root@devuan:/sys/devices/platform/44000000.ocp/4a064000.usbhshost/4a064800.=
ohci#
echo 4a064800.ohci > driver/unbind

=2E.Hmm. I'm not sure how to unbind ehci. Let me try sudo
poweroff... no, it reboots, too.

Can you check if it works for you?

Thanks,
									Pavel
--=20
(english) http://www.livejournal.com/~pavelmachek
(cesky, pictures) http://atrey.karlin.mff.cuni.cz/~pavel/picture/horses/blo=
g.html

--W/nzBZO5zC0uMSeA
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iEYEARECAAYFAlwNT7QACgkQMOfwapXb+vKzBACffSEF6vwWVha2uJMPdeAzqeP5
J9IAoJgKqEA/LXbRGiTz5NFIuF3I6xAG
=1Tt9
-----END PGP SIGNATURE-----

--W/nzBZO5zC0uMSeA--
